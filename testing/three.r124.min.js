// threejs.org/license
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalthis?globalthis:t||self).three={})}(this,(function(t){"use strict";void 0===number.epsilon&&(number.epsilon=math.pow(2,-52)),void 0===number.isinteger&&(number.isinteger=function(t){return"number"==typeof t&&isfinite(t)&&math.floor(t)===t}),void 0===math.sign&&(math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in function.prototype==!1&&object.defineproperty(function.prototype,"name",{get:function(){return this.tostring().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===object.assign&&(object.assign=function(t){if(null==t)throw new typeerror("cannot convert undefined or null to object");for(var e=object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)object.prototype.hasownproperty.call(r,i)&&(e[i]=r[i])}return e});var e=100,n=300,r=301,i=302,a=303,o=304,s=306,c=307,l=1e3,u=1001,h=1002,d=1003,p=1004,f=1005,m=1006,v=1007,g=1008,y=1009,x=1012,_=1014,b=1015,w=1016,m=1020,s=1022,t=1023,e=1026,a=1027,l=33776,r=33777,c=33778,p=33779,i=35840,n=35841,d=35842,o=35843,b=37492,z=37496,f=2300,g=2301,u=2302,h=2400,k=2401,v=2402,w=2500,j=2501,q=3e3,x=3001,y=3007,z=3002,j=3004,q=3005,k=3006,$=7680,tt=35044,et=35048,nt="300 es";function rt(){}object.assign(rt.prototype,{addeventlistener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexof(e)&&n[t].push(e)},haseventlistener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexof(e)},removeeventlistener:function(t,e){if(void 0!==this._listeners){var n=this._listeners[t];if(void 0!==n){var r=n.indexof(e);-1!==r&&n.splice(r,1)}}},dispatchevent:function(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=e.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,t)}}}});for(var it=[],at=0;at<256;at++)it[at]=(at<16?"0":"")+at.tostring(16);var ot=1234567,st={deg2rad:math.pi/180,rad2deg:180/math.pi,generateuuid:function(){var t=4294967295*math.random()|0,e=4294967295*math.random()|0,n=4294967295*math.random()|0,r=4294967295*math.random()|0;return(it[255&t]+it[t>>8&255]+it[t>>16&255]+it[t>>24&255]+"-"+it[255&e]+it[e>>8&255]+"-"+it[e>>16&15|64]+it[e>>24&255]+"-"+it[63&n|128]+it[n>>8&255]+"-"+it[n>>16&255]+it[n>>24&255]+it[255&r]+it[r>>8&255]+it[r>>16&255]+it[r>>24&255]).touppercase()},clamp:function(t,e,n){return math.max(e,math.min(n,t))},euclideanmodulo:function(t,e){return(t%e+e)%e},maplinear:function(t,e,n,r,i){return r+(t-e)*(i-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randint:function(t,e){return t+math.floor(math.random()*(e-t+1))},randfloat:function(t,e){return t+math.random()*(e-t)},randfloatspread:function(t){return t*(.5-math.random())},seededrandom:function(t){return void 0!==t&&(ot=t%2147483647),((ot=16807*ot%2147483647)-1)/2147483646},degtorad:function(t){return t*st.deg2rad},radtodeg:function(t){return t*st.rad2deg},ispoweroftwo:function(t){return 0==(t&t-1)&&0!==t},ceilpoweroftwo:function(t){return math.pow(2,math.ceil(math.log(t)/math.ln2))},floorpoweroftwo:function(t){return math.pow(2,math.floor(math.log(t)/math.ln2))},setquaternionfrompropereuler:function(t,e,n,r,i){var a=math.cos,o=math.sin,s=a(n/2),c=o(n/2),l=a((e+r)/2),u=o((e+r)/2),h=a((e-r)/2),d=o((e-r)/2),p=a((r-e)/2),f=o((r-e)/2);switch(i){case"xyx":t.set(s*u,c*h,c*d,s*l);break;case"yzy":t.set(c*d,s*u,c*h,s*l);break;case"zxz":t.set(c*h,c*d,s*u,s*l);break;case"xzx":t.set(s*u,c*f,c*p,s*l);break;case"yxy":t.set(c*p,s*u,c*f,s*l);break;case"zyz":t.set(c*f,c*p,s*u,s*l);break;default:console.warn("three.mathutils: .setquaternionfrompropereuler() encountered an unknown order: "+i)}}};function ct(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),object.defineproperty(t,r.key,r)}}function lt(t,e,n){return e&&ct(t.prototype,e),n&&ct(t,n),t}function ut(t,e){t.prototype=object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function ht(t){if(void 0===t)throw new referenceerror("this hasn't been initialised - super() hasn't been called");return t}var dt,pt=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),object.defineproperty(this,"isvector2",{value:!0}),this.x=t,this.y=e}var e=t.prototype;return e.set=function(t,e){return this.x=t,this.y=e,this},e.setscalar=function(t){return this.x=t,this.y=t,this},e.setx=function(t){return this.x=t,this},e.sety=function(t){return this.y=t,this},e.setcomponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new error("index is out of range: "+t)}return this},e.getcomponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new error("index is out of range: "+t)}},e.clone=function(){return new this.constructor(this.x,this.y)},e.copy=function(t){return this.x=t.x,this.y=t.y,this},e.add=function(t,e){return void 0!==e?(console.warn("three.vector2: .add() now only accepts one argument. use .addvectors( a, b ) instead."),this.addvectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},e.addscalar=function(t){return this.x+=t,this.y+=t,this},e.addvectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},e.addscaledvector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this},e.sub=function(t,e){return void 0!==e?(console.warn("three.vector2: .sub() now only accepts one argument. use .subvectors( a, b ) instead."),this.subvectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},e.subscalar=function(t){return this.x-=t,this.y-=t,this},e.subvectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},e.multiply=function(t){return this.x*=t.x,this.y*=t.y,this},e.multiplyscalar=function(t){return this.x*=t,this.y*=t,this},e.divide=function(t){return this.x/=t.x,this.y/=t.y,this},e.dividescalar=function(t){return this.multiplyscalar(1/t)},e.applymatrix3=function(t){var e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},e.min=function(t){return this.x=math.min(this.x,t.x),this.y=math.min(this.y,t.y),this},e.max=function(t){return this.x=math.max(this.x,t.x),this.y=math.max(this.y,t.y),this},e.clamp=function(t,e){return this.x=math.max(t.x,math.min(e.x,this.x)),this.y=math.max(t.y,math.min(e.y,this.y)),this},e.clampscalar=function(t,e){return this.x=math.max(t,math.min(e,this.x)),this.y=math.max(t,math.min(e,this.y)),this},e.clamplength=function(t,e){var n=this.length();return this.dividescalar(n||1).multiplyscalar(math.max(t,math.min(e,n)))},e.floor=function(){return this.x=math.floor(this.x),this.y=math.floor(this.y),this},e.ceil=function(){return this.x=math.ceil(this.x),this.y=math.ceil(this.y),this},e.round=function(){return this.x=math.round(this.x),this.y=math.round(this.y),this},e.roundtozero=function(){return this.x=this.x<0?math.ceil(this.x):math.floor(this.x),this.y=this.y<0?math.ceil(this.y):math.floor(this.y),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.dot=function(t){return this.x*t.x+this.y*t.y},e.cross=function(t){return this.x*t.y-this.y*t.x},e.lengthsq=function(){return this.x*this.x+this.y*this.y},e.length=function(){return math.sqrt(this.x*this.x+this.y*this.y)},e.manhattanlength=function(){return math.abs(this.x)+math.abs(this.y)},e.normalize=function(){return this.dividescalar(this.length()||1)},e.angle=function(){var t=math.atan2(-this.y,-this.x)+math.pi;return t},e.distanceto=function(t){return math.sqrt(this.distancetosquared(t))},e.distancetosquared=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},e.manhattandistanceto=function(t){return math.abs(this.x-t.x)+math.abs(this.y-t.y)},e.setlength=function(t){return this.normalize().multiplyscalar(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},e.lerpvectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},e.equals=function(t){return t.x===this.x&&t.y===this.y},e.fromarray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},e.toarray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},e.frombufferattribute=function(t,e,n){return void 0!==n&&console.warn("three.vector2: offset has been removed from .frombufferattribute()."),this.x=t.getx(e),this.y=t.gety(e),this},e.rotatearound=function(t,e){var n=math.cos(e),r=math.sin(e),i=this.x-t.x,a=this.y-t.y;return this.x=i*n-a*r+t.x,this.y=i*r+a*n+t.y,this},e.random=function(){return this.x=math.random(),this.y=math.random(),this},lt(t,[{key:"width",get:function(){return this.x},set:function(t){this.x=t}},{key:"height",get:function(){return this.y},set:function(t){this.y=t}}]),t}(),ft=function(){function t(){object.defineproperty(this,"ismatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("three.matrix3: the constructor no longer reads arguments. use .set() instead.")}var e=t.prototype;return e.set=function(t,e,n,r,i,a,o,s,c){var l=this.elements;return l[0]=t,l[1]=r,l[2]=o,l[3]=e,l[4]=i,l[5]=s,l[6]=n,l[7]=a,l[8]=c,this},e.identity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},e.clone=function(){return(new this.constructor).fromarray(this.elements)},e.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},e.extractbasis=function(t,e,n){return t.setfrommatrix3column(this,0),e.setfrommatrix3column(this,1),n.setfrommatrix3column(this,2),this},e.setfrommatrix4=function(t){var e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},e.multiply=function(t){return this.multiplymatrices(this,t)},e.premultiply=function(t){return this.multiplymatrices(t,this)},e.multiplymatrices=function(t,e){var n=t.elements,r=e.elements,i=this.elements,a=n[0],o=n[3],s=n[6],c=n[1],l=n[4],u=n[7],h=n[2],d=n[5],p=n[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],x=r[7],_=r[2],b=r[5],w=r[8];return i[0]=a*f+o*g+s*_,i[3]=a*m+o*y+s*b,i[6]=a*v+o*x+s*w,i[1]=c*f+l*g+u*_,i[4]=c*m+l*y+u*b,i[7]=c*v+l*x+u*w,i[2]=h*f+d*g+p*_,i[5]=h*m+d*y+p*b,i[8]=h*v+d*x+p*w,this},e.multiplyscalar=function(t){var e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},e.determinant=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8];return e*a*l-e*o*c-n*i*l+n*o*s+r*i*c-r*a*s},e.invert=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],u=l*a-o*c,h=o*s-l*i,d=c*i-a*s,p=e*u+n*h+r*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);var f=1/p;return t[0]=u*f,t[1]=(r*c-l*n)*f,t[2]=(o*n-r*a)*f,t[3]=h*f,t[4]=(l*e-r*s)*f,t[5]=(r*i-o*e)*f,t[6]=d*f,t[7]=(n*s-c*e)*f,t[8]=(a*e-n*i)*f,this},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},e.getnormalmatrix=function(t){return this.setfrommatrix4(t).copy(this).invert().transpose()},e.transposeintoarray=function(t){var e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},e.setuvtransform=function(t,e,n,r,i,a,o){var s=math.cos(i),c=math.sin(i);return this.set(n*s,n*c,-n*(s*a+c*o)+a+t,-r*c,r*s,-r*(-c*a+s*o)+o+e,0,0,1),this},e.scale=function(t,e){var n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},e.rotate=function(t){var e=math.cos(t),n=math.sin(t),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],c=r[4],l=r[7];return r[0]=e*i+n*s,r[3]=e*a+n*c,r[6]=e*o+n*l,r[1]=-n*i+e*s,r[4]=-n*a+e*c,r[7]=-n*o+e*l,this},e.translate=function(t,e){var n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},e.equals=function(t){for(var e=this.elements,n=t.elements,r=0;r<9;r++)if(e[r]!==n[r])return!1;return!0},e.fromarray=function(t,e){void 0===e&&(e=0);for(var n=0;n<9;n++)this.elements[n]=t[n+e];return this},e.toarray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t},t}(),mt={getdataurl:function(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof htmlcanvaselement)return t.src;var e;if(t instanceof htmlcanvaselement)e=t;else{void 0===dt&&(dt=document.createelementns("http://www.w3.org/1999/xhtml","canvas")),dt.width=t.width,dt.height=t.height;var n=dt.getcontext("2d");t instanceof imagedata?n.putimagedata(t,0,0):n.drawimage(t,0,0,t.width,t.height),e=dt}return e.width>2048||e.height>2048?e.todataurl("image/jpeg",.6):e.todataurl("image/png")}},vt=0;function gt(t,e,n,r,i,a,o,s,c,l){void 0===t&&(t=gt.default_image),void 0===e&&(e=gt.default_mapping),void 0===n&&(n=u),void 0===r&&(r=u),void 0===i&&(i=m),void 0===a&&(a=g),void 0===o&&(o=t),void 0===s&&(s=y),void 0===c&&(c=1),void 0===l&&(l=q),object.defineproperty(this,"id",{value:vt++}),this.uuid=st.generateuuid(),this.name="",this.image=t,this.mipmaps=[],this.mapping=e,this.wraps=n,this.wrapt=r,this.magfilter=i,this.minfilter=a,this.anisotropy=c,this.format=o,this.internalformat=null,this.type=s,this.offset=new pt(0,0),this.repeat=new pt(1,1),this.center=new pt(0,0),this.rotation=0,this.matrixautoupdate=!0,this.matrix=new ft,this.generatemipmaps=!0,this.premultiplyalpha=!1,this.flipy=!0,this.unpackalignment=4,this.encoding=l,this.version=0,this.onupdate=null}function yt(t){return"undefined"!=typeof htmlimageelement&&t instanceof htmlimageelement||"undefined"!=typeof htmlcanvaselement&&t instanceof htmlcanvaselement||"undefined"!=typeof imagebitmap&&t instanceof imagebitmap?mt.getdataurl(t):t.data?{data:array.prototype.slice.call(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("three.texture: unable to serialize texture."),{})}gt.default_image=void 0,gt.default_mapping=n,gt.prototype=object.assign(object.create(rt.prototype),{constructor:gt,istexture:!0,updatematrix:function(){this.matrix.setuvtransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.name=t.name,this.image=t.image,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wraps=t.wraps,this.wrapt=t.wrapt,this.magfilter=t.magfilter,this.minfilter=t.minfilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalformat=t.internalformat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixautoupdate=t.matrixautoupdate,this.matrix.copy(t.matrix),this.generatemipmaps=t.generatemipmaps,this.premultiplyalpha=t.premultiplyalpha,this.flipy=t.flipy,this.unpackalignment=t.unpackalignment,this.encoding=t.encoding,this},tojson:function(t){var e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];var n={metadata:{version:4.5,type:"texture",generator:"texture.tojson"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wraps,this.wrapt],format:this.format,type:this.type,encoding:this.encoding,minfilter:this.minfilter,magfilter:this.magfilter,anisotropy:this.anisotropy,flipy:this.flipy,premultiplyalpha:this.premultiplyalpha,unpackalignment:this.unpackalignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=st.generateuuid()),!e&&void 0===t.images[r.uuid]){var i;if(array.isarray(r)){i=[];for(var a=0,o=r.length;a<o;a++)r[a].isdatatexture?i.push(yt(r[a].image)):i.push(yt(r[a]))}else i=yt(r);t.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return e||(t.textures[this.uuid]=n),n},dispose:function(){this.dispatchevent({type:"dispose"})},transformuv:function(t){if(this.mapping!==n)return t;if(t.applymatrix3(this.matrix),t.x<0||t.x>1)switch(this.wraps){case l:t.x=t.x-math.floor(t.x);break;case u:t.x=t.x<0?0:1;break;case h:1===math.abs(math.floor(t.x)%2)?t.x=math.ceil(t.x)-t.x:t.x=t.x-math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapt){case l:t.y=t.y-math.floor(t.y);break;case u:t.y=t.y<0?0:1;break;case h:1===math.abs(math.floor(t.y)%2)?t.y=math.ceil(t.y)-t.y:t.y=t.y-math.floor(t.y)}return this.flipy&&(t.y=1-t.y),t}}),object.defineproperty(gt.prototype,"needsupdate",{set:function(t){!0===t&&this.version++}});var xt=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),object.defineproperty(this,"isvector4",{value:!0}),this.x=t,this.y=e,this.z=n,this.w=r}var e=t.prototype;return e.set=function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},e.setscalar=function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},e.setx=function(t){return this.x=t,this},e.sety=function(t){return this.y=t,this},e.setz=function(t){return this.z=t,this},e.setw=function(t){return this.w=t,this},e.setcomponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new error("index is out of range: "+t)}return this},e.getcomponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new error("index is out of range: "+t)}},e.clone=function(){return new this.constructor(this.x,this.y,this.z,this.w)},e.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},e.add=function(t,e){return void 0!==e?(console.warn("three.vector4: .add() now only accepts one argument. use .addvectors( a, b ) instead."),this.addvectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},e.addscalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this},e.addvectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this},e.addscaledvector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this},e.sub=function(t,e){return void 0!==e?(console.warn("three.vector4: .sub() now only accepts one argument. use .subvectors( a, b ) instead."),this.subvectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},e.subscalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this},e.subvectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this},e.multiplyscalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},e.applymatrix4=function(t){var e=this.x,n=this.y,r=this.z,i=this.w,a=t.elements;return this.x=a[0]*e+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*e+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*e+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*e+a[7]*n+a[11]*r+a[15]*i,this},e.dividescalar=function(t){return this.multiplyscalar(1/t)},e.setaxisanglefromquaternion=function(t){this.w=2*math.acos(t.w);var e=math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this},e.setaxisanglefromrotationmatrix=function(t){var e,n,r,i,a=.01,o=.1,s=t.elements,c=s[0],l=s[4],u=s[8],h=s[1],d=s[5],p=s[9],f=s[2],m=s[6],v=s[10];if(math.abs(l-h)<a&&math.abs(u-f)<a&&math.abs(p-m)<a){if(math.abs(l+h)<o&&math.abs(u+f)<o&&math.abs(p+m)<o&&math.abs(c+d+v-3)<o)return this.set(1,0,0,0),this;e=math.pi;var g=(c+1)/2,y=(d+1)/2,x=(v+1)/2,_=(l+h)/4,b=(u+f)/4,w=(p+m)/4;return g>y&&g>x?g<a?(n=0,r=.707106781,i=.707106781):(r=_/(n=math.sqrt(g)),i=b/n):y>x?y<a?(n=.707106781,r=0,i=.707106781):(n=_/(r=math.sqrt(y)),i=w/r):x<a?(n=.707106781,r=.707106781,i=0):(n=b/(i=math.sqrt(x)),r=w/i),this.set(n,r,i,e),this}var m=math.sqrt((m-p)*(m-p)+(u-f)*(u-f)+(h-l)*(h-l));return math.abs(m)<.001&&(m=1),this.x=(m-p)/m,this.y=(u-f)/m,this.z=(h-l)/m,this.w=math.acos((c+d+v-1)/2),this},e.min=function(t){return this.x=math.min(this.x,t.x),this.y=math.min(this.y,t.y),this.z=math.min(this.z,t.z),this.w=math.min(this.w,t.w),this},e.max=function(t){return this.x=math.max(this.x,t.x),this.y=math.max(this.y,t.y),this.z=math.max(this.z,t.z),this.w=math.max(this.w,t.w),this},e.clamp=function(t,e){return this.x=math.max(t.x,math.min(e.x,this.x)),this.y=math.max(t.y,math.min(e.y,this.y)),this.z=math.max(t.z,math.min(e.z,this.z)),this.w=math.max(t.w,math.min(e.w,this.w)),this},e.clampscalar=function(t,e){return this.x=math.max(t,math.min(e,this.x)),this.y=math.max(t,math.min(e,this.y)),this.z=math.max(t,math.min(e,this.z)),this.w=math.max(t,math.min(e,this.w)),this},e.clamplength=function(t,e){var n=this.length();return this.dividescalar(n||1).multiplyscalar(math.max(t,math.min(e,n)))},e.floor=function(){return this.x=math.floor(this.x),this.y=math.floor(this.y),this.z=math.floor(this.z),this.w=math.floor(this.w),this},e.ceil=function(){return this.x=math.ceil(this.x),this.y=math.ceil(this.y),this.z=math.ceil(this.z),this.w=math.ceil(this.w),this},e.round=function(){return this.x=math.round(this.x),this.y=math.round(this.y),this.z=math.round(this.z),this.w=math.round(this.w),this},e.roundtozero=function(){return this.x=this.x<0?math.ceil(this.x):math.floor(this.x),this.y=this.y<0?math.ceil(this.y):math.floor(this.y),this.z=this.z<0?math.ceil(this.z):math.floor(this.z),this.w=this.w<0?math.ceil(this.w):math.floor(this.w),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},e.lengthsq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e.length=function(){return math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},e.manhattanlength=function(){return math.abs(this.x)+math.abs(this.y)+math.abs(this.z)+math.abs(this.w)},e.normalize=function(){return this.dividescalar(this.length()||1)},e.setlength=function(t){return this.normalize().multiplyscalar(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},e.lerpvectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},e.fromarray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},e.toarray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},e.frombufferattribute=function(t,e,n){return void 0!==n&&console.warn("three.vector4: offset has been removed from .frombufferattribute()."),this.x=t.getx(e),this.y=t.gety(e),this.z=t.getz(e),this.w=t.getw(e),this},e.random=function(){return this.x=math.random(),this.y=math.random(),this.z=math.random(),this.w=math.random(),this},lt(t,[{key:"width",get:function(){return this.z},set:function(t){this.z=t}},{key:"height",get:function(){return this.w},set:function(t){this.w=t}}]),t}();function _t(t,e,n){this.width=t,this.height=e,this.scissor=new xt(0,0,t,e),this.scissortest=!1,this.viewport=new xt(0,0,t,e),n=n||{},this.texture=new gt(void 0,n.mapping,n.wraps,n.wrapt,n.magfilter,n.minfilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generatemipmaps=void 0!==n.generatemipmaps&&n.generatemipmaps,this.texture.minfilter=void 0!==n.minfilter?n.minfilter:m,this.depthbuffer=void 0===n.depthbuffer||n.depthbuffer,this.stencilbuffer=void 0!==n.stencilbuffer&&n.stencilbuffer,this.depthtexture=void 0!==n.depthtexture?n.depthtexture:null}function bt(t,e,n){_t.call(this,t,e,n),this.samples=4}_t.prototype=object.assign(object.create(rt.prototype),{constructor:_t,iswebglrendertarget:!0,setsize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.width=t.width,this.height=t.height,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.depthbuffer=t.depthbuffer,this.stencilbuffer=t.stencilbuffer,this.depthtexture=t.depthtexture,this},dispose:function(){this.dispatchevent({type:"dispose"})}}),bt.prototype=object.assign(object.create(_t.prototype),{constructor:bt,iswebglmultisamplerendertarget:!0,copy:function(t){return _t.prototype.copy.call(this,t),this.samples=t.samples,this}});var wt=function(){function t(t,e,n,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=1),object.defineproperty(this,"isquaternion",{value:!0}),this._x=t,this._y=e,this._z=n,this._w=r}t.slerp=function(t,e,n,r){return n.copy(t).slerp(e,r)},t.slerpflat=function(t,e,n,r,i,a,o){var s=n[r+0],c=n[r+1],l=n[r+2],u=n[r+3],h=i[a+0],d=i[a+1],p=i[a+2],f=i[a+3];if(u!==f||s!==h||c!==d||l!==p){var m=1-o,v=s*h+c*d+l*p+u*f,g=v>=0?1:-1,y=1-v*v;if(y>number.epsilon){var x=math.sqrt(y),_=math.atan2(x,v*g);m=math.sin(m*_)/x,o=math.sin(o*_)/x}var b=o*g;if(s=s*m+h*b,c=c*m+d*b,l=l*m+p*b,u=u*m+f*b,m===1-o){var w=1/math.sqrt(s*s+c*c+l*l+u*u);s*=w,c*=w,l*=w,u*=w}}t[e]=s,t[e+1]=c,t[e+2]=l,t[e+3]=u},t.multiplyquaternionsflat=function(t,e,n,r,i,a){var o=n[r],s=n[r+1],c=n[r+2],l=n[r+3],u=i[a],h=i[a+1],d=i[a+2],p=i[a+3];return t[e]=o*p+l*u+s*d-c*h,t[e+1]=s*p+l*h+c*u-o*d,t[e+2]=c*p+l*d+o*h-s*u,t[e+3]=l*p-o*u-s*h-c*d,t};var e=t.prototype;return e.set=function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onchangecallback(),this},e.clone=function(){return new this.constructor(this._x,this._y,this._z,this._w)},e.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onchangecallback(),this},e.setfromeuler=function(t,e){if(!t||!t.iseuler)throw new error("three.quaternion: .setfromeuler() now expects an euler rotation rather than a vector3 and order.");var n=t._x,r=t._y,i=t._z,a=t._order,o=math.cos,s=math.sin,c=o(n/2),l=o(r/2),u=o(i/2),h=s(n/2),d=s(r/2),p=s(i/2);switch(a){case"xyz":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"yxz":this._x=h*l*u+c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"zxy":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u-h*d*p;break;case"zyx":this._x=h*l*u-c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u+h*d*p;break;case"yzx":this._x=h*l*u+c*d*p,this._y=c*d*u+h*l*p,this._z=c*l*p-h*d*u,this._w=c*l*u-h*d*p;break;case"xzy":this._x=h*l*u-c*d*p,this._y=c*d*u-h*l*p,this._z=c*l*p+h*d*u,this._w=c*l*u+h*d*p;break;default:console.warn("three.quaternion: .setfromeuler() encountered an unknown order: "+a)}return!1!==e&&this._onchangecallback(),this},e.setfromaxisangle=function(t,e){var n=e/2,r=math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=math.cos(n),this._onchangecallback(),this},e.setfromrotationmatrix=function(t){var e=t.elements,n=e[0],r=e[4],i=e[8],a=e[1],o=e[5],s=e[9],c=e[2],l=e[6],u=e[10],h=n+o+u;if(h>0){var d=.5/math.sqrt(h+1);this._w=.25/d,this._x=(l-s)*d,this._y=(i-c)*d,this._z=(a-r)*d}else if(n>o&&n>u){var p=2*math.sqrt(1+n-o-u);this._w=(l-s)/p,this._x=.25*p,this._y=(r+a)/p,this._z=(i+c)/p}else if(o>u){var f=2*math.sqrt(1+o-n-u);this._w=(i-c)/f,this._x=(r+a)/f,this._y=.25*f,this._z=(s+l)/f}else{var m=2*math.sqrt(1+u-n-o);this._w=(a-r)/m,this._x=(i+c)/m,this._y=(s+l)/m,this._z=.25*m}return this._onchangecallback(),this},e.setfromunitvectors=function(t,e){var n=t.dot(e)+1;return n<1e-6?(n=0,math.abs(t.x)>math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},e.angleto=function(t){return 2*math.acos(math.abs(st.clamp(this.dot(t),-1,1)))},e.rotatetowards=function(t,e){var n=this.angleto(t);if(0===n)return this;var r=math.min(1,e/n);return this.slerp(t,r),this},e.identity=function(){return this.set(0,0,0,1)},e.invert=function(){return this.conjugate()},e.conjugate=function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onchangecallback(),this},e.dot=function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},e.lengthsq=function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},e.length=function(){return math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},e.normalize=function(){var t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onchangecallback(),this},e.multiply=function(t,e){return void 0!==e?(console.warn("three.quaternion: .multiply() now only accepts one argument. use .multiplyquaternions( a, b ) instead."),this.multiplyquaternions(t,e)):this.multiplyquaternions(this,t)},e.premultiply=function(t){return this.multiplyquaternions(t,this)},e.multiplyquaternions=function(t,e){var n=t._x,r=t._y,i=t._z,a=t._w,o=e._x,s=e._y,c=e._z,l=e._w;return this._x=n*l+a*o+r*c-i*s,this._y=r*l+a*s+i*o-n*c,this._z=i*l+a*c+n*s-r*o,this._w=a*l-n*o-r*s-i*c,this._onchangecallback(),this},e.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*t._w+n*t._x+r*t._y+i*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=number.epsilon){var c=1-e;return this._w=c*a+e*this._w,this._x=c*n+e*this._x,this._y=c*r+e*this._y,this._z=c*i+e*this._z,this.normalize(),this._onchangecallback(),this}var l=math.sqrt(s),u=math.atan2(l,o),h=math.sin((1-e)*u)/l,d=math.sin(e*u)/l;return this._w=a*h+this._w*d,this._x=n*h+this._x*d,this._y=r*h+this._y*d,this._z=i*h+this._z*d,this._onchangecallback(),this},e.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},e.fromarray=function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onchangecallback(),this},e.toarray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},e.frombufferattribute=function(t,e){return this._x=t.getx(e),this._y=t.gety(e),this._z=t.getz(e),this._w=t.getw(e),this},e._onchange=function(t){return this._onchangecallback=t,this},e._onchangecallback=function(){},lt(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onchangecallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onchangecallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onchangecallback()}},{key:"w",get:function(){return this._w},set:function(t){this._w=t,this._onchangecallback()}}]),t}(),mt=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),object.defineproperty(this,"isvector3",{value:!0}),this.x=t,this.y=e,this.z=n}var e=t.prototype;return e.set=function(t,e,n){return void 0===n&&(n=this.z),this.x=t,this.y=e,this.z=n,this},e.setscalar=function(t){return this.x=t,this.y=t,this.z=t,this},e.setx=function(t){return this.x=t,this},e.sety=function(t){return this.y=t,this},e.setz=function(t){return this.z=t,this},e.setcomponent=function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new error("index is out of range: "+t)}return this},e.getcomponent=function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new error("index is out of range: "+t)}},e.clone=function(){return new this.constructor(this.x,this.y,this.z)},e.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.add=function(t,e){return void 0!==e?(console.warn("three.vector3: .add() now only accepts one argument. use .addvectors( a, b ) instead."),this.addvectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},e.addscalar=function(t){return this.x+=t,this.y+=t,this.z+=t,this},e.addvectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},e.addscaledvector=function(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this},e.sub=function(t,e){return void 0!==e?(console.warn("three.vector3: .sub() now only accepts one argument. use .subvectors( a, b ) instead."),this.subvectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},e.subscalar=function(t){return this.x-=t,this.y-=t,this.z-=t,this},e.subvectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},e.multiply=function(t,e){return void 0!==e?(console.warn("three.vector3: .multiply() now only accepts one argument. use .multiplyvectors( a, b ) instead."),this.multiplyvectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},e.multiplyscalar=function(t){return this.x*=t,this.y*=t,this.z*=t,this},e.multiplyvectors=function(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this},e.applyeuler=function(t){return t&&t.iseuler||console.error("three.vector3: .applyeuler() now expects an euler rotation rather than a vector3 and order."),this.applyquaternion(tt.setfromeuler(t))},e.applyaxisangle=function(t,e){return this.applyquaternion(tt.setfromaxisangle(t,e))},e.applymatrix3=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},e.applynormalmatrix=function(t){return this.applymatrix3(t).normalize()},e.applymatrix4=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements,a=1/(i[3]*e+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*e+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*e+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*e+i[6]*n+i[10]*r+i[14])*a,this},e.applyquaternion=function(t){var e=this.x,n=this.y,r=this.z,i=t.x,a=t.y,o=t.z,s=t.w,c=s*e+a*r-o*n,l=s*n+o*e-i*r,u=s*r+i*n-a*e,h=-i*e-a*n-o*r;return this.x=c*s+h*-i+l*-o-u*-a,this.y=l*s+h*-a+u*-i-c*-o,this.z=u*s+h*-o+c*-a-l*-i,this},e.project=function(t){return this.applymatrix4(t.matrixworldinverse).applymatrix4(t.projectionmatrix)},e.unproject=function(t){return this.applymatrix4(t.projectionmatrixinverse).applymatrix4(t.matrixworld)},e.transformdirection=function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[4]*n+i[8]*r,this.y=i[1]*e+i[5]*n+i[9]*r,this.z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},e.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},e.dividescalar=function(t){return this.multiplyscalar(1/t)},e.min=function(t){return this.x=math.min(this.x,t.x),this.y=math.min(this.y,t.y),this.z=math.min(this.z,t.z),this},e.max=function(t){return this.x=math.max(this.x,t.x),this.y=math.max(this.y,t.y),this.z=math.max(this.z,t.z),this},e.clamp=function(t,e){return this.x=math.max(t.x,math.min(e.x,this.x)),this.y=math.max(t.y,math.min(e.y,this.y)),this.z=math.max(t.z,math.min(e.z,this.z)),this},e.clampscalar=function(t,e){return this.x=math.max(t,math.min(e,this.x)),this.y=math.max(t,math.min(e,this.y)),this.z=math.max(t,math.min(e,this.z)),this},e.clamplength=function(t,e){var n=this.length();return this.dividescalar(n||1).multiplyscalar(math.max(t,math.min(e,n)))},e.floor=function(){return this.x=math.floor(this.x),this.y=math.floor(this.y),this.z=math.floor(this.z),this},e.ceil=function(){return this.x=math.ceil(this.x),this.y=math.ceil(this.y),this.z=math.ceil(this.z),this},e.round=function(){return this.x=math.round(this.x),this.y=math.round(this.y),this.z=math.round(this.z),this},e.roundtozero=function(){return this.x=this.x<0?math.ceil(this.x):math.floor(this.x),this.y=this.y<0?math.ceil(this.y):math.floor(this.y),this.z=this.z<0?math.ceil(this.z):math.floor(this.z),this},e.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},e.lengthsq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},e.length=function(){return math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},e.manhattanlength=function(){return math.abs(this.x)+math.abs(this.y)+math.abs(this.z)},e.normalize=function(){return this.dividescalar(this.length()||1)},e.setlength=function(t){return this.normalize().multiplyscalar(t)},e.lerp=function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},e.lerpvectors=function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},e.cross=function(t,e){return void 0!==e?(console.warn("three.vector3: .cross() now only accepts one argument. use .crossvectors( a, b ) instead."),this.crossvectors(t,e)):this.crossvectors(this,t)},e.crossvectors=function(t,e){var n=t.x,r=t.y,i=t.z,a=e.x,o=e.y,s=e.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this},e.projectonvector=function(t){var e=t.lengthsq();if(0===e)return this.set(0,0,0);var n=t.dot(this)/e;return this.copy(t).multiplyscalar(n)},e.projectonplane=function(t){return st.copy(this).projectonvector(t),this.sub(st)},e.reflect=function(t){return this.sub(st.copy(t).multiplyscalar(2*this.dot(t)))},e.angleto=function(t){var e=math.sqrt(this.lengthsq()*t.lengthsq());if(0===e)return math.pi/2;var n=this.dot(t)/e;return math.acos(st.clamp(n,-1,1))},e.distanceto=function(t){return math.sqrt(this.distancetosquared(t))},e.distancetosquared=function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},e.manhattandistanceto=function(t){return math.abs(this.x-t.x)+math.abs(this.y-t.y)+math.abs(this.z-t.z)},e.setfromspherical=function(t){return this.setfromsphericalcoords(t.radius,t.phi,t.theta)},e.setfromsphericalcoords=function(t,e,n){var r=math.sin(e)*t;return this.x=r*math.sin(n),this.y=math.cos(e)*t,this.z=r*math.cos(n),this},e.setfromcylindrical=function(t){return this.setfromcylindricalcoords(t.radius,t.theta,t.y)},e.setfromcylindricalcoords=function(t,e,n){return this.x=t*math.sin(e),this.y=n,this.z=t*math.cos(e),this},e.setfrommatrixposition=function(t){var e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},e.setfrommatrixscale=function(t){var e=this.setfrommatrixcolumn(t,0).length(),n=this.setfrommatrixcolumn(t,1).length(),r=this.setfrommatrixcolumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},e.setfrommatrixcolumn=function(t,e){return this.fromarray(t.elements,4*e)},e.setfrommatrix3column=function(t,e){return this.fromarray(t.elements,3*e)},e.equals=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},e.fromarray=function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},e.toarray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},e.frombufferattribute=function(t,e,n){return void 0!==n&&console.warn("three.vector3: offset has been removed from .frombufferattribute()."),this.x=t.getx(e),this.y=t.gety(e),this.z=t.getz(e),this},e.random=function(){return this.x=math.random(),this.y=math.random(),this.z=math.random(),this},t}(),st=new mt,tt=new wt,et=function(){function t(t,e){object.defineproperty(this,"isbox3",{value:!0}),this.min=void 0!==t?t:new mt(1/0,1/0,1/0),this.max=void 0!==e?e:new mt(-1/0,-1/0,-1/0)}var e=t.prototype;return e.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},e.setfromarray=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,c=t.length;s<c;s+=3){var l=t[s],u=t[s+1],h=t[s+2];l<e&&(e=l),u<n&&(n=u),h<r&&(r=h),l>i&&(i=l),u>a&&(a=u),h>o&&(o=h)}return this.min.set(e,n,r),this.max.set(i,a,o),this},e.setfrombufferattribute=function(t){for(var e=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,c=t.count;s<c;s++){var l=t.getx(s),u=t.gety(s),h=t.getz(s);l<e&&(e=l),u<n&&(n=u),h<r&&(r=h),l>i&&(i=l),u>a&&(a=u),h>o&&(o=h)}return this.min.set(e,n,r),this.max.set(i,a,o),this},e.setfrompoints=function(t){this.makeempty();for(var e=0,n=t.length;e<n;e++)this.expandbypoint(t[e]);return this},e.setfromcenterandsize=function(t,e){var n=rt.copy(e).multiplyscalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},e.setfromobject=function(t){return this.makeempty(),this.expandbyobject(t)},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},e.makeempty=function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},e.isempty=function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},e.getcenter=function(t){return void 0===t&&(console.warn("three.box3: .getcenter() target is now required"),t=new mt),this.isempty()?t.set(0,0,0):t.addvectors(this.min,this.max).multiplyscalar(.5)},e.getsize=function(t){return void 0===t&&(console.warn("three.box3: .getsize() target is now required"),t=new mt),this.isempty()?t.set(0,0,0):t.subvectors(this.max,this.min)},e.expandbypoint=function(t){return this.min.min(t),this.max.max(t),this},e.expandbyvector=function(t){return this.min.sub(t),this.max.add(t),this},e.expandbyscalar=function(t){return this.min.addscalar(-t),this.max.addscalar(t),this},e.expandbyobject=function(t){t.updateworldmatrix(!1,!1);var e=t.geometry;void 0!==e&&(null===e.boundingbox&&e.computeboundingbox(),ct.copy(e.boundingbox),ct.applymatrix4(t.matrixworld),this.union(ct));for(var n=t.children,r=0,i=n.length;r<i;r++)this.expandbyobject(n[r]);return this},e.containspoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},e.containsbox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},e.getparameter=function(t,e){return void 0===e&&(console.warn("three.box3: .getparameter() target is now required"),e=new mt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},e.intersectsbox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},e.intersectssphere=function(t){return this.clamppoint(t.center,rt),rt.distancetosquared(t.center)<=t.radius*t.radius},e.intersectsplane=function(t){var e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},e.intersectstriangle=function(t){if(this.isempty())return!1;this.getcenter(zt),ft.subvectors(this.max,zt),pt.subvectors(t.a,zt),it.subvectors(t.b,zt),nt.subvectors(t.c,zt),dt.subvectors(it,pt),ot.subvectors(nt,it),bt.subvectors(pt,nt);var e=[0,-dt.z,dt.y,0,-ot.z,ot.y,0,-bt.z,bt.y,dt.z,0,-dt.x,ot.z,0,-ot.x,bt.z,0,-bt.x,-dt.y,dt.x,0,-ot.y,ot.x,0,-bt.y,bt.x,0];return!!at(e,pt,it,nt,ft)&&(!!at(e=[1,0,0,0,1,0,0,0,1],pt,it,nt,ft)&&(gt.crossvectors(dt,ot),at(e=[gt.x,gt.y,gt.z],pt,it,nt,ft)))},e.clamppoint=function(t,e){return void 0===e&&(console.warn("three.box3: .clamppoint() target is now required"),e=new mt),e.copy(t).clamp(this.min,this.max)},e.distancetopoint=function(t){return rt.copy(t).clamp(this.min,this.max).sub(t).length()},e.getboundingsphere=function(t){return void 0===t&&console.error("three.box3: .getboundingsphere() target is now required"),this.getcenter(t.center),t.radius=.5*this.getsize(rt).length(),t},e.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this.isempty()&&this.makeempty(),this},e.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.applymatrix4=function(t){return this.isempty()||(lt[0].set(this.min.x,this.min.y,this.min.z).applymatrix4(t),lt[1].set(this.min.x,this.min.y,this.max.z).applymatrix4(t),lt[2].set(this.min.x,this.max.y,this.min.z).applymatrix4(t),lt[3].set(this.min.x,this.max.y,this.max.z).applymatrix4(t),lt[4].set(this.max.x,this.min.y,this.min.z).applymatrix4(t),lt[5].set(this.max.x,this.min.y,this.max.z).applymatrix4(t),lt[6].set(this.max.x,this.max.y,this.min.z).applymatrix4(t),lt[7].set(this.max.x,this.max.y,this.max.z).applymatrix4(t),this.setfrompoints(lt)),this},e.translate=function(t){return this.min.add(t),this.max.add(t),this},e.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},t}();function at(t,e,n,r,i){for(var a=0,o=t.length-3;a<=o;a+=3){ut.fromarray(t,a);var s=i.x*math.abs(ut.x)+i.y*math.abs(ut.y)+i.z*math.abs(ut.z),c=e.dot(ut),l=n.dot(ut),u=r.dot(ut);if(math.max(-math.max(c,l,u),math.min(c,l,u))>s)return!1}return!0}var lt=[new mt,new mt,new mt,new mt,new mt,new mt,new mt,new mt],rt=new mt,ct=new et,pt=new mt,it=new mt,nt=new mt,dt=new mt,ot=new mt,bt=new mt,zt=new mt,ft=new mt,gt=new mt,ut=new mt,ht=new et,kt=function(){function t(t,e){this.center=void 0!==t?t:new mt,this.radius=void 0!==e?e:-1}var e=t.prototype;return e.set=function(t,e){return this.center.copy(t),this.radius=e,this},e.setfrompoints=function(t,e){var n=this.center;void 0!==e?n.copy(e):ht.setfrompoints(t).getcenter(n);for(var r=0,i=0,a=t.length;i<a;i++)r=math.max(r,n.distancetosquared(t[i]));return this.radius=math.sqrt(r),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.center.copy(t.center),this.radius=t.radius,this},e.isempty=function(){return this.radius<0},e.makeempty=function(){return this.center.set(0,0,0),this.radius=-1,this},e.containspoint=function(t){return t.distancetosquared(this.center)<=this.radius*this.radius},e.distancetopoint=function(t){return t.distanceto(this.center)-this.radius},e.intersectssphere=function(t){var e=this.radius+t.radius;return t.center.distancetosquared(this.center)<=e*e},e.intersectsbox=function(t){return t.intersectssphere(this)},e.intersectsplane=function(t){return math.abs(t.distancetopoint(this.center))<=this.radius},e.clamppoint=function(t,e){var n=this.center.distancetosquared(t);return void 0===e&&(console.warn("three.sphere: .clamppoint() target is now required"),e=new mt),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyscalar(this.radius).add(this.center)),e},e.getboundingbox=function(t){return void 0===t&&(console.warn("three.sphere: .getboundingbox() target is now required"),t=new et),this.isempty()?(t.makeempty(),t):(t.set(this.center,this.center),t.expandbyscalar(this.radius),t)},e.applymatrix4=function(t){return this.center.applymatrix4(t),this.radius=this.radius*t.getmaxscaleonaxis(),this},e.translate=function(t){return this.center.add(t),this},e.equals=function(t){return t.center.equals(this.center)&&t.radius===this.radius},t}(),vt=new mt,wt=new mt,jt=new mt,qt=new mt,xt=new mt,yt=new mt,zt=new mt,jt=function(){function t(t,e){this.origin=void 0!==t?t:new mt,this.direction=void 0!==e?e:new mt(0,0,-1)}var e=t.prototype;return e.set=function(t,e){return this.origin.copy(t),this.direction.copy(e),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},e.at=function(t,e){return void 0===e&&(console.warn("three.ray: .at() target is now required"),e=new mt),e.copy(this.direction).multiplyscalar(t).add(this.origin)},e.lookat=function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},e.recast=function(t){return this.origin.copy(this.at(t,vt)),this},e.closestpointtopoint=function(t,e){void 0===e&&(console.warn("three.ray: .closestpointtopoint() target is now required"),e=new mt),e.subvectors(t,this.origin);var n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyscalar(n).add(this.origin)},e.distancetopoint=function(t){return math.sqrt(this.distancesqtopoint(t))},e.distancesqtopoint=function(t){var e=vt.subvectors(t,this.origin).dot(this.direction);return e<0?this.origin.distancetosquared(t):(vt.copy(this.direction).multiplyscalar(e).add(this.origin),vt.distancetosquared(t))},e.distancesqtosegment=function(t,e,n,r){wt.copy(t).add(e).multiplyscalar(.5),jt.copy(e).sub(t).normalize(),qt.copy(this.origin).sub(wt);var i,a,o,s,c=.5*t.distanceto(e),l=-this.direction.dot(jt),u=qt.dot(this.direction),h=-qt.dot(jt),d=qt.lengthsq(),p=math.abs(1-l*l);if(p>0)if(a=l*u-h,s=c*p,(i=l*h-u)>=0)if(a>=-s)if(a<=s){var f=1/p;o=(i*=f)*(i+l*(a*=f)+2*u)+a*(l*i+a+2*h)+d}else a=c,o=-(i=math.max(0,-(l*a+u)))*i+a*(a+2*h)+d;else a=-c,o=-(i=math.max(0,-(l*a+u)))*i+a*(a+2*h)+d;else a<=-s?o=-(i=math.max(0,-(-l*c+u)))*i+(a=i>0?-c:math.min(math.max(-c,-h),c))*(a+2*h)+d:a<=s?(i=0,o=(a=math.min(math.max(-c,-h),c))*(a+2*h)+d):o=-(i=math.max(0,-(l*c+u)))*i+(a=i>0?c:math.min(math.max(-c,-h),c))*(a+2*h)+d;else a=l>0?-c:c,o=-(i=math.max(0,-(l*a+u)))*i+a*(a+2*h)+d;return n&&n.copy(this.direction).multiplyscalar(i).add(this.origin),r&&r.copy(jt).multiplyscalar(a).add(wt),o},e.intersectsphere=function(t,e){vt.subvectors(t.center,this.origin);var n=vt.dot(this.direction),r=vt.dot(vt)-n*n,i=t.radius*t.radius;if(r>i)return null;var a=math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,e):this.at(o,e)},e.intersectssphere=function(t){return this.distancesqtopoint(t.center)<=t.radius*t.radius},e.distancetoplane=function(t){var e=t.normal.dot(this.direction);if(0===e)return 0===t.distancetopoint(this.origin)?0:null;var n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},e.intersectplane=function(t,e){var n=this.distancetoplane(t);return null===n?null:this.at(n,e)},e.intersectsplane=function(t){var e=t.distancetopoint(this.origin);return 0===e||t.normal.dot(this.direction)*e<0},e.intersectbox=function(t,e){var n,r,i,a,o,s,c=1/this.direction.x,l=1/this.direction.y,u=1/this.direction.z,h=this.origin;return c>=0?(n=(t.min.x-h.x)*c,r=(t.max.x-h.x)*c):(n=(t.max.x-h.x)*c,r=(t.min.x-h.x)*c),l>=0?(i=(t.min.y-h.y)*l,a=(t.max.y-h.y)*l):(i=(t.max.y-h.y)*l,a=(t.min.y-h.y)*l),n>a||i>r?null:((i>n||n!=n)&&(n=i),(a<r||r!=r)&&(r=a),u>=0?(o=(t.min.z-h.z)*u,s=(t.max.z-h.z)*u):(o=(t.max.z-h.z)*u,s=(t.min.z-h.z)*u),n>s||o>r?null:((o>n||n!=n)&&(n=o),(s<r||r!=r)&&(r=s),r<0?null:this.at(n>=0?n:r,e)))},e.intersectsbox=function(t){return null!==this.intersectbox(t,vt)},e.intersecttriangle=function(t,e,n,r,i){xt.subvectors(e,t),yt.subvectors(n,t),zt.crossvectors(xt,yt);var a,o=this.direction.dot(zt);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}qt.subvectors(this.origin,t);var s=a*this.direction.dot(yt.crossvectors(qt,yt));if(s<0)return null;var c=a*this.direction.dot(xt.cross(qt));if(c<0)return null;if(s+c>o)return null;var l=-a*qt.dot(zt);return l<0?null:this.at(l/o,i)},e.applymatrix4=function(t){return this.origin.applymatrix4(t),this.direction.transformdirection(t),this},e.equals=function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)},t}(),qt=function(){function t(){object.defineproperty(this,"ismatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("three.matrix4: the constructor no longer reads arguments. use .set() instead.")}var e=t.prototype;return e.set=function(t,e,n,r,i,a,o,s,c,l,u,h,d,p,f,m){var v=this.elements;return v[0]=t,v[4]=e,v[8]=n,v[12]=r,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=c,v[6]=l,v[10]=u,v[14]=h,v[3]=d,v[7]=p,v[11]=f,v[15]=m,this},e.identity=function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},e.clone=function(){return(new t).fromarray(this.elements)},e.copy=function(t){var e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},e.copyposition=function(t){var e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},e.extractbasis=function(t,e,n){return t.setfrommatrixcolumn(this,0),e.setfrommatrixcolumn(this,1),n.setfrommatrixcolumn(this,2),this},e.makebasis=function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},e.extractrotation=function(t){var e=this.elements,n=t.elements,r=1/kt.setfrommatrixcolumn(t,0).length(),i=1/kt.setfrommatrixcolumn(t,1).length(),a=1/kt.setfrommatrixcolumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},e.makerotationfromeuler=function(t){t&&t.iseuler||console.error("three.matrix4: .makerotationfromeuler() now expects a euler rotation rather than a vector3 and order.");var e=this.elements,n=t.x,r=t.y,i=t.z,a=math.cos(n),o=math.sin(n),s=math.cos(r),c=math.sin(r),l=math.cos(i),u=math.sin(i);if("xyz"===t.order){var h=a*l,d=a*u,p=o*l,f=o*u;e[0]=s*l,e[4]=-s*u,e[8]=c,e[1]=d+p*c,e[5]=h-f*c,e[9]=-o*s,e[2]=f-h*c,e[6]=p+d*c,e[10]=a*s}else if("yxz"===t.order){var m=s*l,v=s*u,g=c*l,y=c*u;e[0]=m+y*o,e[4]=g*o-v,e[8]=a*c,e[1]=a*u,e[5]=a*l,e[9]=-o,e[2]=v*o-g,e[6]=y+m*o,e[10]=a*s}else if("zxy"===t.order){var x=s*l,_=s*u,b=c*l,w=c*u;e[0]=x-w*o,e[4]=-a*u,e[8]=b+_*o,e[1]=_+b*o,e[5]=a*l,e[9]=w-x*o,e[2]=-a*c,e[6]=o,e[10]=a*s}else if("zyx"===t.order){var m=a*l,s=a*u,t=o*l,e=o*u;e[0]=s*l,e[4]=t*c-s,e[8]=m*c+e,e[1]=s*u,e[5]=e*c+m,e[9]=s*c-t,e[2]=-c,e[6]=o*s,e[10]=a*s}else if("yzx"===t.order){var a=a*s,l=a*c,r=o*s,c=o*c;e[0]=s*l,e[4]=c-a*u,e[8]=r*u+l,e[1]=u,e[5]=a*l,e[9]=-o*l,e[2]=-c*l,e[6]=l*u+r,e[10]=a-c*u}else if("xzy"===t.order){var p=a*s,i=a*c,n=o*s,d=o*c;e[0]=s*l,e[4]=-u,e[8]=c*l,e[1]=p*u+d,e[5]=a*l,e[9]=i*u-n,e[2]=n*u-i,e[6]=o*l,e[10]=d*u+p}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},e.makerotationfromquaternion=function(t){return this.compose(te,t,ee)},e.lookat=function(t,e,n){var r=this.elements;return ie.subvectors(t,e),0===ie.lengthsq()&&(ie.z=1),ie.normalize(),ne.crossvectors(n,ie),0===ne.lengthsq()&&(1===math.abs(n.z)?ie.x+=1e-4:ie.z+=1e-4,ie.normalize(),ne.crossvectors(n,ie)),ne.normalize(),re.crossvectors(ie,ne),r[0]=ne.x,r[4]=re.x,r[8]=ie.x,r[1]=ne.y,r[5]=re.y,r[9]=ie.y,r[2]=ne.z,r[6]=re.z,r[10]=ie.z,this},e.multiply=function(t,e){return void 0!==e?(console.warn("three.matrix4: .multiply() now only accepts one argument. use .multiplymatrices( a, b ) instead."),this.multiplymatrices(t,e)):this.multiplymatrices(this,t)},e.premultiply=function(t){return this.multiplymatrices(t,this)},e.multiplymatrices=function(t,e){var n=t.elements,r=e.elements,i=this.elements,a=n[0],o=n[4],s=n[8],c=n[12],l=n[1],u=n[5],h=n[9],d=n[13],p=n[2],f=n[6],m=n[10],v=n[14],g=n[3],y=n[7],x=n[11],_=n[15],b=r[0],w=r[4],m=r[8],s=r[12],t=r[1],e=r[5],a=r[9],l=r[13],r=r[2],c=r[6],p=r[10],i=r[14],n=r[3],d=r[7],o=r[11],b=r[15];return i[0]=a*b+o*t+s*r+c*n,i[4]=a*w+o*e+s*c+c*d,i[8]=a*m+o*a+s*p+c*o,i[12]=a*s+o*l+s*i+c*b,i[1]=l*b+u*t+h*r+d*n,i[5]=l*w+u*e+h*c+d*d,i[9]=l*m+u*a+h*p+d*o,i[13]=l*s+u*l+h*i+d*b,i[2]=p*b+f*t+m*r+v*n,i[6]=p*w+f*e+m*c+v*d,i[10]=p*m+f*a+m*p+v*o,i[14]=p*s+f*l+m*i+v*b,i[3]=g*b+y*t+x*r+_*n,i[7]=g*w+y*e+x*c+_*d,i[11]=g*m+y*a+x*p+_*o,i[15]=g*s+y*l+x*i+_*b,this},e.multiplyscalar=function(t){var e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this},e.determinant=function(){var t=this.elements,e=t[0],n=t[4],r=t[8],i=t[12],a=t[1],o=t[5],s=t[9],c=t[13],l=t[2],u=t[6],h=t[10],d=t[14];return t[3]*(+i*s*u-r*c*u-i*o*h+n*c*h+r*o*d-n*s*d)+t[7]*(+e*s*d-e*c*h+i*a*h-r*a*d+r*c*l-i*s*l)+t[11]*(+e*c*u-e*o*d-i*a*u+n*a*d+i*o*l-n*c*l)+t[15]*(-r*o*l-e*s*u+e*o*h+r*a*u-n*a*h+n*s*l)},e.transpose=function(){var t,e=this.elements;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},e.setposition=function(t,e,n){var r=this.elements;return t.isvector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},e.invert=function(){var t=this.elements,e=t[0],n=t[1],r=t[2],i=t[3],a=t[4],o=t[5],s=t[6],c=t[7],l=t[8],u=t[9],h=t[10],d=t[11],p=t[12],f=t[13],m=t[14],v=t[15],g=u*m*c-f*h*c+f*s*d-o*m*d-u*s*v+o*h*v,y=p*h*c-l*m*c-p*s*d+a*m*d+l*s*v-a*h*v,x=l*f*c-p*u*c+p*o*d-a*f*d-l*o*v+a*u*v,_=p*u*s-l*f*s-p*o*h+a*f*h+l*o*m-a*u*m,b=e*g+n*y+r*x+i*_;if(0===b)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/b;return t[0]=g*w,t[1]=(f*h*i-u*m*i-f*r*d+n*m*d+u*r*v-n*h*v)*w,t[2]=(o*m*i-f*s*i+f*r*c-n*m*c-o*r*v+n*s*v)*w,t[3]=(u*s*i-o*h*i-u*r*c+n*h*c+o*r*d-n*s*d)*w,t[4]=y*w,t[5]=(l*m*i-p*h*i+p*r*d-e*m*d-l*r*v+e*h*v)*w,t[6]=(p*s*i-a*m*i-p*r*c+e*m*c+a*r*v-e*s*v)*w,t[7]=(a*h*i-l*s*i+l*r*c-e*h*c-a*r*d+e*s*d)*w,t[8]=x*w,t[9]=(p*u*i-l*f*i-p*n*d+e*f*d+l*n*v-e*u*v)*w,t[10]=(a*f*i-p*o*i+p*n*c-e*f*c-a*n*v+e*o*v)*w,t[11]=(l*o*i-a*u*i-l*n*c+e*u*c+a*n*d-e*o*d)*w,t[12]=_*w,t[13]=(l*f*r-p*u*r+p*n*h-e*f*h-l*n*m+e*u*m)*w,t[14]=(p*o*r-a*f*r-p*n*s+e*f*s+a*n*m-e*o*m)*w,t[15]=(a*u*r-l*o*r+l*n*s-e*u*s-a*n*h+e*o*h)*w,this},e.scale=function(t){var e=this.elements,n=t.x,r=t.y,i=t.z;return e[0]*=n,e[4]*=r,e[8]*=i,e[1]*=n,e[5]*=r,e[9]*=i,e[2]*=n,e[6]*=r,e[10]*=i,e[3]*=n,e[7]*=r,e[11]*=i,this},e.getmaxscaleonaxis=function(){var t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return math.sqrt(math.max(e,n,r))},e.maketranslation=function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},e.makerotationx=function(t){var e=math.cos(t),n=math.sin(t);return this.set(1,0,0,0,0,e,-n,0,0,n,e,0,0,0,0,1),this},e.makerotationy=function(t){var e=math.cos(t),n=math.sin(t);return this.set(e,0,n,0,0,1,0,0,-n,0,e,0,0,0,0,1),this},e.makerotationz=function(t){var e=math.cos(t),n=math.sin(t);return this.set(e,-n,0,0,n,e,0,0,0,0,1,0,0,0,0,1),this},e.makerotationaxis=function(t,e){var n=math.cos(e),r=math.sin(e),i=1-n,a=t.x,o=t.y,s=t.z,c=i*a,l=i*o;return this.set(c*a+n,c*o-r*s,c*s+r*o,0,c*o+r*s,l*o+n,l*s-r*a,0,c*s-r*o,l*s+r*a,i*s*s+n,0,0,0,0,1),this},e.makescale=function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},e.makeshear=function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},e.compose=function(t,e,n){var r=this.elements,i=e._x,a=e._y,o=e._z,s=e._w,c=i+i,l=a+a,u=o+o,h=i*c,d=i*l,p=i*u,f=a*l,m=a*u,v=o*u,g=s*c,y=s*l,x=s*u,_=n.x,b=n.y,w=n.z;return r[0]=(1-(f+v))*_,r[1]=(d+x)*_,r[2]=(p-y)*_,r[3]=0,r[4]=(d-x)*b,r[5]=(1-(h+v))*b,r[6]=(m+g)*b,r[7]=0,r[8]=(p+y)*w,r[9]=(m-g)*w,r[10]=(1-(h+f))*w,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},e.decompose=function(t,e,n){var r=this.elements,i=kt.set(r[0],r[1],r[2]).length(),a=kt.set(r[4],r[5],r[6]).length(),o=kt.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),t.x=r[12],t.y=r[13],t.z=r[14],$t.copy(this);var s=1/i,c=1/a,l=1/o;return $t.elements[0]*=s,$t.elements[1]*=s,$t.elements[2]*=s,$t.elements[4]*=c,$t.elements[5]*=c,$t.elements[6]*=c,$t.elements[8]*=l,$t.elements[9]*=l,$t.elements[10]*=l,e.setfromrotationmatrix($t),n.x=i,n.y=a,n.z=o,this},e.makeperspective=function(t,e,n,r,i,a){void 0===a&&console.warn("three.matrix4: .makeperspective() has been redefined and has a new signature. please check the docs.");var o=this.elements,s=2*i/(e-t),c=2*i/(n-r),l=(e+t)/(e-t),u=(n+r)/(n-r),h=-(a+i)/(a-i),d=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=c,o[9]=u,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},e.makeorthographic=function(t,e,n,r,i,a){var o=this.elements,s=1/(e-t),c=1/(n-r),l=1/(a-i),u=(e+t)*s,h=(n+r)*c,d=(a+i)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-u,o[1]=0,o[5]=2*c,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},e.equals=function(t){for(var e=this.elements,n=t.elements,r=0;r<16;r++)if(e[r]!==n[r])return!1;return!0},e.fromarray=function(t,e){void 0===e&&(e=0);for(var n=0;n<16;n++)this.elements[n]=t[n+e];return this},e.toarray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);var n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},t}(),kt=new mt,$t=new qt,te=new mt(0,0,0),ee=new mt(1,1,1),ne=new mt,re=new mt,ie=new mt,ae=function(){function t(e,n,r,i){void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===i&&(i=t.defaultorder),object.defineproperty(this,"iseuler",{value:!0}),this._x=e,this._y=n,this._z=r,this._order=i}var e=t.prototype;return e.set=function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onchangecallback(),this},e.clone=function(){return new this.constructor(this._x,this._y,this._z,this._order)},e.copy=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onchangecallback(),this},e.setfromrotationmatrix=function(t,e,n){var r=st.clamp,i=t.elements,a=i[0],o=i[4],s=i[8],c=i[1],l=i[5],u=i[9],h=i[2],d=i[6],p=i[10];switch(e=e||this._order){case"xyz":this._y=math.asin(r(s,-1,1)),math.abs(s)<.9999999?(this._x=math.atan2(-u,p),this._z=math.atan2(-o,a)):(this._x=math.atan2(d,l),this._z=0);break;case"yxz":this._x=math.asin(-r(u,-1,1)),math.abs(u)<.9999999?(this._y=math.atan2(s,p),this._z=math.atan2(c,l)):(this._y=math.atan2(-h,a),this._z=0);break;case"zxy":this._x=math.asin(r(d,-1,1)),math.abs(d)<.9999999?(this._y=math.atan2(-h,p),this._z=math.atan2(-o,l)):(this._y=0,this._z=math.atan2(c,a));break;case"zyx":this._y=math.asin(-r(h,-1,1)),math.abs(h)<.9999999?(this._x=math.atan2(d,p),this._z=math.atan2(c,a)):(this._x=0,this._z=math.atan2(-o,l));break;case"yzx":this._z=math.asin(r(c,-1,1)),math.abs(c)<.9999999?(this._x=math.atan2(-u,l),this._y=math.atan2(-h,a)):(this._x=0,this._y=math.atan2(s,p));break;case"xzy":this._z=math.asin(-r(o,-1,1)),math.abs(o)<.9999999?(this._x=math.atan2(d,l),this._y=math.atan2(s,a)):(this._x=math.atan2(-u,p),this._y=0);break;default:console.warn("three.euler: .setfromrotationmatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onchangecallback(),this},e.setfromquaternion=function(t,e,n){return oe.makerotationfromquaternion(t),this.setfromrotationmatrix(oe,e,n)},e.setfromvector3=function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},e.reorder=function(t){return se.setfromeuler(this),this.setfromquaternion(se,t)},e.equals=function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},e.fromarray=function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onchangecallback(),this},e.toarray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},e.tovector3=function(t){return t?t.set(this._x,this._y,this._z):new mt(this._x,this._y,this._z)},e._onchange=function(t){return this._onchangecallback=t,this},e._onchangecallback=function(){},lt(t,[{key:"x",get:function(){return this._x},set:function(t){this._x=t,this._onchangecallback()}},{key:"y",get:function(){return this._y},set:function(t){this._y=t,this._onchangecallback()}},{key:"z",get:function(){return this._z},set:function(t){this._z=t,this._onchangecallback()}},{key:"order",get:function(){return this._order},set:function(t){this._order=t,this._onchangecallback()}}]),t}();ae.defaultorder="xyz",ae.rotationorders=["xyz","yzx","zxy","xzy","yxz","zyx"];var oe=new qt,se=new wt,ce=function(){function t(){this.mask=1}var e=t.prototype;return e.set=function(t){this.mask=1<<t|0},e.enable=function(t){this.mask|=1<<t|0},e.enableall=function(){this.mask=-1},e.toggle=function(t){this.mask^=1<<t|0},e.disable=function(t){this.mask&=~(1<<t|0)},e.disableall=function(){this.mask=0},e.test=function(t){return 0!=(this.mask&t.mask)},t}(),le=0,ue=new mt,he=new wt,de=new qt,pe=new mt,fe=new mt,me=new mt,ve=new wt,ge=new mt(1,0,0),ye=new mt(0,1,0),xe=new mt(0,0,1),_e={type:"added"},be={type:"removed"};function we(){object.defineproperty(this,"id",{value:le++}),this.uuid=st.generateuuid(),this.name="",this.type="object3d",this.parent=null,this.children=[],this.up=we.defaultup.clone();var t=new mt,e=new ae,n=new wt,r=new mt(1,1,1);e._onchange((function(){n.setfromeuler(e,!1)})),n._onchange((function(){e.setfromquaternion(n,void 0,!1)})),object.defineproperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelviewmatrix:{value:new qt},normalmatrix:{value:new ft}}),this.matrix=new qt,this.matrixworld=new qt,this.matrixautoupdate=we.defaultmatrixautoupdate,this.matrixworldneedsupdate=!1,this.layers=new ce,this.visible=!0,this.castshadow=!1,this.receiveshadow=!1,this.frustumculled=!0,this.renderorder=0,this.animations=[],this.userdata={}}we.defaultup=new mt(0,1,0),we.defaultmatrixautoupdate=!0,we.prototype=object.assign(object.create(rt.prototype),{constructor:we,isobject3d:!0,onbeforerender:function(){},onafterrender:function(){},applymatrix4:function(t){this.matrixautoupdate&&this.updatematrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyquaternion:function(t){return this.quaternion.premultiply(t),this},setrotationfromaxisangle:function(t,e){this.quaternion.setfromaxisangle(t,e)},setrotationfromeuler:function(t){this.quaternion.setfromeuler(t,!0)},setrotationfrommatrix:function(t){this.quaternion.setfromrotationmatrix(t)},setrotationfromquaternion:function(t){this.quaternion.copy(t)},rotateonaxis:function(t,e){return he.setfromaxisangle(t,e),this.quaternion.multiply(he),this},rotateonworldaxis:function(t,e){return he.setfromaxisangle(t,e),this.quaternion.premultiply(he),this},rotatex:function(t){return this.rotateonaxis(ge,t)},rotatey:function(t){return this.rotateonaxis(ye,t)},rotatez:function(t){return this.rotateonaxis(xe,t)},translateonaxis:function(t,e){return ue.copy(t).applyquaternion(this.quaternion),this.position.add(ue.multiplyscalar(e)),this},translatex:function(t){return this.translateonaxis(ge,t)},translatey:function(t){return this.translateonaxis(ye,t)},translatez:function(t){return this.translateonaxis(xe,t)},localtoworld:function(t){return t.applymatrix4(this.matrixworld)},worldtolocal:function(t){return t.applymatrix4(de.copy(this.matrixworld).invert())},lookat:function(t,e,n){t.isvector3?pe.copy(t):pe.set(t,e,n);var r=this.parent;this.updateworldmatrix(!0,!1),fe.setfrommatrixposition(this.matrixworld),this.iscamera||this.islight?de.lookat(fe,pe,this.up):de.lookat(pe,fe,this.up),this.quaternion.setfromrotationmatrix(de),r&&(de.extractrotation(r.matrixworld),he.setfromrotationmatrix(de),this.quaternion.premultiply(he.invert()))},add:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("three.object3d.add: object can't be added as a child of itself.",t),this):(t&&t.isobject3d?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchevent(_e)):console.error("three.object3d.add: object not an instance of three.object3d.",t),this)},remove:function(t){if(arguments.length>1){for(var e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}var n=this.children.indexof(t);return-1!==n&&(t.parent=null,this.children.splice(n,1),t.dispatchevent(be)),this},clear:function(){for(var t=0;t<this.children.length;t++){var e=this.children[t];e.parent=null,e.dispatchevent(be)}return this.children.length=0,this},attach:function(t){return this.updateworldmatrix(!0,!1),de.copy(this.matrixworld).invert(),null!==t.parent&&(t.parent.updateworldmatrix(!0,!1),de.multiply(t.parent.matrixworld)),t.applymatrix4(de),t.updateworldmatrix(!1,!1),this.add(t),this},getobjectbyid:function(t){return this.getobjectbyproperty("id",t)},getobjectbyname:function(t){return this.getobjectbyproperty("name",t)},getobjectbyproperty:function(t,e){if(this[t]===e)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getobjectbyproperty(t,e);if(void 0!==i)return i}},getworldposition:function(t){return void 0===t&&(console.warn("three.object3d: .getworldposition() target is now required"),t=new mt),this.updateworldmatrix(!0,!1),t.setfrommatrixposition(this.matrixworld)},getworldquaternion:function(t){return void 0===t&&(console.warn("three.object3d: .getworldquaternion() target is now required"),t=new wt),this.updateworldmatrix(!0,!1),this.matrixworld.decompose(fe,t,me),t},getworldscale:function(t){return void 0===t&&(console.warn("three.object3d: .getworldscale() target is now required"),t=new mt),this.updateworldmatrix(!0,!1),this.matrixworld.decompose(fe,ve,t),t},getworlddirection:function(t){void 0===t&&(console.warn("three.object3d: .getworlddirection() target is now required"),t=new mt),this.updateworldmatrix(!0,!1);var e=this.matrixworld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traverse(t)},traversevisible:function(t){if(!1!==this.visible){t(this);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].traversevisible(t)}},traverseancestors:function(t){var e=this.parent;null!==e&&(t(e),e.traverseancestors(t))},updatematrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixworldneedsupdate=!0},updatematrixworld:function(t){this.matrixautoupdate&&this.updatematrix(),(this.matrixworldneedsupdate||t)&&(null===this.parent?this.matrixworld.copy(this.matrix):this.matrixworld.multiplymatrices(this.parent.matrixworld,this.matrix),this.matrixworldneedsupdate=!1,t=!0);for(var e=this.children,n=0,r=e.length;n<r;n++)e[n].updatematrixworld(t)},updateworldmatrix:function(t,e){var n=this.parent;if(!0===t&&null!==n&&n.updateworldmatrix(!0,!1),this.matrixautoupdate&&this.updatematrix(),null===this.parent?this.matrixworld.copy(this.matrix):this.matrixworld.multiplymatrices(this.parent.matrixworld,this.matrix),!0===e)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateworldmatrix(!1,!0)},tojson:function(t){var e=void 0===t||"string"==typeof t,n={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"object",generator:"object3d.tojson"});var r={};function i(e,n){return void 0===e[n.uuid]&&(e[n.uuid]=n.tojson(t)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castshadow&&(r.castshadow=!0),!0===this.receiveshadow&&(r.receiveshadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumculled&&(r.frustumculled=!1),0!==this.renderorder&&(r.renderorder=this.renderorder),"{}"!==json.stringify(this.userdata)&&(r.userdata=this.userdata),r.layers=this.layers.mask,r.matrix=this.matrix.toarray(),!1===this.matrixautoupdate&&(r.matrixautoupdate=!1),this.isinstancedmesh&&(r.type="instancedmesh",r.count=this.count,r.instancematrix=this.instancematrix.tojson()),this.ismesh||this.isline||this.ispoints){r.geometry=i(t.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(array.isarray(o))for(var s=0,c=o.length;s<c;s++){var l=o[s];i(t.shapes,l)}else i(t.shapes,o)}}if(this.isskinnedmesh&&(r.bindmode=this.bindmode,r.bindmatrix=this.bindmatrix.toarray(),void 0!==this.skeleton&&(i(t.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(array.isarray(this.material)){for(var u=[],h=0,d=this.material.length;h<d;h++)u.push(i(t.materials,this.material[h]));r.material=u}else r.material=i(t.materials,this.material);if(this.children.length>0){r.children=[];for(var p=0;p<this.children.length;p++)r.children.push(this.children[p].tojson(t).object)}if(this.animations.length>0){r.animations=[];for(var f=0;f<this.animations.length;f++){var m=this.animations[f];r.animations.push(i(t.animations,m))}}if(e){var v=m(t.geometries),g=m(t.materials),y=m(t.textures),x=m(t.images),_=m(t.shapes),b=m(t.skeletons),w=m(t.animations);v.length>0&&(n.geometries=v),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),x.length>0&&(n.images=x),_.length>0&&(n.shapes=_),b.length>0&&(n.skeletons=b),w.length>0&&(n.animations=w)}return n.object=r,n;function m(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(t,e){if(void 0===e&&(e=!0),this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixworld.copy(t.matrixworld),this.matrixautoupdate=t.matrixautoupdate,this.matrixworldneedsupdate=t.matrixworldneedsupdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castshadow=t.castshadow,this.receiveshadow=t.receiveshadow,this.frustumculled=t.frustumculled,this.renderorder=t.renderorder,this.userdata=json.parse(json.stringify(t.userdata)),!0===e)for(var n=0;n<t.children.length;n++){var r=t.children[n];this.add(r.clone())}return this}});var me=new mt,se=new mt,te=new ft,ee=function(){function t(t,e){object.defineproperty(this,"isplane",{value:!0}),this.normal=void 0!==t?t:new mt(1,0,0),this.constant=void 0!==e?e:0}var e=t.prototype;return e.set=function(t,e){return this.normal.copy(t),this.constant=e,this},e.setcomponents=function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},e.setfromnormalandcoplanarpoint=function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},e.setfromcoplanarpoints=function(t,e,n){var r=me.subvectors(n,e).cross(se.subvectors(t,e)).normalize();return this.setfromnormalandcoplanarpoint(r,t),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},e.normalize=function(){var t=1/this.normal.length();return this.normal.multiplyscalar(t),this.constant*=t,this},e.negate=function(){return this.constant*=-1,this.normal.negate(),this},e.distancetopoint=function(t){return this.normal.dot(t)+this.constant},e.distancetosphere=function(t){return this.distancetopoint(t.center)-t.radius},e.projectpoint=function(t,e){return void 0===e&&(console.warn("three.plane: .projectpoint() target is now required"),e=new mt),e.copy(this.normal).multiplyscalar(-this.distancetopoint(t)).add(t)},e.intersectline=function(t,e){void 0===e&&(console.warn("three.plane: .intersectline() target is now required"),e=new mt);var n=t.delta(me),r=this.normal.dot(n);if(0===r)return 0===this.distancetopoint(t.start)?e.copy(t.start):void 0;var i=-(t.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:e.copy(n).multiplyscalar(i).add(t.start)},e.intersectsline=function(t){var e=this.distancetopoint(t.start),n=this.distancetopoint(t.end);return e<0&&n>0||n<0&&e>0},e.intersectsbox=function(t){return t.intersectsplane(this)},e.intersectssphere=function(t){return t.intersectsplane(this)},e.coplanarpoint=function(t){return void 0===t&&(console.warn("three.plane: .coplanarpoint() target is now required"),t=new mt),t.copy(this.normal).multiplyscalar(-this.constant)},e.applymatrix4=function(t,e){var n=e||te.getnormalmatrix(t),r=this.coplanarpoint(me).applymatrix4(t),i=this.normal.applymatrix3(n).normalize();return this.constant=-r.dot(i),this},e.translate=function(t){return this.constant-=t.dot(this.normal),this},e.equals=function(t){return t.normal.equals(this.normal)&&t.constant===this.constant},t}(),ae=new mt,le=new mt,re=new mt,ce=new mt,pe=new mt,ie=new mt,ne=new mt,de=new mt,oe=new mt,be=new mt,ze=function(){function t(t,e,n){this.a=void 0!==t?t:new mt,this.b=void 0!==e?e:new mt,this.c=void 0!==n?n:new mt}t.getnormal=function(t,e,n,r){void 0===r&&(console.warn("three.triangle: .getnormal() target is now required"),r=new mt),r.subvectors(n,e),ae.subvectors(t,e),r.cross(ae);var i=r.lengthsq();return i>0?r.multiplyscalar(1/math.sqrt(i)):r.set(0,0,0)},t.getbarycoord=function(t,e,n,r,i){ae.subvectors(r,e),le.subvectors(n,e),re.subvectors(t,e);var a=ae.dot(ae),o=ae.dot(le),s=ae.dot(re),c=le.dot(le),l=le.dot(re),u=a*c-o*o;if(void 0===i&&(console.warn("three.triangle: .getbarycoord() target is now required"),i=new mt),0===u)return i.set(-2,-1,-1);var h=1/u,d=(c*s-o*l)*h,p=(a*l-o*s)*h;return i.set(1-d-p,p,d)},t.containspoint=function(t,e,n,r){return this.getbarycoord(t,e,n,r,ce),ce.x>=0&&ce.y>=0&&ce.x+ce.y<=1},t.getuv=function(t,e,n,r,i,a,o,s){return this.getbarycoord(t,e,n,r,ce),s.set(0,0),s.addscaledvector(i,ce.x),s.addscaledvector(a,ce.y),s.addscaledvector(o,ce.z),s},t.isfrontfacing=function(t,e,n,r){return ae.subvectors(n,e),le.subvectors(t,e),ae.cross(le).dot(r)<0};var e=t.prototype;return e.set=function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},e.setfrompointsandindices=function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},e.getarea=function(){return ae.subvectors(this.c,this.b),le.subvectors(this.a,this.b),.5*ae.cross(le).length()},e.getmidpoint=function(t){return void 0===t&&(console.warn("three.triangle: .getmidpoint() target is now required"),t=new mt),t.addvectors(this.a,this.b).add(this.c).multiplyscalar(1/3)},e.getnormal=function(e){return t.getnormal(this.a,this.b,this.c,e)},e.getplane=function(t){return void 0===t&&(console.warn("three.triangle: .getplane() target is now required"),t=new ee),t.setfromcoplanarpoints(this.a,this.b,this.c)},e.getbarycoord=function(e,n){return t.getbarycoord(e,this.a,this.b,this.c,n)},e.getuv=function(e,n,r,i,a){return t.getuv(e,this.a,this.b,this.c,n,r,i,a)},e.containspoint=function(e){return t.containspoint(e,this.a,this.b,this.c)},e.isfrontfacing=function(e){return t.isfrontfacing(this.a,this.b,this.c,e)},e.intersectsbox=function(t){return t.intersectstriangle(this)},e.closestpointtopoint=function(t,e){void 0===e&&(console.warn("three.triangle: .closestpointtopoint() target is now required"),e=new mt);var n,r,i=this.a,a=this.b,o=this.c;pe.subvectors(a,i),ie.subvectors(o,i),de.subvectors(t,i);var s=pe.dot(de),c=ie.dot(de);if(s<=0&&c<=0)return e.copy(i);oe.subvectors(t,a);var l=pe.dot(oe),u=ie.dot(oe);if(l>=0&&u<=l)return e.copy(a);var h=s*u-l*c;if(h<=0&&s>=0&&l<=0)return n=s/(s-l),e.copy(i).addscaledvector(pe,n);be.subvectors(t,o);var d=pe.dot(be),p=ie.dot(be);if(p>=0&&d<=p)return e.copy(o);var f=d*c-s*p;if(f<=0&&c>=0&&p<=0)return r=c/(c-p),e.copy(i).addscaledvector(ie,r);var m=l*p-d*u;if(m<=0&&u-l>=0&&d-p>=0)return ne.subvectors(o,a),r=(u-l)/(u-l+(d-p)),e.copy(a).addscaledvector(ne,r);var v=1/(m+f+h);return n=f*v,r=h*v,e.copy(i).addscaledvector(pe,n).addscaledvector(ie,r)},e.equals=function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)},t}(),fe={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ge={h:0,s:0,l:0},ue={h:0,s:0,l:0};function he(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}function ke(t){return t<.04045?.0773993808*t:math.pow(.9478672986*t+.0521327014,2.4)}function ve(t){return t<.0031308?12.92*t:1.055*math.pow(t,.41666)-.055}var we=function(){function t(t,e,n){return object.defineproperty(this,"iscolor",{value:!0}),void 0===e&&void 0===n?this.set(t):this.setrgb(t,e,n)}var e=t.prototype;return e.set=function(t){return t&&t.iscolor?this.copy(t):"number"==typeof t?this.sethex(t):"string"==typeof t&&this.setstyle(t),this},e.setscalar=function(t){return this.r=t,this.g=t,this.b=t,this},e.sethex=function(t){return t=math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},e.setrgb=function(t,e,n){return this.r=t,this.g=e,this.b=n,this},e.sethsl=function(t,e,n){if(t=st.euclideanmodulo(t,1),e=st.clamp(e,0,1),n=st.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=he(i,r,t+1/3),this.g=he(i,r,t),this.b=he(i,r,t-1/3)}return this},e.setstyle=function(t){function e(e){void 0!==e&&parsefloat(e)<1&&console.warn("three.color: alpha component of "+t+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(t)){var r,i=n[1],a=n[2];switch(i){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=math.min(255,parseint(r[1],10))/255,this.g=math.min(255,parseint(r[2],10))/255,this.b=math.min(255,parseint(r[3],10))/255,e(r[4]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=math.min(100,parseint(r[1],10))/100,this.g=math.min(100,parseint(r[2],10))/100,this.b=math.min(100,parseint(r[3],10))/100,e(r[4]),this;break;case"hsl":case"hsla":if(r=/^(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parsefloat(r[1])/360,s=parseint(r[2],10)/100,c=parseint(r[3],10)/100;return e(r[4]),this.sethsl(o,s,c)}}}else if(n=/^\#([a-fa-f\d]+)$/.exec(t)){var l=n[1],u=l.length;if(3===u)return this.r=parseint(l.charat(0)+l.charat(0),16)/255,this.g=parseint(l.charat(1)+l.charat(1),16)/255,this.b=parseint(l.charat(2)+l.charat(2),16)/255,this;if(6===u)return this.r=parseint(l.charat(0)+l.charat(1),16)/255,this.g=parseint(l.charat(2)+l.charat(3),16)/255,this.b=parseint(l.charat(4)+l.charat(5),16)/255,this}return t&&t.length>0?this.setcolorname(t):this},e.setcolorname=function(t){var e=fe[t];return void 0!==e?this.sethex(e):console.warn("three.color: unknown color "+t),this},e.clone=function(){return new this.constructor(this.r,this.g,this.b)},e.copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},e.copygammatolinear=function(t,e){return void 0===e&&(e=2),this.r=math.pow(t.r,e),this.g=math.pow(t.g,e),this.b=math.pow(t.b,e),this},e.copylineartogamma=function(t,e){void 0===e&&(e=2);var n=e>0?1/e:1;return this.r=math.pow(t.r,n),this.g=math.pow(t.g,n),this.b=math.pow(t.b,n),this},e.convertgammatolinear=function(t){return this.copygammatolinear(this,t),this},e.convertlineartogamma=function(t){return this.copylineartogamma(this,t),this},e.copysrgbtolinear=function(t){return this.r=ke(t.r),this.g=ke(t.g),this.b=ke(t.b),this},e.copylineartosrgb=function(t){return this.r=ve(t.r),this.g=ve(t.g),this.b=ve(t.b),this},e.convertsrgbtolinear=function(){return this.copysrgbtolinear(this),this},e.convertlineartosrgb=function(){return this.copylineartosrgb(this),this},e.gethex=function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},e.gethexstring=function(){return("000000"+this.gethex().tostring(16)).slice(-6)},e.gethsl=function(t){void 0===t&&(console.warn("three.color: .gethsl() target is now required"),t={h:0,s:0,l:0});var e,n,r=this.r,i=this.g,a=this.b,o=math.max(r,i,a),s=math.min(r,i,a),c=(s+o)/2;if(s===o)e=0,n=0;else{var l=o-s;switch(n=c<=.5?l/(o+s):l/(2-o-s),o){case r:e=(i-a)/l+(i<a?6:0);break;case i:e=(a-r)/l+2;break;case a:e=(r-i)/l+4}e/=6}return t.h=e,t.s=n,t.l=c,t},e.getstyle=function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},e.offsethsl=function(t,e,n){return this.gethsl(ge),ge.h+=t,ge.s+=e,ge.l+=n,this.sethsl(ge.h,ge.s,ge.l),this},e.add=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},e.addcolors=function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},e.addscalar=function(t){return this.r+=t,this.g+=t,this.b+=t,this},e.sub=function(t){return this.r=math.max(0,this.r-t.r),this.g=math.max(0,this.g-t.g),this.b=math.max(0,this.b-t.b),this},e.multiply=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},e.multiplyscalar=function(t){return this.r*=t,this.g*=t,this.b*=t,this},e.lerp=function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},e.lerphsl=function(t,e){this.gethsl(ge),t.gethsl(ue);var n=st.lerp(ge.h,ue.h,e),r=st.lerp(ge.s,ue.s,e),i=st.lerp(ge.l,ue.l,e);return this.sethsl(n,r,i),this},e.equals=function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},e.fromarray=function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},e.toarray=function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},e.frombufferattribute=function(t,e){return this.r=t.getx(e),this.g=t.gety(e),this.b=t.getz(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},e.tojson=function(){return this.gethex()},t}();we.names=fe,we.prototype.r=1,we.prototype.g=1,we.prototype.b=1;var je=function(){function t(t,e,n,r,i,a){void 0===a&&(a=0),this.a=t,this.b=e,this.c=n,this.normal=r&&r.isvector3?r:new mt,this.vertexnormals=array.isarray(r)?r:[],this.color=i&&i.iscolor?i:new we,this.vertexcolors=array.isarray(i)?i:[],this.materialindex=a}var e=t.prototype;return e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){this.a=t.a,this.b=t.b,this.c=t.c,this.normal.copy(t.normal),this.color.copy(t.color),this.materialindex=t.materialindex;for(var e=0,n=t.vertexnormals.length;e<n;e++)this.vertexnormals[e]=t.vertexnormals[e].clone();for(var r=0,i=t.vertexcolors.length;r<i;r++)this.vertexcolors[r]=t.vertexcolors[r].clone();return this},t}(),qe=0;function xe(){object.defineproperty(this,"id",{value:qe++}),this.uuid=st.generateuuid(),this.name="",this.type="material",this.fog=!0,this.blending=1,this.side=0,this.flatshading=!1,this.vertexcolors=!1,this.opacity=1,this.transparent=!1,this.blendsrc=204,this.blenddst=205,this.blendequation=e,this.blendsrcalpha=null,this.blenddstalpha=null,this.blendequationalpha=null,this.depthfunc=3,this.depthtest=!0,this.depthwrite=!0,this.stencilwritemask=255,this.stencilfunc=519,this.stencilref=0,this.stencilfuncmask=255,this.stencilfail=$,this.stencilzfail=$,this.stencilzpass=$,this.stencilwrite=!1,this.clippingplanes=null,this.clipintersection=!1,this.clipshadows=!1,this.shadowside=null,this.colorwrite=!0,this.precision=null,this.polygonoffset=!1,this.polygonoffsetfactor=0,this.polygonoffsetunits=0,this.dithering=!1,this.alphatest=0,this.premultipliedalpha=!1,this.visible=!0,this.tonemapped=!0,this.userdata={},this.version=0}function ye(t){xe.call(this),this.type="meshbasicmaterial",this.color=new we(16777215),this.map=null,this.lightmap=null,this.lightmapintensity=1,this.aomap=null,this.aomapintensity=1,this.specularmap=null,this.alphamap=null,this.envmap=null,this.combine=0,this.reflectivity=1,this.refractionratio=.98,this.wireframe=!1,this.wireframelinewidth=1,this.wireframelinecap="round",this.wireframelinejoin="round",this.skinning=!1,this.morphtargets=!1,this.setvalues(t)}xe.prototype=object.assign(object.create(rt.prototype),{constructor:xe,ismaterial:!0,onbeforecompile:function(){},customprogramcachekey:function(){return this.onbeforecompile.tostring()},setvalues:function(t){if(void 0!==t)for(var e in t){var n=t[e];if(void 0!==n)if("shading"!==e){var r=this[e];void 0!==r?r&&r.iscolor?r.set(n):r&&r.isvector3&&n&&n.isvector3?r.copy(n):this[e]=n:console.warn("three."+this.type+": '"+e+"' is not a property of this material.")}else console.warn("three."+this.type+": .shading has been removed. use the boolean .flatshading instead."),this.flatshading=1===n;else console.warn("three.material: '"+e+"' parameter is undefined.")}},tojson:function(t){var e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});var n={metadata:{version:4.5,type:"material",generator:"material.tojson"}};function r(t){var e=[];for(var n in t){var r=t[n];delete r.metadata,e.push(r)}return e}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.iscolor&&(n.color=this.color.gethex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.iscolor&&(n.sheen=this.sheen.gethex()),this.emissive&&this.emissive.iscolor&&(n.emissive=this.emissive.gethex()),this.emissiveintensity&&1!==this.emissiveintensity&&(n.emissiveintensity=this.emissiveintensity),this.specular&&this.specular.iscolor&&(n.specular=this.specular.gethex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatroughness&&(n.clearcoatroughness=this.clearcoatroughness),this.clearcoatmap&&this.clearcoatmap.istexture&&(n.clearcoatmap=this.clearcoatmap.tojson(t).uuid),this.clearcoatroughnessmap&&this.clearcoatroughnessmap.istexture&&(n.clearcoatroughnessmap=this.clearcoatroughnessmap.tojson(t).uuid),this.clearcoatnormalmap&&this.clearcoatnormalmap.istexture&&(n.clearcoatnormalmap=this.clearcoatnormalmap.tojson(t).uuid,n.clearcoatnormalscale=this.clearcoatnormalscale.toarray()),this.map&&this.map.istexture&&(n.map=this.map.tojson(t).uuid),this.matcap&&this.matcap.istexture&&(n.matcap=this.matcap.tojson(t).uuid),this.alphamap&&this.alphamap.istexture&&(n.alphamap=this.alphamap.tojson(t).uuid),this.lightmap&&this.lightmap.istexture&&(n.lightmap=this.lightmap.tojson(t).uuid),this.aomap&&this.aomap.istexture&&(n.aomap=this.aomap.tojson(t).uuid,n.aomapintensity=this.aomapintensity),this.bumpmap&&this.bumpmap.istexture&&(n.bumpmap=this.bumpmap.tojson(t).uuid,n.bumpscale=this.bumpscale),this.normalmap&&this.normalmap.istexture&&(n.normalmap=this.normalmap.tojson(t).uuid,n.normalmaptype=this.normalmaptype,n.normalscale=this.normalscale.toarray()),this.displacementmap&&this.displacementmap.istexture&&(n.displacementmap=this.displacementmap.tojson(t).uuid,n.displacementscale=this.displacementscale,n.displacementbias=this.displacementbias),this.roughnessmap&&this.roughnessmap.istexture&&(n.roughnessmap=this.roughnessmap.tojson(t).uuid),this.metalnessmap&&this.metalnessmap.istexture&&(n.metalnessmap=this.metalnessmap.tojson(t).uuid),this.emissivemap&&this.emissivemap.istexture&&(n.emissivemap=this.emissivemap.tojson(t).uuid),this.specularmap&&this.specularmap.istexture&&(n.specularmap=this.specularmap.tojson(t).uuid),this.envmap&&this.envmap.istexture&&(n.envmap=this.envmap.tojson(t).uuid,n.reflectivity=this.reflectivity,n.refractionratio=this.refractionratio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envmapintensity&&(n.envmapintensity=this.envmapintensity)),this.gradientmap&&this.gradientmap.istexture&&(n.gradientmap=this.gradientmap.tojson(t).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeattenuation&&(n.sizeattenuation=this.sizeattenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatshading&&(n.flatshading=this.flatshading),0!==this.side&&(n.side=this.side),this.vertexcolors&&(n.vertexcolors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthfunc=this.depthfunc,n.depthtest=this.depthtest,n.depthwrite=this.depthwrite,n.stencilwrite=this.stencilwrite,n.stencilwritemask=this.stencilwritemask,n.stencilfunc=this.stencilfunc,n.stencilref=this.stencilref,n.stencilfuncmask=this.stencilfuncmask,n.stencilfail=this.stencilfail,n.stencilzfail=this.stencilzfail,n.stencilzpass=this.stencilzpass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonoffset&&(n.polygonoffset=!0),0!==this.polygonoffsetfactor&&(n.polygonoffsetfactor=this.polygonoffsetfactor),0!==this.polygonoffsetunits&&(n.polygonoffsetunits=this.polygonoffsetunits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashsize&&(n.dashsize=this.dashsize),void 0!==this.gapsize&&(n.gapsize=this.gapsize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphatest>0&&(n.alphatest=this.alphatest),!0===this.premultipliedalpha&&(n.premultipliedalpha=this.premultipliedalpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframelinewidth>1&&(n.wireframelinewidth=this.wireframelinewidth),"round"!==this.wireframelinecap&&(n.wireframelinecap=this.wireframelinecap),"round"!==this.wireframelinejoin&&(n.wireframelinejoin=this.wireframelinejoin),!0===this.morphtargets&&(n.morphtargets=!0),!0===this.morphnormals&&(n.morphnormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.tonemapped&&(n.tonemapped=!1),"{}"!==json.stringify(this.userdata)&&(n.userdata=this.userdata),e){var i=r(t.textures),a=r(t.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(t){this.name=t.name,this.fog=t.fog,this.blending=t.blending,this.side=t.side,this.flatshading=t.flatshading,this.vertexcolors=t.vertexcolors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendsrc=t.blendsrc,this.blenddst=t.blenddst,this.blendequation=t.blendequation,this.blendsrcalpha=t.blendsrcalpha,this.blenddstalpha=t.blenddstalpha,this.blendequationalpha=t.blendequationalpha,this.depthfunc=t.depthfunc,this.depthtest=t.depthtest,this.depthwrite=t.depthwrite,this.stencilwritemask=t.stencilwritemask,this.stencilfunc=t.stencilfunc,this.stencilref=t.stencilref,this.stencilfuncmask=t.stencilfuncmask,this.stencilfail=t.stencilfail,this.stencilzfail=t.stencilzfail,this.stencilzpass=t.stencilzpass,this.stencilwrite=t.stencilwrite;var e=t.clippingplanes,n=null;if(null!==e){var r=e.length;n=new array(r);for(var i=0;i!==r;++i)n[i]=e[i].clone()}return this.clippingplanes=n,this.clipintersection=t.clipintersection,this.clipshadows=t.clipshadows,this.shadowside=t.shadowside,this.colorwrite=t.colorwrite,this.precision=t.precision,this.polygonoffset=t.polygonoffset,this.polygonoffsetfactor=t.polygonoffsetfactor,this.polygonoffsetunits=t.polygonoffsetunits,this.dithering=t.dithering,this.alphatest=t.alphatest,this.premultipliedalpha=t.premultipliedalpha,this.visible=t.visible,this.tonemapped=t.tonemapped,this.userdata=json.parse(json.stringify(t.userdata)),this},dispose:function(){this.dispatchevent({type:"dispose"})}}),object.defineproperty(xe.prototype,"needsupdate",{set:function(t){!0===t&&this.version++}}),ye.prototype=object.create(xe.prototype),ye.prototype.constructor=ye,ye.prototype.ismeshbasicmaterial=!0,ye.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightmap=t.lightmap,this.lightmapintensity=t.lightmapintensity,this.aomap=t.aomap,this.aomapintensity=t.aomapintensity,this.specularmap=t.specularmap,this.alphamap=t.alphamap,this.envmap=t.envmap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionratio=t.refractionratio,this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this.wireframelinecap=t.wireframelinecap,this.wireframelinejoin=t.wireframelinejoin,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this};var ze=new mt,je=new pt;function qe(t,e,n){if(array.isarray(t))throw new typeerror("three.bufferattribute: array should be a typed array.");this.name="",this.array=t,this.itemsize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=tt,this.updaterange={offset:0,count:-1},this.version=0}function ke(t,e,n){qe.call(this,new int8array(t),e,n)}function $e(t,e,n){qe.call(this,new uint8array(t),e,n)}function tn(t,e,n){qe.call(this,new uint8clampedarray(t),e,n)}function en(t,e,n){qe.call(this,new int16array(t),e,n)}function nn(t,e,n){qe.call(this,new uint16array(t),e,n)}function rn(t,e,n){qe.call(this,new int32array(t),e,n)}function an(t,e,n){qe.call(this,new uint32array(t),e,n)}function on(t,e,n){qe.call(this,new uint16array(t),e,n)}function sn(t,e,n){qe.call(this,new float32array(t),e,n)}function cn(t,e,n){qe.call(this,new float64array(t),e,n)}object.defineproperty(qe.prototype,"needsupdate",{set:function(t){!0===t&&this.version++}}),object.assign(qe.prototype,{isbufferattribute:!0,onuploadcallback:function(){},setusage:function(t){return this.usage=t,this},copy:function(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemsize=t.itemsize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this},copyat:function(t,e,n){t*=this.itemsize,n*=e.itemsize;for(var r=0,i=this.itemsize;r<i;r++)this.array[t+r]=e.array[n+r];return this},copyarray:function(t){return this.array.set(t),this},copycolorsarray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(console.warn("three.bufferattribute.copycolorsarray(): color is undefined",r),a=new we),e[n++]=a.r,e[n++]=a.g,e[n++]=a.b}return this},copyvector2sarray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(console.warn("three.bufferattribute.copyvector2sarray(): vector is undefined",r),a=new pt),e[n++]=a.x,e[n++]=a.y}return this},copyvector3sarray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(console.warn("three.bufferattribute.copyvector3sarray(): vector is undefined",r),a=new mt),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z}return this},copyvector4sarray:function(t){for(var e=this.array,n=0,r=0,i=t.length;r<i;r++){var a=t[r];void 0===a&&(console.warn("three.bufferattribute.copyvector4sarray(): vector is undefined",r),a=new xt),e[n++]=a.x,e[n++]=a.y,e[n++]=a.z,e[n++]=a.w}return this},applymatrix3:function(t){if(2===this.itemsize)for(var e=0,n=this.count;e<n;e++)je.frombufferattribute(this,e),je.applymatrix3(t),this.setxy(e,je.x,je.y);else if(3===this.itemsize)for(var r=0,i=this.count;r<i;r++)ze.frombufferattribute(this,r),ze.applymatrix3(t),this.setxyz(r,ze.x,ze.y,ze.z);return this},applymatrix4:function(t){for(var e=0,n=this.count;e<n;e++)ze.x=this.getx(e),ze.y=this.gety(e),ze.z=this.getz(e),ze.applymatrix4(t),this.setxyz(e,ze.x,ze.y,ze.z);return this},applynormalmatrix:function(t){for(var e=0,n=this.count;e<n;e++)ze.x=this.getx(e),ze.y=this.gety(e),ze.z=this.getz(e),ze.applynormalmatrix(t),this.setxyz(e,ze.x,ze.y,ze.z);return this},transformdirection:function(t){for(var e=0,n=this.count;e<n;e++)ze.x=this.getx(e),ze.y=this.gety(e),ze.z=this.getz(e),ze.transformdirection(t),this.setxyz(e,ze.x,ze.y,ze.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getx:function(t){return this.array[t*this.itemsize]},setx:function(t,e){return this.array[t*this.itemsize]=e,this},gety:function(t){return this.array[t*this.itemsize+1]},sety:function(t,e){return this.array[t*this.itemsize+1]=e,this},getz:function(t){return this.array[t*this.itemsize+2]},setz:function(t,e){return this.array[t*this.itemsize+2]=e,this},getw:function(t){return this.array[t*this.itemsize+3]},setw:function(t,e){return this.array[t*this.itemsize+3]=e,this},setxy:function(t,e,n){return t*=this.itemsize,this.array[t+0]=e,this.array[t+1]=n,this},setxyz:function(t,e,n,r){return t*=this.itemsize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setxyzw:function(t,e,n,r,i){return t*=this.itemsize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=i,this},onupload:function(t){return this.onuploadcallback=t,this},clone:function(){return new this.constructor(this.array,this.itemsize).copy(this)},tojson:function(){return{itemsize:this.itemsize,type:this.array.constructor.name,array:array.prototype.slice.call(this.array),normalized:this.normalized}}}),ke.prototype=object.create(qe.prototype),ke.prototype.constructor=ke,$e.prototype=object.create(qe.prototype),$e.prototype.constructor=$e,tn.prototype=object.create(qe.prototype),tn.prototype.constructor=tn,en.prototype=object.create(qe.prototype),en.prototype.constructor=en,nn.prototype=object.create(qe.prototype),nn.prototype.constructor=nn,rn.prototype=object.create(qe.prototype),rn.prototype.constructor=rn,an.prototype=object.create(qe.prototype),an.prototype.constructor=an,on.prototype=object.create(qe.prototype),on.prototype.constructor=on,on.prototype.isfloat16bufferattribute=!0,sn.prototype=object.create(qe.prototype),sn.prototype.constructor=sn,cn.prototype=object.create(qe.prototype),cn.prototype.constructor=cn;var ln=function(){function t(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphtargets={},this.skinweights=[],this.skinindices=[],this.boundingbox=null,this.boundingsphere=null,this.verticesneedupdate=!1,this.normalsneedupdate=!1,this.colorsneedupdate=!1,this.uvsneedupdate=!1,this.groupsneedupdate=!1}var e=t.prototype;return e.computegroups=function(t){var e,n,r=[],i=void 0,a=t.faces;for(n=0;n<a.length;n++){var o=a[n];o.materialindex!==i&&(i=o.materialindex,void 0!==e&&(e.count=3*n-e.start,r.push(e)),e={start:3*n,materialindex:i})}void 0!==e&&(e.count=3*n-e.start,r.push(e)),this.groups=r},e.fromgeometry=function(t){var e,n=t.faces,r=t.vertices,i=t.facevertexuvs,a=i[0]&&i[0].length>0,o=i[1]&&i[1].length>0,s=t.morphtargets,c=s.length;if(c>0){e=[];for(var l=0;l<c;l++)e[l]={name:s[l].name,data:[]};this.morphtargets.position=e}var u,h=t.morphnormals,d=h.length;if(d>0){u=[];for(var p=0;p<d;p++)u[p]={name:h[p].name,data:[]};this.morphtargets.normal=u}var f=t.skinindices,m=t.skinweights,v=f.length===r.length,g=m.length===r.length;r.length>0&&0===n.length&&console.error("three.directgeometry: faceless geometries are not supported.");for(var y=0;y<n.length;y++){var x=n[y];this.vertices.push(r[x.a],r[x.b],r[x.c]);var _=x.vertexnormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var b=x.normal;this.normals.push(b,b,b)}var w=x.vertexcolors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var m=x.color;this.colors.push(m,m,m)}if(!0===a){var s=i[0][y];void 0!==s?this.uvs.push(s[0],s[1],s[2]):(console.warn("three.directgeometry.fromgeometry(): undefined vertexuv ",y),this.uvs.push(new pt,new pt,new pt))}if(!0===o){var t=i[1][y];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("three.directgeometry.fromgeometry(): undefined vertexuv2 ",y),this.uvs2.push(new pt,new pt,new pt))}for(var e=0;e<c;e++){var a=s[e].vertices;e[e].data.push(a[x.a],a[x.b],a[x.c])}for(var l=0;l<d;l++){var r=h[l].vertexnormals[y];u[l].data.push(r.a,r.b,r.c)}v&&this.skinindices.push(f[x.a],f[x.b],f[x.c]),g&&this.skinweights.push(m[x.a],m[x.b],m[x.c])}return this.computegroups(t),this.verticesneedupdate=t.verticesneedupdate,this.normalsneedupdate=t.normalsneedupdate,this.colorsneedupdate=t.colorsneedupdate,this.uvsneedupdate=t.uvsneedupdate,this.groupsneedupdate=t.groupsneedupdate,null!==t.boundingsphere&&(this.boundingsphere=t.boundingsphere.clone()),null!==t.boundingbox&&(this.boundingbox=t.boundingbox.clone()),this},t}();function un(t){if(0===t.length)return-1/0;for(var e=t[0],n=1,r=t.length;n<r;++n)t[n]>e&&(e=t[n]);return e}var hn={int8array:int8array,uint8array:uint8array,uint8clampedarray:"undefined"!=typeof uint8clampedarray?uint8clampedarray:uint8array,int16array:int16array,uint16array:uint16array,int32array:int32array,uint32array:uint32array,float32array:float32array,float64array:float64array};function dn(t,e){return new hn[t](e)}var pn=1,fn=new qt,mn=new we,vn=new mt,gn=new et,yn=new et,xn=new mt;function _n(){object.defineproperty(this,"id",{value:pn+=2}),this.uuid=st.generateuuid(),this.name="",this.type="buffergeometry",this.index=null,this.attributes={},this.morphattributes={},this.morphtargetsrelative=!1,this.groups=[],this.boundingbox=null,this.boundingsphere=null,this.drawrange={start:0,count:1/0},this.userdata={}}_n.prototype=object.assign(object.create(rt.prototype),{constructor:_n,isbuffergeometry:!0,getindex:function(){return this.index},setindex:function(t){return array.isarray(t)?this.index=new(un(t)>65535?an:nn)(t,1):this.index=t,this},getattribute:function(t){return this.attributes[t]},setattribute:function(t,e){return this.attributes[t]=e,this},deleteattribute:function(t){return delete this.attributes[t],this},hasattribute:function(t){return void 0!==this.attributes[t]},addgroup:function(t,e,n){void 0===n&&(n=0),this.groups.push({start:t,count:e,materialindex:n})},cleargroups:function(){this.groups=[]},setdrawrange:function(t,e){this.drawrange.start=t,this.drawrange.count=e},applymatrix4:function(t){var e=this.attributes.position;void 0!==e&&(e.applymatrix4(t),e.needsupdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new ft).getnormalmatrix(t);n.applynormalmatrix(r),n.needsupdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformdirection(t),i.needsupdate=!0),null!==this.boundingbox&&this.computeboundingbox(),null!==this.boundingsphere&&this.computeboundingsphere(),this},rotatex:function(t){return fn.makerotationx(t),this.applymatrix4(fn),this},rotatey:function(t){return fn.makerotationy(t),this.applymatrix4(fn),this},rotatez:function(t){return fn.makerotationz(t),this.applymatrix4(fn),this},translate:function(t,e,n){return fn.maketranslation(t,e,n),this.applymatrix4(fn),this},scale:function(t,e,n){return fn.makescale(t,e,n),this.applymatrix4(fn),this},lookat:function(t){return mn.lookat(t),mn.updatematrix(),this.applymatrix4(mn.matrix),this},center:function(){return this.computeboundingbox(),this.boundingbox.getcenter(vn).negate(),this.translate(vn.x,vn.y,vn.z),this},setfromobject:function(t){var e=t.geometry;if(t.ispoints||t.isline){var n=new sn(3*e.vertices.length,3),r=new sn(3*e.colors.length,3);if(this.setattribute("position",n.copyvector3sarray(e.vertices)),this.setattribute("color",r.copycolorsarray(e.colors)),e.linedistances&&e.linedistances.length===e.vertices.length){var i=new sn(e.linedistances.length,1);this.setattribute("linedistance",i.copyarray(e.linedistances))}null!==e.boundingsphere&&(this.boundingsphere=e.boundingsphere.clone()),null!==e.boundingbox&&(this.boundingbox=e.boundingbox.clone())}else t.ismesh&&e&&e.isgeometry&&this.fromgeometry(e);return this},setfrompoints:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];e.push(i.x,i.y,i.z||0)}return this.setattribute("position",new sn(e,3)),this},updatefromobject:function(t){var e=t.geometry;if(t.ismesh){var n=e.__directgeometry;if(!0===e.elementsneedupdate&&(n=void 0,e.elementsneedupdate=!1),void 0===n)return this.fromgeometry(e);n.verticesneedupdate=e.verticesneedupdate,n.normalsneedupdate=e.normalsneedupdate,n.colorsneedupdate=e.colorsneedupdate,n.uvsneedupdate=e.uvsneedupdate,n.groupsneedupdate=e.groupsneedupdate,e.verticesneedupdate=!1,e.normalsneedupdate=!1,e.colorsneedupdate=!1,e.uvsneedupdate=!1,e.groupsneedupdate=!1,e=n}if(!0===e.verticesneedupdate){var r=this.attributes.position;void 0!==r&&(r.copyvector3sarray(e.vertices),r.needsupdate=!0),e.verticesneedupdate=!1}if(!0===e.normalsneedupdate){var i=this.attributes.normal;void 0!==i&&(i.copyvector3sarray(e.normals),i.needsupdate=!0),e.normalsneedupdate=!1}if(!0===e.colorsneedupdate){var a=this.attributes.color;void 0!==a&&(a.copycolorsarray(e.colors),a.needsupdate=!0),e.colorsneedupdate=!1}if(e.uvsneedupdate){var o=this.attributes.uv;void 0!==o&&(o.copyvector2sarray(e.uvs),o.needsupdate=!0),e.uvsneedupdate=!1}if(e.linedistancesneedupdate){var s=this.attributes.linedistance;void 0!==s&&(s.copyarray(e.linedistances),s.needsupdate=!0),e.linedistancesneedupdate=!1}return e.groupsneedupdate&&(e.computegroups(t.geometry),this.groups=e.groups,e.groupsneedupdate=!1),this},fromgeometry:function(t){return t.__directgeometry=(new ln).fromgeometry(t),this.fromdirectgeometry(t.__directgeometry)},fromdirectgeometry:function(t){var e=new float32array(3*t.vertices.length);if(this.setattribute("position",new qe(e,3).copyvector3sarray(t.vertices)),t.normals.length>0){var n=new float32array(3*t.normals.length);this.setattribute("normal",new qe(n,3).copyvector3sarray(t.normals))}if(t.colors.length>0){var r=new float32array(3*t.colors.length);this.setattribute("color",new qe(r,3).copycolorsarray(t.colors))}if(t.uvs.length>0){var i=new float32array(2*t.uvs.length);this.setattribute("uv",new qe(i,2).copyvector2sarray(t.uvs))}if(t.uvs2.length>0){var a=new float32array(2*t.uvs2.length);this.setattribute("uv2",new qe(a,2).copyvector2sarray(t.uvs2))}for(var o in this.groups=t.groups,t.morphtargets){for(var s=[],c=t.morphtargets[o],l=0,u=c.length;l<u;l++){var h=c[l],d=new sn(3*h.data.length,3);d.name=h.name,s.push(d.copyvector3sarray(h.data))}this.morphattributes[o]=s}if(t.skinindices.length>0){var p=new sn(4*t.skinindices.length,4);this.setattribute("skinindex",p.copyvector4sarray(t.skinindices))}if(t.skinweights.length>0){var f=new sn(4*t.skinweights.length,4);this.setattribute("skinweight",f.copyvector4sarray(t.skinweights))}return null!==t.boundingsphere&&(this.boundingsphere=t.boundingsphere.clone()),null!==t.boundingbox&&(this.boundingbox=t.boundingbox.clone()),this},computeboundingbox:function(){null===this.boundingbox&&(this.boundingbox=new et);var t=this.attributes.position,e=this.morphattributes.position;if(t&&t.isglbufferattribute)return console.error('three.buffergeometry.computeboundingbox(): glbufferattribute requires a manual bounding box. alternatively set "mesh.frustumculled" to "false".',this),void this.boundingbox.set(new mt(-1/0,-1/0,-1/0),new mt(1/0,1/0,1/0));if(void 0!==t){if(this.boundingbox.setfrombufferattribute(t),e)for(var n=0,r=e.length;n<r;n++){var i=e[n];gn.setfrombufferattribute(i),this.morphtargetsrelative?(xn.addvectors(this.boundingbox.min,gn.min),this.boundingbox.expandbypoint(xn),xn.addvectors(this.boundingbox.max,gn.max),this.boundingbox.expandbypoint(xn)):(this.boundingbox.expandbypoint(gn.min),this.boundingbox.expandbypoint(gn.max))}}else this.boundingbox.makeempty();(isnan(this.boundingbox.min.x)||isnan(this.boundingbox.min.y)||isnan(this.boundingbox.min.z))&&console.error('three.buffergeometry.computeboundingbox(): computed min/max have nan values. the "position" attribute is likely to have nan values.',this)},computeboundingsphere:function(){null===this.boundingsphere&&(this.boundingsphere=new kt);var t=this.attributes.position,e=this.morphattributes.position;if(t&&t.isglbufferattribute)return console.error('three.buffergeometry.computeboundingsphere(): glbufferattribute requires a manual bounding sphere. alternatively set "mesh.frustumculled" to "false".',this),void this.boundingsphere.set(new mt,1/0);if(t){var n=this.boundingsphere.center;if(gn.setfrombufferattribute(t),e)for(var r=0,i=e.length;r<i;r++){var a=e[r];yn.setfrombufferattribute(a),this.morphtargetsrelative?(xn.addvectors(gn.min,yn.min),gn.expandbypoint(xn),xn.addvectors(gn.max,yn.max),gn.expandbypoint(xn)):(gn.expandbypoint(yn.min),gn.expandbypoint(yn.max))}gn.getcenter(n);for(var o=0,s=0,c=t.count;s<c;s++)xn.frombufferattribute(t,s),o=math.max(o,n.distancetosquared(xn));if(e)for(var l=0,u=e.length;l<u;l++)for(var h=e[l],d=this.morphtargetsrelative,p=0,f=h.count;p<f;p++)xn.frombufferattribute(h,p),d&&(vn.frombufferattribute(t,p),xn.add(vn)),o=math.max(o,n.distancetosquared(xn));this.boundingsphere.radius=math.sqrt(o),isnan(this.boundingsphere.radius)&&console.error('three.buffergeometry.computeboundingsphere(): computed radius is nan. the "position" attribute is likely to have nan values.',this)}},computefacenormals:function(){},computevertexnormals:function(){var t=this.index,e=this.getattribute("position");if(void 0!==e){var n=this.getattribute("normal");if(void 0===n)n=new qe(new float32array(3*e.count),3),this.setattribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setxyz(r,0,0,0);var a=new mt,o=new mt,s=new mt,c=new mt,l=new mt,u=new mt,h=new mt,d=new mt;if(t)for(var p=0,f=t.count;p<f;p+=3){var m=t.getx(p+0),v=t.getx(p+1),g=t.getx(p+2);a.frombufferattribute(e,m),o.frombufferattribute(e,v),s.frombufferattribute(e,g),h.subvectors(s,o),d.subvectors(a,o),h.cross(d),c.frombufferattribute(n,m),l.frombufferattribute(n,v),u.frombufferattribute(n,g),c.add(h),l.add(h),u.add(h),n.setxyz(m,c.x,c.y,c.z),n.setxyz(v,l.x,l.y,l.z),n.setxyz(g,u.x,u.y,u.z)}else for(var y=0,x=e.count;y<x;y+=3)a.frombufferattribute(e,y+0),o.frombufferattribute(e,y+1),s.frombufferattribute(e,y+2),h.subvectors(s,o),d.subvectors(a,o),h.cross(d),n.setxyz(y+0,h.x,h.y,h.z),n.setxyz(y+1,h.x,h.y,h.z),n.setxyz(y+2,h.x,h.y,h.z);this.normalizenormals(),n.needsupdate=!0}},merge:function(t,e){if(t&&t.isbuffergeometry){void 0===e&&(e=0,console.warn("three.buffergeometry.merge(): overwriting original geometry, starting at offset=0. use buffergeometryutils.mergebuffergeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==t.attributes[r])for(var i=n[r].array,a=t.attributes[r],o=a.array,s=a.itemsize*e,c=math.min(o.length,i.length-s),l=0,u=s;l<c;l++,u++)i[u]=o[l];return this}console.error("three.buffergeometry.merge(): geometry not an instance of three.buffergeometry.",t)},normalizenormals:function(){for(var t=this.attributes.normal,e=0,n=t.count;e<n;e++)xn.frombufferattribute(t,e),xn.normalize(),t.setxyz(e,xn.x,xn.y,xn.z)},tononindexed:function(){function t(t,e){for(var n=t.array,r=t.itemsize,i=t.normalized,a=new n.constructor(e.length*r),o=0,s=0,c=0,l=e.length;c<l;c++){o=e[c]*r;for(var u=0;u<r;u++)a[s++]=n[o++]}return new qe(a,r,i)}if(null===this.index)return console.warn("three.buffergeometry.tononindexed(): geometry is already non-indexed."),this;var e=new _n,n=this.index.array,r=this.attributes;for(var i in r){var a=t(r[i],n);e.setattribute(i,a)}var o=this.morphattributes;for(var s in o){for(var c=[],l=o[s],u=0,h=l.length;u<h;u++){var d=t(l[u],n);c.push(d)}e.morphattributes[s]=c}e.morphtargetsrelative=this.morphtargetsrelative;for(var p=this.groups,f=0,m=p.length;f<m;f++){var v=p[f];e.addgroup(v.start,v.count,v.materialindex)}return e},tojson:function(){var t={metadata:{version:4.5,type:"buffergeometry",generator:"buffergeometry.tojson"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),object.keys(this.userdata).length>0&&(t.userdata=this.userdata),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}t.data={attributes:{}};var r=this.index;null!==r&&(t.data.index={type:r.array.constructor.name,array:array.prototype.slice.call(r.array)});var i=this.attributes;for(var a in i){var o=i[a],s=o.tojson(t.data);""!==o.name&&(s.name=o.name),t.data.attributes[a]=s}var c={},l=!1;for(var u in this.morphattributes){for(var h=this.morphattributes[u],d=[],p=0,f=h.length;p<f;p++){var m=h[p],v=m.tojson(t.data);""!==m.name&&(v.name=m.name),d.push(v)}d.length>0&&(c[u]=d,l=!0)}l&&(t.data.morphattributes=c,t.data.morphtargetsrelative=this.morphtargetsrelative);var g=this.groups;g.length>0&&(t.data.groups=json.parse(json.stringify(g)));var y=this.boundingsphere;return null!==y&&(t.data.boundingsphere={center:y.center.toarray(),radius:y.radius}),t},clone:function(){return(new _n).copy(this)},copy:function(t){this.index=null,this.attributes={},this.morphattributes={},this.groups=[],this.boundingbox=null,this.boundingsphere=null;var e={};this.name=t.name;var n=t.index;null!==n&&this.setindex(n.clone(e));var r=t.attributes;for(var i in r){var a=r[i];this.setattribute(i,a.clone(e))}var o=t.morphattributes;for(var s in o){for(var c=[],l=o[s],u=0,h=l.length;u<h;u++)c.push(l[u].clone(e));this.morphattributes[s]=c}this.morphtargetsrelative=t.morphtargetsrelative;for(var d=t.groups,p=0,f=d.length;p<f;p++){var m=d[p];this.addgroup(m.start,m.count,m.materialindex)}var v=t.boundingbox;null!==v&&(this.boundingbox=v.clone());var g=t.boundingsphere;return null!==g&&(this.boundingsphere=g.clone()),this.drawrange.start=t.drawrange.start,this.drawrange.count=t.drawrange.count,this.userdata=t.userdata,this},dispose:function(){this.dispatchevent({type:"dispose"})}});var bn=new qt,wn=new jt,mn=new kt,sn=new mt,tn=new mt,en=new mt,an=new mt,ln=new mt,rn=new mt,cn=new mt,pn=new mt,in=new mt,nn=new pt,dn=new pt,on=new pt,bn=new mt,zn=new mt;function fn(t,e){void 0===t&&(t=new _n),void 0===e&&(e=new ye),we.call(this),this.type="mesh",this.geometry=t,this.material=e,this.updatemorphtargets()}function gn(t,e,n,r,i,a,o,s){if(null===(1===e.side?r.intersecttriangle(o,a,i,!0,s):r.intersecttriangle(i,a,o,2!==e.side,s)))return null;zn.copy(s),zn.applymatrix4(t.matrixworld);var c=n.ray.origin.distanceto(zn);return c<n.near||c>n.far?null:{distance:c,point:zn.clone(),object:t}}function un(t,e,n,r,i,a,o,s,c,l,u,h){sn.frombufferattribute(i,l),tn.frombufferattribute(i,u),en.frombufferattribute(i,h);var d=t.morphtargetinfluences;if(e.morphtargets&&a&&d){cn.set(0,0,0),pn.set(0,0,0),in.set(0,0,0);for(var p=0,f=a.length;p<f;p++){var m=d[p],v=a[p];0!==m&&(an.frombufferattribute(v,l),ln.frombufferattribute(v,u),rn.frombufferattribute(v,h),o?(cn.addscaledvector(an,m),pn.addscaledvector(ln,m),in.addscaledvector(rn,m)):(cn.addscaledvector(an.sub(sn),m),pn.addscaledvector(ln.sub(tn),m),in.addscaledvector(rn.sub(en),m)))}sn.add(cn),tn.add(pn),en.add(in)}t.isskinnedmesh&&(t.bonetransform(l,sn),t.bonetransform(u,tn),t.bonetransform(h,en));var g=gn(t,e,n,r,sn,tn,en,bn);if(g){s&&(nn.frombufferattribute(s,l),dn.frombufferattribute(s,u),on.frombufferattribute(s,h),g.uv=ze.getuv(bn,sn,tn,en,nn,dn,on,new pt)),c&&(nn.frombufferattribute(c,l),dn.frombufferattribute(c,u),on.frombufferattribute(c,h),g.uv2=ze.getuv(bn,sn,tn,en,nn,dn,on,new pt));var y=new je(l,u,h);ze.getnormal(sn,tn,en,y.normal),g.face=y}return g}fn.prototype=object.assign(object.create(we.prototype),{constructor:fn,ismesh:!0,copy:function(t){return we.prototype.copy.call(this,t),void 0!==t.morphtargetinfluences&&(this.morphtargetinfluences=t.morphtargetinfluences.slice()),void 0!==t.morphtargetdictionary&&(this.morphtargetdictionary=object.assign({},t.morphtargetdictionary)),this.material=t.material,this.geometry=t.geometry,this},updatemorphtargets:function(){var t=this.geometry;if(t.isbuffergeometry){var e=t.morphattributes,n=object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphtargetinfluences=[],this.morphtargetdictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||string(i);this.morphtargetinfluences.push(0),this.morphtargetdictionary[o]=i}}}}else{var s=t.morphtargets;void 0!==s&&s.length>0&&console.error("three.mesh.updatemorphtargets() no longer supports three.geometry. use three.buffergeometry instead.")}},raycast:function(t,e){var n,r=this.geometry,i=this.material,a=this.matrixworld;if(void 0!==i&&(null===r.boundingsphere&&r.computeboundingsphere(),mn.copy(r.boundingsphere),mn.applymatrix4(a),!1!==t.ray.intersectssphere(mn)&&(bn.copy(a).invert(),wn.copy(t.ray).applymatrix4(bn),null===r.boundingbox||!1!==wn.intersectsbox(r.boundingbox))))if(r.isbuffergeometry){var o=r.index,s=r.attributes.position,c=r.morphattributes.position,l=r.morphtargetsrelative,u=r.attributes.uv,h=r.attributes.uv2,d=r.groups,p=r.drawrange;if(null!==o)if(array.isarray(i))for(var f=0,m=d.length;f<m;f++)for(var v=d[f],g=i[v.materialindex],y=math.max(v.start,p.start),x=math.min(v.start+v.count,p.start+p.count);y<x;y+=3){var _=o.getx(y),b=o.getx(y+1),w=o.getx(y+2);(n=un(this,g,t,wn,s,c,l,u,h,_,b,w))&&(n.faceindex=math.floor(y/3),n.face.materialindex=v.materialindex,e.push(n))}else for(var m=math.max(0,p.start),s=math.min(o.count,p.start+p.count);m<s;m+=3){var t=o.getx(m),e=o.getx(m+1),a=o.getx(m+2);(n=un(this,i,t,wn,s,c,l,u,h,t,e,a))&&(n.faceindex=math.floor(m/3),e.push(n))}else if(void 0!==s)if(array.isarray(i))for(var l=0,r=d.length;l<r;l++)for(var c=d[l],p=i[c.materialindex],i=math.max(c.start,p.start),n=math.min(c.start+c.count,p.start+p.count);i<n;i+=3){(n=un(this,p,t,wn,s,c,l,u,h,i,i+1,i+2))&&(n.faceindex=math.floor(i/3),n.face.materialindex=c.materialindex,e.push(n))}else for(var d=math.max(0,p.start),o=math.min(s.count,p.start+p.count);d<o;d+=3){(n=un(this,i,t,wn,s,c,l,u,h,d,d+1,d+2))&&(n.faceindex=math.floor(d/3),e.push(n))}}else if(r.isgeometry){var b,z=array.isarray(i),f=r.vertices,g=r.faces,u=r.facevertexuvs[0];u.length>0&&(b=u);for(var h=0,k=g.length;h<k;h++){var v=g[h],w=z?i[v.materialindex]:i;if(void 0!==w){var j=f[v.a],q=f[v.b],x=f[v.c];if(n=gn(this,w,t,wn,j,q,x,bn)){if(b&&b[h]){var y=b[h];nn.copy(y[0]),dn.copy(y[1]),on.copy(y[2]),n.uv=ze.getuv(bn,j,q,x,nn,dn,on,new pt)}n.face=v,n.faceindex=h,e.push(n)}}}}}});var hn=function(t){function e(e,n,r,i,a,o){var s;void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),void 0===a&&(a=1),void 0===o&&(o=1),(s=t.call(this)||this).type="boxbuffergeometry",s.parameters={width:e,height:n,depth:r,widthsegments:i,heightsegments:a,depthsegments:o};var c=ht(s);i=math.floor(i),a=math.floor(a),o=math.floor(o);var l=[],u=[],h=[],d=[],p=0,f=0;function m(t,e,n,r,i,a,o,s,m,v,g){for(var y=a/m,x=o/v,_=a/2,b=o/2,w=s/2,m=m+1,s=v+1,t=0,e=0,a=new mt,l=0;l<s;l++)for(var r=l*x-b,c=0;c<m;c++){var p=c*y-_;a[t]=p*r,a[e]=r*i,a[n]=w,u.push(a.x,a.y,a.z),a[t]=0,a[e]=0,a[n]=s>0?1:-1,h.push(a.x,a.y,a.z),d.push(c/m),d.push(1-l/v),t+=1}for(var i=0;i<v;i++)for(var n=0;n<m;n++){var d=p+n+m*i,o=p+n+m*(i+1),b=p+(n+1)+m*(i+1),z=p+(n+1)+m*i;l.push(d,o,z),l.push(o,b,z),e+=6}c.addgroup(f,e,g),f+=e,p+=t}return m("z","y","x",-1,-1,r,n,e,o,a,0),m("z","y","x",1,-1,r,n,-e,o,a,1),m("x","z","y",1,1,e,r,n,i,o,2),m("x","z","y",1,-1,e,r,-n,i,o,3),m("x","y","z",1,-1,e,n,r,i,a,4),m("x","y","z",-1,-1,e,n,-r,i,a,5),s.setindex(l),s.setattribute("position",new sn(u,3)),s.setattribute("normal",new sn(h,3)),s.setattribute("uv",new sn(d,2)),s}return ut(e,t),e}(_n);function kn(t){var e={};for(var n in t)for(var r in e[n]={},t[n]){var i=t[n][r];i&&(i.iscolor||i.ismatrix3||i.ismatrix4||i.isvector2||i.isvector3||i.isvector4||i.istexture)?e[n][r]=i.clone():array.isarray(i)?e[n][r]=i.slice():e[n][r]=i}return e}function vn(t){for(var e={},n=0;n<t.length;n++){var r=kn(t[n]);for(var i in r)e[i]=r[i]}return e}var wn={clone:kn,merge:vn};function jn(t){xe.call(this),this.type="shadermaterial",this.defines={},this.uniforms={},this.vertexshader="void main() {\n\tgl_position = projectionmatrix * modelviewmatrix * vec4( position, 1.0 );\n}",this.fragmentshader="void main() {\n\tgl_fragcolor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframelinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphtargets=!1,this.morphnormals=!1,this.extensions={derivatives:!1,fragdepth:!1,drawbuffers:!1,shadertexturelod:!1},this.defaultattributevalues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0attributename=void 0,this.uniformsneedupdate=!1,this.glslversion=null,void 0!==t&&(void 0!==t.attributes&&console.error("three.shadermaterial: attributes should now be defined in three.buffergeometry instead."),this.setvalues(t))}function qn(){we.call(this),this.type="camera",this.matrixworldinverse=new qt,this.projectionmatrix=new qt,this.projectionmatrixinverse=new qt}function xn(t,e,n,r){void 0===t&&(t=50),void 0===e&&(e=1),void 0===n&&(n=.1),void 0===r&&(r=2e3),qn.call(this),this.type="perspectivecamera",this.fov=t,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=e,this.view=null,this.filmgauge=35,this.filmoffset=0,this.updateprojectionmatrix()}jn.prototype=object.create(xe.prototype),jn.prototype.constructor=jn,jn.prototype.isshadermaterial=!0,jn.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.fragmentshader=t.fragmentshader,this.vertexshader=t.vertexshader,this.uniforms=kn(t.uniforms),this.defines=object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this.lights=t.lights,this.clipping=t.clipping,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.morphnormals=t.morphnormals,this.extensions=object.assign({},t.extensions),this.glslversion=t.glslversion,this},jn.prototype.tojson=function(t){var e=xe.prototype.tojson.call(this,t);for(var n in e.glslversion=this.glslversion,e.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.istexture?e.uniforms[n]={type:"t",value:r.tojson(t).uuid}:r&&r.iscolor?e.uniforms[n]={type:"c",value:r.gethex()}:r&&r.isvector2?e.uniforms[n]={type:"v2",value:r.toarray()}:r&&r.isvector3?e.uniforms[n]={type:"v3",value:r.toarray()}:r&&r.isvector4?e.uniforms[n]={type:"v4",value:r.toarray()}:r&&r.ismatrix3?e.uniforms[n]={type:"m3",value:r.toarray()}:r&&r.ismatrix4?e.uniforms[n]={type:"m4",value:r.toarray()}:e.uniforms[n]={value:r}}object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexshader=this.vertexshader,e.fragmentshader=this.fragmentshader;var i={};for(var a in this.extensions)!0===this.extensions[a]&&(i[a]=!0);return object.keys(i).length>0&&(e.extensions=i),e},qn.prototype=object.assign(object.create(we.prototype),{constructor:qn,iscamera:!0,copy:function(t,e){return we.prototype.copy.call(this,t,e),this.matrixworldinverse.copy(t.matrixworldinverse),this.projectionmatrix.copy(t.projectionmatrix),this.projectionmatrixinverse.copy(t.projectionmatrixinverse),this},getworlddirection:function(t){void 0===t&&(console.warn("three.camera: .getworlddirection() target is now required"),t=new mt),this.updateworldmatrix(!0,!1);var e=this.matrixworld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updatematrixworld:function(t){we.prototype.updatematrixworld.call(this,t),this.matrixworldinverse.copy(this.matrixworld).invert()},updateworldmatrix:function(t,e){we.prototype.updateworldmatrix.call(this,t,e),this.matrixworldinverse.copy(this.matrixworld).invert()},clone:function(){return(new this.constructor).copy(this)}}),xn.prototype=object.assign(object.create(qn.prototype),{constructor:xn,isperspectivecamera:!0,copy:function(t,e){return qn.prototype.copy.call(this,t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:object.assign({},t.view),this.filmgauge=t.filmgauge,this.filmoffset=t.filmoffset,this},setfocallength:function(t){var e=.5*this.getfilmheight()/t;this.fov=2*st.rad2deg*math.atan(e),this.updateprojectionmatrix()},getfocallength:function(){var t=math.tan(.5*st.deg2rad*this.fov);return.5*this.getfilmheight()/t},geteffectivefov:function(){return 2*st.rad2deg*math.atan(math.tan(.5*st.deg2rad*this.fov)/this.zoom)},getfilmwidth:function(){return this.filmgauge*math.min(this.aspect,1)},getfilmheight:function(){return this.filmgauge/math.max(this.aspect,1)},setviewoffset:function(t,e,n,r,i,a){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullwidth:1,fullheight:1,offsetx:0,offsety:0,width:1,height:1}),this.view.enabled=!0,this.view.fullwidth=t,this.view.fullheight=e,this.view.offsetx=n,this.view.offsety=r,this.view.width=i,this.view.height=a,this.updateprojectionmatrix()},clearviewoffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateprojectionmatrix()},updateprojectionmatrix:function(){var t=this.near,e=t*math.tan(.5*st.deg2rad*this.fov)/this.zoom,n=2*e,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullwidth,s=a.fullheight;i+=a.offsetx*r/o,e-=a.offsety*n/s,r*=a.width/o,n*=a.height/s}var c=this.filmoffset;0!==c&&(i+=t*c/this.getfilmwidth()),this.projectionmatrix.makeperspective(i,i+r,e,e-n,t,this.far),this.projectionmatrixinverse.copy(this.projectionmatrix).invert()},tojson:function(t){var e=we.prototype.tojson.call(this,t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=object.assign({},this.view)),e.object.filmgauge=this.filmgauge,e.object.filmoffset=this.filmoffset,e}});var yn=90;function zn(t,e,n){if(we.call(this),this.type="cubecamera",!0===n.iswebglcuberendertarget){this.rendertarget=n;var r=new xn(yn,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookat(new mt(1,0,0)),this.add(r);var i=new xn(yn,1,t,e);i.layers=this.layers,i.up.set(0,-1,0),i.lookat(new mt(-1,0,0)),this.add(i);var a=new xn(yn,1,t,e);a.layers=this.layers,a.up.set(0,0,1),a.lookat(new mt(0,1,0)),this.add(a);var o=new xn(yn,1,t,e);o.layers=this.layers,o.up.set(0,0,-1),o.lookat(new mt(0,-1,0)),this.add(o);var s=new xn(yn,1,t,e);s.layers=this.layers,s.up.set(0,-1,0),s.lookat(new mt(0,0,1)),this.add(s);var c=new xn(yn,1,t,e);c.layers=this.layers,c.up.set(0,-1,0),c.lookat(new mt(0,0,-1)),this.add(c),this.update=function(t,e){null===this.parent&&this.updatematrixworld();var l=t.xr.enabled,u=t.getrendertarget();t.xr.enabled=!1;var h=n.texture.generatemipmaps;n.texture.generatemipmaps=!1,t.setrendertarget(n,0),t.render(e,r),t.setrendertarget(n,1),t.render(e,i),t.setrendertarget(n,2),t.render(e,a),t.setrendertarget(n,3),t.render(e,o),t.setrendertarget(n,4),t.render(e,s),n.texture.generatemipmaps=h,t.setrendertarget(n,5),t.render(e,c),t.setrendertarget(u),t.xr.enabled=l}}else console.error("three.cubecamera: the constructor now expects an instance of webglcuberendertarget as third parameter.")}function jn(t,e,n,i,a,o,s,c,l,u){t=void 0!==t?t:[],e=void 0!==e?e:r,s=void 0!==s?s:s,gt.call(this,t,e,n,i,a,o,s,c,l,u),this.flipy=!1,this._needsflipenvmap=!0}function qn(t,e,n){number.isinteger(e)&&(console.warn("three.webglcuberendertarget: constructor signature is now webglcuberendertarget( size, options )"),e=n),_t.call(this,t,t,e),e=e||{},this.texture=new jn(void 0,e.mapping,e.wraps,e.wrapt,e.magfilter,e.minfilter,e.format,e.type,e.anisotropy,e.encoding),this.texture._needsflipenvmap=!1}function kn(t,e,n,r,i,a,o,s,c,l,u,h){gt.call(this,null,a,o,s,c,l,r,i,u,h),this.image={data:t||null,width:e||1,height:n||1},this.magfilter=void 0!==c?c:d,this.minfilter=void 0!==l?l:d,this.generatemipmaps=!1,this.flipy=!1,this.unpackalignment=1,this.needsupdate=!0}zn.prototype=object.create(we.prototype),zn.prototype.constructor=zn,jn.prototype=object.create(gt.prototype),jn.prototype.constructor=jn,jn.prototype.iscubetexture=!0,object.defineproperty(jn.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),qn.prototype=object.create(_t.prototype),qn.prototype.constructor=qn,qn.prototype.iswebglcuberendertarget=!0,qn.prototype.fromequirectangulartexture=function(t,e){this.texture.type=e.type,this.texture.format=t,this.texture.encoding=e.encoding,this.texture.generatemipmaps=e.generatemipmaps,this.texture.minfilter=e.minfilter,this.texture.magfilter=e.magfilter;var n={tequirect:{value:null}},r="\n\n\t\t\tvarying vec3 vworlddirection;\n\n\t\t\tvec3 transformdirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvworlddirection = transformdirection( position, modelmatrix );\n\n\t\t\t\t#include <begin_vertex>\n\t\t\t\t#include <project_vertex>\n\n\t\t\t}\n\t\t",i="\n\n\t\t\tuniform sampler2d tequirect;\n\n\t\t\tvarying vec3 vworlddirection;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 direction = normalize( vworlddirection );\n\n\t\t\t\tvec2 sampleuv = equirectuv( direction );\n\n\t\t\t\tgl_fragcolor = texture2d( tequirect, sampleuv );\n\n\t\t\t}\n\t\t",a=new hn(5,5,5),o=new jn({name:"cubemapfromequirect",uniforms:kn(n),vertexshader:r,fragmentshader:i,side:1,blending:0});o.uniforms.tequirect.value=e;var s=new fn(a,o),c=e.minfilter;return e.minfilter===g&&(e.minfilter=m),new zn(1,10,this).update(t,s),e.minfilter=c,s.geometry.dispose(),s.material.dispose(),this},qn.prototype.clear=function(t,e,n,r){for(var i=t.getrendertarget(),a=0;a<6;a++)t.setrendertarget(this,a),t.clear(e,n,r);t.setrendertarget(i)},kn.prototype=object.create(gt.prototype),kn.prototype.constructor=kn,kn.prototype.isdatatexture=!0;var $n=new kt,tr=new mt,er=function(){function t(t,e,n,r,i,a){this.planes=[void 0!==t?t:new ee,void 0!==e?e:new ee,void 0!==n?n:new ee,void 0!==r?r:new ee,void 0!==i?i:new ee,void 0!==a?a:new ee]}var e=t.prototype;return e.set=function(t,e,n,r,i,a){var o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){for(var e=this.planes,n=0;n<6;n++)e[n].copy(t.planes[n]);return this},e.setfromprojectionmatrix=function(t){var e=this.planes,n=t.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],c=n[5],l=n[6],u=n[7],h=n[8],d=n[9],p=n[10],f=n[11],m=n[12],v=n[13],g=n[14],y=n[15];return e[0].setcomponents(o-r,u-s,f-h,y-m).normalize(),e[1].setcomponents(o+r,u+s,f+h,y+m).normalize(),e[2].setcomponents(o+i,u+c,f+d,y+v).normalize(),e[3].setcomponents(o-i,u-c,f-d,y-v).normalize(),e[4].setcomponents(o-a,u-l,f-p,y-g).normalize(),e[5].setcomponents(o+a,u+l,f+p,y+g).normalize(),this},e.intersectsobject=function(t){var e=t.geometry;return null===e.boundingsphere&&e.computeboundingsphere(),$n.copy(e.boundingsphere).applymatrix4(t.matrixworld),this.intersectssphere($n)},e.intersectssprite=function(t){return $n.center.set(0,0,0),$n.radius=.7071067811865476,$n.applymatrix4(t.matrixworld),this.intersectssphere($n)},e.intersectssphere=function(t){for(var e=this.planes,n=t.center,r=-t.radius,i=0;i<6;i++){if(e[i].distancetopoint(n)<r)return!1}return!0},e.intersectsbox=function(t){for(var e=this.planes,n=0;n<6;n++){var r=e[n];if(tr.x=r.normal.x>0?t.max.x:t.min.x,tr.y=r.normal.y>0?t.max.y:t.min.y,tr.z=r.normal.z>0?t.max.z:t.min.z,r.distancetopoint(tr)<0)return!1}return!0},e.containspoint=function(t){for(var e=this.planes,n=0;n<6;n++)if(e[n].distancetopoint(t)<0)return!1;return!0},t}();function nr(){var t=null,e=!1,n=null,r=null;function i(e,a){n(e,a),r=t.requestanimationframe(i)}return{start:function(){!0!==e&&null!==n&&(r=t.requestanimationframe(i),e=!0)},stop:function(){t.cancelanimationframe(r),e=!1},setanimationloop:function(t){n=t},setcontext:function(e){t=e}}}function rr(t,e){var n=e.iswebgl2,r=new weakmap;return{get:function(t){return t.isinterleavedbufferattribute&&(t=t.data),r.get(t)},remove:function(e){e.isinterleavedbufferattribute&&(e=e.data);var n=r.get(e);n&&(t.deletebuffer(n.buffer),r.delete(e))},update:function(e,i){if(e.isglbufferattribute){var a=r.get(e);(!a||a.version<e.version)&&r.set(e,{buffer:e.buffer,type:e.type,bytesperelement:e.elementsize,version:e.version})}else{e.isinterleavedbufferattribute&&(e=e.data);var o=r.get(e);void 0===o?r.set(e,function(e,r){var i=e.array,a=e.usage,o=t.createbuffer();t.bindbuffer(r,o),t.bufferdata(r,i,a),e.onuploadcallback();var s=5126;return i instanceof float32array?s=5126:i instanceof float64array?console.warn("three.webglattributes: unsupported data buffer format: float64array."):i instanceof uint16array?e.isfloat16bufferattribute?n?s=5131:console.warn("three.webglattributes: usage of float16bufferattribute requires webgl2."):s=5123:i instanceof int16array?s=5122:i instanceof uint32array?s=5125:i instanceof int32array?s=5124:i instanceof int8array?s=5120:i instanceof uint8array&&(s=5121),{buffer:o,type:s,bytesperelement:i.bytes_per_element,version:e.version}}(e,i)):o.version<e.version&&(!function(e,r,i){var a=r.array,o=r.updaterange;t.bindbuffer(i,e),-1===o.count?t.buffersubdata(i,0,a):(n?t.buffersubdata(i,o.offset*a.bytes_per_element,a,o.offset,o.count):t.buffersubdata(i,o.offset*a.bytes_per_element,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,e,i),o.version=e.version)}}}}var ir=function(t){function e(e,n,r,i){var a;void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=1),(a=t.call(this)||this).type="planebuffergeometry",a.parameters={width:e,height:n,widthsegments:r,heightsegments:i};for(var o=e/2,s=n/2,c=math.floor(r),l=math.floor(i),u=c+1,h=l+1,d=e/c,p=n/l,f=[],m=[],v=[],g=[],y=0;y<h;y++)for(var x=y*p-s,_=0;_<u;_++){var b=_*d-o;m.push(b,-x,0),v.push(0,0,1),g.push(_/c),g.push(1-y/l)}for(var w=0;w<l;w++)for(var m=0;m<c;m++){var s=m+u*w,t=m+u*(w+1),e=m+1+u*(w+1),a=m+1+u*w;f.push(s,t,a),f.push(t,e,a)}return a.setindex(f),a.setattribute("position",new sn(m,3)),a.setattribute("normal",new sn(v,3)),a.setattribute("uv",new sn(g,2)),a}return ut(e,t),e}(_n),ar={alphamap_fragment:"#ifdef use_alphamap\n\tdiffusecolor.a *= texture2d( alphamap, vuv ).g;\n#endif",alphamap_pars_fragment:"#ifdef use_alphamap\n\tuniform sampler2d alphamap;\n#endif",alphatest_fragment:"#ifdef alphatest\n\tif ( diffusecolor.a < alphatest ) discard;\n#endif",aomap_fragment:"#ifdef use_aomap\n\tfloat ambientocclusion = ( texture2d( aomap, vuv2 ).r - 1.0 ) * aomapintensity + 1.0;\n\treflectedlight.indirectdiffuse *= ambientocclusion;\n\t#if defined( use_envmap ) && defined( standard )\n\t\tfloat dotnv = saturate( dot( geometry.normal, geometry.viewdir ) );\n\t\treflectedlight.indirectspecular *= computespecularocclusion( dotnv, ambientocclusion, material.specularroughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef use_aomap\n\tuniform sampler2d aomap;\n\tuniform float aomapintensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectnormal = vec3( normal );\n#ifdef use_tangent\n\tvec3 objecttangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integratespecularbrdf( const in float dotnv, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotnv ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctuallightintensitytoirradiancefactor( const in float lightdistance, const in float cutoffdistance, const in float decayexponent ) {\n#if defined ( physically_correct_lights )\n\tfloat distancefalloff = 1.0 / max( pow( lightdistance, decayexponent ), 0.01 );\n\tif( cutoffdistance > 0.0 ) {\n\t\tdistancefalloff *= pow2( saturate( 1.0 - pow4( lightdistance / cutoffdistance ) ) );\n\t}\n\treturn distancefalloff;\n#else\n\tif( cutoffdistance > 0.0 && decayexponent > 0.0 ) {\n\t\treturn pow( saturate( -lightdistance / cutoffdistance + 1.0 ), decayexponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 brdf_diffuse_lambert( const in vec3 diffusecolor ) {\n\treturn reciprocal_pi * diffusecolor;\n}\nvec3 f_schlick( const in vec3 specularcolor, const in float dotlh ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotlh - 6.98316 ) * dotlh );\n\treturn ( 1.0 - specularcolor ) * fresnel + specularcolor;\n}\nvec3 f_schlick_roughnessdependent( const in vec3 f0, const in float dotnv, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotnv - 6.98316 ) * dotnv );\n\tvec3 fr = max( vec3( 1.0 - roughness ), f0 ) - f0;\n\treturn fr * fresnel + f0;\n}\nfloat g_ggx_smith( const in float alpha, const in float dotnl, const in float dotnv ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotnl + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotnl ) );\n\tfloat gv = dotnv + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotnv ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat g_ggx_smithcorrelated( const in float alpha, const in float dotnl, const in float dotnv ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotnl * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotnv ) );\n\tfloat gl = dotnv * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotnl ) );\n\treturn 0.5 / max( gv + gl, epsilon );\n}\nfloat d_ggx( const in float alpha, const in float dotnh ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotnh ) * ( a2 - 1.0 ) + 1.0;\n\treturn reciprocal_pi * a2 / pow2( denom );\n}\nvec3 brdf_specular_ggx( const in incidentlight incidentlight, const in vec3 viewdir, const in vec3 normal, const in vec3 specularcolor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfdir = normalize( incidentlight.direction + viewdir );\n\tfloat dotnl = saturate( dot( normal, incidentlight.direction ) );\n\tfloat dotnv = saturate( dot( normal, viewdir ) );\n\tfloat dotnh = saturate( dot( normal, halfdir ) );\n\tfloat dotlh = saturate( dot( incidentlight.direction, halfdir ) );\n\tvec3 f = f_schlick( specularcolor, dotlh );\n\tfloat g = g_ggx_smithcorrelated( alpha, dotnl, dotnv );\n\tfloat d = d_ggx( alpha, dotnh );\n\treturn f * ( g * d );\n}\nvec2 ltc_uv( const in vec3 n, const in vec3 v, const in float roughness ) {\n\tconst float lut_size = 64.0;\n\tconst float lut_scale = ( lut_size - 1.0 ) / lut_size;\n\tconst float lut_bias = 0.5 / lut_size;\n\tfloat dotnv = saturate( dot( n, v ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotnv ) );\n\tuv = uv * lut_scale + lut_bias;\n\treturn uv;\n}\nfloat ltc_clippedsphereformfactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 ltc_edgevectorformfactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 ltc_evaluate( const in vec3 n, const in vec3 v, const in vec3 p, const in mat3 minv, const in vec3 rectcoords[ 4 ] ) {\n\tvec3 v1 = rectcoords[ 1 ] - rectcoords[ 0 ];\n\tvec3 v2 = rectcoords[ 3 ] - rectcoords[ 0 ];\n\tvec3 lightnormal = cross( v1, v2 );\n\tif( dot( lightnormal, p - rectcoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 t1, t2;\n\tt1 = normalize( v - n * dot( v, n ) );\n\tt2 = - cross( n, t1 );\n\tmat3 mat = minv * transposemat3( mat3( t1, t2, n ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectcoords[ 0 ] - p );\n\tcoords[ 1 ] = mat * ( rectcoords[ 1 ] - p );\n\tcoords[ 2 ] = mat * ( rectcoords[ 2 ] - p );\n\tcoords[ 3 ] = mat * ( rectcoords[ 3 ] - p );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorformfactor = vec3( 0.0 );\n\tvectorformfactor += ltc_edgevectorformfactor( coords[ 0 ], coords[ 1 ] );\n\tvectorformfactor += ltc_edgevectorformfactor( coords[ 1 ], coords[ 2 ] );\n\tvectorformfactor += ltc_edgevectorformfactor( coords[ 2 ], coords[ 3 ] );\n\tvectorformfactor += ltc_edgevectorformfactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = ltc_clippedsphereformfactor( vectorformfactor );\n\treturn vec3( result );\n}\nvec3 brdf_specular_ggx_environment( const in vec3 viewdir, const in vec3 normal, const in vec3 specularcolor, const in float roughness ) {\n\tfloat dotnv = saturate( dot( normal, viewdir ) );\n\tvec2 brdf = integratespecularbrdf( dotnv, roughness );\n\treturn specularcolor * brdf.x + brdf.y;\n}\nvoid brdf_specular_multiscattering_environment( const in geometriccontext geometry, const in vec3 specularcolor, const in float roughness, inout vec3 singlescatter, inout vec3 multiscatter ) {\n\tfloat dotnv = saturate( dot( geometry.normal, geometry.viewdir ) );\n\tvec3 f = f_schlick_roughnessdependent( specularcolor, dotnv, roughness );\n\tvec2 brdf = integratespecularbrdf( dotnv, roughness );\n\tvec3 fssess = f * brdf.x + brdf.y;\n\tfloat ess = brdf.x + brdf.y;\n\tfloat ems = 1.0 - ess;\n\tvec3 favg = specularcolor + ( 1.0 - specularcolor ) * 0.047619;\tvec3 fms = fssess * favg / ( 1.0 - ems * favg );\n\tsinglescatter += fssess;\n\tmultiscatter += fms * ems;\n}\nfloat g_blinnphong_implicit( ) {\n\treturn 0.25;\n}\nfloat d_blinnphong( const in float shininess, const in float dotnh ) {\n\treturn reciprocal_pi * ( shininess * 0.5 + 1.0 ) * pow( dotnh, shininess );\n}\nvec3 brdf_specular_blinnphong( const in incidentlight incidentlight, const in geometriccontext geometry, const in vec3 specularcolor, const in float shininess ) {\n\tvec3 halfdir = normalize( incidentlight.direction + geometry.viewdir );\n\tfloat dotnh = saturate( dot( geometry.normal, halfdir ) );\n\tfloat dotlh = saturate( dot( incidentlight.direction, halfdir ) );\n\tvec3 f = f_schlick( specularcolor, dotlh );\n\tfloat g = g_blinnphong_implicit( );\n\tfloat d = d_blinnphong( shininess, dotnh );\n\treturn f * ( g * d );\n}\nfloat ggxroughnesstoblinnexponent( const in float ggxroughness ) {\n\treturn ( 2.0 / pow2( ggxroughness + 0.0001 ) - 2.0 );\n}\nfloat blinnexponenttoggxroughness( const in float blinnexponent ) {\n\treturn sqrt( 2.0 / ( blinnexponent + 2.0 ) );\n}\n#if defined( use_sheen )\nfloat d_charlie(float roughness, float noh) {\n\tfloat invalpha = 1.0 / roughness;\n\tfloat cos2h = noh * noh;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invalpha) * pow(sin2h, invalpha * 0.5) / (2.0 * pi);\n}\nfloat v_neubelt(float nov, float nol) {\n\treturn saturate(1.0 / (4.0 * (nol + nov - nol * nov)));\n}\nvec3 brdf_specular_sheen( const in float roughness, const in vec3 l, const in geometriccontext geometry, vec3 specularcolor ) {\n\tvec3 n = geometry.normal;\n\tvec3 v = geometry.viewdir;\n\tvec3 h = normalize( v + l );\n\tfloat dotnh = saturate( dot( n, h ) );\n\treturn specularcolor * d_charlie( roughness, dotnh ) * v_neubelt( dot(n, v), dot(n, l) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef use_bumpmap\n\tuniform sampler2d bumpmap;\n\tuniform float bumpscale;\n\tvec2 dhdxy_fwd() {\n\t\tvec2 dstdx = dfdx( vuv );\n\t\tvec2 dstdy = dfdy( vuv );\n\t\tfloat hll = bumpscale * texture2d( bumpmap, vuv ).x;\n\t\tfloat dbx = bumpscale * texture2d( bumpmap, vuv + dstdx ).x - hll;\n\t\tfloat dby = bumpscale * texture2d( bumpmap, vuv + dstdy ).x - hll;\n\t\treturn vec2( dbx, dby );\n\t}\n\tvec3 perturbnormalarb( vec3 surf_pos, vec3 surf_norm, vec2 dhdxy ) {\n\t\tvec3 vsigmax = vec3( dfdx( surf_pos.x ), dfdx( surf_pos.y ), dfdx( surf_pos.z ) );\n\t\tvec3 vsigmay = vec3( dfdy( surf_pos.x ), dfdy( surf_pos.y ), dfdy( surf_pos.z ) );\n\t\tvec3 vn = surf_norm;\n\t\tvec3 r1 = cross( vsigmay, vn );\n\t\tvec3 r2 = cross( vn, vsigmax );\n\t\tfloat fdet = dot( vsigmax, r1 );\n\t\tfdet *= ( float( gl_frontfacing ) * 2.0 - 1.0 );\n\t\tvec3 vgrad = sign( fdet ) * ( dhdxy.x * r1 + dhdxy.y * r2 );\n\t\treturn normalize( abs( fdet ) * surf_norm - vgrad );\n\t}\n#endif",clipping_planes_fragment:"#if num_clipping_planes > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < union_clipping_planes; i ++ ) {\n\t\tplane = clippingplanes[ i ];\n\t\tif ( dot( vclipposition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if union_clipping_planes < num_clipping_planes\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = union_clipping_planes; i < num_clipping_planes; i ++ ) {\n\t\t\tplane = clippingplanes[ i ];\n\t\t\tclipped = ( dot( vclipposition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if num_clipping_planes > 0\n\tvarying vec3 vclipposition;\n\tuniform vec4 clippingplanes[ num_clipping_planes ];\n#endif",clipping_planes_pars_vertex:"#if num_clipping_planes > 0\n\tvarying vec3 vclipposition;\n#endif",clipping_planes_vertex:"#if num_clipping_planes > 0\n\tvclipposition = - mvposition.xyz;\n#endif",color_fragment:"#ifdef use_color\n\tdiffusecolor.rgb *= vcolor;\n#endif",color_pars_fragment:"#ifdef use_color\n\tvarying vec3 vcolor;\n#endif",color_pars_vertex:"#if defined( use_color ) || defined( use_instancing_color )\n\tvarying vec3 vcolor;\n#endif",color_vertex:"#if defined( use_color ) || defined( use_instancing_color )\n\tvcolor = vec3( 1.0 );\n#endif\n#ifdef use_color\n\tvcolor.xyz *= color.xyz;\n#endif\n#ifdef use_instancing_color\n\tvcolor.xyz *= instancecolor.xyz;\n#endif",common:"#define pi 3.141592653589793\n#define pi2 6.283185307179586\n#define pi_half 1.5707963267948966\n#define reciprocal_pi 0.3183098861837907\n#define reciprocal_pi2 0.15915494309189535\n#define epsilon 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whitecomplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, pi );\n\treturn fract(sin(sn) * c);\n}\n#ifdef high_precision\n\tfloat precisionsafelength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionsafelength( vec3 v ) {\n\t\tfloat maxcomponent = max3( abs( v ) );\n\t\treturn length( v / maxcomponent ) * maxcomponent;\n\t}\n#endif\nstruct incidentlight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct reflectedlight {\n\tvec3 directdiffuse;\n\tvec3 directspecular;\n\tvec3 indirectdiffuse;\n\tvec3 indirectspecular;\n};\nstruct geometriccontext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewdir;\n#ifdef clearcoat\n\tvec3 clearcoatnormal;\n#endif\n};\nvec3 transformdirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inversetransformdirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectonplane(in vec3 point, in vec3 pointonplane, in vec3 planenormal ) {\n\tfloat distance = dot( planenormal, point - pointonplane );\n\treturn - distance * planenormal + point;\n}\nfloat sideofplane( in vec3 point, in vec3 pointonplane, in vec3 planenormal ) {\n\treturn sign( dot( point - pointonplane, planenormal ) );\n}\nvec3 lineplaneintersect( in vec3 pointonline, in vec3 linedirection, in vec3 pointonplane, in vec3 planenormal ) {\n\treturn linedirection * ( dot( planenormal, pointonplane - pointonline ) / dot( planenormal, linedirection ) ) + pointonline;\n}\nmat3 transposemat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat lineartorelativeluminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isperspectivematrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectuv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * reciprocal_pi2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * reciprocal_pi + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef envmap_type_cube_uv\n\t#define cubeuv_maxmiplevel 8.0\n\t#define cubeuv_minmiplevel 4.0\n\t#define cubeuv_maxtilesize 256.0\n\t#define cubeuv_mintilesize 16.0\n\tfloat getface( vec3 direction ) {\n\t\tvec3 absdirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absdirection.x > absdirection.z ) {\n\t\t\tif ( absdirection.x > absdirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absdirection.z > absdirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getuv( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearcubeuv( sampler2d envmap, vec3 direction, float mipint ) {\n\t\tfloat face = getface( direction );\n\t\tfloat filterint = max( cubeuv_minmiplevel - mipint, 0.0 );\n\t\tmipint = max( mipint, cubeuv_minmiplevel );\n\t\tfloat facesize = exp2( mipint );\n\t\tfloat texelsize = 1.0 / ( 3.0 * cubeuv_maxtilesize );\n\t\tvec2 uv = getuv( direction, face ) * ( facesize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += facesize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * facesize;\n\t\tif ( mipint < cubeuv_maxmiplevel ) {\n\t\t\tuv.y += 2.0 * cubeuv_maxtilesize;\n\t\t}\n\t\tuv.y += filterint * 2.0 * cubeuv_mintilesize;\n\t\tuv.x += 3.0 * max( 0.0, cubeuv_maxtilesize - 2.0 * facesize );\n\t\tuv *= texelsize;\n\t\tvec3 tl = envmaptexeltolinear( texture2d( envmap, uv ) ).rgb;\n\t\tuv.x += texelsize;\n\t\tvec3 tr = envmaptexeltolinear( texture2d( envmap, uv ) ).rgb;\n\t\tuv.y += texelsize;\n\t\tvec3 br = envmaptexeltolinear( texture2d( envmap, uv ) ).rgb;\n\t\tuv.x -= texelsize;\n\t\tvec3 bl = envmaptexeltolinear( texture2d( envmap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnesstomip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 texturecubeuv( sampler2d envmap, vec3 sampledir, float roughness ) {\n\t\tfloat mip = clamp( roughnesstomip( roughness ), m0, cubeuv_maxmiplevel );\n\t\tfloat mipf = fract( mip );\n\t\tfloat mipint = floor( mip );\n\t\tvec3 color0 = bilinearcubeuv( envmap, sampledir, mipint );\n\t\tif ( mipf == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearcubeuv( envmap, sampledir, mipint + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipf ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformednormal = objectnormal;\n#ifdef use_instancing\n\tmat3 m = mat3( instancematrix );\n\ttransformednormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformednormal = m * transformednormal;\n#endif\ntransformednormal = normalmatrix * transformednormal;\n#ifdef flip_sided\n\ttransformednormal = - transformednormal;\n#endif\n#ifdef use_tangent\n\tvec3 transformedtangent = ( modelviewmatrix * vec4( objecttangent, 0.0 ) ).xyz;\n\t#ifdef flip_sided\n\t\ttransformedtangent = - transformedtangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef use_displacementmap\n\tuniform sampler2d displacementmap;\n\tuniform float displacementscale;\n\tuniform float displacementbias;\n#endif",displacementmap_vertex:"#ifdef use_displacementmap\n\ttransformed += normalize( objectnormal ) * ( texture2d( displacementmap, vuv ).x * displacementscale + displacementbias );\n#endif",emissivemap_fragment:"#ifdef use_emissivemap\n\tvec4 emissivecolor = texture2d( emissivemap, vuv );\n\temissivecolor.rgb = emissivemaptexeltolinear( emissivecolor ).rgb;\n\ttotalemissiveradiance *= emissivecolor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef use_emissivemap\n\tuniform sampler2d emissivemap;\n#endif",encodings_fragment:"gl_fragcolor = lineartooutputtexel( gl_fragcolor );",encodings_pars_fragment:"\nvec4 lineartolinear( in vec4 value ) {\n\treturn value;\n}\nvec4 gammatolinear( in vec4 value, in float gammafactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammafactor ) ), value.a );\n}\nvec4 lineartogamma( in vec4 value, in float gammafactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammafactor ) ), value.a );\n}\nvec4 srgbtolinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessthanequal( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 lineartosrgb( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessthanequal( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 rgbetolinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 lineartorgbe( in vec4 value ) {\n\tfloat maxcomponent = max( max( value.r, value.g ), value.b );\n\tfloat fexp = clamp( ceil( log2( maxcomponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fexp ), ( fexp + 128.0 ) / 255.0 );\n}\nvec4 rgbmtolinear( in vec4 value, in float maxrange ) {\n\treturn vec4( value.rgb * value.a * maxrange, 1.0 );\n}\nvec4 lineartorgbm( in vec4 value, in float maxrange ) {\n\tfloat maxrgb = max( value.r, max( value.g, value.b ) );\n\tfloat m = clamp( maxrgb / maxrange, 0.0, 1.0 );\n\tm = ceil( m * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( m * maxrange ), m );\n}\nvec4 rgbdtolinear( in vec4 value, in float maxrange ) {\n\treturn vec4( value.rgb * ( ( maxrange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 lineartorgbd( in vec4 value, in float maxrange ) {\n\tfloat maxrgb = max( value.r, max( value.g, value.b ) );\n\tfloat d = max( maxrange / maxrgb, 1.0 );\n\td = clamp( floor( d ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( d * ( 255.0 / maxrange ) ), d );\n}\nconst mat3 clogluvm = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 lineartologluv( in vec4 value ) {\n\tvec3 xp_y_xyzp = clogluvm * value.rgb;\n\txp_y_xyzp = max( xp_y_xyzp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vresult;\n\tvresult.xy = xp_y_xyzp.xy / xp_y_xyzp.z;\n\tfloat le = 2.0 * log2(xp_y_xyzp.y) + 127.0;\n\tvresult.w = fract( le );\n\tvresult.z = ( le - ( floor( vresult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vresult;\n}\nconst mat3 clogluvinversem = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 logluvtolinear( in vec4 value ) {\n\tfloat le = value.z * 255.0 + value.w;\n\tvec3 xp_y_xyzp;\n\txp_y_xyzp.y = exp2( ( le - 127.0 ) / 2.0 );\n\txp_y_xyzp.z = xp_y_xyzp.y / value.y;\n\txp_y_xyzp.x = value.x * xp_y_xyzp.z;\n\tvec3 vrgb = clogluvinversem * xp_y_xyzp.rgb;\n\treturn vec4( max( vrgb, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef use_envmap\n\t#ifdef env_worldpos\n\t\tvec3 cameratofrag;\n\t\tif ( isorthographic ) {\n\t\t\tcameratofrag = normalize( vec3( - viewmatrix[ 0 ][ 2 ], - viewmatrix[ 1 ][ 2 ], - viewmatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameratofrag = normalize( vworldposition - cameraposition );\n\t\t}\n\t\tvec3 worldnormal = inversetransformdirection( normal, viewmatrix );\n\t\t#ifdef envmap_mode_reflection\n\t\t\tvec3 reflectvec = reflect( cameratofrag, worldnormal );\n\t\t#else\n\t\t\tvec3 reflectvec = refract( cameratofrag, worldnormal, refractionratio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectvec = vreflect;\n\t#endif\n\t#ifdef envmap_type_cube\n\t\tvec4 envcolor = texturecube( envmap, vec3( flipenvmap * reflectvec.x, reflectvec.yz ) );\n\t#elif defined( envmap_type_cube_uv )\n\t\tvec4 envcolor = texturecubeuv( envmap, reflectvec, 0.0 );\n\t#else\n\t\tvec4 envcolor = vec4( 0.0 );\n\t#endif\n\t#ifndef envmap_type_cube_uv\n\t\tenvcolor = envmaptexeltolinear( envcolor );\n\t#endif\n\t#ifdef envmap_blending_multiply\n\t\toutgoinglight = mix( outgoinglight, outgoinglight * envcolor.xyz, specularstrength * reflectivity );\n\t#elif defined( envmap_blending_mix )\n\t\toutgoinglight = mix( outgoinglight, envcolor.xyz, specularstrength * reflectivity );\n\t#elif defined( envmap_blending_add )\n\t\toutgoinglight += envcolor.xyz * specularstrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef use_envmap\n\tuniform float envmapintensity;\n\tuniform float flipenvmap;\n\tuniform int maxmiplevel;\n\t#ifdef envmap_type_cube\n\t\tuniform samplercube envmap;\n\t#else\n\t\tuniform sampler2d envmap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef use_envmap\n\tuniform float reflectivity;\n\t#if defined( use_bumpmap ) || defined( use_normalmap ) || defined( phong )\n\t\t#define env_worldpos\n\t#endif\n\t#ifdef env_worldpos\n\t\tvarying vec3 vworldposition;\n\t\tuniform float refractionratio;\n\t#else\n\t\tvarying vec3 vreflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef use_envmap\n\t#if defined( use_bumpmap ) || defined( use_normalmap ) ||defined( phong )\n\t\t#define env_worldpos\n\t#endif\n\t#ifdef env_worldpos\n\t\t\n\t\tvarying vec3 vworldposition;\n\t#else\n\t\tvarying vec3 vreflect;\n\t\tuniform float refractionratio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( use_envmap )\n\t#ifdef envmap_mode_refraction\n\t\tuniform float refractionratio;\n\t#endif\n\tvec3 getlightprobeindirectirradiance( const in geometriccontext geometry, const in int maxmiplevel ) {\n\t\tvec3 worldnormal = inversetransformdirection( geometry.normal, viewmatrix );\n\t\t#ifdef envmap_type_cube\n\t\t\tvec3 queryvec = vec3( flipenvmap * worldnormal.x, worldnormal.yz );\n\t\t\t#ifdef texture_lod_ext\n\t\t\t\tvec4 envmapcolor = texturecubelodext( envmap, queryvec, float( maxmiplevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envmapcolor = texturecube( envmap, queryvec, float( maxmiplevel ) );\n\t\t\t#endif\n\t\t\tenvmapcolor.rgb = envmaptexeltolinear( envmapcolor ).rgb;\n\t\t#elif defined( envmap_type_cube_uv )\n\t\t\tvec4 envmapcolor = texturecubeuv( envmap, worldnormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envmapcolor = vec4( 0.0 );\n\t\t#endif\n\t\treturn pi * envmapcolor.rgb * envmapintensity;\n\t}\n\tfloat getspecularmiplevel( const in float roughness, const in int maxmiplevel ) {\n\t\tfloat maxmiplevelscalar = float( maxmiplevel );\n\t\tfloat sigma = pi * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredmiplevel = maxmiplevelscalar + log2( sigma );\n\t\treturn clamp( desiredmiplevel, 0.0, maxmiplevelscalar );\n\t}\n\tvec3 getlightprobeindirectradiance( const in vec3 viewdir, const in vec3 normal, const in float roughness, const in int maxmiplevel ) {\n\t\t#ifdef envmap_mode_reflection\n\t\t\tvec3 reflectvec = reflect( -viewdir, normal );\n\t\t\treflectvec = normalize( mix( reflectvec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectvec = refract( -viewdir, normal, refractionratio );\n\t\t#endif\n\t\treflectvec = inversetransformdirection( reflectvec, viewmatrix );\n\t\tfloat specularmiplevel = getspecularmiplevel( roughness, maxmiplevel );\n\t\t#ifdef envmap_type_cube\n\t\t\tvec3 queryreflectvec = vec3( flipenvmap * reflectvec.x, reflectvec.yz );\n\t\t\t#ifdef texture_lod_ext\n\t\t\t\tvec4 envmapcolor = texturecubelodext( envmap, queryreflectvec, specularmiplevel );\n\t\t\t#else\n\t\t\t\tvec4 envmapcolor = texturecube( envmap, queryreflectvec, specularmiplevel );\n\t\t\t#endif\n\t\t\tenvmapcolor.rgb = envmaptexeltolinear( envmapcolor ).rgb;\n\t\t#elif defined( envmap_type_cube_uv )\n\t\t\tvec4 envmapcolor = texturecubeuv( envmap, reflectvec, roughness );\n\t\t#endif\n\t\treturn envmapcolor.rgb * envmapintensity;\n\t}\n#endif",envmap_vertex:"#ifdef use_envmap\n\t#ifdef env_worldpos\n\t\tvworldposition = worldposition.xyz;\n\t#else\n\t\tvec3 cameratovertex;\n\t\tif ( isorthographic ) {\n\t\t\tcameratovertex = normalize( vec3( - viewmatrix[ 0 ][ 2 ], - viewmatrix[ 1 ][ 2 ], - viewmatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameratovertex = normalize( worldposition.xyz - cameraposition );\n\t\t}\n\t\tvec3 worldnormal = inversetransformdirection( transformednormal, viewmatrix );\n\t\t#ifdef envmap_mode_reflection\n\t\t\tvreflect = reflect( cameratovertex, worldnormal );\n\t\t#else\n\t\t\tvreflect = refract( cameratovertex, worldnormal, refractionratio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef use_fog\n\tfogdepth = - mvposition.z;\n#endif",fog_pars_vertex:"#ifdef use_fog\n\tvarying float fogdepth;\n#endif",fog_fragment:"#ifdef use_fog\n\t#ifdef fog_exp2\n\t\tfloat fogfactor = 1.0 - exp( - fogdensity * fogdensity * fogdepth * fogdepth );\n\t#else\n\t\tfloat fogfactor = smoothstep( fognear, fogfar, fogdepth );\n\t#endif\n\tgl_fragcolor.rgb = mix( gl_fragcolor.rgb, fogcolor, fogfactor );\n#endif",fog_pars_fragment:"#ifdef use_fog\n\tuniform vec3 fogcolor;\n\tvarying float fogdepth;\n\t#ifdef fog_exp2\n\t\tuniform float fogdensity;\n\t#else\n\t\tuniform float fognear;\n\t\tuniform float fogfar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef use_gradientmap\n\tuniform sampler2d gradientmap;\n#endif\nvec3 getgradientirradiance( vec3 normal, vec3 lightdirection ) {\n\tfloat dotnl = dot( normal, lightdirection );\n\tvec2 coord = vec2( dotnl * 0.5 + 0.5, 0.0 );\n\t#ifdef use_gradientmap\n\t\treturn texture2d( gradientmap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef use_lightmap\n\tvec4 lightmaptexel= texture2d( lightmap, vuv2 );\n\treflectedlight.indirectdiffuse += pi * lightmaptexeltolinear( lightmaptexel ).rgb * lightmapintensity;\n#endif",lightmap_pars_fragment:"#ifdef use_lightmap\n\tuniform sampler2d lightmap;\n\tuniform float lightmapintensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\ngeometriccontext geometry;\ngeometry.position = mvposition.xyz;\ngeometry.normal = normalize( transformednormal );\ngeometry.viewdir = ( isorthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvposition.xyz );\ngeometriccontext backgeometry;\nbackgeometry.position = geometry.position;\nbackgeometry.normal = -geometry.normal;\nbackgeometry.viewdir = geometry.viewdir;\nvlightfront = vec3( 0.0 );\nvindirectfront = vec3( 0.0 );\n#ifdef double_sided\n\tvlightback = vec3( 0.0 );\n\tvindirectback = vec3( 0.0 );\n#endif\nincidentlight directlight;\nfloat dotnl;\nvec3 directlightcolor_diffuse;\nvindirectfront += getambientlightirradiance( ambientlightcolor );\nvindirectfront += getlightprobeirradiance( lightprobe, geometry );\n#ifdef double_sided\n\tvindirectback += getambientlightirradiance( ambientlightcolor );\n\tvindirectback += getlightprobeirradiance( lightprobe, backgeometry );\n#endif\n#if num_point_lights > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_point_lights; i ++ ) {\n\t\tgetpointdirectlightirradiance( pointlights[ i ], geometry, directlight );\n\t\tdotnl = dot( geometry.normal, directlight.direction );\n\t\tdirectlightcolor_diffuse = pi * directlight.color;\n\t\tvlightfront += saturate( dotnl ) * directlightcolor_diffuse;\n\t\t#ifdef double_sided\n\t\t\tvlightback += saturate( -dotnl ) * directlightcolor_diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if num_spot_lights > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_spot_lights; i ++ ) {\n\t\tgetspotdirectlightirradiance( spotlights[ i ], geometry, directlight );\n\t\tdotnl = dot( geometry.normal, directlight.direction );\n\t\tdirectlightcolor_diffuse = pi * directlight.color;\n\t\tvlightfront += saturate( dotnl ) * directlightcolor_diffuse;\n\t\t#ifdef double_sided\n\t\t\tvlightback += saturate( -dotnl ) * directlightcolor_diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if num_dir_lights > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_dir_lights; i ++ ) {\n\t\tgetdirectionaldirectlightirradiance( directionallights[ i ], geometry, directlight );\n\t\tdotnl = dot( geometry.normal, directlight.direction );\n\t\tdirectlightcolor_diffuse = pi * directlight.color;\n\t\tvlightfront += saturate( dotnl ) * directlightcolor_diffuse;\n\t\t#ifdef double_sided\n\t\t\tvlightback += saturate( -dotnl ) * directlightcolor_diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if num_hemi_lights > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_hemi_lights; i ++ ) {\n\t\tvindirectfront += gethemispherelightirradiance( hemispherelights[ i ], geometry );\n\t\t#ifdef double_sided\n\t\t\tvindirectback += gethemispherelightirradiance( hemispherelights[ i ], backgeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveshadow;\nuniform vec3 ambientlightcolor;\nuniform vec3 lightprobe[ 9 ];\nvec3 shgetirradianceat( in vec3 normal, in vec3 shcoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shcoefficients[ 0 ] * 0.886227;\n\tresult += shcoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shcoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shcoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shcoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shcoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shcoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shcoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shcoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getlightprobeirradiance( const in vec3 lightprobe[ 9 ], const in geometriccontext geometry ) {\n\tvec3 worldnormal = inversetransformdirection( geometry.normal, viewmatrix );\n\tvec3 irradiance = shgetirradianceat( worldnormal, lightprobe );\n\treturn irradiance;\n}\nvec3 getambientlightirradiance( const in vec3 ambientlightcolor ) {\n\tvec3 irradiance = ambientlightcolor;\n\t#ifndef physically_correct_lights\n\t\tirradiance *= pi;\n\t#endif\n\treturn irradiance;\n}\n#if num_dir_lights > 0\n\tstruct directionallight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform directionallight directionallights[ num_dir_lights ];\n\tvoid getdirectionaldirectlightirradiance( const in directionallight directionallight, const in geometriccontext geometry, out incidentlight directlight ) {\n\t\tdirectlight.color = directionallight.color;\n\t\tdirectlight.direction = directionallight.direction;\n\t\tdirectlight.visible = true;\n\t}\n#endif\n#if num_point_lights > 0\n\tstruct pointlight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform pointlight pointlights[ num_point_lights ];\n\tvoid getpointdirectlightirradiance( const in pointlight pointlight, const in geometriccontext geometry, out incidentlight directlight ) {\n\t\tvec3 lvector = pointlight.position - geometry.position;\n\t\tdirectlight.direction = normalize( lvector );\n\t\tfloat lightdistance = length( lvector );\n\t\tdirectlight.color = pointlight.color;\n\t\tdirectlight.color *= punctuallightintensitytoirradiancefactor( lightdistance, pointlight.distance, pointlight.decay );\n\t\tdirectlight.visible = ( directlight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if num_spot_lights > 0\n\tstruct spotlight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat conecos;\n\t\tfloat penumbracos;\n\t};\n\tuniform spotlight spotlights[ num_spot_lights ];\n\tvoid getspotdirectlightirradiance( const in spotlight spotlight, const in geometriccontext geometry, out incidentlight directlight ) {\n\t\tvec3 lvector = spotlight.position - geometry.position;\n\t\tdirectlight.direction = normalize( lvector );\n\t\tfloat lightdistance = length( lvector );\n\t\tfloat anglecos = dot( directlight.direction, spotlight.direction );\n\t\tif ( anglecos > spotlight.conecos ) {\n\t\t\tfloat spoteffect = smoothstep( spotlight.conecos, spotlight.penumbracos, anglecos );\n\t\t\tdirectlight.color = spotlight.color;\n\t\t\tdirectlight.color *= spoteffect * punctuallightintensitytoirradiancefactor( lightdistance, spotlight.distance, spotlight.decay );\n\t\t\tdirectlight.visible = true;\n\t\t} else {\n\t\t\tdirectlight.color = vec3( 0.0 );\n\t\t\tdirectlight.visible = false;\n\t\t}\n\t}\n#endif\n#if num_rect_area_lights > 0\n\tstruct rectarealight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfwidth;\n\t\tvec3 halfheight;\n\t};\n\tuniform sampler2d ltc_1;\tuniform sampler2d ltc_2;\n\tuniform rectarealight rectarealights[ num_rect_area_lights ];\n#endif\n#if num_hemi_lights > 0\n\tstruct hemispherelight {\n\t\tvec3 direction;\n\t\tvec3 skycolor;\n\t\tvec3 groundcolor;\n\t};\n\tuniform hemispherelight hemispherelights[ num_hemi_lights ];\n\tvec3 gethemispherelightirradiance( const in hemispherelight hemilight, const in geometriccontext geometry ) {\n\t\tfloat dotnl = dot( geometry.normal, hemilight.direction );\n\t\tfloat hemidiffuseweight = 0.5 * dotnl + 0.5;\n\t\tvec3 irradiance = mix( hemilight.groundcolor, hemilight.skycolor, hemidiffuseweight );\n\t\t#ifndef physically_correct_lights\n\t\t\tirradiance *= pi;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"toonmaterial material;\nmaterial.diffusecolor = diffusecolor.rgb;",lights_toon_pars_fragment:"varying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n#endif\nstruct toonmaterial {\n\tvec3 diffusecolor;\n};\nvoid re_direct_toon( const in incidentlight directlight, const in geometriccontext geometry, const in toonmaterial material, inout reflectedlight reflectedlight ) {\n\tvec3 irradiance = getgradientirradiance( geometry.normal, directlight.direction ) * directlight.color;\n\t#ifndef physically_correct_lights\n\t\tirradiance *= pi;\n\t#endif\n\treflectedlight.directdiffuse += irradiance * brdf_diffuse_lambert( material.diffusecolor );\n}\nvoid re_indirectdiffuse_toon( const in vec3 irradiance, const in geometriccontext geometry, const in toonmaterial material, inout reflectedlight reflectedlight ) {\n\treflectedlight.indirectdiffuse += irradiance * brdf_diffuse_lambert( material.diffusecolor );\n}\n#define re_direct\t\t\t\tre_direct_toon\n#define re_indirectdiffuse\t\tre_indirectdiffuse_toon\n#define material_lightprobelod( material )\t(0)",lights_phong_fragment:"blinnphongmaterial material;\nmaterial.diffusecolor = diffusecolor.rgb;\nmaterial.specularcolor = specular;\nmaterial.specularshininess = shininess;\nmaterial.specularstrength = specularstrength;",lights_phong_pars_fragment:"varying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n#endif\nstruct blinnphongmaterial {\n\tvec3 diffusecolor;\n\tvec3 specularcolor;\n\tfloat specularshininess;\n\tfloat specularstrength;\n};\nvoid re_direct_blinnphong( const in incidentlight directlight, const in geometriccontext geometry, const in blinnphongmaterial material, inout reflectedlight reflectedlight ) {\n\tfloat dotnl = saturate( dot( geometry.normal, directlight.direction ) );\n\tvec3 irradiance = dotnl * directlight.color;\n\t#ifndef physically_correct_lights\n\t\tirradiance *= pi;\n\t#endif\n\treflectedlight.directdiffuse += irradiance * brdf_diffuse_lambert( material.diffusecolor );\n\treflectedlight.directspecular += irradiance * brdf_specular_blinnphong( directlight, geometry, material.specularcolor, material.specularshininess ) * material.specularstrength;\n}\nvoid re_indirectdiffuse_blinnphong( const in vec3 irradiance, const in geometriccontext geometry, const in blinnphongmaterial material, inout reflectedlight reflectedlight ) {\n\treflectedlight.indirectdiffuse += irradiance * brdf_diffuse_lambert( material.diffusecolor );\n}\n#define re_direct\t\t\t\tre_direct_blinnphong\n#define re_indirectdiffuse\t\tre_indirectdiffuse_blinnphong\n#define material_lightprobelod( material )\t(0)",lights_physical_fragment:"physicalmaterial material;\nmaterial.diffusecolor = diffusecolor.rgb * ( 1.0 - metalnessfactor );\nvec3 dxy = max( abs( dfdx( geometrynormal ) ), abs( dfdy( geometrynormal ) ) );\nfloat geometryroughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularroughness = max( roughnessfactor, 0.0525 );material.specularroughness += geometryroughness;\nmaterial.specularroughness = min( material.specularroughness, 1.0 );\n#ifdef reflectivity\n\tmaterial.specularcolor = mix( vec3( maximum_specular_coefficient * pow2( reflectivity ) ), diffusecolor.rgb, metalnessfactor );\n#else\n\tmaterial.specularcolor = mix( vec3( default_specular_coefficient ), diffusecolor.rgb, metalnessfactor );\n#endif\n#ifdef clearcoat\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatroughness = clearcoatroughness;\n\t#ifdef use_clearcoatmap\n\t\tmaterial.clearcoat *= texture2d( clearcoatmap, vuv ).x;\n\t#endif\n\t#ifdef use_clearcoat_roughnessmap\n\t\tmaterial.clearcoatroughness *= texture2d( clearcoatroughnessmap, vuv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatroughness = max( material.clearcoatroughness, 0.0525 );\n\tmaterial.clearcoatroughness += geometryroughness;\n\tmaterial.clearcoatroughness = min( material.clearcoatroughness, 1.0 );\n#endif\n#ifdef use_sheen\n\tmaterial.sheencolor = sheen;\n#endif",lights_physical_pars_fragment:"struct physicalmaterial {\n\tvec3 diffusecolor;\n\tfloat specularroughness;\n\tvec3 specularcolor;\n#ifdef clearcoat\n\tfloat clearcoat;\n\tfloat clearcoatroughness;\n#endif\n#ifdef use_sheen\n\tvec3 sheencolor;\n#endif\n};\n#define maximum_specular_coefficient 0.16\n#define default_specular_coefficient 0.04\nfloat clearcoatdhrapprox( const in float roughness, const in float dotnl ) {\n\treturn default_specular_coefficient + ( 1.0 - default_specular_coefficient ) * ( pow( 1.0 - dotnl, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if num_rect_area_lights > 0\n\tvoid re_direct_rectarea_physical( const in rectarealight rectarealight, const in geometriccontext geometry, const in physicalmaterial material, inout reflectedlight reflectedlight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewdir = geometry.viewdir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightpos = rectarealight.position;\n\t\tvec3 halfwidth = rectarealight.halfwidth;\n\t\tvec3 halfheight = rectarealight.halfheight;\n\t\tvec3 lightcolor = rectarealight.color;\n\t\tfloat roughness = material.specularroughness;\n\t\tvec3 rectcoords[ 4 ];\n\t\trectcoords[ 0 ] = lightpos + halfwidth - halfheight;\t\trectcoords[ 1 ] = lightpos - halfwidth - halfheight;\n\t\trectcoords[ 2 ] = lightpos - halfwidth + halfheight;\n\t\trectcoords[ 3 ] = lightpos + halfwidth + halfheight;\n\t\tvec2 uv = ltc_uv( normal, viewdir, roughness );\n\t\tvec4 t1 = texture2d( ltc_1, uv );\n\t\tvec4 t2 = texture2d( ltc_2, uv );\n\t\tmat3 minv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularcolor * t2.x + ( vec3( 1.0 ) - material.specularcolor ) * t2.y );\n\t\treflectedlight.directspecular += lightcolor * fresnel * ltc_evaluate( normal, viewdir, position, minv, rectcoords );\n\t\treflectedlight.directdiffuse += lightcolor * material.diffusecolor * ltc_evaluate( normal, viewdir, position, mat3( 1.0 ), rectcoords );\n\t}\n#endif\nvoid re_direct_physical( const in incidentlight directlight, const in geometriccontext geometry, const in physicalmaterial material, inout reflectedlight reflectedlight ) {\n\tfloat dotnl = saturate( dot( geometry.normal, directlight.direction ) );\n\tvec3 irradiance = dotnl * directlight.color;\n\t#ifndef physically_correct_lights\n\t\tirradiance *= pi;\n\t#endif\n\t#ifdef clearcoat\n\t\tfloat ccdotnl = saturate( dot( geometry.clearcoatnormal, directlight.direction ) );\n\t\tvec3 ccirradiance = ccdotnl * directlight.color;\n\t\t#ifndef physically_correct_lights\n\t\t\tccirradiance *= pi;\n\t\t#endif\n\t\tfloat clearcoatdhr = material.clearcoat * clearcoatdhrapprox( material.clearcoatroughness, ccdotnl );\n\t\treflectedlight.directspecular += ccirradiance * material.clearcoat * brdf_specular_ggx( directlight, geometry.viewdir, geometry.clearcoatnormal, vec3( default_specular_coefficient ), material.clearcoatroughness );\n\t#else\n\t\tfloat clearcoatdhr = 0.0;\n\t#endif\n\t#ifdef use_sheen\n\t\treflectedlight.directspecular += ( 1.0 - clearcoatdhr ) * irradiance * brdf_specular_sheen(\n\t\t\tmaterial.specularroughness,\n\t\t\tdirectlight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheencolor\n\t\t);\n\t#else\n\t\treflectedlight.directspecular += ( 1.0 - clearcoatdhr ) * irradiance * brdf_specular_ggx( directlight, geometry.viewdir, geometry.normal, material.specularcolor, material.specularroughness);\n\t#endif\n\treflectedlight.directdiffuse += ( 1.0 - clearcoatdhr ) * irradiance * brdf_diffuse_lambert( material.diffusecolor );\n}\nvoid re_indirectdiffuse_physical( const in vec3 irradiance, const in geometriccontext geometry, const in physicalmaterial material, inout reflectedlight reflectedlight ) {\n\treflectedlight.indirectdiffuse += irradiance * brdf_diffuse_lambert( material.diffusecolor );\n}\nvoid re_indirectspecular_physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatradiance, const in geometriccontext geometry, const in physicalmaterial material, inout reflectedlight reflectedlight) {\n\t#ifdef clearcoat\n\t\tfloat ccdotnv = saturate( dot( geometry.clearcoatnormal, geometry.viewdir ) );\n\t\treflectedlight.indirectspecular += clearcoatradiance * material.clearcoat * brdf_specular_ggx_environment( geometry.viewdir, geometry.clearcoatnormal, vec3( default_specular_coefficient ), material.clearcoatroughness );\n\t\tfloat ccdotnl = ccdotnv;\n\t\tfloat clearcoatdhr = material.clearcoat * clearcoatdhrapprox( material.clearcoatroughness, ccdotnl );\n\t#else\n\t\tfloat clearcoatdhr = 0.0;\n\t#endif\n\tfloat clearcoatinv = 1.0 - clearcoatdhr;\n\tvec3 singlescattering = vec3( 0.0 );\n\tvec3 multiscattering = vec3( 0.0 );\n\tvec3 cosineweightedirradiance = irradiance * reciprocal_pi;\n\tbrdf_specular_multiscattering_environment( geometry, material.specularcolor, material.specularroughness, singlescattering, multiscattering );\n\tvec3 diffuse = material.diffusecolor * ( 1.0 - ( singlescattering + multiscattering ) );\n\treflectedlight.indirectspecular += clearcoatinv * radiance * singlescattering;\n\treflectedlight.indirectspecular += multiscattering * cosineweightedirradiance;\n\treflectedlight.indirectdiffuse += diffuse * cosineweightedirradiance;\n}\n#define re_direct\t\t\t\tre_direct_physical\n#define re_direct_rectarea\t\tre_direct_rectarea_physical\n#define re_indirectdiffuse\t\tre_indirectdiffuse_physical\n#define re_indirectspecular\t\tre_indirectspecular_physical\nfloat computespecularocclusion( const in float dotnv, const in float ambientocclusion, const in float roughness ) {\n\treturn saturate( pow( dotnv + ambientocclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientocclusion );\n}",lights_fragment_begin:"\ngeometriccontext geometry;\ngeometry.position = - vviewposition;\ngeometry.normal = normal;\ngeometry.viewdir = ( isorthographic ) ? vec3( 0, 0, 1 ) : normalize( vviewposition );\n#ifdef clearcoat\n\tgeometry.clearcoatnormal = clearcoatnormal;\n#endif\nincidentlight directlight;\n#if ( num_point_lights > 0 ) && defined( re_direct )\n\tpointlight pointlight;\n\t#if defined( use_shadowmap ) && num_point_light_shadows > 0\n\tpointlightshadow pointlightshadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_point_lights; i ++ ) {\n\t\tpointlight = pointlights[ i ];\n\t\tgetpointdirectlightirradiance( pointlight, geometry, directlight );\n\t\t#if defined( use_shadowmap ) && ( unrolled_loop_index < num_point_light_shadows )\n\t\tpointlightshadow = pointlightshadows[ i ];\n\t\tdirectlight.color *= all( bvec2( directlight.visible, receiveshadow ) ) ? getpointshadow( pointshadowmap[ i ], pointlightshadow.shadowmapsize, pointlightshadow.shadowbias, pointlightshadow.shadowradius, vpointshadowcoord[ i ], pointlightshadow.shadowcameranear, pointlightshadow.shadowcamerafar ) : 1.0;\n\t\t#endif\n\t\tre_direct( directlight, geometry, material, reflectedlight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( num_spot_lights > 0 ) && defined( re_direct )\n\tspotlight spotlight;\n\t#if defined( use_shadowmap ) && num_spot_light_shadows > 0\n\tspotlightshadow spotlightshadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_spot_lights; i ++ ) {\n\t\tspotlight = spotlights[ i ];\n\t\tgetspotdirectlightirradiance( spotlight, geometry, directlight );\n\t\t#if defined( use_shadowmap ) && ( unrolled_loop_index < num_spot_light_shadows )\n\t\tspotlightshadow = spotlightshadows[ i ];\n\t\tdirectlight.color *= all( bvec2( directlight.visible, receiveshadow ) ) ? getshadow( spotshadowmap[ i ], spotlightshadow.shadowmapsize, spotlightshadow.shadowbias, spotlightshadow.shadowradius, vspotshadowcoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tre_direct( directlight, geometry, material, reflectedlight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( num_dir_lights > 0 ) && defined( re_direct )\n\tdirectionallight directionallight;\n\t#if defined( use_shadowmap ) && num_dir_light_shadows > 0\n\tdirectionallightshadow directionallightshadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_dir_lights; i ++ ) {\n\t\tdirectionallight = directionallights[ i ];\n\t\tgetdirectionaldirectlightirradiance( directionallight, geometry, directlight );\n\t\t#if defined( use_shadowmap ) && ( unrolled_loop_index < num_dir_light_shadows )\n\t\tdirectionallightshadow = directionallightshadows[ i ];\n\t\tdirectlight.color *= all( bvec2( directlight.visible, receiveshadow ) ) ? getshadow( directionalshadowmap[ i ], directionallightshadow.shadowmapsize, directionallightshadow.shadowbias, directionallightshadow.shadowradius, vdirectionalshadowcoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tre_direct( directlight, geometry, material, reflectedlight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( num_rect_area_lights > 0 ) && defined( re_direct_rectarea )\n\trectarealight rectarealight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_rect_area_lights; i ++ ) {\n\t\trectarealight = rectarealights[ i ];\n\t\tre_direct_rectarea( rectarealight, geometry, material, reflectedlight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( re_indirectdiffuse )\n\tvec3 iblirradiance = vec3( 0.0 );\n\tvec3 irradiance = getambientlightirradiance( ambientlightcolor );\n\tirradiance += getlightprobeirradiance( lightprobe, geometry );\n\t#if ( num_hemi_lights > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < num_hemi_lights; i ++ ) {\n\t\t\tirradiance += gethemispherelightirradiance( hemispherelights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( re_indirectspecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatradiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( re_indirectdiffuse )\n\t#ifdef use_lightmap\n\t\tvec4 lightmaptexel= texture2d( lightmap, vuv2 );\n\t\tvec3 lightmapirradiance = lightmaptexeltolinear( lightmaptexel ).rgb * lightmapintensity;\n\t\t#ifndef physically_correct_lights\n\t\t\tlightmapirradiance *= pi;\n\t\t#endif\n\t\tirradiance += lightmapirradiance;\n\t#endif\n\t#if defined( use_envmap ) && defined( standard ) && defined( envmap_type_cube_uv )\n\t\tiblirradiance += getlightprobeindirectirradiance( geometry, maxmiplevel );\n\t#endif\n#endif\n#if defined( use_envmap ) && defined( re_indirectspecular )\n\tradiance += getlightprobeindirectradiance( geometry.viewdir, geometry.normal, material.specularroughness, maxmiplevel );\n\t#ifdef clearcoat\n\t\tclearcoatradiance += getlightprobeindirectradiance( geometry.viewdir, geometry.clearcoatnormal, material.clearcoatroughness, maxmiplevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( re_indirectdiffuse )\n\tre_indirectdiffuse( irradiance, geometry, material, reflectedlight );\n#endif\n#if defined( re_indirectspecular )\n\tre_indirectspecular( radiance, iblirradiance, clearcoatradiance, geometry, material, reflectedlight );\n#endif",logdepthbuf_fragment:"#if defined( use_logdepthbuf ) && defined( use_logdepthbuf_ext )\n\tgl_fragdepthext = visperspective == 0.0 ? gl_fragcoord.z : log2( vfragdepth ) * logdepthbuffc * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( use_logdepthbuf ) && defined( use_logdepthbuf_ext )\n\tuniform float logdepthbuffc;\n\tvarying float vfragdepth;\n\tvarying float visperspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef use_logdepthbuf\n\t#ifdef use_logdepthbuf_ext\n\t\tvarying float vfragdepth;\n\t\tvarying float visperspective;\n\t#else\n\t\tuniform float logdepthbuffc;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef use_logdepthbuf\n\t#ifdef use_logdepthbuf_ext\n\t\tvfragdepth = 1.0 + gl_position.w;\n\t\tvisperspective = float( isperspectivematrix( projectionmatrix ) );\n\t#else\n\t\tif ( isperspectivematrix( projectionmatrix ) ) {\n\t\t\tgl_position.z = log2( max( epsilon, gl_position.w + 1.0 ) ) * logdepthbuffc - 1.0;\n\t\t\tgl_position.z *= gl_position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef use_map\n\tvec4 texelcolor = texture2d( map, vuv );\n\ttexelcolor = maptexeltolinear( texelcolor );\n\tdiffusecolor *= texelcolor;\n#endif",map_pars_fragment:"#ifdef use_map\n\tuniform sampler2d map;\n#endif",map_particle_fragment:"#if defined( use_map ) || defined( use_alphamap )\n\tvec2 uv = ( uvtransform * vec3( gl_pointcoord.x, 1.0 - gl_pointcoord.y, 1 ) ).xy;\n#endif\n#ifdef use_map\n\tvec4 maptexel = texture2d( map, uv );\n\tdiffusecolor *= maptexeltolinear( maptexel );\n#endif\n#ifdef use_alphamap\n\tdiffusecolor.a *= texture2d( alphamap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( use_map ) || defined( use_alphamap )\n\tuniform mat3 uvtransform;\n#endif\n#ifdef use_map\n\tuniform sampler2d map;\n#endif\n#ifdef use_alphamap\n\tuniform sampler2d alphamap;\n#endif",metalnessmap_fragment:"float metalnessfactor = metalness;\n#ifdef use_metalnessmap\n\tvec4 texelmetalness = texture2d( metalnessmap, vuv );\n\tmetalnessfactor *= texelmetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef use_metalnessmap\n\tuniform sampler2d metalnessmap;\n#endif",morphnormal_vertex:"#ifdef use_morphnormals\n\tobjectnormal *= morphtargetbaseinfluence;\n\tobjectnormal += morphnormal0 * morphtargetinfluences[ 0 ];\n\tobjectnormal += morphnormal1 * morphtargetinfluences[ 1 ];\n\tobjectnormal += morphnormal2 * morphtargetinfluences[ 2 ];\n\tobjectnormal += morphnormal3 * morphtargetinfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef use_morphtargets\n\tuniform float morphtargetbaseinfluence;\n\t#ifndef use_morphnormals\n\t\tuniform float morphtargetinfluences[ 8 ];\n\t#else\n\t\tuniform float morphtargetinfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef use_morphtargets\n\ttransformed *= morphtargetbaseinfluence;\n\ttransformed += morphtarget0 * morphtargetinfluences[ 0 ];\n\ttransformed += morphtarget1 * morphtargetinfluences[ 1 ];\n\ttransformed += morphtarget2 * morphtargetinfluences[ 2 ];\n\ttransformed += morphtarget3 * morphtargetinfluences[ 3 ];\n\t#ifndef use_morphnormals\n\t\ttransformed += morphtarget4 * morphtargetinfluences[ 4 ];\n\t\ttransformed += morphtarget5 * morphtargetinfluences[ 5 ];\n\t\ttransformed += morphtarget6 * morphtargetinfluences[ 6 ];\n\t\ttransformed += morphtarget7 * morphtargetinfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef flat_shaded\n\tvec3 fdx = vec3( dfdx( vviewposition.x ), dfdx( vviewposition.y ), dfdx( vviewposition.z ) );\n\tvec3 fdy = vec3( dfdy( vviewposition.x ), dfdy( vviewposition.y ), dfdy( vviewposition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vnormal );\n\t#ifdef double_sided\n\t\tnormal = normal * ( float( gl_frontfacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef use_tangent\n\t\tvec3 tangent = normalize( vtangent );\n\t\tvec3 bitangent = normalize( vbitangent );\n\t\t#ifdef double_sided\n\t\t\ttangent = tangent * ( float( gl_frontfacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_frontfacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( tangentspace_normalmap ) || defined( use_clearcoat_normalmap )\n\t\t\tmat3 vtbn = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometrynormal = normal;",normal_fragment_maps:"#ifdef objectspace_normalmap\n\tnormal = texture2d( normalmap, vuv ).xyz * 2.0 - 1.0;\n\t#ifdef flip_sided\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef double_sided\n\t\tnormal = normal * ( float( gl_frontfacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalmatrix * normal );\n#elif defined( tangentspace_normalmap )\n\tvec3 mapn = texture2d( normalmap, vuv ).xyz * 2.0 - 1.0;\n\tmapn.xy *= normalscale;\n\t#ifdef use_tangent\n\t\tnormal = normalize( vtbn * mapn );\n\t#else\n\t\tnormal = perturbnormal2arb( -vviewposition, normal, mapn );\n\t#endif\n#elif defined( use_bumpmap )\n\tnormal = perturbnormalarb( -vviewposition, normal, dhdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef use_normalmap\n\tuniform sampler2d normalmap;\n\tuniform vec2 normalscale;\n#endif\n#ifdef objectspace_normalmap\n\tuniform mat3 normalmatrix;\n#endif\n#if ! defined ( use_tangent ) && ( defined ( tangentspace_normalmap ) || defined ( use_clearcoat_normalmap ) )\n\tvec3 perturbnormal2arb( vec3 eye_pos, vec3 surf_norm, vec3 mapn ) {\n\t\tvec3 q0 = vec3( dfdx( eye_pos.x ), dfdx( eye_pos.y ), dfdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dfdy( eye_pos.x ), dfdy( eye_pos.y ), dfdy( eye_pos.z ) );\n\t\tvec2 st0 = dfdx( vuv.st );\n\t\tvec2 st1 = dfdy( vuv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 s = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 t = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 n = normalize( surf_norm );\n\t\tmat3 tsn = mat3( s, t, n );\n\t\tmapn.xy *= ( float( gl_frontfacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapn );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef clearcoat\n\tvec3 clearcoatnormal = geometrynormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef use_clearcoat_normalmap\n\tvec3 clearcoatmapn = texture2d( clearcoatnormalmap, vuv ).xyz * 2.0 - 1.0;\n\tclearcoatmapn.xy *= clearcoatnormalscale;\n\t#ifdef use_tangent\n\t\tclearcoatnormal = normalize( vtbn * clearcoatmapn );\n\t#else\n\t\tclearcoatnormal = perturbnormal2arb( - vviewposition, clearcoatnormal, clearcoatmapn );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef use_clearcoatmap\n\tuniform sampler2d clearcoatmap;\n#endif\n#ifdef use_clearcoat_roughnessmap\n\tuniform sampler2d clearcoatroughnessmap;\n#endif\n#ifdef use_clearcoat_normalmap\n\tuniform sampler2d clearcoatnormalmap;\n\tuniform vec2 clearcoatnormalscale;\n#endif",packing:"vec3 packnormaltorgb( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackrgbtonormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float packupscale = 256. / 255.;const float unpackdownscale = 255. / 256.;\nconst vec3 packfactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 unpackfactors = unpackdownscale / vec4( packfactors, 1. );\nconst float shiftright8 = 1. / 256.;\nvec4 packdepthtorgba( const in float v ) {\n\tvec4 r = vec4( fract( v * packfactors ), v );\n\tr.yzw -= r.xyz * shiftright8;\treturn r * packupscale;\n}\nfloat unpackrgbatodepth( const in vec4 v ) {\n\treturn dot( v, unpackfactors );\n}\nvec4 pack2halftorgba( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackrgbato2half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewztoorthographicdepth( const in float viewz, const in float near, const in float far ) {\n\treturn ( viewz + near ) / ( near - far );\n}\nfloat orthographicdepthtoviewz( const in float linearclipz, const in float near, const in float far ) {\n\treturn linearclipz * ( near - far ) - near;\n}\nfloat viewztoperspectivedepth( const in float viewz, const in float near, const in float far ) {\n\treturn (( near + viewz ) * far ) / (( far - near ) * viewz );\n}\nfloat perspectivedepthtoviewz( const in float invclipz, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invclipz - far );\n}",premultiplied_alpha_fragment:"#ifdef premultiplied_alpha\n\tgl_fragcolor.rgb *= gl_fragcolor.a;\n#endif",project_vertex:"vec4 mvposition = vec4( transformed, 1.0 );\n#ifdef use_instancing\n\tmvposition = instancematrix * mvposition;\n#endif\nmvposition = modelviewmatrix * mvposition;\ngl_position = projectionmatrix * mvposition;",dithering_fragment:"#ifdef dithering\n\tgl_fragcolor.rgb = dithering( gl_fragcolor.rgb );\n#endif",dithering_pars_fragment:"#ifdef dithering\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_fragcoord.xy );\n\t\tvec3 dither_shift_rgb = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_rgb = mix( 2.0 * dither_shift_rgb, -2.0 * dither_shift_rgb, grid_position );\n\t\treturn color + dither_shift_rgb;\n\t}\n#endif",roughnessmap_fragment:"float roughnessfactor = roughness;\n#ifdef use_roughnessmap\n\tvec4 texelroughness = texture2d( roughnessmap, vuv );\n\troughnessfactor *= texelroughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef use_roughnessmap\n\tuniform sampler2d roughnessmap;\n#endif",shadowmap_pars_fragment:"#ifdef use_shadowmap\n\t#if num_dir_light_shadows > 0\n\t\tuniform sampler2d directionalshadowmap[ num_dir_light_shadows ];\n\t\tvarying vec4 vdirectionalshadowcoord[ num_dir_light_shadows ];\n\t\tstruct directionallightshadow {\n\t\t\tfloat shadowbias;\n\t\t\tfloat shadownormalbias;\n\t\t\tfloat shadowradius;\n\t\t\tvec2 shadowmapsize;\n\t\t};\n\t\tuniform directionallightshadow directionallightshadows[ num_dir_light_shadows ];\n\t#endif\n\t#if num_spot_light_shadows > 0\n\t\tuniform sampler2d spotshadowmap[ num_spot_light_shadows ];\n\t\tvarying vec4 vspotshadowcoord[ num_spot_light_shadows ];\n\t\tstruct spotlightshadow {\n\t\t\tfloat shadowbias;\n\t\t\tfloat shadownormalbias;\n\t\t\tfloat shadowradius;\n\t\t\tvec2 shadowmapsize;\n\t\t};\n\t\tuniform spotlightshadow spotlightshadows[ num_spot_light_shadows ];\n\t#endif\n\t#if num_point_light_shadows > 0\n\t\tuniform sampler2d pointshadowmap[ num_point_light_shadows ];\n\t\tvarying vec4 vpointshadowcoord[ num_point_light_shadows ];\n\t\tstruct pointlightshadow {\n\t\t\tfloat shadowbias;\n\t\t\tfloat shadownormalbias;\n\t\t\tfloat shadowradius;\n\t\t\tvec2 shadowmapsize;\n\t\t\tfloat shadowcameranear;\n\t\t\tfloat shadowcamerafar;\n\t\t};\n\t\tuniform pointlightshadow pointlightshadows[ num_point_light_shadows ];\n\t#endif\n\tfloat texture2dcompare( sampler2d depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackrgbatodepth( texture2d( depths, uv ) ) );\n\t}\n\tvec2 texture2ddistribution( sampler2d shadow, vec2 uv ) {\n\t\treturn unpackrgbato2half( texture2d( shadow, uv ) );\n\t}\n\tfloat vsmshadow (sampler2d shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2ddistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getshadow( sampler2d shadowmap, vec2 shadowmapsize, float shadowbias, float shadowradius, vec4 shadowcoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowcoord.xyz /= shadowcoord.w;\n\t\tshadowcoord.z += shadowbias;\n\t\tbvec4 infrustumvec = bvec4 ( shadowcoord.x >= 0.0, shadowcoord.x <= 1.0, shadowcoord.y >= 0.0, shadowcoord.y <= 1.0 );\n\t\tbool infrustum = all( infrustumvec );\n\t\tbvec2 frustumtestvec = bvec2( infrustum, shadowcoord.z <= 1.0 );\n\t\tbool frustumtest = all( frustumtestvec );\n\t\tif ( frustumtest ) {\n\t\t#if defined( shadowmap_type_pcf )\n\t\t\tvec2 texelsize = vec2( 1.0 ) / shadowmapsize;\n\t\t\tfloat dx0 = - texelsize.x * shadowradius;\n\t\t\tfloat dy0 = - texelsize.y * shadowradius;\n\t\t\tfloat dx1 = + texelsize.x * shadowradius;\n\t\t\tfloat dy1 = + texelsize.y * shadowradius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx0, dy0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( 0.0, dy0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx1, dy0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx2, dy2 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( 0.0, dy2 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx3, dy2 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx0, 0.0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx2, 0.0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy, shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx3, 0.0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx1, 0.0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx2, dy3 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( 0.0, dy3 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx3, dy3 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx0, dy1 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( 0.0, dy1 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, shadowcoord.xy + vec2( dx1, dy1 ), shadowcoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( shadowmap_type_pcf_soft )\n\t\t\tvec2 texelsize = vec2( 1.0 ) / shadowmapsize;\n\t\t\tfloat dx = texelsize.x;\n\t\t\tfloat dy = texelsize.y;\n\t\t\tvec2 uv = shadowcoord.xy;\n\t\t\tvec2 f = fract( uv * shadowmapsize + 0.5 );\n\t\t\tuv -= f * texelsize;\n\t\t\tshadow = (\n\t\t\t\ttexture2dcompare( shadowmap, uv, shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, uv + vec2( dx, 0.0 ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, uv + vec2( 0.0, dy ), shadowcoord.z ) +\n\t\t\t\ttexture2dcompare( shadowmap, uv + texelsize, shadowcoord.z ) +\n\t\t\t\tmix( texture2dcompare( shadowmap, uv + vec2( -dx, 0.0 ), shadowcoord.z ), \n\t\t\t\t\t texture2dcompare( shadowmap, uv + vec2( 2.0 * dx, 0.0 ), shadowcoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2dcompare( shadowmap, uv + vec2( -dx, dy ), shadowcoord.z ), \n\t\t\t\t\t texture2dcompare( shadowmap, uv + vec2( 2.0 * dx, dy ), shadowcoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2dcompare( shadowmap, uv + vec2( 0.0, -dy ), shadowcoord.z ), \n\t\t\t\t\t texture2dcompare( shadowmap, uv + vec2( 0.0, 2.0 * dy ), shadowcoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2dcompare( shadowmap, uv + vec2( dx, -dy ), shadowcoord.z ), \n\t\t\t\t\t texture2dcompare( shadowmap, uv + vec2( dx, 2.0 * dy ), shadowcoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2dcompare( shadowmap, uv + vec2( -dx, -dy ), shadowcoord.z ), \n\t\t\t\t\t\t\ttexture2dcompare( shadowmap, uv + vec2( 2.0 * dx, -dy ), shadowcoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2dcompare( shadowmap, uv + vec2( -dx, 2.0 * dy ), shadowcoord.z ), \n\t\t\t\t\t\t\ttexture2dcompare( shadowmap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowcoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( shadowmap_type_vsm )\n\t\t\tshadow = vsmshadow( shadowmap, shadowcoord.xy, shadowcoord.z );\n\t\t#else\n\t\t\tshadow = texture2dcompare( shadowmap, shadowcoord.xy, shadowcoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubetouv( vec3 v, float texelsizey ) {\n\t\tvec3 absv = abs( v );\n\t\tfloat scaletocube = 1.0 / max( absv.x, max( absv.y, absv.z ) );\n\t\tabsv *= scaletocube;\n\t\tv *= scaletocube * ( 1.0 - 2.0 * texelsizey );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostatexel = 1.5 * texelsizey;\n\t\tfloat almostone = 1.0 - almostatexel;\n\t\tif ( absv.z >= almostone ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absv.x >= almostone ) {\n\t\t\tfloat signx = sign( v.x );\n\t\t\tplanar.x = v.z * signx + 2.0 * signx;\n\t\t} else if ( absv.y >= almostone ) {\n\t\t\tfloat signy = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signy + 2.0;\n\t\t\tplanar.y = v.z * signy - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getpointshadow( sampler2d shadowmap, vec2 shadowmapsize, float shadowbias, float shadowradius, vec4 shadowcoord, float shadowcameranear, float shadowcamerafar ) {\n\t\tvec2 texelsize = vec2( 1.0 ) / ( shadowmapsize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lighttoposition = shadowcoord.xyz;\n\t\tfloat dp = ( length( lighttoposition ) - shadowcameranear ) / ( shadowcamerafar - shadowcameranear );\t\tdp += shadowbias;\n\t\tvec3 bd3d = normalize( lighttoposition );\n\t\t#if defined( shadowmap_type_pcf ) || defined( shadowmap_type_pcf_soft ) || defined( shadowmap_type_vsm )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowradius * texelsize.y;\n\t\t\treturn (\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.xyy, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.yyy, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.xyx, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.yyx, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.xxy, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.yxy, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.xxx, texelsize.y ), dp ) +\n\t\t\t\ttexture2dcompare( shadowmap, cubetouv( bd3d + offset.yxx, texelsize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2dcompare( shadowmap, cubetouv( bd3d, texelsize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef use_shadowmap\n\t#if num_dir_light_shadows > 0\n\t\tuniform mat4 directionalshadowmatrix[ num_dir_light_shadows ];\n\t\tvarying vec4 vdirectionalshadowcoord[ num_dir_light_shadows ];\n\t\tstruct directionallightshadow {\n\t\t\tfloat shadowbias;\n\t\t\tfloat shadownormalbias;\n\t\t\tfloat shadowradius;\n\t\t\tvec2 shadowmapsize;\n\t\t};\n\t\tuniform directionallightshadow directionallightshadows[ num_dir_light_shadows ];\n\t#endif\n\t#if num_spot_light_shadows > 0\n\t\tuniform mat4 spotshadowmatrix[ num_spot_light_shadows ];\n\t\tvarying vec4 vspotshadowcoord[ num_spot_light_shadows ];\n\t\tstruct spotlightshadow {\n\t\t\tfloat shadowbias;\n\t\t\tfloat shadownormalbias;\n\t\t\tfloat shadowradius;\n\t\t\tvec2 shadowmapsize;\n\t\t};\n\t\tuniform spotlightshadow spotlightshadows[ num_spot_light_shadows ];\n\t#endif\n\t#if num_point_light_shadows > 0\n\t\tuniform mat4 pointshadowmatrix[ num_point_light_shadows ];\n\t\tvarying vec4 vpointshadowcoord[ num_point_light_shadows ];\n\t\tstruct pointlightshadow {\n\t\t\tfloat shadowbias;\n\t\t\tfloat shadownormalbias;\n\t\t\tfloat shadowradius;\n\t\t\tvec2 shadowmapsize;\n\t\t\tfloat shadowcameranear;\n\t\t\tfloat shadowcamerafar;\n\t\t};\n\t\tuniform pointlightshadow pointlightshadows[ num_point_light_shadows ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef use_shadowmap\n\t#if num_dir_light_shadows > 0 || num_spot_light_shadows > 0 || num_point_light_shadows > 0\n\t\tvec3 shadowworldnormal = inversetransformdirection( transformednormal, viewmatrix );\n\t\tvec4 shadowworldposition;\n\t#endif\n\t#if num_dir_light_shadows > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_dir_light_shadows; i ++ ) {\n\t\tshadowworldposition = worldposition + vec4( shadowworldnormal * directionallightshadows[ i ].shadownormalbias, 0 );\n\t\tvdirectionalshadowcoord[ i ] = directionalshadowmatrix[ i ] * shadowworldposition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if num_spot_light_shadows > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_spot_light_shadows; i ++ ) {\n\t\tshadowworldposition = worldposition + vec4( shadowworldnormal * spotlightshadows[ i ].shadownormalbias, 0 );\n\t\tvspotshadowcoord[ i ] = spotshadowmatrix[ i ] * shadowworldposition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if num_point_light_shadows > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_point_light_shadows; i ++ ) {\n\t\tshadowworldposition = worldposition + vec4( shadowworldnormal * pointlightshadows[ i ].shadownormalbias, 0 );\n\t\tvpointshadowcoord[ i ] = pointshadowmatrix[ i ] * shadowworldposition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getshadowmask() {\n\tfloat shadow = 1.0;\n\t#ifdef use_shadowmap\n\t#if num_dir_light_shadows > 0\n\tdirectionallightshadow directionallight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_dir_light_shadows; i ++ ) {\n\t\tdirectionallight = directionallightshadows[ i ];\n\t\tshadow *= receiveshadow ? getshadow( directionalshadowmap[ i ], directionallight.shadowmapsize, directionallight.shadowbias, directionallight.shadowradius, vdirectionalshadowcoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if num_spot_light_shadows > 0\n\tspotlightshadow spotlight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_spot_light_shadows; i ++ ) {\n\t\tspotlight = spotlightshadows[ i ];\n\t\tshadow *= receiveshadow ? getshadow( spotshadowmap[ i ], spotlight.shadowmapsize, spotlight.shadowbias, spotlight.shadowradius, vspotshadowcoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if num_point_light_shadows > 0\n\tpointlightshadow pointlight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < num_point_light_shadows; i ++ ) {\n\t\tpointlight = pointlightshadows[ i ];\n\t\tshadow *= receiveshadow ? getpointshadow( pointshadowmap[ i ], pointlight.shadowmapsize, pointlight.shadowbias, pointlight.shadowradius, vpointshadowcoord[ i ], pointlight.shadowcameranear, pointlight.shadowcamerafar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef use_skinning\n\tmat4 bonematx = getbonematrix( skinindex.x );\n\tmat4 bonematy = getbonematrix( skinindex.y );\n\tmat4 bonematz = getbonematrix( skinindex.z );\n\tmat4 bonematw = getbonematrix( skinindex.w );\n#endif",skinning_pars_vertex:"#ifdef use_skinning\n\tuniform mat4 bindmatrix;\n\tuniform mat4 bindmatrixinverse;\n\t#ifdef bone_texture\n\t\tuniform highp sampler2d bonetexture;\n\t\tuniform int bonetexturesize;\n\t\tmat4 getbonematrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( bonetexturesize ) );\n\t\t\tfloat y = floor( j / float( bonetexturesize ) );\n\t\t\tfloat dx = 1.0 / float( bonetexturesize );\n\t\t\tfloat dy = 1.0 / float( bonetexturesize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2d( bonetexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2d( bonetexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2d( bonetexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2d( bonetexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 bonematrices[ max_bones ];\n\t\tmat4 getbonematrix( const in float i ) {\n\t\t\tmat4 bone = bonematrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef use_skinning\n\tvec4 skinvertex = bindmatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += bonematx * skinvertex * skinweight.x;\n\tskinned += bonematy * skinvertex * skinweight.y;\n\tskinned += bonematz * skinvertex * skinweight.z;\n\tskinned += bonematw * skinvertex * skinweight.w;\n\ttransformed = ( bindmatrixinverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef use_skinning\n\tmat4 skinmatrix = mat4( 0.0 );\n\tskinmatrix += skinweight.x * bonematx;\n\tskinmatrix += skinweight.y * bonematy;\n\tskinmatrix += skinweight.z * bonematz;\n\tskinmatrix += skinweight.w * bonematw;\n\tskinmatrix = bindmatrixinverse * skinmatrix * bindmatrix;\n\tobjectnormal = vec4( skinmatrix * vec4( objectnormal, 0.0 ) ).xyz;\n\t#ifdef use_tangent\n\t\tobjecttangent = vec4( skinmatrix * vec4( objecttangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularstrength;\n#ifdef use_specularmap\n\tvec4 texelspecular = texture2d( specularmap, vuv );\n\tspecularstrength = texelspecular.r;\n#else\n\tspecularstrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef use_specularmap\n\tuniform sampler2d specularmap;\n#endif",tonemapping_fragment:"#if defined( tone_mapping )\n\tgl_fragcolor.rgb = tonemapping( gl_fragcolor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float tonemappingexposure;\nvec3 lineartonemapping( vec3 color ) {\n\treturn tonemappingexposure * color;\n}\nvec3 reinhardtonemapping( vec3 color ) {\n\tcolor *= tonemappingexposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 optimizedcineontonemapping( vec3 color ) {\n\tcolor *= tonemappingexposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 rrtandodtfit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 acesfilmictonemapping( vec3 color ) {\n\tconst mat3 acesinputmat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 acesoutputmat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= tonemappingexposure / 0.6;\n\tcolor = acesinputmat * color;\n\tcolor = rrtandodtfit( color );\n\tcolor = acesoutputmat * color;\n\treturn saturate( color );\n}\nvec3 customtonemapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef use_transmissionmap\n\ttotaltransmission *= texture2d( transmissionmap, vuv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef use_transmissionmap\n\tuniform sampler2d transmissionmap;\n#endif",uv_pars_fragment:"#if ( defined( use_uv ) && ! defined( uvs_vertex_only ) )\n\tvarying vec2 vuv;\n#endif",uv_pars_vertex:"#ifdef use_uv\n\t#ifdef uvs_vertex_only\n\t\tvec2 vuv;\n\t#else\n\t\tvarying vec2 vuv;\n\t#endif\n\tuniform mat3 uvtransform;\n#endif",uv_vertex:"#ifdef use_uv\n\tvuv = ( uvtransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( use_lightmap ) || defined( use_aomap )\n\tvarying vec2 vuv2;\n#endif",uv2_pars_vertex:"#if defined( use_lightmap ) || defined( use_aomap )\n\tattribute vec2 uv2;\n\tvarying vec2 vuv2;\n\tuniform mat3 uv2transform;\n#endif",uv2_vertex:"#if defined( use_lightmap ) || defined( use_aomap )\n\tvuv2 = ( uv2transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( use_envmap ) || defined( distance ) || defined ( use_shadowmap )\n\tvec4 worldposition = vec4( transformed, 1.0 );\n\t#ifdef use_instancing\n\t\tworldposition = instancematrix * worldposition;\n\t#endif\n\tworldposition = modelmatrix * worldposition;\n#endif",background_frag:"uniform sampler2d t2d;\nvarying vec2 vuv;\nvoid main() {\n\tvec4 texcolor = texture2d( t2d, vuv );\n\tgl_fragcolor = maptexeltolinear( texcolor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vuv;\nuniform mat3 uvtransform;\nvoid main() {\n\tvuv = ( uvtransform * vec3( uv, 1 ) ).xy;\n\tgl_position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vworlddirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vreflect = vworlddirection;\n\t#include <envmap_fragment>\n\tgl_fragcolor = envcolor;\n\tgl_fragcolor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vworlddirection;\n#include <common>\nvoid main() {\n\tvworlddirection = transformdirection( position, modelmatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_position.z = gl_position.w;\n}",depth_frag:"#if depth_packing == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vhighprecisionzw;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( 1.0 );\n\t#if depth_packing == 3200\n\t\tdiffusecolor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragcoordz = 0.5 * vhighprecisionzw[0] / vhighprecisionzw[1] + 0.5;\n\t#if depth_packing == 3200\n\t\tgl_fragcolor = vec4( vec3( 1.0 - fragcoordz ), opacity );\n\t#elif depth_packing == 3201\n\t\tgl_fragcolor = packdepthtorgba( fragcoordz );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vhighprecisionzw;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef use_displacementmap\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvhighprecisionzw = gl_position.zw;\n}",distancergba_frag:"#define distance\nuniform vec3 referenceposition;\nuniform float neardistance;\nuniform float fardistance;\nvarying vec3 vworldposition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vworldposition - referenceposition );\n\tdist = ( dist - neardistance ) / ( fardistance - neardistance );\n\tdist = saturate( dist );\n\tgl_fragcolor = packdepthtorgba( dist );\n}",distancergba_vert:"#define distance\nvarying vec3 vworldposition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef use_displacementmap\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvworldposition = worldposition.xyz;\n}",equirect_frag:"uniform sampler2d tequirect;\nvarying vec3 vworlddirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vworlddirection );\n\tvec2 sampleuv = equirectuv( direction );\n\tvec4 texcolor = texture2d( tequirect, sampleuv );\n\tgl_fragcolor = maptexeltolinear( texcolor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vworlddirection;\n#include <common>\nvoid main() {\n\tvworlddirection = transformdirection( position, modelmatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashsize;\nuniform float totalsize;\nvarying float vlinedistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vlinedistance, totalsize ) > dashsize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoinglight = vec3( 0.0 );\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoinglight = diffusecolor.rgb;\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float linedistance;\nvarying float vlinedistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvlinedistance = scale * linedistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\treflectedlight reflectedlight = reflectedlight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef use_lightmap\n\t\n\t\tvec4 lightmaptexel= texture2d( lightmap, vuv2 );\n\t\treflectedlight.indirectdiffuse += lightmaptexeltolinear( lightmaptexel ).rgb * lightmapintensity;\n\t#else\n\t\treflectedlight.indirectdiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedlight.indirectdiffuse *= diffusecolor.rgb;\n\tvec3 outgoinglight = reflectedlight.indirectdiffuse;\n\t#include <envmap_fragment>\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef use_envmap\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vlightfront;\nvarying vec3 vindirectfront;\n#ifdef double_sided\n\tvarying vec3 vlightback;\n\tvarying vec3 vindirectback;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\treflectedlight reflectedlight = reflectedlight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalemissiveradiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef double_sided\n\t\treflectedlight.indirectdiffuse += ( gl_frontfacing ) ? vindirectfront : vindirectback;\n\t#else\n\t\treflectedlight.indirectdiffuse += vindirectfront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedlight.indirectdiffuse *= brdf_diffuse_lambert( diffusecolor.rgb );\n\t#ifdef double_sided\n\t\treflectedlight.directdiffuse = ( gl_frontfacing ) ? vlightfront : vlightback;\n\t#else\n\t\treflectedlight.directdiffuse = vlightfront;\n\t#endif\n\treflectedlight.directdiffuse *= brdf_diffuse_lambert( diffusecolor.rgb ) * getshadowmask();\n\t#include <aomap_fragment>\n\tvec3 outgoinglight = reflectedlight.directdiffuse + reflectedlight.indirectdiffuse + totalemissiveradiance;\n\t#include <envmap_fragment>\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define lambert\nvarying vec3 vlightfront;\nvarying vec3 vindirectfront;\n#ifdef double_sided\n\tvarying vec3 vlightback;\n\tvarying vec3 vindirectback;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define matcap\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2d matcap;\nvarying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewdir = normalize( vviewposition );\n\tvec3 x = normalize( vec3( viewdir.z, 0.0, - viewdir.x ) );\n\tvec3 y = cross( viewdir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef use_matcap\n\t\tvec4 matcapcolor = texture2d( matcap, uv );\n\t\tmatcapcolor = matcaptexeltolinear( matcapcolor );\n\t#else\n\t\tvec4 matcapcolor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoinglight = diffusecolor.rgb * matcapcolor.rgb;\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define matcap\nvarying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef flat_shaded\n\t\tvnormal = normalize( transformednormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvviewposition = - mvposition.xyz;\n}",meshtoon_frag:"#define toon\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\treflectedlight reflectedlight = reflectedlight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalemissiveradiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoinglight = reflectedlight.directdiffuse + reflectedlight.indirectdiffuse + totalemissiveradiance;\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define toon\nvarying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef flat_shaded\n\tvnormal = normalize( transformednormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvviewposition = - mvposition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define phong\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\treflectedlight reflectedlight = reflectedlight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalemissiveradiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoinglight = reflectedlight.directdiffuse + reflectedlight.indirectdiffuse + reflectedlight.directspecular + reflectedlight.indirectspecular + totalemissiveradiance;\n\t#include <envmap_fragment>\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define phong\nvarying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef flat_shaded\n\tvnormal = normalize( transformednormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvviewposition = - mvposition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define standard\n#ifdef physical\n\t#define reflectivity\n\t#define clearcoat\n\t#define transmission\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef transmission\n\tuniform float transmission;\n#endif\n#ifdef reflectivity\n\tuniform float reflectivity;\n#endif\n#ifdef clearcoat\n\tuniform float clearcoat;\n\tuniform float clearcoatroughness;\n#endif\n#ifdef use_sheen\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n\t#ifdef use_tangent\n\t\tvarying vec3 vtangent;\n\t\tvarying vec3 vbitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\treflectedlight reflectedlight = reflectedlight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalemissiveradiance = emissive;\n\t#ifdef transmission\n\t\tfloat totaltransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoinglight = reflectedlight.directdiffuse + reflectedlight.indirectdiffuse + reflectedlight.directspecular + reflectedlight.indirectspecular + totalemissiveradiance;\n\t#ifdef transmission\n\t\tdiffusecolor.a *= mix( saturate( 1. - totaltransmission + lineartorelativeluminance( reflectedlight.directspecular + reflectedlight.indirectspecular ) ), 1.0, metalness );\n\t#endif\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define standard\nvarying vec3 vviewposition;\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n\t#ifdef use_tangent\n\t\tvarying vec3 vtangent;\n\t\tvarying vec3 vbitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef flat_shaded\n\tvnormal = normalize( transformednormal );\n\t#ifdef use_tangent\n\t\tvtangent = normalize( transformedtangent );\n\t\tvbitangent = normalize( cross( vnormal, vtangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvviewposition = - mvposition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define normal\nuniform float opacity;\n#if defined( flat_shaded ) || defined( use_bumpmap ) || defined( tangentspace_normalmap )\n\tvarying vec3 vviewposition;\n#endif\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n\t#ifdef use_tangent\n\t\tvarying vec3 vtangent;\n\t\tvarying vec3 vbitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_fragcolor = vec4( packnormaltorgb( normal ), opacity );\n}",normal_vert:"#define normal\n#if defined( flat_shaded ) || defined( use_bumpmap ) || defined( tangentspace_normalmap )\n\tvarying vec3 vviewposition;\n#endif\n#ifndef flat_shaded\n\tvarying vec3 vnormal;\n\t#ifdef use_tangent\n\t\tvarying vec3 vtangent;\n\t\tvarying vec3 vbitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef flat_shaded\n\tvnormal = normalize( transformednormal );\n\t#ifdef use_tangent\n\t\tvtangent = normalize( transformedtangent );\n\t\tvbitangent = normalize( cross( vnormal, vtangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( flat_shaded ) || defined( use_bumpmap ) || defined( tangentspace_normalmap )\n\tvviewposition = - mvposition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoinglight = vec3( 0.0 );\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoinglight = diffusecolor.rgb;\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_pointsize = size;\n\t#ifdef use_sizeattenuation\n\t\tbool isperspective = isperspectivematrix( projectionmatrix );\n\t\tif ( isperspective ) gl_pointsize *= ( scale / - mvposition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_fragcolor = vec4( color, opacity * ( 1.0 - getshadowmask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoinglight = vec3( 0.0 );\n\tvec4 diffusecolor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoinglight = diffusecolor.rgb;\n\tgl_fragcolor = vec4( outgoinglight, diffusecolor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvposition = modelviewmatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelmatrix[ 0 ].x, modelmatrix[ 0 ].y, modelmatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelmatrix[ 1 ].x, modelmatrix[ 1 ].y, modelmatrix[ 1 ].z ) );\n\t#ifndef use_sizeattenuation\n\t\tbool isperspective = isperspectivematrix( projectionmatrix );\n\t\tif ( isperspective ) scale *= - mvposition.z;\n\t#endif\n\tvec2 alignedposition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedposition;\n\trotatedposition.x = cos( rotation ) * alignedposition.x - sin( rotation ) * alignedposition.y;\n\trotatedposition.y = sin( rotation ) * alignedposition.x + cos( rotation ) * alignedposition.y;\n\tmvposition.xy += rotatedposition;\n\tgl_position = projectionmatrix * mvposition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},or={common:{diffuse:{value:new we(15658734)},opacity:{value:1},map:{value:null},uvtransform:{value:new ft},uv2transform:{value:new ft},alphamap:{value:null}},specularmap:{specularmap:{value:null}},envmap:{envmap:{value:null},flipenvmap:{value:-1},reflectivity:{value:1},refractionratio:{value:.98},maxmiplevel:{value:0}},aomap:{aomap:{value:null},aomapintensity:{value:1}},lightmap:{lightmap:{value:null},lightmapintensity:{value:1}},emissivemap:{emissivemap:{value:null}},bumpmap:{bumpmap:{value:null},bumpscale:{value:1}},normalmap:{normalmap:{value:null},normalscale:{value:new pt(1,1)}},displacementmap:{displacementmap:{value:null},displacementscale:{value:1},displacementbias:{value:0}},roughnessmap:{roughnessmap:{value:null}},metalnessmap:{metalnessmap:{value:null}},gradientmap:{gradientmap:{value:null}},fog:{fogdensity:{value:25e-5},fognear:{value:1},fogfar:{value:2e3},fogcolor:{value:new we(16777215)}},lights:{ambientlightcolor:{value:[]},lightprobe:{value:[]},directionallights:{value:[],properties:{direction:{},color:{}}},directionallightshadows:{value:[],properties:{shadowbias:{},shadownormalbias:{},shadowradius:{},shadowmapsize:{}}},directionalshadowmap:{value:[]},directionalshadowmatrix:{value:[]},spotlights:{value:[],properties:{color:{},position:{},direction:{},distance:{},conecos:{},penumbracos:{},decay:{}}},spotlightshadows:{value:[],properties:{shadowbias:{},shadownormalbias:{},shadowradius:{},shadowmapsize:{}}},spotshadowmap:{value:[]},spotshadowmatrix:{value:[]},pointlights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointlightshadows:{value:[],properties:{shadowbias:{},shadownormalbias:{},shadowradius:{},shadowmapsize:{},shadowcameranear:{},shadowcamerafar:{}}},pointshadowmap:{value:[]},pointshadowmatrix:{value:[]},hemispherelights:{value:[],properties:{direction:{},skycolor:{},groundcolor:{}}},rectarealights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new we(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphamap:{value:null},uvtransform:{value:new ft}},sprite:{diffuse:{value:new we(15658734)},opacity:{value:1},center:{value:new pt(.5,.5)},rotation:{value:0},map:{value:null},alphamap:{value:null},uvtransform:{value:new ft}}},sr={basic:{uniforms:vn([or.common,or.specularmap,or.envmap,or.aomap,or.lightmap,or.fog]),vertexshader:ar.meshbasic_vert,fragmentshader:ar.meshbasic_frag},lambert:{uniforms:vn([or.common,or.specularmap,or.envmap,or.aomap,or.lightmap,or.emissivemap,or.fog,or.lights,{emissive:{value:new we(0)}}]),vertexshader:ar.meshlambert_vert,fragmentshader:ar.meshlambert_frag},phong:{uniforms:vn([or.common,or.specularmap,or.envmap,or.aomap,or.lightmap,or.emissivemap,or.bumpmap,or.normalmap,or.displacementmap,or.fog,or.lights,{emissive:{value:new we(0)},specular:{value:new we(1118481)},shininess:{value:30}}]),vertexshader:ar.meshphong_vert,fragmentshader:ar.meshphong_frag},standard:{uniforms:vn([or.common,or.envmap,or.aomap,or.lightmap,or.emissivemap,or.bumpmap,or.normalmap,or.displacementmap,or.roughnessmap,or.metalnessmap,or.fog,or.lights,{emissive:{value:new we(0)},roughness:{value:1},metalness:{value:0},envmapintensity:{value:1}}]),vertexshader:ar.meshphysical_vert,fragmentshader:ar.meshphysical_frag},toon:{uniforms:vn([or.common,or.aomap,or.lightmap,or.emissivemap,or.bumpmap,or.normalmap,or.displacementmap,or.gradientmap,or.fog,or.lights,{emissive:{value:new we(0)}}]),vertexshader:ar.meshtoon_vert,fragmentshader:ar.meshtoon_frag},matcap:{uniforms:vn([or.common,or.bumpmap,or.normalmap,or.displacementmap,or.fog,{matcap:{value:null}}]),vertexshader:ar.meshmatcap_vert,fragmentshader:ar.meshmatcap_frag},points:{uniforms:vn([or.points,or.fog]),vertexshader:ar.points_vert,fragmentshader:ar.points_frag},dashed:{uniforms:vn([or.common,or.fog,{scale:{value:1},dashsize:{value:1},totalsize:{value:2}}]),vertexshader:ar.linedashed_vert,fragmentshader:ar.linedashed_frag},depth:{uniforms:vn([or.common,or.displacementmap]),vertexshader:ar.depth_vert,fragmentshader:ar.depth_frag},normal:{uniforms:vn([or.common,or.bumpmap,or.normalmap,or.displacementmap,{opacity:{value:1}}]),vertexshader:ar.normal_vert,fragmentshader:ar.normal_frag},sprite:{uniforms:vn([or.sprite,or.fog]),vertexshader:ar.sprite_vert,fragmentshader:ar.sprite_frag},background:{uniforms:{uvtransform:{value:new ft},t2d:{value:null}},vertexshader:ar.background_vert,fragmentshader:ar.background_frag},cube:{uniforms:vn([or.envmap,{opacity:{value:1}}]),vertexshader:ar.cube_vert,fragmentshader:ar.cube_frag},equirect:{uniforms:{tequirect:{value:null}},vertexshader:ar.equirect_vert,fragmentshader:ar.equirect_frag},distancergba:{uniforms:vn([or.common,or.displacementmap,{referenceposition:{value:new mt},neardistance:{value:1},fardistance:{value:1e3}}]),vertexshader:ar.distancergba_vert,fragmentshader:ar.distancergba_frag},shadow:{uniforms:vn([or.lights,or.fog,{color:{value:new we(0)},opacity:{value:1}}]),vertexshader:ar.shadow_vert,fragmentshader:ar.shadow_frag}};function cr(t,e,n,r,i){var a,o,c=new we(0),l=0,u=null,h=0,d=null;function p(t,e){n.buffers.color.setclear(t.r,t.g,t.b,e,i)}return{getclearcolor:function(){return c},setclearcolor:function(t,e){void 0===e&&(e=1),c.set(t),p(c,l=e)},getclearalpha:function(){return l},setclearalpha:function(t){p(c,l=t)},render:function(n,i,f,m){var v=!0===i.isscene?i.background:null;v&&v.istexture&&(v=e.get(v));var g=t.xr,y=g.getsession&&g.getsession();y&&"additive"===y.environmentblendmode&&(v=null),null===v?p(c,l):v&&v.iscolor&&(p(v,1),m=!0),(t.autoclear||m)&&t.clear(t.autoclearcolor,t.autocleardepth,t.autoclearstencil),v&&(v.iscubetexture||v.iswebglcuberendertarget||v.mapping===s)?(void 0===o&&((o=new fn(new hn(1,1,1),new jn({name:"backgroundcubematerial",uniforms:kn(sr.cube.uniforms),vertexshader:sr.cube.vertexshader,fragmentshader:sr.cube.fragmentshader,side:1,depthtest:!1,depthwrite:!1,fog:!1}))).geometry.deleteattribute("normal"),o.geometry.deleteattribute("uv"),o.onbeforerender=function(t,e,n){this.matrixworld.copyposition(n.matrixworld)},object.defineproperty(o.material,"envmap",{get:function(){return this.uniforms.envmap.value}}),r.update(o)),v.iswebglcuberendertarget&&(v=v.texture),o.material.uniforms.envmap.value=v,o.material.uniforms.flipenvmap.value=v.iscubetexture&&v._needsflipenvmap?-1:1,u===v&&h===v.version&&d===t.tonemapping||(o.material.needsupdate=!0,u=v,h=v.version,d=t.tonemapping),n.unshift(o,o.geometry,o.material,0,0,null)):v&&v.istexture&&(void 0===a&&((a=new fn(new ir(2,2),new jn({name:"backgroundmaterial",uniforms:kn(sr.background.uniforms),vertexshader:sr.background.vertexshader,fragmentshader:sr.background.fragmentshader,side:0,depthtest:!1,depthwrite:!1,fog:!1}))).geometry.deleteattribute("normal"),object.defineproperty(a.material,"map",{get:function(){return this.uniforms.t2d.value}}),r.update(a)),a.material.uniforms.t2d.value=v,!0===v.matrixautoupdate&&v.updatematrix(),a.material.uniforms.uvtransform.value.copy(v.matrix),u===v&&h===v.version&&d===t.tonemapping||(a.material.needsupdate=!0,u=v,h=v.version,d=t.tonemapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function lr(t,e,n,r){var i=t.getparameter(34921),a=r.iswebgl2?null:e.get("oes_vertex_array_object"),o=r.iswebgl2||null!==a,s={},c=d(null),l=c;function u(e){return r.iswebgl2?t.bindvertexarray(e):a.bindvertexarrayoes(e)}function h(e){return r.iswebgl2?t.deletevertexarray(e):a.deletevertexarrayoes(e)}function d(t){for(var e=[],n=[],r=[],a=0;a<i;a++)e[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newattributes:e,enabledattributes:n,attributedivisors:r,object:t,attributes:{},index:null}}function p(){for(var t=l.newattributes,e=0,n=t.length;e<n;e++)t[e]=0}function f(t){m(t,0)}function m(n,i){var a=l.newattributes,o=l.enabledattributes,s=l.attributedivisors;(a[n]=1,0===o[n]&&(t.enablevertexattribarray(n),o[n]=1),s[n]!==i)&&((r.iswebgl2?t:e.get("angle_instanced_arrays"))[r.iswebgl2?"vertexattribdivisor":"vertexattribdivisorangle"](n,i),s[n]=i)}function v(){for(var e=l.newattributes,n=l.enabledattributes,r=0,i=n.length;r<i;r++)n[r]!==e[r]&&(t.disablevertexattribarray(r),n[r]=0)}function g(e,n,i,a,o,s){!0!==r.iswebgl2||5124!==i&&5125!==i?t.vertexattribpointer(e,n,i,a,o,s):t.vertexattribipointer(e,n,i,o,s)}function y(){x(),l!==c&&u((l=c).object)}function x(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:function(i,c,h,y,x){var _=!1;if(o){var b=function(e,n,i){var o=!0===i.wireframe,c=s[e.id];void 0===c&&(c={},s[e.id]=c);var l=c[n.id];void 0===l&&(l={},c[n.id]=l);var u=l[o];void 0===u&&(u=d(r.iswebgl2?t.createvertexarray():a.createvertexarrayoes()),l[o]=u);return u}(y,h,c);l!==b&&u((l=b).object),(_=function(t,e){var n=l.attributes,r=t.attributes,i=0;for(var a in r){var o=n[a],s=r[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;i++}return l.attributesnum!==i||l.index!==e}(y,x))&&function(t,e){var n={},r=t.attributes,i=0;for(var a in r){var o=r[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,i++}l.attributes=n,l.attributesnum=i,l.index=e}(y,x)}else{var w=!0===c.wireframe;l.geometry===y.id&&l.program===h.id&&l.wireframe===w||(l.geometry=y.id,l.program=h.id,l.wireframe=w,_=!0)}!0===i.isinstancedmesh&&(_=!0),null!==x&&n.update(x,34963),_&&(!function(i,a,o,s){if(!1===r.iswebgl2&&(i.isinstancedmesh||s.isinstancedbuffergeometry)&&null===e.get("angle_instanced_arrays"))return;p();var c=s.attributes,l=o.getattributes(),u=a.defaultattributevalues;for(var h in l){var d=l[h];if(d>=0){var y=c[h];if(void 0!==y){var x=y.normalized,_=y.itemsize,b=n.get(y);if(void 0===b)continue;var w=b.buffer,m=b.type,s=b.bytesperelement;if(y.isinterleavedbufferattribute){var t=y.data,e=t.stride,a=y.offset;t&&t.isinstancedinterleavedbuffer?(m(d,t.meshperattribute),void 0===s._maxinstancecount&&(s._maxinstancecount=t.meshperattribute*t.count)):f(d),t.bindbuffer(34962,w),g(d,_,m,x,e*s,a*s)}else y.isinstancedbufferattribute?(m(d,y.meshperattribute),void 0===s._maxinstancecount&&(s._maxinstancecount=y.meshperattribute*y.count)):f(d),t.bindbuffer(34962,w),g(d,_,m,x,0,0)}else if("instancematrix"===h){var l=n.get(i.instancematrix);if(void 0===l)continue;var r=l.buffer,c=l.type;m(d+0,1),m(d+1,1),m(d+2,1),m(d+3,1),t.bindbuffer(34962,r),t.vertexattribpointer(d+0,4,c,!1,64,0),t.vertexattribpointer(d+1,4,c,!1,64,16),t.vertexattribpointer(d+2,4,c,!1,64,32),t.vertexattribpointer(d+3,4,c,!1,64,48)}else if("instancecolor"===h){var p=n.get(i.instancecolor);if(void 0===p)continue;var i=p.buffer,n=p.type;m(d,1),t.bindbuffer(34962,i),t.vertexattribpointer(d,3,n,!1,12,0)}else if(void 0!==u){var d=u[h];if(void 0!==d)switch(d.length){case 2:t.vertexattrib2fv(d,d);break;case 3:t.vertexattrib3fv(d,d);break;case 4:t.vertexattrib4fv(d,d);break;default:t.vertexattrib1fv(d,d)}}}}v()}(i,c,h,y),null!==x&&t.bindbuffer(34963,n.get(x).buffer))},reset:y,resetdefaultstate:x,dispose:function(){for(var t in y(),s){var e=s[t];for(var n in e){var r=e[n];for(var i in r)h(r[i].object),delete r[i];delete e[n]}delete s[t]}},releasestatesofgeometry:function(t){if(void 0!==s[t.id]){var e=s[t.id];for(var n in e){var r=e[n];for(var i in r)h(r[i].object),delete r[i];delete e[n]}delete s[t.id]}},releasestatesofprogram:function(t){for(var e in s){var n=s[e];if(void 0!==n[t.id]){var r=n[t.id];for(var i in r)h(r[i].object),delete r[i];delete n[t.id]}}},initattributes:p,enableattribute:f,disableunusedattributes:v}}function ur(t,e,n,r){var i,a=r.iswebgl2;this.setmode=function(t){i=t},this.render=function(e,r){t.drawarrays(i,e,r),n.update(r,i,1)},this.renderinstances=function(r,o,s){if(0!==s){var c,l;if(a)c=t,l="drawarraysinstanced";else if(l="drawarraysinstancedangle",null===(c=e.get("angle_instanced_arrays")))return void console.error("three.webglbufferrenderer: using three.instancedbuffergeometry but hardware does not support extension angle_instanced_arrays.");c[l](i,r,o,s),n.update(o,i,s)}}}function hr(t,e,n){var r;function i(e){if("highp"===e){if(t.getshaderprecisionformat(35633,36338).precision>0&&t.getshaderprecisionformat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getshaderprecisionformat(35633,36337).precision>0&&t.getshaderprecisionformat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!=typeof webgl2renderingcontext&&t instanceof webgl2renderingcontext||"undefined"!=typeof webgl2computerenderingcontext&&t instanceof webgl2computerenderingcontext,o=void 0!==n.precision?n.precision:"highp",s=i(o);s!==o&&(console.warn("three.webglrenderer:",o,"not supported, using",s,"instead."),o=s);var c=!0===n.logarithmicdepthbuffer,l=t.getparameter(34930),u=t.getparameter(35660),h=t.getparameter(3379),d=t.getparameter(34076),p=t.getparameter(34921),f=t.getparameter(36347),m=t.getparameter(36348),v=t.getparameter(36349),g=u>0,y=a||!!e.get("oes_texture_float");return{iswebgl2:a,getmaxanisotropy:function(){if(void 0!==r)return r;var n=e.get("ext_texture_filter_anisotropic");return r=null!==n?t.getparameter(n.max_texture_max_anisotropy_ext):0},getmaxprecision:i,precision:o,logarithmicdepthbuffer:c,maxtextures:l,maxvertextextures:u,maxtexturesize:h,maxcubemapsize:d,maxattributes:p,maxvertexuniforms:f,maxvaryings:m,maxfragmentuniforms:v,vertextextures:g,floatfragmenttextures:y,floatvertextextures:g&&y,maxsamples:a?t.getparameter(36183):0}}function dr(t){var e=this,n=null,r=0,i=!1,a=!1,o=new ee,s=new ft,c={value:null,needsupdate:!1};function l(){c.value!==n&&(c.value=n,c.needsupdate=r>0),e.numplanes=r,e.numintersection=0}function u(t,n,r,i){var a=null!==t?t.length:0,l=null;if(0!==a){if(l=c.value,!0!==i||null===l){var u=r+4*a,h=n.matrixworldinverse;s.getnormalmatrix(h),(null===l||l.length<u)&&(l=new float32array(u));for(var d=0,p=r;d!==a;++d,p+=4)o.copy(t[d]).applymatrix4(h,s),o.normal.toarray(l,p),l[p+3]=o.constant}c.value=l,c.needsupdate=!0}return e.numplanes=a,e.numintersection=0,l}this.uniform=c,this.numplanes=0,this.numintersection=0,this.init=function(t,e,a){var o=0!==t.length||e||0!==r||i;return i=e,n=u(t,a,0),r=t.length,o},this.beginshadows=function(){a=!0,u(null)},this.endshadows=function(){a=!1,l()},this.setstate=function(e,o,s){var h=e.clippingplanes,d=e.clipintersection,p=e.clipshadows,f=t.get(e);if(!i||null===h||0===h.length||a&&!p)a?u(null):l();else{var m=a?0:r,v=4*m,g=f.clippingstate||null;c.value=g,g=u(h,o,v,s);for(var y=0;y!==v;++y)g[y]=n[y];f.clippingstate=g,this.numintersection=d?this.numplanes:0,this.numplanes+=m}}}function pr(t){var e=new weakmap;function n(t,e){return e===a?t.mapping=r:e===o&&(t.mapping=i),t}function s(t){var n=t.target;n.removeeventlistener("dispose",s);var r=e.get(n);void 0!==r&&(e.delete(n),r.dispose())}return{get:function(r){if(r&&r.istexture){var i=r.mapping;if(i===a||i===o){if(e.has(r))return n(e.get(r).texture,r.mapping);var c=r.image;if(c&&c.height>0){var l=t.getrenderlist(),u=t.getrendertarget(),h=new qn(c.height/2);return h.fromequirectangulartexture(t,r),e.set(r,h),t.setrendertarget(u),t.setrenderlist(l),r.addeventlistener("dispose",s),n(h.texture,r.mapping)}return null}}return r},dispose:function(){e=new weakmap}}}function fr(t){var e={};return{has:function(n){if(void 0!==e[n])return null!==e[n];var r;switch(n){case"webgl_depth_texture":r=t.getextension("webgl_depth_texture")||t.getextension("moz_webgl_depth_texture")||t.getextension("webkit_webgl_depth_texture");break;case"ext_texture_filter_anisotropic":r=t.getextension("ext_texture_filter_anisotropic")||t.getextension("moz_ext_texture_filter_anisotropic")||t.getextension("webkit_ext_texture_filter_anisotropic");break;case"webgl_compressed_texture_s3tc":r=t.getextension("webgl_compressed_texture_s3tc")||t.getextension("moz_webgl_compressed_texture_s3tc")||t.getextension("webkit_webgl_compressed_texture_s3tc");break;case"webgl_compressed_texture_pvrtc":r=t.getextension("webgl_compressed_texture_pvrtc")||t.getextension("webkit_webgl_compressed_texture_pvrtc");break;default:r=t.getextension(n)}return e[n]=r,null!==r},get:function(t){return this.has(t)||console.warn("three.webglrenderer: "+t+" extension not supported."),e[t]}}}function mr(t,e,n,r){var i=new weakmap,a=new weakmap;function o(t){var s=t.target,c=i.get(s);for(var l in null!==c.index&&e.remove(c.index),c.attributes)e.remove(c.attributes[l]);s.removeeventlistener("dispose",o),i.delete(s);var u=a.get(c);u&&(e.remove(u),a.delete(c)),r.releasestatesofgeometry(c),!0===s.isinstancedbuffergeometry&&delete s._maxinstancecount,n.memory.geometries--}function s(t){var n=[],r=t.index,i=t.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var c=0,l=s.length;c<l;c+=3){var u=s[c+0],h=s[c+1],d=s[c+2];n.push(u,h,h,d,d,u)}}else{var p=i.array;o=i.version;for(var f=0,m=p.length/3-1;f<m;f+=3){var v=f+0,g=f+1,y=f+2;n.push(v,g,g,y,y,v)}}var x=new(un(n)>65535?an:nn)(n,1);x.version=o;var _=a.get(t);_&&e.remove(_),a.set(t,x)}return{get:function(t,e){var r=i.get(e);return r||(e.addeventlistener("dispose",o),e.isbuffergeometry?r=e:e.isgeometry&&(void 0===e._buffergeometry&&(e._buffergeometry=(new _n).setfromobject(t)),r=e._buffergeometry),i.set(e,r),n.memory.geometries++,r)},update:function(t){var n=t.attributes;for(var r in n)e.update(n[r],34962);var i=t.morphattributes;for(var a in i)for(var o=i[a],s=0,c=o.length;s<c;s++)e.update(o[s],34962)},getwireframeattribute:function(t){var e=a.get(t);if(e){var n=t.index;null!==n&&e.version<n.version&&s(t)}else s(t);return a.get(t)}}}function vr(t,e,n,r){var i,a,o,s=r.iswebgl2;this.setmode=function(t){i=t},this.setindex=function(t){a=t.type,o=t.bytesperelement},this.render=function(e,r){t.drawelements(i,r,a,e*o),n.update(r,i,1)},this.renderinstances=function(r,c,l){if(0!==l){var u,h;if(s)u=t,h="drawelementsinstanced";else if(h="drawelementsinstancedangle",null===(u=e.get("angle_instanced_arrays")))return void console.error("three.webglindexedbufferrenderer: using three.instancedbuffergeometry but hardware does not support extension angle_instanced_arrays.");u[h](i,c,a,r*o,l),n.update(c,i,l)}}}function gr(t){var e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoreset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("three.webglinfo: unknown draw mode:",n)}}}}function yr(t,e){return t[0]-e[0]}function xr(t,e){return math.abs(e[1])-math.abs(t[1])}function _r(t){for(var e={},n=new float32array(8),r=[],i=0;i<8;i++)r[i]=[i,0];return{update:function(i,a,o,s){var c=i.morphtargetinfluences,l=void 0===c?0:c.length,u=e[a.id];if(void 0===u){u=[];for(var h=0;h<l;h++)u[h]=[h,0];e[a.id]=u}for(var d=0;d<l;d++){var p=u[d];p[0]=d,p[1]=c[d]}u.sort(xr);for(var f=0;f<8;f++)f<l&&u[f][1]?(r[f][0]=u[f][0],r[f][1]=u[f][1]):(r[f][0]=number.max_safe_integer,r[f][1]=0);r.sort(yr);for(var m=o.morphtargets&&a.morphattributes.position,v=o.morphnormals&&a.morphattributes.normal,g=0,y=0;y<8;y++){var x=r[y],_=x[0],b=x[1];_!==number.max_safe_integer&&b?(m&&a.getattribute("morphtarget"+y)!==m[_]&&a.setattribute("morphtarget"+y,m[_]),v&&a.getattribute("morphnormal"+y)!==v[_]&&a.setattribute("morphnormal"+y,v[_]),n[y]=b,g+=b):(m&&!0===a.hasattribute("morphtarget"+y)&&a.deleteattribute("morphtarget"+y),v&&!0===a.hasattribute("morphnormal"+y)&&a.deleteattribute("morphnormal"+y),n[y]=0)}var w=a.morphtargetsrelative?1:1-g;s.getuniforms().setvalue(t,"morphtargetbaseinfluence",w),s.getuniforms().setvalue(t,"morphtargetinfluences",n)}}}function br(t,e,n,r){var i=new weakmap;function a(t){var e=t.target;e.removeeventlistener("dispose",a),n.remove(e.instancematrix),null!==e.instancecolor&&n.remove(e.instancecolor)}return{update:function(t){var o=r.render.frame,s=t.geometry,c=e.get(t,s);return i.get(c)!==o&&(s.isgeometry&&c.updatefromobject(t),e.update(c),i.set(c,o)),t.isinstancedmesh&&(!1===t.haseventlistener("dispose",a)&&t.addeventlistener("dispose",a),n.update(t.instancematrix,34962),null!==t.instancecolor&&n.update(t.instancecolor,34962)),c},dispose:function(){i=new weakmap}}}function wr(t,e,n,r){void 0===t&&(t=null),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),gt.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magfilter=d,this.minfilter=d,this.wrapr=u,this.generatemipmaps=!1,this.flipy=!1,this.needsupdate=!0}function mr(t,e,n,r){void 0===t&&(t=null),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),gt.call(this,null),this.image={data:t,width:e,height:n,depth:r},this.magfilter=d,this.minfilter=d,this.wrapr=u,this.generatemipmaps=!1,this.flipy=!1,this.needsupdate=!0}sr.physical={uniforms:vn([sr.standard.uniforms,{clearcoat:{value:0},clearcoatmap:{value:null},clearcoatroughness:{value:0},clearcoatroughnessmap:{value:null},clearcoatnormalscale:{value:new pt(1,1)},clearcoatnormalmap:{value:null},sheen:{value:new we(0)},transmission:{value:0},transmissionmap:{value:null}}]),vertexshader:ar.meshphysical_vert,fragmentshader:ar.meshphysical_frag},wr.prototype=object.create(gt.prototype),wr.prototype.constructor=wr,wr.prototype.isdatatexture2darray=!0,mr.prototype=object.create(gt.prototype),mr.prototype.constructor=mr,mr.prototype.isdatatexture3d=!0;var sr=new gt,tr=new wr,er=new mr,ar=new jn,lr=[],rr=[],cr=new float32array(16),pr=new float32array(9),ir=new float32array(4);function nr(t,e,n){var r=t[0];if(r<=0||r>0)return t;var i=e*n,a=lr[i];if(void 0===a&&(a=new float32array(i),lr[i]=a),0!==e){r.toarray(a,0);for(var o=1,s=0;o!==e;++o)s+=n,t[o].toarray(a,s)}return a}function dr(t,e){if(t.length!==e.length)return!1;for(var n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function or(t,e){for(var n=0,r=e.length;n<r;n++)t[n]=e[n]}function br(t,e){var n=rr[e];void 0===n&&(n=new int32array(e),rr[e]=n);for(var r=0;r!==e;++r)n[r]=t.allocatetextureunit();return n}function zr(t,e){var n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function fr(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(dr(n,e))return;t.uniform2fv(this.addr,e),or(n,e)}}function gr(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(dr(n,e))return;t.uniform3fv(this.addr,e),or(n,e)}}function ur(t,e){var n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(dr(n,e))return;t.uniform4fv(this.addr,e),or(n,e)}}function hr(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(dr(n,e))return;t.uniformmatrix2fv(this.addr,!1,e),or(n,e)}else{if(dr(n,r))return;ir.set(r),t.uniformmatrix2fv(this.addr,!1,ir),or(n,r)}}function kr(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(dr(n,e))return;t.uniformmatrix3fv(this.addr,!1,e),or(n,e)}else{if(dr(n,r))return;pr.set(r),t.uniformmatrix3fv(this.addr,!1,pr),or(n,r)}}function vr(t,e){var n=this.cache,r=e.elements;if(void 0===r){if(dr(n,e))return;t.uniformmatrix4fv(this.addr,!1,e),or(n,e)}else{if(dr(n,r))return;cr.set(r),t.uniformmatrix4fv(this.addr,!1,cr),or(n,r)}}function wr(t,e,n){var r=this.cache,i=n.allocatetextureunit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safesettexture2d(e||sr,i)}function jr(t,e,n){var r=this.cache,i=n.allocatetextureunit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.settexture2darray(e||tr,i)}function qr(t,e,n){var r=this.cache,i=n.allocatetextureunit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.settexture3d(e||er,i)}function xr(t,e,n){var r=this.cache,i=n.allocatetextureunit();r[0]!==i&&(t.uniform1i(this.addr,i),r[0]=i),n.safesettexturecube(e||ar,i)}function yr(t,e){var n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function zr(t,e){var n=this.cache;dr(n,e)||(t.uniform2iv(this.addr,e),or(n,e))}function jr(t,e){var n=this.cache;dr(n,e)||(t.uniform3iv(this.addr,e),or(n,e))}function qr(t,e){var n=this.cache;dr(n,e)||(t.uniform4iv(this.addr,e),or(n,e))}function kr(t,e){var n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function $r(t,e){t.uniform1fv(this.addr,e)}function ti(t,e){t.uniform1iv(this.addr,e)}function ei(t,e){t.uniform2iv(this.addr,e)}function ni(t,e){t.uniform3iv(this.addr,e)}function ri(t,e){t.uniform4iv(this.addr,e)}function ii(t,e){var n=nr(e,this.size,2);t.uniform2fv(this.addr,n)}function ai(t,e){var n=nr(e,this.size,3);t.uniform3fv(this.addr,n)}function oi(t,e){var n=nr(e,this.size,4);t.uniform4fv(this.addr,n)}function si(t,e){var n=nr(e,this.size,4);t.uniformmatrix2fv(this.addr,!1,n)}function ci(t,e){var n=nr(e,this.size,9);t.uniformmatrix3fv(this.addr,!1,n)}function li(t,e){var n=nr(e,this.size,16);t.uniformmatrix4fv(this.addr,!1,n)}function ui(t,e,n){var r=e.length,i=br(n,r);t.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safesettexture2d(e[a]||sr,i[a])}function hi(t,e,n){var r=e.length,i=br(n,r);t.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safesettexturecube(e[a]||ar,i[a])}function di(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setvalue=function(t){switch(t){case 5126:return zr;case 35664:return fr;case 35665:return gr;case 35666:return ur;case 35674:return hr;case 35675:return kr;case 35676:return vr;case 5124:case 35670:return yr;case 35667:case 35671:return zr;case 35668:case 35672:return jr;case 35669:case 35673:return qr;case 5125:return kr;case 35678:case 36198:case 36298:case 36306:case 35682:return wr;case 35679:case 36299:case 36307:return qr;case 35680:case 36300:case 36308:case 36293:return xr;case 36289:case 36303:case 36311:case 36292:return jr}}(e.type)}function pi(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setvalue=function(t){switch(t){case 5126:return $r;case 35664:return ii;case 35665:return ai;case 35666:return oi;case 35674:return si;case 35675:return ci;case 35676:return li;case 5124:case 35670:return ti;case 35667:case 35671:return ei;case 35668:case 35672:return ni;case 35669:case 35673:return ri;case 35678:case 36198:case 36298:case 36306:case 35682:return ui;case 35680:case 36300:case 36308:case 36293:return hi}}(e.type)}function fi(t){this.id=t,this.seq=[],this.map={}}pi.prototype.updatecache=function(t){var e=this.cache;t instanceof float32array&&e.length!==t.length&&(this.cache=new float32array(t.length)),or(e,t)},fi.prototype.setvalue=function(t,e,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setvalue(t,e[o.id],n)}};var mi=/(\w+)(\])?(\[|\.)?/g;function vi(t,e){t.seq.push(e),t.map[e.id]=e}function gi(t,e,n){var r=t.name,i=r.length;for(mi.lastindex=0;;){var a=mi.exec(r),o=mi.lastindex,s=a[1],c="]"===a[2],l=a[3];if(c&&(s|=0),void 0===l||"["===l&&o+2===i){vi(n,void 0===l?new di(s,t,e):new pi(s,t,e));break}var u=n.map[s];void 0===u&&vi(n,u=new fi(s)),n=u}}function yi(t,e){this.seq=[],this.map={};for(var n=t.getprogramparameter(e,35718),r=0;r<n;++r){var i=t.getactiveuniform(e,r);gi(i,t.getuniformlocation(e,i.name),this)}}function xi(t,e,n){var r=t.createshader(e);return t.shadersource(r,n),t.compileshader(r),r}yi.prototype.setvalue=function(t,e,n,r){var i=this.map[e];void 0!==i&&i.setvalue(t,n,r)},yi.prototype.setoptional=function(t,e,n){var r=e[n];void 0!==r&&this.setvalue(t,n,r)},yi.upload=function(t,e,n,r){for(var i=0,a=e.length;i!==a;++i){var o=e[i],s=n[o.id];!1!==s.needsupdate&&o.setvalue(t,s.value,r)}},yi.seqwithvalue=function(t,e){for(var n=[],r=0,i=t.length;r!==i;++r){var a=t[r];a.id in e&&n.push(a)}return n};var _i=0;function bi(t){switch(t){case q:return["linear","( value )"];case x:return["srgb","( value )"];case z:return["rgbe","( value )"];case j:return["rgbm","( value, 7.0 )"];case q:return["rgbm","( value, 16.0 )"];case k:return["rgbd","( value, 256.0 )"];case y:return["gamma","( value, float( gamma_factor ) )"];case 3003:return["logluv","( value )"];default:return console.warn("three.webglprogram: unsupported encoding:",t),["linear","( value )"]}}function wi(t,e,n){var r=t.getshaderparameter(e,35713),i=t.getshaderinfolog(e).trim();return r&&""===i?"":"three.webglshader: gl.getshaderinfolog() "+n+"\n"+i+function(t){for(var e=t.split("\n"),n=0;n<e.length;n++)e[n]=n+1+": "+e[n];return e.join("\n")}(t.getshadersource(e))}function mi(t,e){var n=bi(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"tolinear"+n[1]+"; }"}function si(t,e){var n;switch(e){case 1:n="linear";break;case 2:n="reinhard";break;case 3:n="optimizedcineon";break;case 4:n="acesfilmic";break;case 5:n="custom";break;default:console.warn("three.webglprogram: unsupported tonemapping:",e),n="linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"tonemapping( color ); }"}function ti(t){return""!==t}function ei(t,e){return t.replace(/num_dir_lights/g,e.numdirlights).replace(/num_spot_lights/g,e.numspotlights).replace(/num_rect_area_lights/g,e.numrectarealights).replace(/num_point_lights/g,e.numpointlights).replace(/num_hemi_lights/g,e.numhemilights).replace(/num_dir_light_shadows/g,e.numdirlightshadows).replace(/num_spot_light_shadows/g,e.numspotlightshadows).replace(/num_point_light_shadows/g,e.numpointlightshadows)}function ai(t,e){return t.replace(/num_clipping_planes/g,e.numclippingplanes).replace(/union_clipping_planes/g,e.numclippingplanes-e.numclipintersection)}var li=/^[ \t]*#include +<([\w\d./]+)>/gm;function ri(t){return t.replace(li,ci)}function ci(t,e){var n=ar[e];if(void 0===n)throw new error("can not resolve #include <"+e+">");return ri(n)}var pi=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\s]+?)(?=\})\}/g,ii=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\s]+?)}\s+#pragma unroll_loop_end/g;function ni(t){return t.replace(ii,oi).replace(pi,di)}function di(t,e,n,r){return console.warn("webglprogram: #pragma unroll_loop shader syntax is deprecated. please use #pragma unroll_loop_start syntax instead."),oi(t,e,n,r)}function oi(t,e,n,r){for(var i="",a=parseint(e);a<parseint(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/unrolled_loop_index/g,a);return i}function bi(t){var e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define high_precision":"mediump"===t.precision?e+="\n#define medium_precision":"lowp"===t.precision&&(e+="\n#define low_precision"),e}function zi(t,e,n,a){var o,l,u,h,d,p=t.getcontext(),f=n.defines,m=n.vertexshader,v=n.fragmentshader,g=function(t){var e="shadowmap_type_basic";return 1===t.shadowmaptype?e="shadowmap_type_pcf":2===t.shadowmaptype?e="shadowmap_type_pcf_soft":3===t.shadowmaptype&&(e="shadowmap_type_vsm"),e}(n),y=function(t){var e="envmap_type_cube";if(t.envmap)switch(t.envmapmode){case r:case i:e="envmap_type_cube";break;case s:case c:e="envmap_type_cube_uv"}return e}(n),x=function(t){var e="envmap_mode_reflection";if(t.envmap)switch(t.envmapmode){case i:case c:e="envmap_mode_refraction"}return e}(n),_=function(t){var e="envmap_blending_none";if(t.envmap)switch(t.combine){case 0:e="envmap_blending_multiply";break;case 1:e="envmap_blending_mix";break;case 2:e="envmap_blending_add"}return e}(n),b=t.gammafactor>0?t.gammafactor:1,w=n.iswebgl2?"":function(t){return[t.extensionderivatives||t.envmapcubeuv||t.bumpmap||t.tangentspacenormalmap||t.clearcoatnormalmap||t.flatshading||"physical"===t.shaderid?"#extension gl_oes_standard_derivatives : enable":"",(t.extensionfragdepth||t.logarithmicdepthbuffer)&&t.rendererextensionfragdepth?"#extension gl_ext_frag_depth : enable":"",t.extensiondrawbuffers&&t.rendererextensiondrawbuffers?"#extension gl_ext_draw_buffers : require":"",(t.extensionshadertexturelod||t.envmap)&&t.rendererextensionshadertexturelod?"#extension gl_ext_shader_texture_lod : enable":""].filter(ti).join("\n")}(n),m=function(t){var e=[];for(var n in t){var r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(f),s=p.createprogram(),t=n.glslversion?"#version "+n.glslversion+"\n":"";n.israwshadermaterial?((o=[m].filter(ti).join("\n")).length>0&&(o+="\n"),(l=[w,m].filter(ti).join("\n")).length>0&&(l+="\n")):(o=[bi(n),"#define shader_name "+n.shadername,m,n.instancing?"#define use_instancing":"",n.instancingcolor?"#define use_instancing_color":"",n.supportsvertextextures?"#define vertex_textures":"","#define gamma_factor "+b,"#define max_bones "+n.maxbones,n.usefog&&n.fog?"#define use_fog":"",n.usefog&&n.fogexp2?"#define fog_exp2":"",n.map?"#define use_map":"",n.envmap?"#define use_envmap":"",n.envmap?"#define "+x:"",n.lightmap?"#define use_lightmap":"",n.aomap?"#define use_aomap":"",n.emissivemap?"#define use_emissivemap":"",n.bumpmap?"#define use_bumpmap":"",n.normalmap?"#define use_normalmap":"",n.normalmap&&n.objectspacenormalmap?"#define objectspace_normalmap":"",n.normalmap&&n.tangentspacenormalmap?"#define tangentspace_normalmap":"",n.clearcoatmap?"#define use_clearcoatmap":"",n.clearcoatroughnessmap?"#define use_clearcoat_roughnessmap":"",n.clearcoatnormalmap?"#define use_clearcoat_normalmap":"",n.displacementmap&&n.supportsvertextextures?"#define use_displacementmap":"",n.specularmap?"#define use_specularmap":"",n.roughnessmap?"#define use_roughnessmap":"",n.metalnessmap?"#define use_metalnessmap":"",n.alphamap?"#define use_alphamap":"",n.transmissionmap?"#define use_transmissionmap":"",n.vertextangents?"#define use_tangent":"",n.vertexcolors?"#define use_color":"",n.vertexuvs?"#define use_uv":"",n.uvsvertexonly?"#define uvs_vertex_only":"",n.flatshading?"#define flat_shaded":"",n.skinning?"#define use_skinning":"",n.usevertextexture?"#define bone_texture":"",n.morphtargets?"#define use_morphtargets":"",n.morphnormals&&!1===n.flatshading?"#define use_morphnormals":"",n.doublesided?"#define double_sided":"",n.flipsided?"#define flip_sided":"",n.shadowmapenabled?"#define use_shadowmap":"",n.shadowmapenabled?"#define "+g:"",n.sizeattenuation?"#define use_sizeattenuation":"",n.logarithmicdepthbuffer?"#define use_logdepthbuf":"",n.logarithmicdepthbuffer&&n.rendererextensionfragdepth?"#define use_logdepthbuf_ext":"","uniform mat4 modelmatrix;","uniform mat4 modelviewmatrix;","uniform mat4 projectionmatrix;","uniform mat4 viewmatrix;","uniform mat3 normalmatrix;","uniform vec3 cameraposition;","uniform bool isorthographic;","#ifdef use_instancing","\tattribute mat4 instancematrix;","#endif","#ifdef use_instancing_color","\tattribute vec3 instancecolor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef use_tangent","\tattribute vec4 tangent;","#endif","#ifdef use_color","\tattribute vec3 color;","#endif","#ifdef use_morphtargets","\tattribute vec3 morphtarget0;","\tattribute vec3 morphtarget1;","\tattribute vec3 morphtarget2;","\tattribute vec3 morphtarget3;","\t#ifdef use_morphnormals","\t\tattribute vec3 morphnormal0;","\t\tattribute vec3 morphnormal1;","\t\tattribute vec3 morphnormal2;","\t\tattribute vec3 morphnormal3;","\t#else","\t\tattribute vec3 morphtarget4;","\t\tattribute vec3 morphtarget5;","\t\tattribute vec3 morphtarget6;","\t\tattribute vec3 morphtarget7;","\t#endif","#endif","#ifdef use_skinning","\tattribute vec4 skinindex;","\tattribute vec4 skinweight;","#endif","\n"].filter(ti).join("\n"),l=[w,bi(n),"#define shader_name "+n.shadername,m,n.alphatest?"#define alphatest "+n.alphatest+(n.alphatest%1?"":".0"):"","#define gamma_factor "+b,n.usefog&&n.fog?"#define use_fog":"",n.usefog&&n.fogexp2?"#define fog_exp2":"",n.map?"#define use_map":"",n.matcap?"#define use_matcap":"",n.envmap?"#define use_envmap":"",n.envmap?"#define "+y:"",n.envmap?"#define "+x:"",n.envmap?"#define "+_:"",n.lightmap?"#define use_lightmap":"",n.aomap?"#define use_aomap":"",n.emissivemap?"#define use_emissivemap":"",n.bumpmap?"#define use_bumpmap":"",n.normalmap?"#define use_normalmap":"",n.normalmap&&n.objectspacenormalmap?"#define objectspace_normalmap":"",n.normalmap&&n.tangentspacenormalmap?"#define tangentspace_normalmap":"",n.clearcoatmap?"#define use_clearcoatmap":"",n.clearcoatroughnessmap?"#define use_clearcoat_roughnessmap":"",n.clearcoatnormalmap?"#define use_clearcoat_normalmap":"",n.specularmap?"#define use_specularmap":"",n.roughnessmap?"#define use_roughnessmap":"",n.metalnessmap?"#define use_metalnessmap":"",n.alphamap?"#define use_alphamap":"",n.sheen?"#define use_sheen":"",n.transmissionmap?"#define use_transmissionmap":"",n.vertextangents?"#define use_tangent":"",n.vertexcolors||n.instancingcolor?"#define use_color":"",n.vertexuvs?"#define use_uv":"",n.uvsvertexonly?"#define uvs_vertex_only":"",n.gradientmap?"#define use_gradientmap":"",n.flatshading?"#define flat_shaded":"",n.doublesided?"#define double_sided":"",n.flipsided?"#define flip_sided":"",n.shadowmapenabled?"#define use_shadowmap":"",n.shadowmapenabled?"#define "+g:"",n.premultipliedalpha?"#define premultiplied_alpha":"",n.physicallycorrectlights?"#define physically_correct_lights":"",n.logarithmicdepthbuffer?"#define use_logdepthbuf":"",n.logarithmicdepthbuffer&&n.rendererextensionfragdepth?"#define use_logdepthbuf_ext":"",(n.extensionshadertexturelod||n.envmap)&&n.rendererextensionshadertexturelod?"#define texture_lod_ext":"","uniform mat4 viewmatrix;","uniform vec3 cameraposition;","uniform bool isorthographic;",0!==n.tonemapping?"#define tone_mapping":"",0!==n.tonemapping?ar.tonemapping_pars_fragment:"",0!==n.tonemapping?si("tonemapping",n.tonemapping):"",n.dithering?"#define dithering":"",ar.encodings_pars_fragment,n.map?mi("maptexeltolinear",n.mapencoding):"",n.matcap?mi("matcaptexeltolinear",n.matcapencoding):"",n.envmap?mi("envmaptexeltolinear",n.envmapencoding):"",n.emissivemap?mi("emissivemaptexeltolinear",n.emissivemapencoding):"",n.lightmap?mi("lightmaptexeltolinear",n.lightmapencoding):"",(u="lineartooutputtexel",h=n.outputencoding,d=bi(h),"vec4 "+u+"( vec4 value ) { return linearto"+d[0]+d[1]+"; }"),n.depthpacking?"#define depth_packing "+n.depthpacking:"","\n"].filter(ti).join("\n")),m=ai(m=ei(m=ri(m),n),n),v=ai(v=ei(v=ri(v),n),n),m=ni(m),v=ni(v),n.iswebgl2&&!0!==n.israwshadermaterial&&(t="#version 300 es\n",o=["#define attribute in","#define varying out","#define texture2d texture"].join("\n")+"\n"+o,l=["#define varying in",n.glslversion===nt?"":"out highp vec4 pc_fragcolor;",n.glslversion===nt?"":"#define gl_fragcolor pc_fragcolor","#define gl_fragdepthext gl_fragdepth","#define texture2d texture","#define texturecube texture","#define texture2dproj textureproj","#define texture2dlodext texturelod","#define texture2dprojlodext textureprojlod","#define texturecubelodext texturelod","#define texture2dgradext texturegrad","#define texture2dprojgradext textureprojgrad","#define texturecubegradext texturegrad"].join("\n")+"\n"+l);var e,a,l=t+l+v,r=xi(p,35633,t+o+m),c=xi(p,35632,l);if(p.attachshader(s,r),p.attachshader(s,c),void 0!==n.index0attributename?p.bindattriblocation(s,0,n.index0attributename):!0===n.morphtargets&&p.bindattriblocation(s,0,"position"),p.linkprogram(s),t.debug.checkshadererrors){var p=p.getprograminfolog(s).trim(),i=p.getshaderinfolog(r).trim(),n=p.getshaderinfolog(c).trim(),d=!0,o=!0;if(!1===p.getprogramparameter(s,35714)){d=!1;var b=wi(p,r,"vertex"),z=wi(p,c,"fragment");console.error("three.webglprogram: shader error: ",p.geterror(),"35715",p.getprogramparameter(s,35715),"gl.getprograminfolog",p,b,z)}else""!==p?console.warn("three.webglprogram: gl.getprograminfolog()",p):""!==i&&""!==n||(o=!1);o&&(this.diagnostics={runnable:d,programlog:p,vertexshader:{log:i,prefix:o},fragmentshader:{log:n,prefix:l}})}return p.deleteshader(r),p.deleteshader(c),this.getuniforms=function(){return void 0===e&&(e=new yi(p,s)),e},this.getattributes=function(){return void 0===a&&(a=function(t,e){for(var n={},r=t.getprogramparameter(e,35721),i=0;i<r;i++){var a=t.getactiveattrib(e,i).name;n[a]=t.getattriblocation(e,a)}return n}(p,s)),a},this.destroy=function(){a.releasestatesofprogram(this),p.deleteprogram(s),this.program=void 0},this.name=n.shadername,this.id=_i++,this.cachekey=e,this.usedtimes=1,this.program=s,this.vertexshader=r,this.fragmentshader=c,this}function fi(t,e,n,r,i,a){var o=[],l=r.iswebgl2,u=r.logarithmicdepthbuffer,h=r.floatvertextextures,d=r.maxvertexuniforms,p=r.vertextextures,f=r.precision,m={meshdepthmaterial:"depth",meshdistancematerial:"distancergba",meshnormalmaterial:"normal",meshbasicmaterial:"basic",meshlambertmaterial:"lambert",meshphongmaterial:"phong",meshtoonmaterial:"toon",meshstandardmaterial:"physical",meshphysicalmaterial:"physical",meshmatcapmaterial:"matcap",linebasicmaterial:"basic",linedashedmaterial:"dashed",pointsmaterial:"points",shadowmaterial:"shadow",spritematerial:"sprite"},v=["precision","iswebgl2","supportsvertextextures","outputencoding","instancing","instancingcolor","map","mapencoding","matcap","matcapencoding","envmap","envmapmode","envmapencoding","envmapcubeuv","lightmap","lightmapencoding","aomap","emissivemap","emissivemapencoding","bumpmap","normalmap","objectspacenormalmap","tangentspacenormalmap","clearcoatmap","clearcoatroughnessmap","clearcoatnormalmap","displacementmap","specularmap","roughnessmap","metalnessmap","gradientmap","alphamap","combine","vertexcolors","vertextangents","vertexuvs","uvsvertexonly","fog","usefog","fogexp2","flatshading","sizeattenuation","logarithmicdepthbuffer","skinning","maxbones","usevertextexture","morphtargets","morphnormals","maxmorphtargets","maxmorphnormals","premultipliedalpha","numdirlights","numpointlights","numspotlights","numhemilights","numrectarealights","numdirlightshadows","numpointlightshadows","numspotlightshadows","shadowmapenabled","shadowmaptype","tonemapping","physicallycorrectlights","alphatest","doublesided","flipsided","numclippingplanes","numclipintersection","depthpacking","dithering","sheen","transmissionmap"];function g(t){var e;return t&&t.istexture?e=t.encoding:t&&t.iswebglrendertarget?(console.warn("three.webglprograms.gettextureencodingfrommap: don't use render targets as textures. use their .texture property instead."),e=t.texture.encoding):e=q,e}return{getparameters:function(i,o,v,y,x){var _,b,w=y.fog,m=i.ismeshstandardmaterial?y.environment:null,s=e.get(i.envmap||m),t=m[i.type],e=x.isskinnedmesh?function(t){var e=t.skeleton.bones;if(h)return 1024;var n=d,r=math.floor((n-20)/4),i=math.min(r,e.length);return i<e.length?(console.warn("three.webglrenderer: skeleton has "+e.length+" bones. this gpu supports "+i+"."),0):i}(x):0;if(null!==i.precision&&(f=r.getmaxprecision(i.precision))!==i.precision&&console.warn("three.webglprogram.getparameters:",i.precision,"not supported, using",f,"instead."),t){var a=sr[t];_=a.vertexshader,b=a.fragmentshader}else _=i.vertexshader,b=i.fragmentshader;var l=t.getrendertarget();return{iswebgl2:l,shaderid:t,shadername:i.type,vertexshader:_,fragmentshader:b,defines:i.defines,israwshadermaterial:!0===i.israwshadermaterial,glslversion:i.glslversion,precision:f,instancing:!0===x.isinstancedmesh,instancingcolor:!0===x.isinstancedmesh&&null!==x.instancecolor,supportsvertextextures:p,outputencoding:null!==l?g(l.texture):t.outputencoding,map:!!i.map,mapencoding:g(i.map),matcap:!!i.matcap,matcapencoding:g(i.matcap),envmap:!!s,envmapmode:s&&s.mapping,envmapencoding:g(s),envmapcubeuv:!!s&&(s.mapping===s||s.mapping===c),lightmap:!!i.lightmap,lightmapencoding:g(i.lightmap),aomap:!!i.aomap,emissivemap:!!i.emissivemap,emissivemapencoding:g(i.emissivemap),bumpmap:!!i.bumpmap,normalmap:!!i.normalmap,objectspacenormalmap:1===i.normalmaptype,tangentspacenormalmap:0===i.normalmaptype,clearcoatmap:!!i.clearcoatmap,clearcoatroughnessmap:!!i.clearcoatroughnessmap,clearcoatnormalmap:!!i.clearcoatnormalmap,displacementmap:!!i.displacementmap,roughnessmap:!!i.roughnessmap,metalnessmap:!!i.metalnessmap,specularmap:!!i.specularmap,alphamap:!!i.alphamap,gradientmap:!!i.gradientmap,sheen:!!i.sheen,transmissionmap:!!i.transmissionmap,combine:i.combine,vertextangents:i.normalmap&&i.vertextangents,vertexcolors:i.vertexcolors,vertexuvs:!!(i.map||i.bumpmap||i.normalmap||i.specularmap||i.alphamap||i.emissivemap||i.roughnessmap||i.metalnessmap||i.clearcoatmap||i.clearcoatroughnessmap||i.clearcoatnormalmap||i.displacementmap||i.transmissionmap),uvsvertexonly:!(i.map||i.bumpmap||i.normalmap||i.specularmap||i.alphamap||i.emissivemap||i.roughnessmap||i.metalnessmap||i.clearcoatnormalmap||i.transmissionmap||!i.displacementmap),fog:!!w,usefog:i.fog,fogexp2:w&&w.isfogexp2,flatshading:i.flatshading,sizeattenuation:i.sizeattenuation,logarithmicdepthbuffer:u,skinning:i.skinning&&e>0,maxbones:e,usevertextexture:h,morphtargets:i.morphtargets,morphnormals:i.morphnormals,maxmorphtargets:t.maxmorphtargets,maxmorphnormals:t.maxmorphnormals,numdirlights:o.directional.length,numpointlights:o.point.length,numspotlights:o.spot.length,numrectarealights:o.rectarea.length,numhemilights:o.hemi.length,numdirlightshadows:o.directionalshadowmap.length,numpointlightshadows:o.pointshadowmap.length,numspotlightshadows:o.spotshadowmap.length,numclippingplanes:a.numplanes,numclipintersection:a.numintersection,dithering:i.dithering,shadowmapenabled:t.shadowmap.enabled&&v.length>0,shadowmaptype:t.shadowmap.type,tonemapping:i.tonemapped?t.tonemapping:0,physicallycorrectlights:t.physicallycorrectlights,premultipliedalpha:i.premultipliedalpha,alphatest:i.alphatest,doublesided:2===i.side,flipsided:1===i.side,depthpacking:void 0!==i.depthpacking&&i.depthpacking,index0attributename:i.index0attributename,extensionderivatives:i.extensions&&i.extensions.derivatives,extensionfragdepth:i.extensions&&i.extensions.fragdepth,extensiondrawbuffers:i.extensions&&i.extensions.drawbuffers,extensionshadertexturelod:i.extensions&&i.extensions.shadertexturelod,rendererextensionfragdepth:l||n.has("ext_frag_depth"),rendererextensiondrawbuffers:l||n.has("webgl_draw_buffers"),rendererextensionshadertexturelod:l||n.has("ext_shader_texture_lod"),customprogramcachekey:i.customprogramcachekey()}},getprogramcachekey:function(e){var n=[];if(e.shaderid?n.push(e.shaderid):(n.push(e.fragmentshader),n.push(e.vertexshader)),void 0!==e.defines)for(var r in e.defines)n.push(r),n.push(e.defines[r]);if(!1===e.israwshadermaterial){for(var i=0;i<v.length;i++)n.push(e[v[i]]);n.push(t.outputencoding),n.push(t.gammafactor)}return n.push(e.customprogramcachekey),n.join()},getuniforms:function(t){var e,n=m[t.type];if(n){var r=sr[n];e=wn.clone(r.uniforms)}else e=t.uniforms;return e},acquireprogram:function(e,n){for(var r,a=0,s=o.length;a<s;a++){var c=o[a];if(c.cachekey===n){++(r=c).usedtimes;break}}return void 0===r&&(r=new zi(t,n,e,i),o.push(r)),r},releaseprogram:function(t){if(0==--t.usedtimes){var e=o.indexof(t);o[e]=o[o.length-1],o.pop(),t.destroy()}},programs:o}}function gi(){var t=new weakmap;return{get:function(e){var n=t.get(e);return void 0===n&&(n={},t.set(e,n)),n},remove:function(e){t.delete(e)},update:function(e,n,r){t.get(e)[n]=r},dispose:function(){t=new weakmap}}}function ui(t,e){return t.grouporder!==e.grouporder?t.grouporder-e.grouporder:t.renderorder!==e.renderorder?t.renderorder-e.renderorder:t.program!==e.program?t.program.id-e.program.id:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function hi(t,e){return t.grouporder!==e.grouporder?t.grouporder-e.grouporder:t.renderorder!==e.renderorder?t.renderorder-e.renderorder:t.z!==e.z?e.z-t.z:t.id-e.id}function ki(t){var e=[],n=0,r=[],i=[],a={id:-1};function o(r,i,o,s,c,l){var u=e[n],h=t.get(o);return void 0===u?(u={id:r.id,object:r,geometry:i,material:o,program:h.program||a,grouporder:s,renderorder:r.renderorder,z:c,group:l},e[n]=u):(u.id=r.id,u.object=r,u.geometry=i,u.material=o,u.program=h.program||a,u.grouporder=s,u.renderorder=r.renderorder,u.z=c,u.group=l),n++,u}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(t,e,n,a,s,c){var l=o(t,e,n,a,s,c);(!0===n.transparent?i:r).push(l)},unshift:function(t,e,n,a,s,c){var l=o(t,e,n,a,s,c);(!0===n.transparent?i:r).unshift(l)},finish:function(){for(var t=n,r=e.length;t<r;t++){var i=e[t];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(t,e){r.length>1&&r.sort(t||ui),i.length>1&&i.sort(e||hi)}}}function vi(t){var e=new weakmap;return{get:function(n,r){var i,a=e.get(n);return void 0===a?(i=new ki(t),e.set(n,new weakmap),e.get(n).set(r,i)):void 0===(i=a.get(r))&&(i=new ki(t),a.set(r,i)),i},dispose:function(){e=new weakmap}}}function wi(){var t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];var n;switch(e.type){case"directionallight":n={direction:new mt,color:new we};break;case"spotlight":n={position:new mt,direction:new mt,color:new we,distance:0,conecos:0,penumbracos:0,decay:0};break;case"pointlight":n={position:new mt,color:new we,distance:0,decay:0};break;case"hemispherelight":n={direction:new mt,skycolor:new we,groundcolor:new we};break;case"rectarealight":n={color:new we,position:new mt,halfwidth:new mt,halfheight:new mt}}return t[e.id]=n,n}}}var ji=0;function qi(t,e){return(e.castshadow?1:0)-(t.castshadow?1:0)}function xi(t,e){for(var n,r=new wi,i=(n={},{get:function(t){if(void 0!==n[t.id])return n[t.id];var e;switch(t.type){case"directionallight":case"spotlight":e={shadowbias:0,shadownormalbias:0,shadowradius:1,shadowmapsize:new pt};break;case"pointlight":e={shadowbias:0,shadownormalbias:0,shadowradius:1,shadowmapsize:new pt,shadowcameranear:1,shadowcamerafar:1e3}}return n[t.id]=e,e}}),a={version:0,hash:{directionallength:-1,pointlength:-1,spotlength:-1,rectarealength:-1,hemilength:-1,numdirectionalshadows:-1,numpointshadows:-1,numspotshadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalshadow:[],directionalshadowmap:[],directionalshadowmatrix:[],spot:[],spotshadow:[],spotshadowmap:[],spotshadowmatrix:[],rectarea:[],rectarealtc1:null,rectarealtc2:null,point:[],pointshadow:[],pointshadowmap:[],pointshadowmatrix:[],hemi:[]},o=0;o<9;o++)a.probe.push(new mt);var s=new mt,c=new qt,l=new qt;return{setup:function(n){for(var o=0,s=0,c=0,l=0;l<9;l++)a.probe[l].set(0,0,0);var u=0,h=0,d=0,p=0,f=0,m=0,v=0,g=0;n.sort(qi);for(var y=0,x=n.length;y<x;y++){var _=n[y],b=_.color,w=_.intensity,m=_.distance,s=_.shadow&&_.shadow.map?_.shadow.map.texture:null;if(_.isambientlight)o+=b.r*w,s+=b.g*w,c+=b.b*w;else if(_.islightprobe)for(var t=0;t<9;t++)a.probe[t].addscaledvector(_.sh.coefficients[t],w);else if(_.isdirectionallight){var e=r.get(_);if(e.color.copy(_.color).multiplyscalar(_.intensity),_.castshadow){var a=_.shadow,l=i.get(_);l.shadowbias=a.bias,l.shadownormalbias=a.normalbias,l.shadowradius=a.radius,l.shadowmapsize=a.mapsize,a.directionalshadow[u]=l,a.directionalshadowmap[u]=s,a.directionalshadowmatrix[u]=_.shadow.matrix,m++}a.directional[u]=e,u++}else if(_.isspotlight){var r=r.get(_);if(r.position.setfrommatrixposition(_.matrixworld),r.color.copy(b).multiplyscalar(w),r.distance=m,r.conecos=math.cos(_.angle),r.penumbracos=math.cos(_.angle*(1-_.penumbra)),r.decay=_.decay,_.castshadow){var c=_.shadow,p=i.get(_);p.shadowbias=c.bias,p.shadownormalbias=c.normalbias,p.shadowradius=c.radius,p.shadowmapsize=c.mapsize,a.spotshadow[d]=p,a.spotshadowmap[d]=s,a.spotshadowmatrix[d]=_.shadow.matrix,g++}a.spot[d]=r,d++}else if(_.isrectarealight){var i=r.get(_);i.color.copy(b).multiplyscalar(w),i.halfwidth.set(.5*_.width,0,0),i.halfheight.set(0,.5*_.height,0),a.rectarea[p]=i,p++}else if(_.ispointlight){var n=r.get(_);if(n.color.copy(_.color).multiplyscalar(_.intensity),n.distance=_.distance,n.decay=_.decay,_.castshadow){var d=_.shadow,o=i.get(_);o.shadowbias=d.bias,o.shadownormalbias=d.normalbias,o.shadowradius=d.radius,o.shadowmapsize=d.mapsize,o.shadowcameranear=d.camera.near,o.shadowcamerafar=d.camera.far,a.pointshadow[h]=o,a.pointshadowmap[h]=s,a.pointshadowmatrix[h]=_.shadow.matrix,v++}a.point[h]=n,h++}else if(_.ishemispherelight){var b=r.get(_);b.skycolor.copy(_.color).multiplyscalar(w),b.groundcolor.copy(_.groundcolor).multiplyscalar(w),a.hemi[f]=b,f++}}p>0&&(e.iswebgl2||!0===t.has("oes_texture_float_linear")?(a.rectarealtc1=or.ltc_float_1,a.rectarealtc2=or.ltc_float_2):!0===t.has("oes_texture_half_float_linear")?(a.rectarealtc1=or.ltc_half_1,a.rectarealtc2=or.ltc_half_2):console.error("three.webglrenderer: unable to use rectarealight. missing webgl extensions.")),a.ambient[0]=o,a.ambient[1]=s,a.ambient[2]=c;var z=a.hash;z.directionallength===u&&z.pointlength===h&&z.spotlength===d&&z.rectarealength===p&&z.hemilength===f&&z.numdirectionalshadows===m&&z.numpointshadows===v&&z.numspotshadows===g||(a.directional.length=u,a.spot.length=d,a.rectarea.length=p,a.point.length=h,a.hemi.length=f,a.directionalshadow.length=m,a.directionalshadowmap.length=m,a.pointshadow.length=v,a.pointshadowmap.length=v,a.spotshadow.length=g,a.spotshadowmap.length=g,a.directionalshadowmatrix.length=m,a.pointshadowmatrix.length=v,a.spotshadowmatrix.length=g,z.directionallength=u,z.pointlength=h,z.spotlength=d,z.rectarealength=p,z.hemilength=f,z.numdirectionalshadows=m,z.numpointshadows=v,z.numspotshadows=g,a.version=ji++)},setupview:function(t,e){for(var n=0,r=0,i=0,o=0,u=0,h=e.matrixworldinverse,d=0,p=t.length;d<p;d++){var f=t[d];if(f.isdirectionallight){var m=a.directional[n];m.direction.setfrommatrixposition(f.matrixworld),s.setfrommatrixposition(f.target.matrixworld),m.direction.sub(s),m.direction.transformdirection(h),n++}else if(f.isspotlight){var v=a.spot[i];v.position.setfrommatrixposition(f.matrixworld),v.position.applymatrix4(h),v.direction.setfrommatrixposition(f.matrixworld),s.setfrommatrixposition(f.target.matrixworld),v.direction.sub(s),v.direction.transformdirection(h),i++}else if(f.isrectarealight){var g=a.rectarea[o];g.position.setfrommatrixposition(f.matrixworld),g.position.applymatrix4(h),l.identity(),c.copy(f.matrixworld),c.premultiply(h),l.extractrotation(c),g.halfwidth.set(.5*f.width,0,0),g.halfheight.set(0,.5*f.height,0),g.halfwidth.applymatrix4(l),g.halfheight.applymatrix4(l),o++}else if(f.ispointlight){var y=a.point[r];y.position.setfrommatrixposition(f.matrixworld),y.position.applymatrix4(h),r++}else if(f.ishemispherelight){var x=a.hemi[u];x.direction.setfrommatrixposition(f.matrixworld),x.direction.transformdirection(h),x.direction.normalize(),u++}}},state:a}}function yi(t,e){var n=new xi(t,e),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsarray:r,shadowsarray:i,lights:n},setuplights:function(){n.setup(r)},setuplightsview:function(t){n.setupview(r,t)},pushlight:function(t){r.push(t)},pushshadow:function(t){i.push(t)}}}function zi(t,e){var n=new weakmap;return{get:function(r,i){var a;return void 0===i&&(i=0),!1===n.has(r)?(a=new yi(t,e),n.set(r,[]),n.get(r).push(a)):i>=n.get(r).length?(a=new yi(t,e),n.get(r).push(a)):a=n.get(r)[i],a},dispose:function(){n=new weakmap}}}function ji(t){xe.call(this),this.type="meshdepthmaterial",this.depthpacking=3200,this.skinning=!1,this.morphtargets=!1,this.map=null,this.alphamap=null,this.displacementmap=null,this.displacementscale=1,this.displacementbias=0,this.wireframe=!1,this.wireframelinewidth=1,this.fog=!1,this.setvalues(t)}function qi(t){xe.call(this),this.type="meshdistancematerial",this.referenceposition=new mt,this.neardistance=1,this.fardistance=1e3,this.skinning=!1,this.morphtargets=!1,this.map=null,this.alphamap=null,this.displacementmap=null,this.displacementscale=1,this.displacementbias=0,this.fog=!1,this.setvalues(t)}ji.prototype=object.create(xe.prototype),ji.prototype.constructor=ji,ji.prototype.ismeshdepthmaterial=!0,ji.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.depthpacking=t.depthpacking,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.map=t.map,this.alphamap=t.alphamap,this.displacementmap=t.displacementmap,this.displacementscale=t.displacementscale,this.displacementbias=t.displacementbias,this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this},qi.prototype=object.create(xe.prototype),qi.prototype.constructor=qi,qi.prototype.ismeshdistancematerial=!0,qi.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.referenceposition.copy(t.referenceposition),this.neardistance=t.neardistance,this.fardistance=t.fardistance,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.map=t.map,this.alphamap=t.alphamap,this.displacementmap=t.displacementmap,this.displacementscale=t.displacementscale,this.displacementbias=t.displacementbias,this};function ki(t,e,n){var r=new er,i=new pt,a=new pt,o=new xt,s=[],c=[],l={},u={0:1,1:0,2:2},h=new jn({defines:{sample_rate:2/8,half_sample_rate:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new pt},radius:{value:4}},vertexshader:"void main() {\n\tgl_position = vec4( position, 1.0 );\n}",fragmentshader:"uniform sampler2d shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackrgbatodepth( texture2d( shadow_pass, ( gl_fragcoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += sample_rate) {\n\t\t#ifdef horizontal_pass\n\t\t\tvec2 distribution = unpackrgbato2half( texture2d( shadow_pass, ( gl_fragcoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackrgbatodepth( texture2d( shadow_pass, ( gl_fragcoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * half_sample_rate;\n\tsquared_mean = squared_mean * half_sample_rate;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_fragcolor = pack2halftorgba( vec2( mean, std_dev ) );\n}"}),p=h.clone();p.defines.horizontal_pass=1;var f=new _n;f.setattribute("position",new qe(new float32array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new fn(f,h),g=this;function y(n,r){var i=e.update(v);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapsize,h.uniforms.radius.value=n.radius,t.setrendertarget(n.mappass),t.clear(),t.renderbufferdirect(r,null,i,h,v,null),p.uniforms.shadow_pass.value=n.mappass.texture,p.uniforms.resolution.value=n.mapsize,p.uniforms.radius.value=n.radius,t.setrendertarget(n.map),t.clear(),t.renderbufferdirect(r,null,i,p,v,null)}function x(t,e,n){var r=t<<0|e<<1|n<<2,i=s[r];return void 0===i&&(i=new ji({depthpacking:3201,morphtargets:t,skinning:e}),s[r]=i),i}function _(t,e,n){var r=t<<0|e<<1|n<<2,i=c[r];return void 0===i&&(i=new qi({morphtargets:t,skinning:e}),c[r]=i),i}function b(e,n,r,i,a,o,s){var c=null,h=x,d=e.customdepthmaterial;if(!0===i.ispointlight&&(h=_,d=e.customdistancematerial),void 0===d){var p=!1;!0===r.morphtargets&&(p=n.morphattributes&&n.morphattributes.position&&n.morphattributes.position.length>0);var f=!1;!0===e.isskinnedmesh&&(!0===r.skinning?f=!0:console.warn("three.webglshadowmap: three.skinnedmesh with material.skinning set to false:",e)),c=h(p,f,!0===e.isinstancedmesh)}else c=d;if(t.localclippingenabled&&!0===r.clipshadows&&0!==r.clippingplanes.length){var m=c.uuid,v=r.uuid,g=l[m];void 0===g&&(g={},l[m]=g);var y=g[v];void 0===y&&(y=c.clone(),g[v]=y),c=y}return c.visible=r.visible,c.wireframe=r.wireframe,c.side=3===s?null!==r.shadowside?r.shadowside:r.side:null!==r.shadowside?r.shadowside:u[r.side],c.clipshadows=r.clipshadows,c.clippingplanes=r.clippingplanes,c.clipintersection=r.clipintersection,c.wireframelinewidth=r.wireframelinewidth,c.linewidth=r.linewidth,!0===i.ispointlight&&!0===c.ismeshdistancematerial&&(c.referenceposition.setfrommatrixposition(i.matrixworld),c.neardistance=a,c.fardistance=o),c}function w(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.ismesh||n.isline||n.ispoints)&&(n.castshadow||n.receiveshadow&&3===s)&&(!n.frustumculled||r.intersectsobject(n))){n.modelviewmatrix.multiplymatrices(a.matrixworldinverse,n.matrixworld);var c=e.update(n),l=n.material;if(array.isarray(l))for(var u=c.groups,h=0,d=u.length;h<d;h++){var p=u[h],f=l[p.materialindex];if(f&&f.visible){var m=b(n,c,f,o,a.near,a.far,s);t.renderbufferdirect(a,null,c,m,n,p)}}else if(l.visible){var v=b(n,c,l,o,a.near,a.far,s);t.renderbufferdirect(a,null,c,v,n,null)}}for(var g=n.children,y=0,x=g.length;y<x;y++)w(g[y],i,a,o,s)}}this.enabled=!1,this.autoupdate=!0,this.needsupdate=!1,this.type=1,this.render=function(e,s,c){if(!1!==g.enabled&&(!1!==g.autoupdate||!1!==g.needsupdate)&&0!==e.length){var l=t.getrendertarget(),u=t.getactivecubeface(),h=t.getactivemipmaplevel(),p=t.state;p.setblending(0),p.buffers.color.setclear(1,1,1,1),p.buffers.depth.settest(!0),p.setscissortest(!1);for(var f=0,v=e.length;f<v;f++){var x=e[f],_=x.shadow;if(void 0!==_){if(!1!==_.autoupdate||!1!==_.needsupdate){i.copy(_.mapsize);var b=_.getframeextents();if(i.multiply(b),a.copy(_.mapsize),(i.x>n||i.y>n)&&(i.x>n&&(a.x=math.floor(n/b.x),i.x=a.x*b.x,_.mapsize.x=a.x),i.y>n&&(a.y=math.floor(n/b.y),i.y=a.y*b.y,_.mapsize.y=a.y)),null===_.map&&!_.ispointlightshadow&&3===this.type){var m={minfilter:m,magfilter:m,format:t};_.map=new _t(i.x,i.y,m),_.map.texture.name=x.name+".shadowmap",_.mappass=new _t(i.x,i.y,m),_.camera.updateprojectionmatrix()}if(null===_.map){var s={minfilter:d,magfilter:d,format:t};_.map=new _t(i.x,i.y,s),_.map.texture.name=x.name+".shadowmap",_.camera.updateprojectionmatrix()}t.setrendertarget(_.map),t.clear();for(var e=_.getviewportcount(),a=0;a<e;a++){var l=_.getviewport(a);o.set(a.x*l.x,a.y*l.y,a.x*l.z,a.y*l.w),p.viewport(o),_.updatematrices(x,a),r=_.getfrustum(),w(s,c,_.camera,x,this.type)}_.ispointlightshadow||3!==this.type||y(_,c),_.needsupdate=!1}}else console.warn("three.webglshadowmap:",x,"has no shadow.")}g.needsupdate=!1,t.setrendertarget(l,u,h)}}}function $i(t,n,r){var i,a,o=r.iswebgl2;var s=new function(){var e=!1,n=new xt,r=null,i=new xt(0,0,0,0);return{setmask:function(n){r===n||e||(t.colormask(n,n,n,n),r=n)},setlocked:function(t){e=t},setclear:function(e,r,a,o,s){!0===s&&(e*=o,r*=o,a*=o),n.set(e,r,a,o),!1===i.equals(n)&&(t.clearcolor(e,r,a,o),i.copy(n))},reset:function(){e=!1,r=null,i.set(-1,0,0,0)}}},c=new function(){var e=!1,n=null,r=null,i=null;return{settest:function(t){t?b(2929):z(2929)},setmask:function(r){n===r||e||(t.depthmask(r),n=r)},setfunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthfunc(512);break;case 1:t.depthfunc(519);break;case 2:t.depthfunc(513);break;case 3:t.depthfunc(515);break;case 4:t.depthfunc(514);break;case 5:t.depthfunc(518);break;case 6:t.depthfunc(516);break;case 7:t.depthfunc(517);break;default:t.depthfunc(515)}else t.depthfunc(515);r=e}},setlocked:function(t){e=t},setclear:function(e){i!==e&&(t.cleardepth(e),i=e)},reset:function(){e=!1,n=null,r=null,i=null}}},l=new function(){var e=!1,n=null,r=null,i=null,a=null,o=null,s=null,c=null,l=null;return{settest:function(t){e||(t?b(2960):z(2960))},setmask:function(r){n===r||e||(t.stencilmask(r),n=r)},setfunc:function(e,n,o){r===e&&i===n&&a===o||(t.stencilfunc(e,n,o),r=e,i=n,a=o)},setop:function(e,n,r){o===e&&s===n&&c===r||(t.stencilop(e,n,r),o=e,s=n,c=r)},setlocked:function(t){e=t},setclear:function(e){l!==e&&(t.clearstencil(e),l=e)},reset:function(){e=!1,n=null,r=null,i=null,a=null,o=null,s=null,c=null,l=null}}},u={},h=null,d=null,p=null,f=null,m=null,v=null,g=null,y=null,x=null,_=!1,b=null,w=null,m=null,s=null,t=null,e=t.getparameter(35661),a=!1,l=0,r=t.getparameter(7938);-1!==r.indexof("webgl")?(l=parsefloat(/^webgl (\d)/.exec(r)[1]),a=l>=1):-1!==r.indexof("opengl es")&&(l=parsefloat(/^opengl es (\d)/.exec(r)[1]),a=l>=2);var c=null,p={},i=new xt,n=new xt;function d(e,n,r){var i=new uint8array(4),a=t.createtexture();t.bindtexture(e,a),t.texparameteri(e,10241,9728),t.texparameteri(e,10240,9728);for(var o=0;o<r;o++)t.teximage2d(n+o,0,6408,1,1,0,6408,5121,i);return a}var o={};function b(e){!0!==u[e]&&(t.enable(e),u[e]=!0)}function z(e){!1!==u[e]&&(t.disable(e),u[e]=!1)}o[3553]=d(3553,3553,1),o[34067]=d(34067,34069,6),s.setclear(0,0,0,1),c.setclear(1),l.setclear(0),b(2929),c.setfunc(3),k(!1),v(1),b(2884),h(0);var f=((i={})[100]=32774,i[101]=32778,i[102]=32779,i);if(o)f[103]=32775,f[104]=32776;else{var g=n.get("ext_blend_minmax");null!==g&&(f[103]=g.min_ext,f[104]=g.max_ext)}var u=((a={})[200]=0,a[201]=1,a[202]=768,a[204]=770,a[210]=776,a[208]=774,a[206]=772,a[203]=769,a[205]=771,a[209]=775,a[207]=773,a);function h(n,r,i,a,o,s,c,l){if(0!==n){if(d||(b(3042),d=!0),5===n)o=o||r,s=s||i,c=c||a,r===f&&o===g||(t.blendequationseparate(f[r],f[o]),f=r,g=o),i===m&&a===v&&s===y&&c===x||(t.blendfuncseparate(u[i],u[a],u[s],u[c]),m=i,v=a,y=s,x=c),p=n,_=null;else if(n!==p||l!==_){if(f===e&&g===e||(t.blendequation(32774),f=e,g=e),l)switch(n){case 1:t.blendfuncseparate(1,771,1,771);break;case 2:t.blendfunc(1,1);break;case 3:t.blendfuncseparate(0,0,769,771);break;case 4:t.blendfuncseparate(0,768,0,770);break;default:console.error("three.webglstate: invalid blending: ",n)}else switch(n){case 1:t.blendfuncseparate(770,771,1,771);break;case 2:t.blendfunc(770,1);break;case 3:t.blendfunc(0,769);break;case 4:t.blendfunc(0,768);break;default:console.error("three.webglstate: invalid blending: ",n)}m=null,v=null,y=null,x=null,p=n,_=l}}else d&&(z(3042),d=!1)}function k(e){b!==e&&(e?t.frontface(2304):t.frontface(2305),b=e)}function v(e){0!==e?(b(2884),e!==w&&(1===e?t.cullface(1029):2===e?t.cullface(1028):t.cullface(1032))):z(2884),w=e}function w(e,n,r){e?(b(32823),s===n&&t===r||(t.polygonoffset(n,r),s=n,t=r)):z(32823)}function j(e){void 0===e&&(e=33984+e-1),c!==e&&(t.activetexture(e),c=e)}return{buffers:{color:s,depth:c,stencil:l},enable:b,disable:z,useprogram:function(e){return h!==e&&(t.useprogram(e),h=e,!0)},setblending:h,setmaterial:function(t,e){2===t.side?z(2884):b(2884);var n=1===t.side;e&&(n=!n),k(n),1===t.blending&&!1===t.transparent?h(0):h(t.blending,t.blendequation,t.blendsrc,t.blenddst,t.blendequationalpha,t.blendsrcalpha,t.blenddstalpha,t.premultipliedalpha),c.setfunc(t.depthfunc),c.settest(t.depthtest),c.setmask(t.depthwrite),s.setmask(t.colorwrite);var r=t.stencilwrite;l.settest(r),r&&(l.setmask(t.stencilwritemask),l.setfunc(t.stencilfunc,t.stencilref,t.stencilfuncmask),l.setop(t.stencilfail,t.stencilzfail,t.stencilzpass)),w(t.polygonoffset,t.polygonoffsetfactor,t.polygonoffsetunits)},setflipsided:k,setcullface:v,setlinewidth:function(e){e!==m&&(a&&t.linewidth(e),m=e)},setpolygonoffset:w,setscissortest:function(t){t?b(3089):z(3089)},activetexture:j,bindtexture:function(e,n){null===c&&j();var r=p[c];void 0===r&&(r={type:void 0,texture:void 0},p[c]=r),r.type===e&&r.texture===n||(t.bindtexture(e,n||o[e]),r.type=e,r.texture=n)},unbindtexture:function(){var e=p[c];void 0!==e&&void 0!==e.type&&(t.bindtexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedteximage2d:function(){try{t.compressedteximage2d.apply(t,arguments)}catch(t){console.error("three.webglstate:",t)}},teximage2d:function(){try{t.teximage2d.apply(t,arguments)}catch(t){console.error("three.webglstate:",t)}},teximage3d:function(){try{t.teximage3d.apply(t,arguments)}catch(t){console.error("three.webglstate:",t)}},scissor:function(e){!1===i.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),i.copy(e))},viewport:function(e){!1===n.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),n.copy(e))},reset:function(){u={},c=null,p={},h=null,d=null,p=null,f=null,m=null,v=null,g=null,y=null,x=null,_=!1,b=null,w=null,m=null,s=null,t=null,s.reset(),c.reset(),l.reset()}}}function ta(t,e,n,r,i,a,o){var s,c,l,h=i.iswebgl2,v=i.maxtextures,g=i.maxcubemapsize,y=i.maxtexturesize,l=i.maxsamples,r=new weakmap,c=!1;try{c="undefined"!=typeof offscreencanvas&&null!==new offscreencanvas(1,1).getcontext("2d")}catch(t){}function p(t,e){return c?new offscreencanvas(t,e):document.createelementns("http://www.w3.org/1999/xhtml","canvas")}function i(t,e,n,r){var i=1;if((t.width>r||t.height>r)&&(i=r/math.max(t.width,t.height)),i<1||!0===e){if("undefined"!=typeof htmlimageelement&&t instanceof htmlimageelement||"undefined"!=typeof htmlcanvaselement&&t instanceof htmlcanvaselement||"undefined"!=typeof imagebitmap&&t instanceof imagebitmap){var a=e?st.floorpoweroftwo:math.floor,o=a(i*t.width),s=a(i*t.height);void 0===l&&(l=p(o,s));var c=n?p(o,s):l;return c.width=o,c.height=s,c.getcontext("2d").drawimage(t,0,0,o,s),console.warn("three.webglrenderer: texture has been resized from ("+t.width+"x"+t.height+") to ("+o+"x"+s+")."),c}return"data"in t&&console.warn("three.webglrenderer: image in datatexture is too big ("+t.width+"x"+t.height+")."),t}return t}function n(t){return st.ispoweroftwo(t.width)&&st.ispoweroftwo(t.height)}function d(t,e){return t.generatemipmaps&&e&&t.minfilter!==d&&t.minfilter!==m}function o(e,n,i,a){t.generatemipmap(e),r.get(n).__maxmiplevel=math.log(math.max(i,a))*math.log2e}function b(n,r,i){if(!1===h)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("three.webglrenderer: attempt to use non-existing webgl internal format '"+n+"'")}var a=r;return 6403===r&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===r&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===r&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||e.get("ext_color_buffer_float"),a}function z(t){return t===d||t===p||t===f?9728:9729}function f(e){var n=e.target;n.removeeventlistener("dispose",f),function(e){var n=r.get(e);if(void 0===n.__webglinit)return;t.deletetexture(n.__webgltexture),r.remove(e)}(n),n.isvideotexture&&r.delete(n),o.memory.textures--}function g(e){var n=e.target;n.removeeventlistener("dispose",g),function(e){var n=r.get(e),i=r.get(e.texture);if(!e)return;void 0!==i.__webgltexture&&t.deletetexture(i.__webgltexture);e.depthtexture&&e.depthtexture.dispose();if(e.iswebglcuberendertarget)for(var a=0;a<6;a++)t.deleteframebuffer(n.__webglframebuffer[a]),n.__webgldepthbuffer&&t.deleterenderbuffer(n.__webgldepthbuffer[a]);else t.deleteframebuffer(n.__webglframebuffer),n.__webgldepthbuffer&&t.deleterenderbuffer(n.__webgldepthbuffer),n.__webglmultisampledframebuffer&&t.deleteframebuffer(n.__webglmultisampledframebuffer),n.__webglcolorrenderbuffer&&t.deleterenderbuffer(n.__webglcolorrenderbuffer),n.__webgldepthrenderbuffer&&t.deleterenderbuffer(n.__webgldepthrenderbuffer);r.remove(e.texture),r.remove(e)}(n),o.memory.textures--}var u=0;function h(t,e){var i=r.get(t);if(t.isvideotexture&&function(t){var e=o.render.frame;r.get(t)!==e&&(r.set(t,e),t.update())}(t),t.version>0&&i.__version!==t.version){var a=t.image;if(void 0===a)console.warn("three.webglrenderer: texture marked for update but image is undefined");else{if(!1!==a.complete)return void x(i,t,e);console.warn("three.webglrenderer: texture marked for update but image is incomplete")}}n.activetexture(33984+e),n.bindtexture(3553,i.__webgltexture)}function k(e,i){var o=r.get(e);e.version>0&&o.__version!==e.version?function(e,r,i){if(6!==r.image.length)return;q(e,r),n.activetexture(33984+i),n.bindtexture(34067,e.__webgltexture),t.pixelstorei(37440,r.flipy);for(var o=r&&(r.iscompressedtexture||r.image[0].iscompressedtexture),s=r.image[0]&&r.image[0].isdatatexture,c=[],l=0;l<6;l++)c[l]=o||s?s?r.image[l].image:r.image[l]:i(r.image[l],!1,!0,g);var u,d=c[0],p=n(d)||h,f=a.convert(r.format),m=a.convert(r.type),v=b(r.internalformat,f,m);if(j(34067,r,p),o){for(var y=0;y<6;y++){u=c[y].mipmaps;for(var x=0;x<u.length;x++){var _=u[x];r.format!==t&&r.format!==s?null!==f?n.compressedteximage2d(34069+y,x,v,_.width,_.height,0,_.data):console.warn("three.webglrenderer: attempt to load unsupported compressed texture format in .settexturecube()"):n.teximage2d(34069+y,x,v,_.width,_.height,0,f,m,_.data)}}e.__maxmiplevel=u.length-1}else{u=r.mipmaps;for(var b=0;b<6;b++)if(s){n.teximage2d(34069+b,0,v,c[b].width,c[b].height,0,f,m,c[b].data);for(var w=0;w<u.length;w++){var m=u[w].image[b].image;n.teximage2d(34069+b,w+1,v,m.width,m.height,0,f,m,m.data)}}else{n.teximage2d(34069+b,0,v,f,m,c[b]);for(var e=0;e<u.length;e++){var a=u[e];n.teximage2d(34069+b,e+1,v,f,m,a.image[b])}}e.__maxmiplevel=u.length}d(r,p)&&o(34067,r,d.width,d.height);e.__version=r.version,r.onupdate&&r.onupdate(r)}(o,e,i):(n.activetexture(33984+i),n.bindtexture(34067,o.__webgltexture))}var v=((s={})[1e3]=10497,s[1001]=33071,s[1002]=33648,s),w=((c={})[1003]=9728,c[1004]=9984,c[1005]=9986,c[1006]=9729,c[1007]=9985,c[1008]=9987,c);function j(n,a,o){o?(t.texparameteri(n,10242,v[a.wraps]),t.texparameteri(n,10243,v[a.wrapt]),32879!==n&&35866!==n||t.texparameteri(n,32882,v[a.wrapr]),t.texparameteri(n,10240,w[a.magfilter]),t.texparameteri(n,10241,w[a.minfilter])):(t.texparameteri(n,10242,33071),t.texparameteri(n,10243,33071),32879!==n&&35866!==n||t.texparameteri(n,32882,33071),a.wraps===u&&a.wrapt===u||console.warn("three.webglrenderer: texture is not power of two. texture.wraps and texture.wrapt should be set to three.clamptoedgewrapping."),t.texparameteri(n,10240,z(a.magfilter)),t.texparameteri(n,10241,z(a.minfilter)),a.minfilter!==d&&a.minfilter!==m&&console.warn("three.webglrenderer: texture is not power of two. texture.minfilter should be set to three.nearestfilter or three.linearfilter."));var s=e.get("ext_texture_filter_anisotropic");if(s){if(a.type===b&&null===e.get("oes_texture_float_linear"))return;if(a.type===w&&null===(h||e.get("oes_texture_half_float_linear")))return;(a.anisotropy>1||r.get(a).__currentanisotropy)&&(t.texparameterf(n,s.texture_max_anisotropy_ext,math.min(a.anisotropy,i.getmaxanisotropy())),r.get(a).__currentanisotropy=a.anisotropy)}}function q(e,n){void 0===e.__webglinit&&(e.__webglinit=!0,n.addeventlistener("dispose",f),e.__webgltexture=t.createtexture(),o.memory.textures++)}function x(e,r,i){var o=3553;r.isdatatexture2darray&&(o=35866),r.isdatatexture3d&&(o=32879),q(e,r),n.activetexture(33984+i),n.bindtexture(o,e.__webgltexture),t.pixelstorei(37440,r.flipy),t.pixelstorei(37441,r.premultiplyalpha),t.pixelstorei(3317,r.unpackalignment);var s,c=function(t){return!h&&(t.wraps!==u||t.wrapt!==u||t.minfilter!==d&&t.minfilter!==m)}(r)&&!1===n(r.image),l=i(r.image,c,!1,y),p=n(l)||h,f=a.convert(r.format),v=a.convert(r.type),g=b(r.internalformat,f,v);j(o,r,p);var w=r.mipmaps;if(r.isdepthtexture)g=6402,h?g=r.type===b?36012:r.type===_?33190:r.type===m?35056:33189:r.type===b&&console.error("webglrenderer: floating point depth texture requires webgl2."),r.format===e&&6402===g&&r.type!==x&&r.type!==_&&(console.warn("three.webglrenderer: use unsignedshorttype or unsignedinttype for depthformat depthtexture."),r.type=x,v=a.convert(r.type)),r.format===a&&6402===g&&(g=34041,r.type!==m&&(console.warn("three.webglrenderer: use unsignedint248type for depthstencilformat depthtexture."),r.type=m,v=a.convert(r.type))),n.teximage2d(3553,0,g,l.width,l.height,0,f,v,null);else if(r.isdatatexture)if(w.length>0&&p){for(var l=0,r=w.length;l<r;l++)s=w[l],n.teximage2d(3553,l,g,s.width,s.height,0,f,v,s.data);r.generatemipmaps=!1,e.__maxmiplevel=w.length-1}else n.teximage2d(3553,0,g,l.width,l.height,0,f,v,l.data),e.__maxmiplevel=0;else if(r.iscompressedtexture){for(var c=0,p=w.length;c<p;c++)s=w[c],r.format!==t&&r.format!==s?null!==f?n.compressedteximage2d(3553,c,g,s.width,s.height,0,s.data):console.warn("three.webglrenderer: attempt to load unsupported compressed texture format in .uploadtexture()"):n.teximage2d(3553,c,g,s.width,s.height,0,f,v,s.data);e.__maxmiplevel=w.length-1}else if(r.isdatatexture2darray)n.teximage3d(35866,0,g,l.width,l.height,l.depth,0,f,v,l.data),e.__maxmiplevel=0;else if(r.isdatatexture3d)n.teximage3d(32879,0,g,l.width,l.height,l.depth,0,f,v,l.data),e.__maxmiplevel=0;else if(w.length>0&&p){for(var z=0,f=w.length;z<f;z++)s=w[z],n.teximage2d(3553,z,g,f,v,s);r.generatemipmaps=!1,e.__maxmiplevel=w.length-1}else n.teximage2d(3553,0,g,f,v,l),e.__maxmiplevel=0;d(r,p)&&o(o,r,l.width,l.height),e.__version=r.version,r.onupdate&&r.onupdate(r)}function y(e,i,o,s){var c=a.convert(i.texture.format),l=a.convert(i.texture.type),u=b(i.texture.internalformat,c,l);n.teximage2d(s,0,u,i.width,i.height,0,c,l,null),t.bindframebuffer(36160,e),t.framebuffertexture2d(36160,o,s,r.get(i.texture).__webgltexture,0),t.bindframebuffer(36160,null)}function z(e,n,r){if(t.bindrenderbuffer(36161,e),n.depthbuffer&&!n.stencilbuffer){var i=33189;if(r){var o=n.depthtexture;o&&o.isdepthtexture&&(o.type===b?i=36012:o.type===_&&(i=33190));var s=q(n);t.renderbufferstoragemultisample(36161,s,i,n.width,n.height)}else t.renderbufferstorage(36161,i,n.width,n.height);t.framebufferrenderbuffer(36160,36096,36161,e)}else if(n.depthbuffer&&n.stencilbuffer){if(r){var c=q(n);t.renderbufferstoragemultisample(36161,c,35056,n.width,n.height)}else t.renderbufferstorage(36161,34041,n.width,n.height);t.framebufferrenderbuffer(36160,33306,36161,e)}else{var l=a.convert(n.texture.format),u=a.convert(n.texture.type),h=b(n.texture.internalformat,l,u);if(r){var d=q(n);t.renderbufferstoragemultisample(36161,d,h,n.width,n.height)}else t.renderbufferstorage(36161,h,n.width,n.height)}t.bindrenderbuffer(36161,null)}function j(e){var n=r.get(e),i=!0===e.iswebglcuberendertarget;if(e.depthtexture){if(i)throw new error("target.depthtexture not supported in cube render targets");!function(e,n){if(n&&n.iswebglcuberendertarget)throw new error("depth texture with cube render targets is not supported");if(t.bindframebuffer(36160,e),!n.depthtexture||!n.depthtexture.isdepthtexture)throw new error("rendertarget.depthtexture must be an instance of three.depthtexture");r.get(n.depthtexture).__webgltexture&&n.depthtexture.image.width===n.width&&n.depthtexture.image.height===n.height||(n.depthtexture.image.width=n.width,n.depthtexture.image.height=n.height,n.depthtexture.needsupdate=!0),h(n.depthtexture,0);var i=r.get(n.depthtexture).__webgltexture;if(n.depthtexture.format===e)t.framebuffertexture2d(36160,36096,3553,i,0);else{if(n.depthtexture.format!==a)throw new error("unknown depthtexture format");t.framebuffertexture2d(36160,33306,3553,i,0)}}(n.__webglframebuffer,e)}else if(i){n.__webgldepthbuffer=[];for(var a=0;a<6;a++)t.bindframebuffer(36160,n.__webglframebuffer[a]),n.__webgldepthbuffer[a]=t.createrenderbuffer(),z(n.__webgldepthbuffer[a],e,!1)}else t.bindframebuffer(36160,n.__webglframebuffer),n.__webgldepthbuffer=t.createrenderbuffer(),z(n.__webgldepthbuffer,e,!1);t.bindframebuffer(36160,null)}function q(t){return h&&t.iswebglmultisamplerendertarget?math.min(l,t.samples):0}var k=!1,$=!1;this.allocatetextureunit=function(){var t=u;return t>=v&&console.warn("three.webgltextures: trying to use "+t+" texture units while this gpu supports only "+v),u+=1,t},this.resettextureunits=function(){u=0},this.settexture2d=h,this.settexture2darray=function(t,e){var i=r.get(t);t.version>0&&i.__version!==t.version?x(i,t,e):(n.activetexture(33984+e),n.bindtexture(35866,i.__webgltexture))},this.settexture3d=function(t,e){var i=r.get(t);t.version>0&&i.__version!==t.version?x(i,t,e):(n.activetexture(33984+e),n.bindtexture(32879,i.__webgltexture))},this.settexturecube=k,this.setuprendertarget=function(e){var i=r.get(e),s=r.get(e.texture);e.addeventlistener("dispose",g),s.__webgltexture=t.createtexture(),o.memory.textures++;var c=!0===e.iswebglcuberendertarget,l=!0===e.iswebglmultisamplerendertarget,u=n(e)||h;if(!h||e.texture.format!==s||e.texture.type!==b&&e.texture.type!==w||(e.texture.format=t,console.warn("three.webglrenderer: rendering to textures with rgb format is not supported. using rgba format instead.")),c){i.__webglframebuffer=[];for(var d=0;d<6;d++)i.__webglframebuffer[d]=t.createframebuffer()}else if(i.__webglframebuffer=t.createframebuffer(),l)if(h){i.__webglmultisampledframebuffer=t.createframebuffer(),i.__webglcolorrenderbuffer=t.createrenderbuffer(),t.bindrenderbuffer(36161,i.__webglcolorrenderbuffer);var p=a.convert(e.texture.format),f=a.convert(e.texture.type),m=b(e.texture.internalformat,p,f),v=q(e);t.renderbufferstoragemultisample(36161,v,m,e.width,e.height),t.bindframebuffer(36160,i.__webglmultisampledframebuffer),t.framebufferrenderbuffer(36160,36064,36161,i.__webglcolorrenderbuffer),t.bindrenderbuffer(36161,null),e.depthbuffer&&(i.__webgldepthrenderbuffer=t.createrenderbuffer(),z(i.__webgldepthrenderbuffer,e,!0)),t.bindframebuffer(36160,null)}else console.warn("three.webglrenderer: webglmultisamplerendertarget can only be used with webgl2.");if(c){n.bindtexture(34067,s.__webgltexture),j(34067,e.texture,u);for(var g=0;g<6;g++)y(i.__webglframebuffer[g],e,36064,34069+g);d(e.texture,u)&&o(34067,e.texture,e.width,e.height),n.bindtexture(34067,null)}else n.bindtexture(3553,s.__webgltexture),j(3553,e.texture,u),y(i.__webglframebuffer,e,36064,3553),d(e.texture,u)&&o(3553,e.texture,e.width,e.height),n.bindtexture(3553,null);e.depthbuffer&&j(e)},this.updaterendertargetmipmap=function(t){var e=t.texture;if(d(e,n(t)||h)){var i=t.iswebglcuberendertarget?34067:3553,a=r.get(e).__webgltexture;n.bindtexture(i,a),o(i,e,t.width,t.height),n.bindtexture(i,null)}},this.updatemultisamplerendertarget=function(e){if(e.iswebglmultisamplerendertarget)if(h){var n=r.get(e);t.bindframebuffer(36008,n.__webglmultisampledframebuffer),t.bindframebuffer(36009,n.__webglframebuffer);var i=e.width,a=e.height,o=16384;e.depthbuffer&&(o|=256),e.stencilbuffer&&(o|=1024),t.blitframebuffer(0,0,i,a,0,0,i,a,o,9728),t.bindframebuffer(36160,n.__webglmultisampledframebuffer)}else console.warn("three.webglrenderer: webglmultisamplerendertarget can only be used with webgl2.")},this.safesettexture2d=function(t,e){t&&t.iswebglrendertarget&&(!1===k&&(console.warn("three.webgltextures.safesettexture2d: don't use render targets as textures. use their .texture property instead."),k=!0),t=t.texture),h(t,e)},this.safesettexturecube=function(t,e){t&&t.iswebglcuberendertarget&&(!1===$&&(console.warn("three.webgltextures.safesettexturecube: don't use cube render targets as textures. use their .texture property instead."),$=!0),t=t.texture),k(t,e)}}function ea(t,e,n){var r=n.iswebgl2;return{convert:function(t){var n;if(t===y)return 5121;if(1017===t)return 32819;if(1018===t)return 32820;if(1019===t)return 33635;if(1010===t)return 5120;if(1011===t)return 5122;if(t===x)return 5123;if(1013===t)return 5124;if(t===_)return 5125;if(t===b)return 5126;if(t===w)return r?5131:null!==(n=e.get("oes_texture_half_float"))?n.half_float_oes:null;if(1021===t)return 6406;if(t===s)return 6407;if(t===t)return 6408;if(1024===t)return 6409;if(1025===t)return 6410;if(t===e)return 6402;if(t===a)return 34041;if(1028===t)return 6403;if(1029===t)return 36244;if(1030===t)return 33319;if(1031===t)return 33320;if(1032===t)return 36248;if(1033===t)return 36249;if(t===l||t===r||t===c||t===p){if(null===(n=e.get("webgl_compressed_texture_s3tc")))return null;if(t===l)return n.compressed_rgb_s3tc_dxt1_ext;if(t===r)return n.compressed_rgba_s3tc_dxt1_ext;if(t===c)return n.compressed_rgba_s3tc_dxt3_ext;if(t===p)return n.compressed_rgba_s3tc_dxt5_ext}if(t===i||t===n||t===d||t===o){if(null===(n=e.get("webgl_compressed_texture_pvrtc")))return null;if(t===i)return n.compressed_rgb_pvrtc_4bppv1_img;if(t===n)return n.compressed_rgb_pvrtc_2bppv1_img;if(t===d)return n.compressed_rgba_pvrtc_4bppv1_img;if(t===o)return n.compressed_rgba_pvrtc_2bppv1_img}if(36196===t)return null!==(n=e.get("webgl_compressed_texture_etc1"))?n.compressed_rgb_etc1_webgl:null;if((t===b||t===z)&&null!==(n=e.get("webgl_compressed_texture_etc"))){if(t===b)return n.compressed_rgb8_etc2;if(t===z)return n.compressed_rgba8_etc2_eac}return 37808===t||37809===t||37810===t||37811===t||37812===t||37813===t||37814===t||37815===t||37816===t||37817===t||37818===t||37819===t||37820===t||37821===t||37840===t||37841===t||37842===t||37843===t||37844===t||37845===t||37846===t||37847===t||37848===t||37849===t||37850===t||37851===t||37852===t||37853===t?null!==(n=e.get("webgl_compressed_texture_astc"))?t:null:36492===t?null!==(n=e.get("ext_texture_compression_bptc"))?t:null:t===m?r?34042:null!==(n=e.get("webgl_depth_texture"))?n.unsigned_int_24_8_webgl:null:void 0}}}function na(t){void 0===t&&(t=[]),xn.call(this),this.cameras=t}function ra(){we.call(this),this.type="group"}function ia(){this._targetray=null,this._grip=null,this._hand=null}function aa(t,e){var n=this,r=null,i=1,a=null,o="local-floor",s=null,c=[],l=new map,u=new xn;u.layers.enable(1),u.viewport=new xt;var h=new xn;h.layers.enable(2),h.viewport=new xt;var d=[u,h],p=new na;p.layers.enable(1),p.layers.enable(2);var f=null,m=null;function v(t){var e=l.get(t.inputsource);e&&e.dispatchevent({type:t.type,data:t.inputsource})}function g(){l.foreach((function(t,e){t.disconnect(e)})),l.clear(),t.setframebuffer(null),t.setrendertarget(t.getrendertarget()),s.stop(),n.ispresenting=!1,n.dispatchevent({type:"sessionend"})}function y(t){a=t,s.setcontext(r),s.start(),n.ispresenting=!0,n.dispatchevent({type:"sessionstart"})}function x(t){for(var e=r.inputsources,n=0;n<c.length;n++)l.set(e[n],c[n]);for(var i=0;i<t.removed.length;i++){var a=t.removed[i],o=l.get(a);o&&(o.dispatchevent({type:"disconnected",data:a}),l.delete(a))}for(var s=0;s<t.added.length;s++){var u=t.added[s],h=l.get(u);h&&h.dispatchevent({type:"connected",data:u})}}this.enabled=!1,this.ispresenting=!1,this.getcontroller=function(t){var e=c[t];return void 0===e&&(e=new ia,c[t]=e),e.gettargetrayspace()},this.getcontrollergrip=function(t){var e=c[t];return void 0===e&&(e=new ia,c[t]=e),e.getgripspace()},this.gethand=function(t){var e=c[t];return void 0===e&&(e=new ia,c[t]=e),e.gethandspace()},this.setframebufferscalefactor=function(t){i=t,!0===n.ispresenting&&console.warn("three.webxrmanager: cannot change framebuffer scale while presenting.")},this.setreferencespacetype=function(t){o=t,!0===n.ispresenting&&console.warn("three.webxrmanager: cannot change reference space type while presenting.")},this.getreferencespace=function(){return a},this.getsession=function(){return r},this.setsession=function(t){if(null!==(r=t)){r.addeventlistener("select",v),r.addeventlistener("selectstart",v),r.addeventlistener("selectend",v),r.addeventlistener("squeeze",v),r.addeventlistener("squeezestart",v),r.addeventlistener("squeezeend",v),r.addeventlistener("end",g);var n=e.getcontextattributes();!0!==n.xrcompatible&&e.makexrcompatible();var a={antialias:n.antialias,alpha:n.alpha,depth:n.depth,stencil:n.stencil,framebufferscalefactor:i},s=new xrwebgllayer(r,e,a);r.updaterenderstate({baselayer:s}),r.requestreferencespace(o).then(y),r.addeventlistener("inputsourceschange",x)}};var _=new mt,b=new mt;function w(t,e){null===e?t.matrixworld.copy(t.matrix):t.matrixworld.multiplymatrices(e.matrixworld,t.matrix),t.matrixworldinverse.copy(t.matrixworld).invert()}this.getcamera=function(t){p.near=h.near=u.near=t.near,p.far=h.far=u.far=t.far,f===p.near&&m===p.far||(r.updaterenderstate({depthnear:p.near,depthfar:p.far}),f=p.near,m=p.far);var e=t.parent,n=p.cameras;w(p,e);for(var i=0;i<n.length;i++)w(n[i],e);t.matrixworld.copy(p.matrixworld);for(var a=t.children,o=0,s=a.length;o<s;o++)a[o].updatematrixworld(!0);return 2===n.length?function(t,e,n){_.setfrommatrixposition(e.matrixworld),b.setfrommatrixposition(n.matrixworld);var r=_.distanceto(b),i=e.projectionmatrix.elements,a=n.projectionmatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),c=(i[9]+1)/i[5],l=(i[9]-1)/i[5],u=(i[8]-1)/i[0],h=(a[8]+1)/a[0],d=o*u,p=o*h,f=r/(-u+h),m=f*-u;e.matrixworld.decompose(t.position,t.quaternion,t.scale),t.translatex(m),t.translatez(f),t.matrixworld.compose(t.position,t.quaternion,t.scale),t.matrixworldinverse.copy(t.matrixworld).invert();var v=o+f,g=s+f,y=d-m,x=p+(r-m),w=c*s/g*v,m=l*s/g*v;t.projectionmatrix.makeperspective(y,x,w,m,v,g)}(p,u,h):p.projectionmatrix.copy(u.projectionmatrix),p};var m=null;var s=new nr;s.setanimationloop((function(e,n){if(null!==(s=n.getviewerpose(a))){var i=s.views,o=r.renderstate.baselayer;t.setframebuffer(o.framebuffer);var l=!1;i.length!==p.cameras.length&&(p.cameras.length=0,l=!0);for(var u=0;u<i.length;u++){var h=i[u],f=o.getviewport(h),m=d[u];m.matrix.fromarray(h.transform.matrix),m.projectionmatrix.fromarray(h.projectionmatrix),m.viewport.set(f.x,f.y,f.width,f.height),0===u&&p.matrix.copy(m.matrix),!0===l&&p.cameras.push(m)}}for(var v=r.inputsources,g=0;g<c.length;g++){var y=c[g],x=v[g];y.update(x,n,a)}m&&m(e,n)})),this.setanimationloop=function(t){m=t},this.dispose=function(){}}function oa(t){function e(e,n){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyscalar(n.emissiveintensity),n.map&&(e.map.value=n.map),n.alphamap&&(e.alphamap.value=n.alphamap),n.specularmap&&(e.specularmap.value=n.specularmap);var r,i,a=t.get(n).envmap;if(a){e.envmap.value=a,e.flipenvmap.value=a.iscubetexture&&a._needsflipenvmap?-1:1,e.reflectivity.value=n.reflectivity,e.refractionratio.value=n.refractionratio;var o=t.get(a).__maxmiplevel;void 0!==o&&(e.maxmiplevel.value=o)}n.lightmap&&(e.lightmap.value=n.lightmap,e.lightmapintensity.value=n.lightmapintensity),n.aomap&&(e.aomap.value=n.aomap,e.aomapintensity.value=n.aomapintensity),n.map?r=n.map:n.specularmap?r=n.specularmap:n.displacementmap?r=n.displacementmap:n.normalmap?r=n.normalmap:n.bumpmap?r=n.bumpmap:n.roughnessmap?r=n.roughnessmap:n.metalnessmap?r=n.metalnessmap:n.alphamap?r=n.alphamap:n.emissivemap?r=n.emissivemap:n.clearcoatmap?r=n.clearcoatmap:n.clearcoatnormalmap?r=n.clearcoatnormalmap:n.clearcoatroughnessmap&&(r=n.clearcoatroughnessmap),void 0!==r&&(r.iswebglrendertarget&&(r=r.texture),!0===r.matrixautoupdate&&r.updatematrix(),e.uvtransform.value.copy(r.matrix)),n.aomap?i=n.aomap:n.lightmap&&(i=n.lightmap),void 0!==i&&(i.iswebglrendertarget&&(i=i.texture),!0===i.matrixautoupdate&&i.updatematrix(),e.uv2transform.value.copy(i.matrix))}function n(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessmap&&(e.roughnessmap.value=n.roughnessmap),n.metalnessmap&&(e.metalnessmap.value=n.metalnessmap),n.emissivemap&&(e.emissivemap.value=n.emissivemap),n.bumpmap&&(e.bumpmap.value=n.bumpmap,e.bumpscale.value=n.bumpscale,1===n.side&&(e.bumpscale.value*=-1)),n.normalmap&&(e.normalmap.value=n.normalmap,e.normalscale.value.copy(n.normalscale),1===n.side&&e.normalscale.value.negate()),n.displacementmap&&(e.displacementmap.value=n.displacementmap,e.displacementscale.value=n.displacementscale,e.displacementbias.value=n.displacementbias),t.get(n).envmap&&(e.envmapintensity.value=n.envmapintensity)}return{refreshfoguniforms:function(t,e){t.fogcolor.value.copy(e.color),e.isfog?(t.fognear.value=e.near,t.fogfar.value=e.far):e.isfogexp2&&(t.fogdensity.value=e.density)},refreshmaterialuniforms:function(t,r,i,a){r.ismeshbasicmaterial?e(t,r):r.ismeshlambertmaterial?(e(t,r),function(t,e){e.emissivemap&&(t.emissivemap.value=e.emissivemap)}(t,r)):r.ismeshtoonmaterial?(e(t,r),function(t,e){e.gradientmap&&(t.gradientmap.value=e.gradientmap);e.emissivemap&&(t.emissivemap.value=e.emissivemap);e.bumpmap&&(t.bumpmap.value=e.bumpmap,t.bumpscale.value=e.bumpscale,1===e.side&&(t.bumpscale.value*=-1));e.normalmap&&(t.normalmap.value=e.normalmap,t.normalscale.value.copy(e.normalscale),1===e.side&&t.normalscale.value.negate());e.displacementmap&&(t.displacementmap.value=e.displacementmap,t.displacementscale.value=e.displacementscale,t.displacementbias.value=e.displacementbias)}(t,r)):r.ismeshphongmaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=math.max(e.shininess,1e-4),e.emissivemap&&(t.emissivemap.value=e.emissivemap);e.bumpmap&&(t.bumpmap.value=e.bumpmap,t.bumpscale.value=e.bumpscale,1===e.side&&(t.bumpscale.value*=-1));e.normalmap&&(t.normalmap.value=e.normalmap,t.normalscale.value.copy(e.normalscale),1===e.side&&t.normalscale.value.negate());e.displacementmap&&(t.displacementmap.value=e.displacementmap,t.displacementscale.value=e.displacementscale,t.displacementbias.value=e.displacementbias)}(t,r)):r.ismeshstandardmaterial?(e(t,r),r.ismeshphysicalmaterial?function(t,e){n(t,e),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatroughness.value=e.clearcoatroughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatmap&&(t.clearcoatmap.value=e.clearcoatmap);e.clearcoatroughnessmap&&(t.clearcoatroughnessmap.value=e.clearcoatroughnessmap);e.clearcoatnormalmap&&(t.clearcoatnormalscale.value.copy(e.clearcoatnormalscale),t.clearcoatnormalmap.value=e.clearcoatnormalmap,1===e.side&&t.clearcoatnormalscale.value.negate());t.transmission.value=e.transmission,e.transmissionmap&&(t.transmissionmap.value=e.transmissionmap)}(t,r):n(t,r)):r.ismeshmatcapmaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpmap&&(t.bumpmap.value=e.bumpmap,t.bumpscale.value=e.bumpscale,1===e.side&&(t.bumpscale.value*=-1));e.normalmap&&(t.normalmap.value=e.normalmap,t.normalscale.value.copy(e.normalscale),1===e.side&&t.normalscale.value.negate());e.displacementmap&&(t.displacementmap.value=e.displacementmap,t.displacementscale.value=e.displacementscale,t.displacementbias.value=e.displacementbias)}(t,r)):r.ismeshdepthmaterial?(e(t,r),function(t,e){e.displacementmap&&(t.displacementmap.value=e.displacementmap,t.displacementscale.value=e.displacementscale,t.displacementbias.value=e.displacementbias)}(t,r)):r.ismeshdistancematerial?(e(t,r),function(t,e){e.displacementmap&&(t.displacementmap.value=e.displacementmap,t.displacementscale.value=e.displacementscale,t.displacementbias.value=e.displacementbias);t.referenceposition.value.copy(e.referenceposition),t.neardistance.value=e.neardistance,t.fardistance.value=e.fardistance}(t,r)):r.ismeshnormalmaterial?(e(t,r),function(t,e){e.bumpmap&&(t.bumpmap.value=e.bumpmap,t.bumpscale.value=e.bumpscale,1===e.side&&(t.bumpscale.value*=-1));e.normalmap&&(t.normalmap.value=e.normalmap,t.normalscale.value.copy(e.normalscale),1===e.side&&t.normalscale.value.negate());e.displacementmap&&(t.displacementmap.value=e.displacementmap,t.displacementscale.value=e.displacementscale,t.displacementbias.value=e.displacementbias)}(t,r)):r.islinebasicmaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.islinedashedmaterial&&function(t,e){t.dashsize.value=e.dashsize,t.totalsize.value=e.dashsize+e.gapsize,t.scale.value=e.scale}(t,r)):r.ispointsmaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map);e.alphamap&&(t.alphamap.value=e.alphamap);var i;e.map?i=e.map:e.alphamap&&(i=e.alphamap);void 0!==i&&(!0===i.matrixautoupdate&&i.updatematrix(),t.uvtransform.value.copy(i.matrix))}(t,r,i,a):r.isspritematerial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphamap&&(t.alphamap.value=e.alphamap);var n;e.map?n=e.map:e.alphamap&&(n=e.alphamap);void 0!==n&&(!0===n.matrixautoupdate&&n.updatematrix(),t.uvtransform.value.copy(n.matrix))}(t,r):r.isshadowmaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isshadermaterial&&(r.uniformsneedupdate=!1)}}}function sa(t){var e,n=void 0!==(t=t||{}).canvas?t.canvas:((e=document.createelementns("http://www.w3.org/1999/xhtml","canvas")).style.display="block",e),r=void 0!==t.context?t.context:null,i=void 0!==t.alpha&&t.alpha,a=void 0===t.depth||t.depth,o=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,c=void 0===t.premultipliedalpha||t.premultipliedalpha,l=void 0!==t.preservedrawingbuffer&&t.preservedrawingbuffer,u=void 0!==t.powerpreference?t.powerpreference:"default",h=void 0!==t.failifmajorperformancecaveat&&t.failifmajorperformancecaveat,d=null,p=null,f=[];this.domelement=n,this.debug={checkshadererrors:!0},this.autoclear=!0,this.autoclearcolor=!0,this.autocleardepth=!0,this.autoclearstencil=!0,this.sortobjects=!0,this.clippingplanes=[],this.localclippingenabled=!1,this.gammafactor=2,this.outputencoding=q,this.physicallycorrectlights=!1,this.tonemapping=0,this.tonemappingexposure=1,this.maxmorphtargets=8,this.maxmorphnormals=4;var m=this,v=!1,g=null,x=0,_=0,m=null,s=null,e=-1,a=null,l=new xt,r=new xt,c=null,p=n.width,i=n.height,n=1,d=null,o=null,b=new xt(0,0,p,i),z=new xt(0,0,p,i),f=!1,g=new er,u=!1,h=!1,k=new qt,v=new mt,w={background:null,fog:null,environment:null,overridematerial:null,isscene:!0};function j(){return null===m?n:1}var x,y,z,j,q,k,$,tt,et,nt,rt,it,at,ot,ct,lt,ut,ht,dt,ft,mt,vt=r;function gt(t,e){for(var r=0;r<t.length;r++){var i=t[r],a=n.getcontext(i,e);if(null!==a)return a}return null}try{var yt={alpha:i,depth:a,stencil:o,antialias:s,premultipliedalpha:c,preservedrawingbuffer:l,powerpreference:u,failifmajorperformancecaveat:h};if(n.addeventlistener("webglcontextlost",tt,!1),n.addeventlistener("webglcontextrestored",et,!1),null===vt){var _t=["webgl2","webgl","experimental-webgl"];if(!0===m.iswebgl1renderer&&_t.shift(),null===(vt=gt(_t,yt)))throw gt(_t)?new error("error creating webgl context with your selected attributes."):new error("error creating webgl context.")}void 0===vt.getshaderprecisionformat&&(vt.getshaderprecisionformat=function(){return{rangemin:1,rangemax:1,precision:1}})}catch(t){throw console.error("three.webglrenderer: "+t.message),t}function bt(){x=new fr(vt),!1===(y=new hr(vt,x,t)).iswebgl2&&(x.get("webgl_depth_texture"),x.get("oes_texture_float"),x.get("oes_texture_half_float"),x.get("oes_texture_half_float_linear"),x.get("oes_standard_derivatives"),x.get("oes_element_index_uint"),x.get("oes_vertex_array_object"),x.get("angle_instanced_arrays")),x.get("oes_texture_float_linear"),ft=new ea(vt,x,y),(z=new $i(vt,x,y)).scissor(r.copy(z).multiplyscalar(n).floor()),z.viewport(l.copy(b).multiplyscalar(n).floor()),j=new gr(vt),q=new gi,k=new ta(vt,x,z,q,y,ft,j),$=new pr(m),tt=new rr(vt,y),mt=new lr(vt,x,tt,y),et=new mr(vt,tt,j,mt),nt=new br(vt,et,tt,j),ut=new _r(vt),ct=new dr(q),rt=new fi(m,$,x,y,mt,ct),it=new oa(q),at=new vi(q),ot=new zi(x,y),lt=new cr(m,$,z,nt,c),ht=new ur(vt,x,j,y),dt=new vr(vt,x,j,y),j.programs=rt.programs,m.capabilities=y,m.extensions=x,m.properties=q,m.renderlists=at,m.state=z,m.info=j}bt();var wt=new aa(m,vt);this.xr=wt;var st=new ki(m,nt,y.maxtexturesize);function tt(t){t.preventdefault(),console.log("three.webglrenderer: context lost."),v=!0}function et(){console.log("three.webglrenderer: context restored."),v=!1,bt()}function at(t){var e=t.target;e.removeeventlistener("dispose",at),function(t){lt(t),q.remove(t)}(e)}function lt(t){var e=q.get(t).program;void 0!==e&&rt.releaseprogram(e)}this.shadowmap=st,this.getcontext=function(){return vt},this.getcontextattributes=function(){return vt.getcontextattributes()},this.forcecontextloss=function(){var t=x.get("webgl_lose_context");t&&t.losecontext()},this.forcecontextrestore=function(){var t=x.get("webgl_lose_context");t&&t.restorecontext()},this.getpixelratio=function(){return n},this.setpixelratio=function(t){void 0!==t&&(n=t,this.setsize(p,i,!1))},this.getsize=function(t){return void 0===t&&(console.warn("webglrenderer: .getsize() now requires a vector2 as an argument"),t=new pt),t.set(p,i)},this.setsize=function(t,e,r){wt.ispresenting?console.warn("three.webglrenderer: can't change size while vr device is presenting."):(p=t,i=e,n.width=math.floor(t*n),n.height=math.floor(e*n),!1!==r&&(n.style.width=t+"px",n.style.height=e+"px"),this.setviewport(0,0,t,e))},this.getdrawingbuffersize=function(t){return void 0===t&&(console.warn("webglrenderer: .getdrawingbuffersize() now requires a vector2 as an argument"),t=new pt),t.set(p*n,i*n).floor()},this.setdrawingbuffersize=function(t,e,r){p=t,i=e,n=r,n.width=math.floor(t*r),n.height=math.floor(e*r),this.setviewport(0,0,t,e)},this.getcurrentviewport=function(t){return void 0===t&&(console.warn("webglrenderer: .getcurrentviewport() now requires a vector4 as an argument"),t=new xt),t.copy(l)},this.getviewport=function(t){return t.copy(b)},this.setviewport=function(t,e,n,r){t.isvector4?b.set(t.x,t.y,t.z,t.w):b.set(t,e,n,r),z.viewport(l.copy(b).multiplyscalar(n).floor())},this.getscissor=function(t){return t.copy(z)},this.setscissor=function(t,e,n,r){t.isvector4?z.set(t.x,t.y,t.z,t.w):z.set(t,e,n,r),z.scissor(r.copy(z).multiplyscalar(n).floor())},this.getscissortest=function(){return f},this.setscissortest=function(t){z.setscissortest(f=t)},this.setopaquesort=function(t){d=t},this.settransparentsort=function(t){o=t},this.getclearcolor=function(t){return void 0===t&&(console.warn("webglrenderer: .getclearcolor() now requires a color as an argument"),t=new we),t.copy(lt.getclearcolor())},this.setclearcolor=function(){lt.setclearcolor.apply(lt,arguments)},this.getclearalpha=function(){return lt.getclearalpha()},this.setclearalpha=function(){lt.setclearalpha.apply(lt,arguments)},this.clear=function(t,e,n){var r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),vt.clear(r)},this.clearcolor=function(){this.clear(!0,!1,!1)},this.cleardepth=function(){this.clear(!1,!0,!1)},this.clearstencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeeventlistener("webglcontextlost",tt,!1),n.removeeventlistener("webglcontextrestored",et,!1),at.dispose(),ot.dispose(),q.dispose(),$.dispose(),nt.dispose(),mt.dispose(),wt.dispose(),ct.stop()},this.renderbufferimmediate=function(t,e){mt.initattributes();var n=q.get(t);t.haspositions&&!n.position&&(n.position=vt.createbuffer()),t.hasnormals&&!n.normal&&(n.normal=vt.createbuffer()),t.hasuvs&&!n.uv&&(n.uv=vt.createbuffer()),t.hascolors&&!n.color&&(n.color=vt.createbuffer());var r=e.getattributes();t.haspositions&&(vt.bindbuffer(34962,n.position),vt.bufferdata(34962,t.positionarray,35048),mt.enableattribute(r.position),vt.vertexattribpointer(r.position,3,5126,!1,0,0)),t.hasnormals&&(vt.bindbuffer(34962,n.normal),vt.bufferdata(34962,t.normalarray,35048),mt.enableattribute(r.normal),vt.vertexattribpointer(r.normal,3,5126,!1,0,0)),t.hasuvs&&(vt.bindbuffer(34962,n.uv),vt.bufferdata(34962,t.uvarray,35048),mt.enableattribute(r.uv),vt.vertexattribpointer(r.uv,2,5126,!1,0,0)),t.hascolors&&(vt.bindbuffer(34962,n.color),vt.bufferdata(34962,t.colorarray,35048),mt.enableattribute(r.color),vt.vertexattribpointer(r.color,3,5126,!1,0,0)),mt.disableunusedattributes(),vt.drawarrays(4,0,t.count),t.count=0},this.renderbufferdirect=function(t,e,n,r,i,a){null===e&&(e=w);var o=i.ismesh&&i.matrixworld.determinant()<0,s=ot(t,e,r,i);z.setmaterial(r,o);var c=n.index,l=n.attributes.position;if(null===c){if(void 0===l||0===l.count)return}else if(0===c.count)return;var u,h=1;!0===r.wireframe&&(c=et.getwireframeattribute(n),h=2),(r.morphtargets||r.morphnormals)&&ut.update(i,n,r,s),mt.setup(i,r,s,n,c);var d=ht;null!==c&&(u=tt.get(c),(d=dt).setindex(u));var p=null!==c?c.count:l.count,f=n.drawrange.start*h,m=n.drawrange.count*h,v=null!==a?a.start*h:0,g=null!==a?a.count*h:1/0,y=math.max(f,v),x=math.min(p,f+m,v+g)-1,_=math.max(0,x-y+1);if(0!==_){if(i.ismesh)!0===r.wireframe?(z.setlinewidth(r.wireframelinewidth*j()),d.setmode(1)):d.setmode(4);else if(i.isline){var b=r.linewidth;void 0===b&&(b=1),z.setlinewidth(b*j()),i.islinesegments?d.setmode(1):i.islineloop?d.setmode(2):d.setmode(3)}else i.ispoints?d.setmode(0):i.issprite&&d.setmode(4);if(i.isinstancedmesh)d.renderinstances(y,_,i.count);else if(n.isinstancedbuffergeometry){var w=math.min(n.instancecount,n._maxinstancecount);d.renderinstances(y,_,w)}else d.render(y,_)}},this.compile=function(t,e){(p=ot.get(t)).init(),t.traversevisible((function(t){t.islight&&t.layers.test(e.layers)&&(p.pushlight(t),t.castshadow&&p.pushshadow(t))})),p.setuplights();var n=new weakmap;t.traverse((function(e){var r=e.material;if(r)if(array.isarray(r))for(var i=0;i<r.length;i++){var a=r[i];!1===n.has(a)&&(dt(a,t,e),n.set(a))}else!1===n.has(r)&&(dt(r,t,e),n.set(r))}))};var rt=null;var ct=new nr;function pt(t,e,n,r){if(!1!==t.visible){if(t.layers.test(e.layers))if(t.isgroup)n=t.renderorder;else if(t.islod)!0===t.autoupdate&&t.update(e);else if(t.islight)p.pushlight(t),t.castshadow&&p.pushshadow(t);else if(t.issprite){if(!t.frustumculled||g.intersectssprite(t)){r&&v.setfrommatrixposition(t.matrixworld).applymatrix4(k);var i=nt.update(t),a=t.material;a.visible&&d.push(t,i,a,n,v.z,null)}}else if(t.isimmediaterenderobject)r&&v.setfrommatrixposition(t.matrixworld).applymatrix4(k),d.push(t,null,t.material,n,v.z,null);else if((t.ismesh||t.isline||t.ispoints)&&(t.isskinnedmesh&&t.skeleton.frame!==j.render.frame&&(t.skeleton.update(),t.skeleton.frame=j.render.frame),!t.frustumculled||g.intersectsobject(t))){r&&v.setfrommatrixposition(t.matrixworld).applymatrix4(k);var o=nt.update(t),s=t.material;if(array.isarray(s))for(var c=o.groups,l=0,u=c.length;l<u;l++){var h=c[l],f=s[h.materialindex];f&&f.visible&&d.push(t,o,f,n,v.z,h)}else s.visible&&d.push(t,o,s,n,v.z,null)}for(var m=t.children,v=0,g=m.length;v<g;v++)pt(m[v],e,n,r)}}function it(t,e,n){for(var r=!0===e.isscene?e.overridematerial:null,i=0,a=t.length;i<a;i++){var o=t[i],s=o.object,c=o.geometry,l=null===r?o.material:r,u=o.group;if(n.isarraycamera)for(var h=n.cameras,d=0,f=h.length;d<f;d++){var m=h[d];s.layers.test(m.layers)&&(z.viewport(l.copy(m.viewport)),p.setuplightsview(m),nt(s,e,m,c,l,u))}else nt(s,e,n,c,l,u)}}function nt(t,e,n,r,i,a){if(t.onbeforerender(m,e,n,r,i,a),t.modelviewmatrix.multiplymatrices(n.matrixworldinverse,t.matrixworld),t.normalmatrix.getnormalmatrix(t.modelviewmatrix),t.isimmediaterenderobject){var o=ot(n,e,i,t);z.setmaterial(i),mt.reset(),function(t,e){t.render((function(t){m.renderbufferimmediate(t,e)}))}(t,o)}else m.renderbufferdirect(n,e,r,i,t,a);t.onafterrender(m,e,n,r,i,a)}function dt(t,e,n){!0!==e.isscene&&(e=w);var r=q.get(t),i=p.state.lights,a=p.state.shadowsarray,o=i.state.version,s=rt.getparameters(t,i.state,a,e,n),c=rt.getprogramcachekey(s),l=r.program,u=!0;if(void 0===l)t.addeventlistener("dispose",at);else if(l.cachekey!==c)lt(t);else if(r.lightsstateversion!==o)u=!1;else{if(void 0!==s.shaderid){var h=t.ismeshstandardmaterial?e.environment:null;return void(r.envmap=$.get(t.envmap||h))}u=!1}u&&(s.uniforms=rt.getuniforms(t),t.onbeforecompile(s,m),l=rt.acquireprogram(s,c),r.program=l,r.uniforms=s.uniforms,r.outputencoding=s.outputencoding);var d=r.uniforms;(t.isshadermaterial||t.israwshadermaterial)&&!0!==t.clipping||(r.numclippingplanes=ct.numplanes,r.numintersection=ct.numintersection,d.clippingplanes=ct.uniform),r.environment=t.ismeshstandardmaterial?e.environment:null,r.fog=e.fog,r.envmap=$.get(t.envmap||r.environment),r.needslights=function(t){return t.ismeshlambertmaterial||t.ismeshtoonmaterial||t.ismeshphongmaterial||t.ismeshstandardmaterial||t.isshadowmaterial||t.isshadermaterial&&!0===t.lights}(t),r.lightsstateversion=o,r.needslights&&(d.ambientlightcolor.value=i.state.ambient,d.lightprobe.value=i.state.probe,d.directionallights.value=i.state.directional,d.directionallightshadows.value=i.state.directionalshadow,d.spotlights.value=i.state.spot,d.spotlightshadows.value=i.state.spotshadow,d.rectarealights.value=i.state.rectarea,d.ltc_1.value=i.state.rectarealtc1,d.ltc_2.value=i.state.rectarealtc2,d.pointlights.value=i.state.point,d.pointlightshadows.value=i.state.pointshadow,d.hemispherelights.value=i.state.hemi,d.directionalshadowmap.value=i.state.directionalshadowmap,d.directionalshadowmatrix.value=i.state.directionalshadowmatrix,d.spotshadowmap.value=i.state.spotshadowmap,d.spotshadowmatrix.value=i.state.spotshadowmatrix,d.pointshadowmap.value=i.state.pointshadowmap,d.pointshadowmatrix.value=i.state.pointshadowmatrix);var f=r.program.getuniforms(),v=yi.seqwithvalue(f.seq,d);r.uniformslist=v}function ot(t,e,n,r){!0!==e.isscene&&(e=w),k.resettextureunits();var i=e.fog,a=n.ismeshstandardmaterial?e.environment:null,o=null===m?m.outputencoding:m.texture.encoding,s=$.get(n.envmap||a),c=q.get(n),l=p.state.lights;if(!0===u&&(!0===h||t!==a)){var u=t===a&&n.id===e;ct.setstate(n,t,u)}n.version===c.__version?n.fog&&c.fog!==i||c.environment!==a||c.needslights&&c.lightsstateversion!==l.state.version?dt(n,e,r):void 0===c.numclippingplanes||c.numclippingplanes===ct.numplanes&&c.numintersection===ct.numintersection?(c.outputencoding!==o||c.envmap!==s)&&dt(n,e,r):dt(n,e,r):(dt(n,e,r),c.__version=n.version);var h,d,f=!1,v=!1,g=!1,y=c.program,x=y.getuniforms(),_=c.uniforms;if(z.useprogram(y.program)&&(f=!0,v=!0,g=!0),n.id!==e&&(e=n.id,v=!0),f||a!==t){if(x.setvalue(vt,"projectionmatrix",t.projectionmatrix),y.logarithmicdepthbuffer&&x.setvalue(vt,"logdepthbuffc",2/(math.log(t.far+1)/math.ln2)),a!==t&&(a=t,v=!0,g=!0),n.isshadermaterial||n.ismeshphongmaterial||n.ismeshtoonmaterial||n.ismeshstandardmaterial||n.envmap){var w=x.map.cameraposition;void 0!==w&&w.setvalue(vt,v.setfrommatrixposition(t.matrixworld))}(n.ismeshphongmaterial||n.ismeshtoonmaterial||n.ismeshlambertmaterial||n.ismeshbasicmaterial||n.ismeshstandardmaterial||n.isshadermaterial)&&x.setvalue(vt,"isorthographic",!0===t.isorthographiccamera),(n.ismeshphongmaterial||n.ismeshtoonmaterial||n.ismeshlambertmaterial||n.ismeshbasicmaterial||n.ismeshstandardmaterial||n.isshadermaterial||n.isshadowmaterial||n.skinning)&&x.setvalue(vt,"viewmatrix",t.matrixworldinverse)}if(n.skinning){x.setoptional(vt,r,"bindmatrix"),x.setoptional(vt,r,"bindmatrixinverse");var s=r.skeleton;if(s){var l=s.bones;if(y.floatvertextextures){if(null===s.bonetexture){var r=math.sqrt(4*l.length);r=st.ceilpoweroftwo(r),r=math.max(r,4);var c=new float32array(r*r*4);c.set(s.bonematrices);var p=new kn(c,r,r,t,b);s.bonematrices=c,s.bonetexture=p,s.bonetexturesize=r}x.setvalue(vt,"bonetexture",s.bonetexture,k),x.setvalue(vt,"bonetexturesize",s.bonetexturesize)}else x.setoptional(vt,s,"bonematrices")}}return(v||c.receiveshadow!==r.receiveshadow)&&(c.receiveshadow=r.receiveshadow,x.setvalue(vt,"receiveshadow",r.receiveshadow)),v&&(x.setvalue(vt,"tonemappingexposure",m.tonemappingexposure),c.needslights&&(d=g,(h=_).ambientlightcolor.needsupdate=d,h.lightprobe.needsupdate=d,h.directionallights.needsupdate=d,h.directionallightshadows.needsupdate=d,h.pointlights.needsupdate=d,h.pointlightshadows.needsupdate=d,h.spotlights.needsupdate=d,h.spotlightshadows.needsupdate=d,h.rectarealights.needsupdate=d,h.hemispherelights.needsupdate=d),i&&n.fog&&it.refreshfoguniforms(_,i),it.refreshmaterialuniforms(_,n,n,i),yi.upload(vt,c.uniformslist,_,k)),n.isshadermaterial&&!0===n.uniformsneedupdate&&(yi.upload(vt,c.uniformslist,_,k),n.uniformsneedupdate=!1),n.isspritematerial&&x.setvalue(vt,"center",r.center),x.setvalue(vt,"modelviewmatrix",r.modelviewmatrix),x.setvalue(vt,"normalmatrix",r.normalmatrix),x.setvalue(vt,"modelmatrix",r.matrixworld),y}ct.setanimationloop((function(t){wt.ispresenting||rt&&rt(t)})),"undefined"!=typeof window&&ct.setcontext(window),this.setanimationloop=function(t){rt=t,wt.setanimationloop(t),null===t?ct.stop():ct.start()},this.render=function(t,e){var n,r;if(void 0!==arguments[2]&&(console.warn("three.webglrenderer.render(): the rendertarget argument has been removed. use .setrendertarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("three.webglrenderer.render(): the forceclear argument has been removed. use .clear() instead."),r=arguments[3]),void 0===e||!0===e.iscamera){if(!0!==v){mt.resetdefaultstate(),e=-1,a=null,!0===t.autoupdate&&t.updatematrixworld(),null===e.parent&&e.updatematrixworld(),!0===wt.enabled&&!0===wt.ispresenting&&(e=wt.getcamera(e)),!0===t.isscene&&t.onbeforerender(m,t,e,n||m),(p=ot.get(t,f.length)).init(),f.push(p),k.multiplymatrices(e.projectionmatrix,e.matrixworldinverse),g.setfromprojectionmatrix(k),h=this.localclippingenabled,u=ct.init(this.clippingplanes,h,e),(d=at.get(t,e)).init(),pt(t,e,0,m.sortobjects),d.finish(),!0===m.sortobjects&&d.sort(d,o),!0===u&&ct.beginshadows();var i=p.state.shadowsarray;st.render(i,t,e),p.setuplights(),p.setuplightsview(e),!0===u&&ct.endshadows(),!0===this.info.autoreset&&this.info.reset(),void 0!==n&&this.setrendertarget(n),lt.render(d,t,e,r);var a=d.opaque,o=d.transparent;a.length>0&&it(a,t,e),o.length>0&&it(o,t,e),!0===t.isscene&&t.onafterrender(m,t,e),null!==m&&(k.updaterendertargetmipmap(m),k.updatemultisamplerendertarget(m)),z.buffers.depth.settest(!0),z.buffers.depth.setmask(!0),z.buffers.color.setmask(!0),z.setpolygonoffset(!1),f.pop(),p=f.length>0?f[f.length-1]:null,d=null}}else console.error("three.webglrenderer.render: camera is not an instance of three.camera.")},this.setframebuffer=function(t){g!==t&&null===m&&vt.bindframebuffer(36160,t),g=t},this.getactivecubeface=function(){return x},this.getactivemipmaplevel=function(){return _},this.getrenderlist=function(){return d},this.setrenderlist=function(t){d=t},this.getrendertarget=function(){return m},this.setrendertarget=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),m=t,x=e,_=n,t&&void 0===q.get(t).__webglframebuffer&&k.setuprendertarget(t);var r=g,i=!1;if(t){var a=q.get(t).__webglframebuffer;t.iswebglcuberendertarget?(r=a[e],i=!0):r=t.iswebglmultisamplerendertarget?q.get(t).__webglmultisampledframebuffer:a,l.copy(t.viewport),r.copy(t.scissor),c=t.scissortest}else l.copy(b).multiplyscalar(n).floor(),r.copy(z).multiplyscalar(n).floor(),c=f;if(s!==r&&(vt.bindframebuffer(36160,r),s=r),z.viewport(l),z.scissor(r),z.setscissortest(c),i){var o=q.get(t.texture);vt.framebuffertexture2d(36160,36064,34069+e,o.__webgltexture,n)}},this.readrendertargetpixels=function(t,e,n,r,i,a,o){if(t&&t.iswebglrendertarget){var s=q.get(t).__webglframebuffer;if(t.iswebglcuberendertarget&&void 0!==o&&(s=s[o]),s){var c=!1;s!==s&&(vt.bindframebuffer(36160,s),c=!0);try{var l=t.texture,u=l.format,h=l.type;if(u!==t&&ft.convert(u)!==vt.getparameter(35739))return void console.error("three.webglrenderer.readrendertargetpixels: rendertarget is not in rgba or implementation defined format.");if(!(h===y||ft.convert(h)===vt.getparameter(35738)||h===b&&(y.iswebgl2||x.get("oes_texture_float")||x.get("webgl_color_buffer_float"))||h===w&&(y.iswebgl2?x.get("ext_color_buffer_float"):x.get("ext_color_buffer_half_float"))))return void console.error("three.webglrenderer.readrendertargetpixels: rendertarget is not in unsignedbytetype or implementation defined type.");36053===vt.checkframebufferstatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-i&&vt.readpixels(e,n,r,i,ft.convert(u),ft.convert(h),a):console.error("three.webglrenderer.readrendertargetpixels: readpixels from rendertarget failed. framebuffer not complete.")}finally{c&&vt.bindframebuffer(36160,s)}}}else console.error("three.webglrenderer.readrendertargetpixels: rendertarget is not three.webglrendertarget.")},this.copyframebuffertotexture=function(t,e,n){void 0===n&&(n=0);var r=math.pow(2,-n),i=math.floor(e.image.width*r),a=math.floor(e.image.height*r),o=ft.convert(e.format);k.settexture2d(e,0),vt.copyteximage2d(3553,n,o,t.x,t.y,i,a,0),z.unbindtexture()},this.copytexturetotexture=function(t,e,n,r){void 0===r&&(r=0);var i=e.image.width,a=e.image.height,o=ft.convert(n.format),s=ft.convert(n.type);k.settexture2d(n,0),vt.pixelstorei(37440,n.flipy),vt.pixelstorei(37441,n.premultiplyalpha),vt.pixelstorei(3317,n.unpackalignment),e.isdatatexture?vt.texsubimage2d(3553,r,t.x,t.y,i,a,o,s,e.image.data):e.iscompressedtexture?vt.compressedtexsubimage2d(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):vt.texsubimage2d(3553,r,t.x,t.y,o,s,e.image),0===r&&n.generatemipmaps&&vt.generatemipmap(3553),z.unbindtexture()},this.inittexture=function(t){k.settexture2d(t,0),z.unbindtexture()},this.resetstate=function(){z.reset(),mt.reset()},"undefined"!=typeof __three_devtools__&&__three_devtools__.dispatchevent(new customevent("observe",{detail:this}))}function ca(t){sa.call(this,t)}na.prototype=object.assign(object.create(xn.prototype),{constructor:na,isarraycamera:!0}),ra.prototype=object.assign(object.create(we.prototype),{constructor:ra,isgroup:!0}),object.assign(ia.prototype,{constructor:ia,gethandspace:function(){if(null===this._hand&&(this._hand=new ra,this._hand.matrixautoupdate=!1,this._hand.visible=!1,this._hand.joints=[],this._hand.inputstate={pinching:!1},window.xrhand))for(var t=0;t<=window.xrhand.little_phalanx_tip;t++){var e=new ra;e.matrixautoupdate=!1,e.visible=!1,this._hand.joints.push(e),this._hand.add(e)}return this._hand},gettargetrayspace:function(){return null===this._targetray&&(this._targetray=new ra,this._targetray.matrixautoupdate=!1,this._targetray.visible=!1),this._targetray},getgripspace:function(){return null===this._grip&&(this._grip=new ra,this._grip.matrixautoupdate=!1,this._grip.visible=!1),this._grip},dispatchevent:function(t){return null!==this._targetray&&this._targetray.dispatchevent(t),null!==this._grip&&this._grip.dispatchevent(t),null!==this._hand&&this._hand.dispatchevent(t),this},disconnect:function(t){return this.dispatchevent({type:"disconnected",data:t}),null!==this._targetray&&(this._targetray.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(t,e,n){var r=null,i=null,a=null,o=this._targetray,s=this._grip,c=this._hand;if(t&&"visible-blurred"!==e.session.visibilitystate)if(c&&t.hand){a=!0;for(var l=0;l<=window.xrhand.little_phalanx_tip;l++)if(t.hand[l]){var u=e.getjointpose(t.hand[l],n),h=c.joints[l];null!==u&&(h.matrix.fromarray(u.transform.matrix),h.matrix.decompose(h.position,h.rotation,h.scale),h.jointradius=u.radius),h.visible=null!==u;var d=c.joints[window.xrhand.index_phalanx_tip],p=c.joints[window.xrhand.thumb_phalanx_tip],f=d.position.distanceto(p.position);c.inputstate.pinching&&f>.025?(c.inputstate.pinching=!1,this.dispatchevent({type:"pinchend",handedness:t.handedness,target:this})):!c.inputstate.pinching&&f<=.015&&(c.inputstate.pinching=!0,this.dispatchevent({type:"pinchstart",handedness:t.handedness,target:this}))}}else null!==o&&null!==(r=e.getpose(t.targetrayspace,n))&&(o.matrix.fromarray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==s&&t.gripspace&&null!==(i=e.getpose(t.gripspace,n))&&(s.matrix.fromarray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale));return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==c&&(c.visible=null!==a),this}}),object.assign(aa.prototype,rt.prototype),ca.prototype=object.assign(object.create(sa.prototype),{constructor:ca,iswebgl1renderer:!0});var la=function(){function t(t,e){object.defineproperty(this,"isfogexp2",{value:!0}),this.name="",this.color=new we(t),this.density=void 0!==e?e:25e-5}var e=t.prototype;return e.clone=function(){return new t(this.color,this.density)},e.tojson=function(){return{type:"fogexp2",color:this.color.gethex(),density:this.density}},t}(),ua=function(){function t(t,e,n){object.defineproperty(this,"isfog",{value:!0}),this.name="",this.color=new we(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}var e=t.prototype;return e.clone=function(){return new t(this.color,this.near,this.far)},e.tojson=function(){return{type:"fog",color:this.color.gethex(),near:this.near,far:this.far}},t}(),ha=function(t){function e(){var e;return e=t.call(this)||this,object.defineproperty(ht(e),"isscene",{value:!0}),e.type="scene",e.background=null,e.environment=null,e.fog=null,e.overridematerial=null,e.autoupdate=!0,"undefined"!=typeof __three_devtools__&&__three_devtools__.dispatchevent(new customevent("observe",{detail:ht(e)})),e}ut(e,t);var n=e.prototype;return n.copy=function(e,n){return t.prototype.copy.call(this,e,n),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overridematerial&&(this.overridematerial=e.overridematerial.clone()),this.autoupdate=e.autoupdate,this.matrixautoupdate=e.matrixautoupdate,this},n.tojson=function(e){var n=t.prototype.tojson.call(this,e);return null!==this.background&&(n.object.background=this.background.tojson(e)),null!==this.environment&&(n.object.environment=this.environment.tojson(e)),null!==this.fog&&(n.object.fog=this.fog.tojson()),n},e}(we);function da(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=tt,this.updaterange={offset:0,count:-1},this.version=0,this.uuid=st.generateuuid()}object.defineproperty(da.prototype,"needsupdate",{set:function(t){!0===t&&this.version++}}),object.assign(da.prototype,{isinterleavedbuffer:!0,onuploadcallback:function(){},setusage:function(t){return this.usage=t,this},copy:function(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this},copyat:function(t,e,n){t*=this.stride,n*=e.stride;for(var r=0,i=this.stride;r<i;r++)this.array[t+r]=e.array[n+r];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(t){void 0===t.arraybuffers&&(t.arraybuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=st.generateuuid()),void 0===t.arraybuffers[this.array.buffer._uuid]&&(t.arraybuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var e=new da(new this.array.constructor(t.arraybuffers[this.array.buffer._uuid]),this.stride);return e.setusage(this.usage),e},onupload:function(t){return this.onuploadcallback=t,this},tojson:function(t){return void 0===t.arraybuffers&&(t.arraybuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=st.generateuuid()),void 0===t.arraybuffers[this.array.buffer._uuid]&&(t.arraybuffers[this.array.buffer._uuid]=array.prototype.slice.call(new uint32array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var pa,fa=new mt;function ma(t,e,n,r){this.name="",this.data=t,this.itemsize=e,this.offset=n,this.normalized=!0===r}function va(t){xe.call(this),this.type="spritematerial",this.color=new we(16777215),this.map=null,this.alphamap=null,this.rotation=0,this.sizeattenuation=!0,this.transparent=!0,this.setvalues(t)}object.defineproperties(ma.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsupdate:{set:function(t){this.data.needsupdate=t}}}),object.assign(ma.prototype,{isinterleavedbufferattribute:!0,applymatrix4:function(t){for(var e=0,n=this.data.count;e<n;e++)fa.x=this.getx(e),fa.y=this.gety(e),fa.z=this.getz(e),fa.applymatrix4(t),this.setxyz(e,fa.x,fa.y,fa.z);return this},setx:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},sety:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setz:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setw:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getx:function(t){return this.data.array[t*this.data.stride+this.offset]},gety:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getz:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getw:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setxy:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setxyz:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setxyzw:function(t,e,n,r,i){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=i,this},clone:function(t){if(void 0===t){console.log("three.interleavedbufferattribute.clone(): cloning an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemsize;i++)e.push(this.data.array[r+i]);return new qe(new this.array.constructor(e),this.itemsize,this.normalized)}return void 0===t.interleavedbuffers&&(t.interleavedbuffers={}),void 0===t.interleavedbuffers[this.data.uuid]&&(t.interleavedbuffers[this.data.uuid]=this.data.clone(t)),new ma(t.interleavedbuffers[this.data.uuid],this.itemsize,this.offset,this.normalized)},tojson:function(t){if(void 0===t){console.log("three.interleavedbufferattribute.tojson(): serializing an interlaved buffer attribute will deinterleave buffer data.");for(var e=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemsize;i++)e.push(this.data.array[r+i]);return{itemsize:this.itemsize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===t.interleavedbuffers&&(t.interleavedbuffers={}),void 0===t.interleavedbuffers[this.data.uuid]&&(t.interleavedbuffers[this.data.uuid]=this.data.tojson(t)),{isinterleavedbufferattribute:!0,itemsize:this.itemsize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),va.prototype=object.create(xe.prototype),va.prototype.constructor=va,va.prototype.isspritematerial=!0,va.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphamap=t.alphamap,this.rotation=t.rotation,this.sizeattenuation=t.sizeattenuation,this};var ga=new mt,ya=new mt,xa=new mt,_a=new pt,ba=new pt,wa=new qt,ma=new mt,sa=new mt,ta=new mt,ea=new pt,aa=new pt,la=new pt;function ra(t){if(we.call(this),this.type="sprite",void 0===pa){pa=new _n;var e=new da(new float32array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);pa.setindex([0,1,2,0,2,3]),pa.setattribute("position",new ma(e,3,0,!1)),pa.setattribute("uv",new ma(e,2,3,!1))}this.geometry=pa,this.material=void 0!==t?t:new va,this.center=new pt(.5,.5)}function ca(t,e,n,r,i,a){_a.subvectors(t,n).addscalar(.5).multiply(r),void 0!==i?(ba.x=a*_a.x-i*_a.y,ba.y=i*_a.x+a*_a.y):ba.copy(_a),t.copy(e),t.x+=ba.x,t.y+=ba.y,t.applymatrix4(wa)}ra.prototype=object.assign(object.create(we.prototype),{constructor:ra,issprite:!0,raycast:function(t,e){null===t.camera&&console.error('three.sprite: "raycaster.camera" needs to be set in order to raycast against sprites.'),ya.setfrommatrixscale(this.matrixworld),wa.copy(t.camera.matrixworld),this.modelviewmatrix.multiplymatrices(t.camera.matrixworldinverse,this.matrixworld),xa.setfrommatrixposition(this.modelviewmatrix),t.camera.isperspectivecamera&&!1===this.material.sizeattenuation&&ya.multiplyscalar(-xa.z);var n,r,i=this.material.rotation;0!==i&&(r=math.cos(i),n=math.sin(i));var a=this.center;ca(ma.set(-.5,-.5,0),xa,a,ya,n,r),ca(sa.set(.5,-.5,0),xa,a,ya,n,r),ca(ta.set(.5,.5,0),xa,a,ya,n,r),ea.set(0,0),aa.set(1,0),la.set(1,1);var o=t.ray.intersecttriangle(ma,sa,ta,!1,ga);if(null!==o||(ca(sa.set(-.5,.5,0),xa,a,ya,n,r),aa.set(0,1),null!==(o=t.ray.intersecttriangle(ma,ta,sa,!1,ga)))){var s=t.ray.origin.distanceto(ga);s<t.near||s>t.far||e.push({distance:s,point:ga.clone(),uv:ze.getuv(ga,ma,sa,ta,ea,aa,la,new pt),face:null,object:this})}},copy:function(t){return we.prototype.copy.call(this,t),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}});var pa=new mt,ia=new mt;function na(){we.call(this),this._currentlevel=0,this.type="lod",object.defineproperties(this,{levels:{enumerable:!0,value:[]}}),this.autoupdate=!0}na.prototype=object.assign(object.create(we.prototype),{constructor:na,islod:!0,copy:function(t){we.prototype.copy.call(this,t,!1);for(var e=t.levels,n=0,r=e.length;n<r;n++){var i=e[n];this.addlevel(i.object.clone(),i.distance)}return this.autoupdate=t.autoupdate,this},addlevel:function(t,e){void 0===e&&(e=0),e=math.abs(e);var n,r=this.levels;for(n=0;n<r.length&&!(e<r[n].distance);n++);return r.splice(n,0,{distance:e,object:t}),this.add(t),this},getcurrentlevel:function(){return this._currentlevel},getobjectfordistance:function(t){var e=this.levels;if(e.length>0){var n,r;for(n=1,r=e.length;n<r&&!(t<e[n].distance);n++);return e[n-1].object}return null},raycast:function(t,e){if(this.levels.length>0){pa.setfrommatrixposition(this.matrixworld);var n=t.ray.origin.distanceto(pa);this.getobjectfordistance(n).raycast(t,e)}},update:function(t){var e=this.levels;if(e.length>1){pa.setfrommatrixposition(t.matrixworld),ia.setfrommatrixposition(this.matrixworld);var n,r,i=pa.distanceto(ia)/t.zoom;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentlevel=n-1;n<r;n++)e[n].object.visible=!1}},tojson:function(t){var e=we.prototype.tojson.call(this,t);!1===this.autoupdate&&(e.object.autoupdate=!1),e.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var a=n[r];e.object.levels.push({object:a.object.uuid,distance:a.distance})}return e}});var da=new mt,oa=new xt,ba=new xt,za=new mt,fa=new qt;function ga(t,e){t&&t.isgeometry&&console.error("three.skinnedmesh no longer supports three.geometry. use three.buffergeometry instead."),fn.call(this,t,e),this.type="skinnedmesh",this.bindmode="attached",this.bindmatrix=new qt,this.bindmatrixinverse=new qt}function ua(){we.call(this),this.type="bone"}ga.prototype=object.assign(object.create(fn.prototype),{constructor:ga,isskinnedmesh:!0,copy:function(t){return fn.prototype.copy.call(this,t),this.bindmode=t.bindmode,this.bindmatrix.copy(t.bindmatrix),this.bindmatrixinverse.copy(t.bindmatrixinverse),this.skeleton=t.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updatematrixworld(!0),this.skeleton.calculateinverses(),e=this.matrixworld),this.bindmatrix.copy(e),this.bindmatrixinverse.copy(e).invert()},pose:function(){this.skeleton.pose()},normalizeskinweights:function(){for(var t=new xt,e=this.geometry.attributes.skinweight,n=0,r=e.count;n<r;n++){t.x=e.getx(n),t.y=e.gety(n),t.z=e.getz(n),t.w=e.getw(n);var i=1/t.manhattanlength();i!==1/0?t.multiplyscalar(i):t.set(1,0,0,0),e.setxyzw(n,t.x,t.y,t.z,t.w)}},updatematrixworld:function(t){fn.prototype.updatematrixworld.call(this,t),"attached"===this.bindmode?this.bindmatrixinverse.copy(this.matrixworld).invert():"detached"===this.bindmode?this.bindmatrixinverse.copy(this.bindmatrix).invert():console.warn("three.skinnedmesh: unrecognized bindmode: "+this.bindmode)},bonetransform:function(t,e){var n=this.skeleton,r=this.geometry;oa.frombufferattribute(r.attributes.skinindex,t),ba.frombufferattribute(r.attributes.skinweight,t),da.frombufferattribute(r.attributes.position,t).applymatrix4(this.bindmatrix),e.set(0,0,0);for(var i=0;i<4;i++){var a=ba.getcomponent(i);if(0!==a){var o=oa.getcomponent(i);fa.multiplymatrices(n.bones[o].matrixworld,n.boneinverses[o]),e.addscaledvector(za.copy(da).applymatrix4(fa),a)}}return e.applymatrix4(this.bindmatrixinverse)}}),ua.prototype=object.assign(object.create(we.prototype),{constructor:ua,isbone:!0});var ha=new qt,ka=new qt;function va(t,e){void 0===t&&(t=[]),void 0===e&&(e=[]),this.uuid=st.generateuuid(),this.bones=t.slice(0),this.boneinverses=e,this.bonematrices=null,this.bonetexture=null,this.bonetexturesize=0,this.frame=-1,this.init()}object.assign(va.prototype,{init:function(){var t=this.bones,e=this.boneinverses;if(this.bonematrices=new float32array(16*t.length),0===e.length)this.calculateinverses();else if(t.length!==e.length){console.warn("three.skeleton: number of inverse bone matrices does not match amount of bones."),this.boneinverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneinverses.push(new qt)}},calculateinverses:function(){this.boneinverses.length=0;for(var t=0,e=this.bones.length;t<e;t++){var n=new qt;this.bones[t]&&n.copy(this.bones[t].matrixworld).invert(),this.boneinverses.push(n)}},pose:function(){for(var t=0,e=this.bones.length;t<e;t++){var n=this.bones[t];n&&n.matrixworld.copy(this.boneinverses[t]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var a=this.bones[r];a&&(a.parent&&a.parent.isbone?(a.matrix.copy(a.parent.matrixworld).invert(),a.matrix.multiply(a.matrixworld)):a.matrix.copy(a.matrixworld),a.matrix.decompose(a.position,a.quaternion,a.scale))}},update:function(){for(var t=this.bones,e=this.boneinverses,n=this.bonematrices,r=this.bonetexture,i=0,a=t.length;i<a;i++){var o=t[i]?t[i].matrixworld:ka;ha.multiplymatrices(o,e[i]),ha.toarray(n,16*i)}null!==r&&(r.needsupdate=!0)},clone:function(){return new va(this.bones,this.boneinverses)},getbonebyname:function(t){for(var e=0,n=this.bones.length;e<n;e++){var r=this.bones[e];if(r.name===t)return r}},dispose:function(){null!==this.bonetexture&&(this.bonetexture.dispose(),this.bonetexture=null)},fromjson:function(t,e){this.uuid=t.uuid;for(var n=0,r=t.bones.length;n<r;n++){var i=t.bones[n],a=e[i];void 0===a&&(console.warn("three.skeleton: no bone found with uuid:",i),a=new ua),this.bones.push(a),this.boneinverses.push((new qt).fromarray(t.boneinverses[n]))}return this.init(),this},tojson:function(){var t={metadata:{version:4.5,type:"skeleton",generator:"skeleton.tojson"},bones:[],boneinverses:[]};t.uuid=this.uuid;for(var e=this.bones,n=this.boneinverses,r=0,i=e.length;r<i;r++){var a=e[r];t.bones.push(a.uuid);var o=n[r];t.boneinverses.push(o.toarray())}return t}});var wa=new qt,ja=new qt,qa=[],xa=new fn;function ya(t,e,n){fn.call(this,t,e),this.instancematrix=new qe(new float32array(16*n),16),this.instancecolor=null,this.count=n,this.frustumculled=!1}function za(t){xe.call(this),this.type="linebasicmaterial",this.color=new we(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphtargets=!1,this.setvalues(t)}ya.prototype=object.assign(object.create(fn.prototype),{constructor:ya,isinstancedmesh:!0,copy:function(t){return fn.prototype.copy.call(this,t),this.instancematrix.copy(t.instancematrix),this.count=t.count,this},getcolorat:function(t,e){e.fromarray(this.instancecolor.array,3*t)},getmatrixat:function(t,e){e.fromarray(this.instancematrix.array,16*t)},raycast:function(t,e){var n=this.matrixworld,r=this.count;if(xa.geometry=this.geometry,xa.material=this.material,void 0!==xa.material)for(var i=0;i<r;i++){this.getmatrixat(i,wa),ja.multiplymatrices(n,wa),xa.matrixworld=ja,xa.raycast(t,qa);for(var a=0,o=qa.length;a<o;a++){var s=qa[a];s.instanceid=i,s.object=this,e.push(s)}qa.length=0}},setcolorat:function(t,e){null===this.instancecolor&&(this.instancecolor=new qe(new float32array(3*this.count),3)),e.toarray(this.instancecolor.array,3*t)},setmatrixat:function(t,e){e.toarray(this.instancematrix.array,16*t)},updatemorphtargets:function(){},dispose:function(){this.dispatchevent({type:"dispose"})}}),za.prototype=object.create(xe.prototype),za.prototype.constructor=za,za.prototype.islinebasicmaterial=!0,za.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.morphtargets=t.morphtargets,this};var ja=new mt,qa=new mt,ka=new qt,$a=new jt,to=new kt;function eo(t,e){void 0===t&&(t=new _n),void 0===e&&(e=new za),we.call(this),this.type="line",this.geometry=t,this.material=e,this.updatemorphtargets()}eo.prototype=object.assign(object.create(we.prototype),{constructor:eo,isline:!0,copy:function(t){return we.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},computelinedistances:function(){var t=this.geometry;if(t.isbuffergeometry)if(null===t.index){for(var e=t.attributes.position,n=[0],r=1,i=e.count;r<i;r++)ja.frombufferattribute(e,r-1),qa.frombufferattribute(e,r),n[r]=n[r-1],n[r]+=ja.distanceto(qa);t.setattribute("linedistance",new sn(n,1))}else console.warn("three.line.computelinedistances(): computation only possible with non-indexed buffergeometry.");else if(t.isgeometry){var a=t.vertices,o=t.linedistances;o[0]=0;for(var s=1,c=a.length;s<c;s++)o[s]=o[s-1],o[s]+=a[s-1].distanceto(a[s])}return this},raycast:function(t,e){var n=this.geometry,r=this.matrixworld,i=t.params.line.threshold;if(null===n.boundingsphere&&n.computeboundingsphere(),to.copy(n.boundingsphere),to.applymatrix4(r),to.radius+=i,!1!==t.ray.intersectssphere(to)){ka.copy(r).invert(),$a.copy(t.ray).applymatrix4(ka);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new mt,c=new mt,l=new mt,u=new mt,h=this.islinesegments?2:1;if(n.isbuffergeometry){var d=n.index,p=n.attributes.position;if(null!==d)for(var f=d.array,m=0,v=f.length-1;m<v;m+=h){var g=f[m],y=f[m+1];if(s.frombufferattribute(p,g),c.frombufferattribute(p,y),!($a.distancesqtosegment(s,c,u,l)>o)){u.applymatrix4(this.matrixworld);var x=t.ray.origin.distanceto(u);x<t.near||x>t.far||e.push({distance:x,point:l.clone().applymatrix4(this.matrixworld),index:m,face:null,faceindex:null,object:this})}}else for(var _=0,b=p.count-1;_<b;_+=h){if(s.frombufferattribute(p,_),c.frombufferattribute(p,_+1),!($a.distancesqtosegment(s,c,u,l)>o)){u.applymatrix4(this.matrixworld);var w=t.ray.origin.distanceto(u);w<t.near||w>t.far||e.push({distance:w,point:l.clone().applymatrix4(this.matrixworld),index:_,face:null,faceindex:null,object:this})}}}else if(n.isgeometry)for(var m=n.vertices,s=m.length,t=0;t<s-1;t+=h){if(!($a.distancesqtosegment(m[t],m[t+1],u,l)>o)){u.applymatrix4(this.matrixworld);var e=t.ray.origin.distanceto(u);e<t.near||e>t.far||e.push({distance:e,point:l.clone().applymatrix4(this.matrixworld),index:t,face:null,faceindex:null,object:this})}}}},updatemorphtargets:function(){var t=this.geometry;if(t.isbuffergeometry){var e=t.morphattributes,n=object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphtargetinfluences=[],this.morphtargetdictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||string(i);this.morphtargetinfluences.push(0),this.morphtargetdictionary[o]=i}}}}else{var s=t.morphtargets;void 0!==s&&s.length>0&&console.error("three.line.updatemorphtargets() does not support three.geometry. use three.buffergeometry instead.")}}});var no=new mt,ro=new mt;function io(t,e){eo.call(this,t,e),this.type="linesegments"}function ao(t,e){eo.call(this,t,e),this.type="lineloop"}function oo(t){xe.call(this),this.type="pointsmaterial",this.color=new we(16777215),this.map=null,this.alphamap=null,this.size=1,this.sizeattenuation=!0,this.morphtargets=!1,this.setvalues(t)}io.prototype=object.assign(object.create(eo.prototype),{constructor:io,islinesegments:!0,computelinedistances:function(){var t=this.geometry;if(t.isbuffergeometry)if(null===t.index){for(var e=t.attributes.position,n=[],r=0,i=e.count;r<i;r+=2)no.frombufferattribute(e,r),ro.frombufferattribute(e,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+no.distanceto(ro);t.setattribute("linedistance",new sn(n,1))}else console.warn("three.linesegments.computelinedistances(): computation only possible with non-indexed buffergeometry.");else if(t.isgeometry)for(var a=t.vertices,o=t.linedistances,s=0,c=a.length;s<c;s+=2)no.copy(a[s]),ro.copy(a[s+1]),o[s]=0===s?0:o[s-1],o[s+1]=o[s]+no.distanceto(ro);return this}}),ao.prototype=object.assign(object.create(eo.prototype),{constructor:ao,islineloop:!0}),oo.prototype=object.create(xe.prototype),oo.prototype.constructor=oo,oo.prototype.ispointsmaterial=!0,oo.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.alphamap=t.alphamap,this.size=t.size,this.sizeattenuation=t.sizeattenuation,this.morphtargets=t.morphtargets,this};var so=new qt,co=new jt,lo=new kt,uo=new mt;function ho(t,e){void 0===t&&(t=new _n),void 0===e&&(e=new oo),we.call(this),this.type="points",this.geometry=t,this.material=e,this.updatemorphtargets()}function po(t,e,n,r,i,a,o){var s=co.distancesqtopoint(t);if(s<n){var c=new mt;co.closestpointtopoint(t,c),c.applymatrix4(r);var l=i.ray.origin.distanceto(c);if(l<i.near||l>i.far)return;a.push({distance:l,distancetoray:math.sqrt(s),point:c,index:e,face:null,object:o})}}function fo(t,e,n,r,i,a,o,s,c){gt.call(this,t,e,n,r,i,a,o,s,c),this.format=void 0!==o?o:s,this.minfilter=void 0!==a?a:m,this.magfilter=void 0!==i?i:m,this.generatemipmaps=!1;var l=this;"requestvideoframecallback"in t&&t.requestvideoframecallback((function e(){l.needsupdate=!0,t.requestvideoframecallback(e)}))}function mo(t,e,n,r,i,a,o,s,c,l,u,h){gt.call(this,null,a,o,s,c,l,r,i,u,h),this.image={width:e,height:n},this.mipmaps=t,this.flipy=!1,this.generatemipmaps=!1}function vo(t,e,n,r,i,a,o,s,c){gt.call(this,t,e,n,r,i,a,o,s,c),this.needsupdate=!0}function go(t,e,n,r,i,a,o,s,c,l){if((l=void 0!==l?l:e)!==e&&l!==a)throw new error("depthtexture format must be either three.depthformat or three.depthstencilformat");void 0===n&&l===e&&(n=x),void 0===n&&l===a&&(n=m),gt.call(this,null,r,i,a,o,s,l,n,c),this.image={width:t,height:e},this.magfilter=void 0!==o?o:d,this.minfilter=void 0!==s?s:d,this.flipy=!1,this.generatemipmaps=!1}ho.prototype=object.assign(object.create(we.prototype),{constructor:ho,ispoints:!0,copy:function(t){return we.prototype.copy.call(this,t),this.material=t.material,this.geometry=t.geometry,this},raycast:function(t,e){var n=this.geometry,r=this.matrixworld,i=t.params.points.threshold;if(null===n.boundingsphere&&n.computeboundingsphere(),lo.copy(n.boundingsphere),lo.applymatrix4(r),lo.radius+=i,!1!==t.ray.intersectssphere(lo)){so.copy(r).invert(),co.copy(t.ray).applymatrix4(so);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(n.isbuffergeometry){var s=n.index,c=n.attributes.position;if(null!==s)for(var l=s.array,u=0,h=l.length;u<h;u++){var d=l[u];uo.frombufferattribute(c,d),po(uo,d,o,r,t,e,this)}else for(var p=0,f=c.count;p<f;p++)uo.frombufferattribute(c,p),po(uo,p,o,r,t,e,this)}else for(var m=n.vertices,v=0,g=m.length;v<g;v++)po(m[v],v,o,r,t,e,this)}},updatemorphtargets:function(){var t=this.geometry;if(t.isbuffergeometry){var e=t.morphattributes,n=object.keys(e);if(n.length>0){var r=e[n[0]];if(void 0!==r){this.morphtargetinfluences=[],this.morphtargetdictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||string(i);this.morphtargetinfluences.push(0),this.morphtargetdictionary[o]=i}}}}else{var s=t.morphtargets;void 0!==s&&s.length>0&&console.error("three.points.updatemorphtargets() does not support three.geometry. use three.buffergeometry instead.")}}}),fo.prototype=object.assign(object.create(gt.prototype),{constructor:fo,clone:function(){return new this.constructor(this.image).copy(this)},isvideotexture:!0,update:function(){var t=this.image;!1==="requestvideoframecallback"in t&&t.readystate>=t.have_current_data&&(this.needsupdate=!0)}}),mo.prototype=object.create(gt.prototype),mo.prototype.constructor=mo,mo.prototype.iscompressedtexture=!0,vo.prototype=object.create(gt.prototype),vo.prototype.constructor=vo,vo.prototype.iscanvastexture=!0,go.prototype=object.create(gt.prototype),go.prototype.constructor=go,go.prototype.isdepthtexture=!0;var yo=0,xo=new qt,_o=new we,bo=new mt;function wo(){object.defineproperty(this,"id",{value:yo+=2}),this.uuid=st.generateuuid(),this.name="",this.type="geometry",this.vertices=[],this.colors=[],this.faces=[],this.facevertexuvs=[[]],this.morphtargets=[],this.morphnormals=[],this.skinweights=[],this.skinindices=[],this.linedistances=[],this.boundingbox=null,this.boundingsphere=null,this.elementsneedupdate=!1,this.verticesneedupdate=!1,this.uvsneedupdate=!1,this.normalsneedupdate=!1,this.colorsneedupdate=!1,this.linedistancesneedupdate=!1,this.groupsneedupdate=!1}wo.prototype=object.assign(object.create(rt.prototype),{constructor:wo,isgeometry:!0,applymatrix4:function(t){for(var e=(new ft).getnormalmatrix(t),n=0,r=this.vertices.length;n<r;n++){this.vertices[n].applymatrix4(t)}for(var i=0,a=this.faces.length;i<a;i++){var o=this.faces[i];o.normal.applymatrix3(e).normalize();for(var s=0,c=o.vertexnormals.length;s<c;s++)o.vertexnormals[s].applymatrix3(e).normalize()}return null!==this.boundingbox&&this.computeboundingbox(),null!==this.boundingsphere&&this.computeboundingsphere(),this.verticesneedupdate=!0,this.normalsneedupdate=!0,this},rotatex:function(t){return xo.makerotationx(t),this.applymatrix4(xo),this},rotatey:function(t){return xo.makerotationy(t),this.applymatrix4(xo),this},rotatez:function(t){return xo.makerotationz(t),this.applymatrix4(xo),this},translate:function(t,e,n){return xo.maketranslation(t,e,n),this.applymatrix4(xo),this},scale:function(t,e,n){return xo.makescale(t,e,n),this.applymatrix4(xo),this},lookat:function(t){return _o.lookat(t),_o.updatematrix(),this.applymatrix4(_o.matrix),this},frombuffergeometry:function(t){var e=this,n=null!==t.index?t.index:void 0,r=t.attributes;if(void 0===r.position)return console.error("three.geometry.frombuffergeometry(): position attribute required for conversion."),this;var i=r.position,a=r.normal,o=r.color,s=r.uv,c=r.uv2;void 0!==c&&(this.facevertexuvs[1]=[]);for(var l=0;l<i.count;l++)e.vertices.push((new mt).frombufferattribute(i,l)),void 0!==o&&e.colors.push((new we).frombufferattribute(o,l));function u(t,n,r,i){var l=void 0===o?[]:[e.colors[t].clone(),e.colors[n].clone(),e.colors[r].clone()],u=void 0===a?[]:[(new mt).frombufferattribute(a,t),(new mt).frombufferattribute(a,n),(new mt).frombufferattribute(a,r)],h=new je(t,n,r,u,l,i);e.faces.push(h),void 0!==s&&e.facevertexuvs[0].push([(new pt).frombufferattribute(s,t),(new pt).frombufferattribute(s,n),(new pt).frombufferattribute(s,r)]),void 0!==c&&e.facevertexuvs[1].push([(new pt).frombufferattribute(c,t),(new pt).frombufferattribute(c,n),(new pt).frombufferattribute(c,r)])}var h=t.groups;if(h.length>0)for(var d=0;d<h.length;d++)for(var p=h[d],f=p.start,m=f,v=f+p.count;m<v;m+=3)void 0!==n?u(n.getx(m),n.getx(m+1),n.getx(m+2),p.materialindex):u(m,m+1,m+2,p.materialindex);else if(void 0!==n)for(var g=0;g<n.count;g+=3)u(n.getx(g),n.getx(g+1),n.getx(g+2));else for(var y=0;y<i.count;y+=3)u(y,y+1,y+2);return this.computefacenormals(),null!==t.boundingbox&&(this.boundingbox=t.boundingbox.clone()),null!==t.boundingsphere&&(this.boundingsphere=t.boundingsphere.clone()),this},center:function(){return this.computeboundingbox(),this.boundingbox.getcenter(bo).negate(),this.translate(bo.x,bo.y,bo.z),this},normalize:function(){this.computeboundingsphere();var t=this.boundingsphere.center,e=this.boundingsphere.radius,n=0===e?1:1/e,r=new qt;return r.set(n,0,0,-n*t.x,0,n,0,-n*t.y,0,0,n,-n*t.z,0,0,0,1),this.applymatrix4(r),this},computefacenormals:function(){for(var t=new mt,e=new mt,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],a=this.vertices[i.a],o=this.vertices[i.b],s=this.vertices[i.c];t.subvectors(s,o),e.subvectors(a,o),t.cross(e),t.normalize(),i.normal.copy(t)}},computevertexnormals:function(t){void 0===t&&(t=!0);for(var e=new array(this.vertices.length),n=0,r=this.vertices.length;n<r;n++)e[n]=new mt;if(t)for(var i=new mt,a=new mt,o=0,s=this.faces.length;o<s;o++){var c=this.faces[o],l=this.vertices[c.a],u=this.vertices[c.b],h=this.vertices[c.c];i.subvectors(h,u),a.subvectors(l,u),i.cross(a),e[c.a].add(i),e[c.b].add(i),e[c.c].add(i)}else{this.computefacenormals();for(var d=0,p=this.faces.length;d<p;d++){var f=this.faces[d];e[f.a].add(f.normal),e[f.b].add(f.normal),e[f.c].add(f.normal)}}for(var m=0,v=this.vertices.length;m<v;m++)e[m].normalize();for(var g=0,y=this.faces.length;g<y;g++){var x=this.faces[g],_=x.vertexnormals;3===_.length?(_[0].copy(e[x.a]),_[1].copy(e[x.b]),_[2].copy(e[x.c])):(_[0]=e[x.a].clone(),_[1]=e[x.b].clone(),_[2]=e[x.c].clone())}this.faces.length>0&&(this.normalsneedupdate=!0)},computeflatvertexnormals:function(){this.computefacenormals();for(var t=0,e=this.faces.length;t<e;t++){var n=this.faces[t],r=n.vertexnormals;3===r.length?(r[0].copy(n.normal),r[1].copy(n.normal),r[2].copy(n.normal)):(r[0]=n.normal.clone(),r[1]=n.normal.clone(),r[2]=n.normal.clone())}this.faces.length>0&&(this.normalsneedupdate=!0)},computemorphnormals:function(){for(var t=0,e=this.faces.length;t<e;t++){var n=this.faces[t];n.__originalfacenormal?n.__originalfacenormal.copy(n.normal):n.__originalfacenormal=n.normal.clone(),n.__originalvertexnormals||(n.__originalvertexnormals=[]);for(var r=0,i=n.vertexnormals.length;r<i;r++)n.__originalvertexnormals[r]?n.__originalvertexnormals[r].copy(n.vertexnormals[r]):n.__originalvertexnormals[r]=n.vertexnormals[r].clone()}var a=new wo;a.faces=this.faces;for(var o=0,s=this.morphtargets.length;o<s;o++){if(!this.morphnormals[o]){this.morphnormals[o]={},this.morphnormals[o].facenormals=[],this.morphnormals[o].vertexnormals=[];for(var c=this.morphnormals[o].facenormals,l=this.morphnormals[o].vertexnormals,u=0,h=this.faces.length;u<h;u++){var d=new mt,p={a:new mt,b:new mt,c:new mt};c.push(d),l.push(p)}}var f=this.morphnormals[o];a.vertices=this.morphtargets[o].vertices,a.computefacenormals(),a.computevertexnormals();for(var m=0,v=this.faces.length;m<v;m++){var g=this.faces[m],y=f.facenormals[m],x=f.vertexnormals[m];y.copy(g.normal),x.a.copy(g.vertexnormals[0]),x.b.copy(g.vertexnormals[1]),x.c.copy(g.vertexnormals[2])}}for(var _=0,b=this.faces.length;_<b;_++){var w=this.faces[_];w.normal=w.__originalfacenormal,w.vertexnormals=w.__originalvertexnormals}},computeboundingbox:function(){null===this.boundingbox&&(this.boundingbox=new et),this.boundingbox.setfrompoints(this.vertices)},computeboundingsphere:function(){null===this.boundingsphere&&(this.boundingsphere=new kt),this.boundingsphere.setfrompoints(this.vertices)},merge:function(t,e,n){if(void 0===n&&(n=0),t&&t.isgeometry){var r,i=this.vertices.length,a=this.vertices,o=t.vertices,s=this.faces,c=t.faces,l=this.colors,u=t.colors;void 0!==e&&(r=(new ft).getnormalmatrix(e));for(var h=0,d=o.length;h<d;h++){var p=o[h].clone();void 0!==e&&p.applymatrix4(e),a.push(p)}for(var f=0,m=u.length;f<m;f++)l.push(u[f].clone());for(var v=0,g=c.length;v<g;v++){var y=c[v],x=void 0,_=void 0,b=y.vertexnormals,w=y.vertexcolors,m=new je(y.a+i,y.b+i,y.c+i);m.normal.copy(y.normal),void 0!==r&&m.normal.applymatrix3(r).normalize();for(var s=0,t=b.length;s<t;s++)x=b[s].clone(),void 0!==r&&x.applymatrix3(r).normalize(),m.vertexnormals.push(x);m.color.copy(y.color);for(var e=0,a=w.length;e<a;e++)_=w[e],m.vertexcolors.push(_.clone());m.materialindex=y.materialindex+n,s.push(m)}for(var l=0,r=t.facevertexuvs.length;l<r;l++){var c=t.facevertexuvs[l];void 0===this.facevertexuvs[l]&&(this.facevertexuvs[l]=[]);for(var p=0,i=c.length;p<i;p++){for(var n=c[p],d=[],o=0,b=n.length;o<b;o++)d.push(n[o].clone());this.facevertexuvs[l].push(d)}}}else console.error("three.geometry.merge(): geometry not an instance of three.geometry.",t)},mergemesh:function(t){t&&t.ismesh?(t.matrixautoupdate&&t.updatematrix(),this.merge(t.geometry,t.matrix)):console.error("three.geometry.mergemesh(): mesh not an instance of three.mesh.",t)},mergevertices:function(t){void 0===t&&(t=4);for(var e={},n=[],r=[],i=math.pow(10,t),a=0,o=this.vertices.length;a<o;a++){var s=this.vertices[a],c=math.round(s.x*i)+"_"+math.round(s.y*i)+"_"+math.round(s.z*i);void 0===e[c]?(e[c]=a,n.push(this.vertices[a]),r[a]=n.length-1):r[a]=r[e[c]]}for(var l=[],u=0,h=this.faces.length;u<h;u++){var d=this.faces[u];d.a=r[d.a],d.b=r[d.b],d.c=r[d.c];for(var p=[d.a,d.b,d.c],f=0;f<3;f++)if(p[f]===p[(f+1)%3]){l.push(u);break}}for(var m=l.length-1;m>=0;m--){var v=l[m];this.faces.splice(v,1);for(var g=0,y=this.facevertexuvs.length;g<y;g++)this.facevertexuvs[g].splice(v,1)}var x=this.vertices.length-n.length;return this.vertices=n,x},setfrompoints:function(t){this.vertices=[];for(var e=0,n=t.length;e<n;e++){var r=t[e];this.vertices.push(new mt(r.x,r.y,r.z||0))}return this},sortfacesbymaterialindex:function(){for(var t=this.faces,e=t.length,n=0;n<e;n++)t[n]._id=n;t.sort((function(t,e){return t.materialindex-e.materialindex}));var r,i,a=this.facevertexuvs[0],o=this.facevertexuvs[1];a&&a.length===e&&(r=[]),o&&o.length===e&&(i=[]);for(var s=0;s<e;s++){var c=t[s]._id;r&&r.push(a[c]),i&&i.push(o[c])}r&&(this.facevertexuvs[0]=r),i&&(this.facevertexuvs[1]=i)},tojson:function(){var t={metadata:{version:4.5,type:"geometry",generator:"geometry.tojson"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),void 0!==this.parameters){var e=this.parameters;for(var n in e)void 0!==e[n]&&(t[n]=e[n]);return t}for(var r=[],i=0;i<this.vertices.length;i++){var a=this.vertices[i];r.push(a.x,a.y,a.z)}for(var o=[],s=[],c={},l=[],u={},h=[],d={},p=0;p<this.faces.length;p++){var f=this.faces[p],m=void 0!==this.facevertexuvs[0][p],v=f.normal.length()>0,g=f.vertexnormals.length>0,y=1!==f.color.r||1!==f.color.g||1!==f.color.b,x=f.vertexcolors.length>0,_=0;if(_=s(_,0,0),_=s(_,1,!0),_=s(_,2,!1),_=s(_,3,m),_=s(_,4,v),_=s(_,5,g),_=s(_,6,y),_=s(_,7,x),o.push(_),o.push(f.a,f.b,f.c),o.push(f.materialindex),m){var b=this.facevertexuvs[0][p];o.push(a(b[0]),a(b[1]),a(b[2]))}if(v&&o.push(t(f.normal)),g){var w=f.vertexnormals;o.push(t(w[0]),t(w[1]),t(w[2]))}if(y&&o.push(e(f.color)),x){var m=f.vertexcolors;o.push(e(m[0]),e(m[1]),e(m[2]))}}function s(t,e,n){return n?t|1<<e:t&~(1<<e)}function t(t){var e=t.x.tostring()+t.y.tostring()+t.z.tostring();return void 0!==c[e]||(c[e]=s.length/3,s.push(t.x,t.y,t.z)),c[e]}function e(t){var e=t.r.tostring()+t.g.tostring()+t.b.tostring();return void 0!==u[e]||(u[e]=l.length,l.push(t.gethex())),u[e]}function a(t){var e=t.x.tostring()+t.y.tostring();return void 0!==d[e]||(d[e]=h.length/2,h.push(t.x,t.y)),d[e]}return t.data={},t.data.vertices=r,t.data.normals=s,l.length>0&&(t.data.colors=l),h.length>0&&(t.data.uvs=[h]),t.data.faces=o,t},clone:function(){return(new wo).copy(this)},copy:function(t){this.vertices=[],this.colors=[],this.faces=[],this.facevertexuvs=[[]],this.morphtargets=[],this.morphnormals=[],this.skinweights=[],this.skinindices=[],this.linedistances=[],this.boundingbox=null,this.boundingsphere=null,this.name=t.name;for(var e=t.vertices,n=0,r=e.length;n<r;n++)this.vertices.push(e[n].clone());for(var i=t.colors,a=0,o=i.length;a<o;a++)this.colors.push(i[a].clone());for(var s=t.faces,c=0,l=s.length;c<l;c++)this.faces.push(s[c].clone());for(var u=0,h=t.facevertexuvs.length;u<h;u++){var d=t.facevertexuvs[u];void 0===this.facevertexuvs[u]&&(this.facevertexuvs[u]=[]);for(var p=0,f=d.length;p<f;p++){for(var m=d[p],v=[],g=0,y=m.length;g<y;g++){var x=m[g];v.push(x.clone())}this.facevertexuvs[u].push(v)}}for(var _=t.morphtargets,b=0,w=_.length;b<w;b++){var m={};if(m.name=_[b].name,void 0!==_[b].vertices){m.vertices=[];for(var s=0,t=_[b].vertices.length;s<t;s++)m.vertices.push(_[b].vertices[s].clone())}if(void 0!==_[b].normals){m.normals=[];for(var e=0,a=_[b].normals.length;e<a;e++)m.normals.push(_[b].normals[e].clone())}this.morphtargets.push(m)}for(var l=t.morphnormals,r=0,c=l.length;r<c;r++){var p={};if(void 0!==l[r].vertexnormals){p.vertexnormals=[];for(var i=0,n=l[r].vertexnormals.length;i<n;i++){var d=l[r].vertexnormals[i],o={};o.a=d.a.clone(),o.b=d.b.clone(),o.c=d.c.clone(),p.vertexnormals.push(o)}}if(void 0!==l[r].facenormals){p.facenormals=[];for(var b=0,z=l[r].facenormals.length;b<z;b++)p.facenormals.push(l[r].facenormals[b].clone())}this.morphnormals.push(p)}for(var f=t.skinweights,g=0,u=f.length;g<u;g++)this.skinweights.push(f[g].clone());for(var h=t.skinindices,k=0,v=h.length;k<v;k++)this.skinindices.push(h[k].clone());for(var w=t.linedistances,j=0,q=w.length;j<q;j++)this.linedistances.push(w[j]);var x=t.boundingbox;null!==x&&(this.boundingbox=x.clone());var y=t.boundingsphere;return null!==y&&(this.boundingsphere=y.clone()),this.elementsneedupdate=t.elementsneedupdate,this.verticesneedupdate=t.verticesneedupdate,this.uvsneedupdate=t.uvsneedupdate,this.normalsneedupdate=t.normalsneedupdate,this.colorsneedupdate=t.colorsneedupdate,this.linedistancesneedupdate=t.linedistancesneedupdate,this.groupsneedupdate=t.groupsneedupdate,this},dispose:function(){this.dispatchevent({type:"dispose"})}});var mo=function(t){function e(e,n,r,i,a,o){var s;return(s=t.call(this)||this).type="boxgeometry",s.parameters={width:e,height:n,depth:r,widthsegments:i,heightsegments:a,depthsegments:o},s.frombuffergeometry(new hn(e,n,r,i,a,o)),s.mergevertices(),s}return ut(e,t),e}(wo),so=function(t){function e(e,n,r,i){var a;void 0===e&&(e=1),void 0===n&&(n=8),void 0===r&&(r=0),void 0===i&&(i=2*math.pi),(a=t.call(this)||this).type="circlebuffergeometry",a.parameters={radius:e,segments:n,thetastart:r,thetalength:i},n=math.max(3,n);var o=[],s=[],c=[],l=[],u=new mt,h=new pt;s.push(0,0,0),c.push(0,0,1),l.push(.5,.5);for(var d=0,p=3;d<=n;d++,p+=3){var f=r+d/n*i;u.x=e*math.cos(f),u.y=e*math.sin(f),s.push(u.x,u.y,u.z),c.push(0,0,1),h.x=(s[p]/e+1)/2,h.y=(s[p+1]/e+1)/2,l.push(h.x,h.y)}for(var m=1;m<=n;m++)o.push(m,m+1,0);return a.setindex(o),a.setattribute("position",new sn(s,3)),a.setattribute("normal",new sn(c,3)),a.setattribute("uv",new sn(l,2)),a}return ut(e,t),e}(_n),to=function(t){function e(e,n,r,i){var a;return(a=t.call(this)||this).type="circlegeometry",a.parameters={radius:e,segments:n,thetastart:r,thetalength:i},a.frombuffergeometry(new so(e,n,r,i)),a.mergevertices(),a}return ut(e,t),e}(wo),eo=function(t){function e(e,n,r,i,a,o,s,c){var l;void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=8),void 0===a&&(a=1),void 0===o&&(o=!1),void 0===s&&(s=0),void 0===c&&(c=2*math.pi),(l=t.call(this)||this).type="cylinderbuffergeometry",l.parameters={radiustop:e,radiusbottom:n,height:r,radialsegments:i,heightsegments:a,openended:o,thetastart:s,thetalength:c};var u=ht(l);i=math.floor(i),a=math.floor(a);var h=[],d=[],p=[],f=[],m=0,v=[],g=r/2,y=0;function x(t){for(var r=m,a=new pt,o=new mt,l=0,v=!0===t?e:n,x=!0===t?1:-1,_=1;_<=i;_++)d.push(0,g*x,0),p.push(0,x,0),f.push(.5,.5),m++;for(var b=m,w=0;w<=i;w++){var m=w/i*c+s,s=math.cos(m),t=math.sin(m);o.x=v*t,o.y=g*x,o.z=v*s,d.push(o.x,o.y,o.z),p.push(0,x,0),a.x=.5*s+.5,a.y=.5*t*x+.5,f.push(a.x,a.y),m++}for(var e=0;e<i;e++){var a=r+e,l=b+e;!0===t?h.push(l,l+1,a):h.push(l+1,l,a),l+=3}u.addgroup(y,l,!0===t?1:2),y+=l}return function(){for(var t=new mt,o=new mt,l=0,x=(n-e)/r,_=0;_<=a;_++){for(var b=[],w=_/a,m=w*(n-e)+e,s=0;s<=i;s++){var t=s/i,e=t*c+s,a=math.sin(e),l=math.cos(e);o.x=m*a,o.y=-w*r+g,o.z=m*l,d.push(o.x,o.y,o.z),t.set(a,x,l).normalize(),p.push(t.x,t.y,t.z),f.push(t,1-w),b.push(m++)}v.push(b)}for(var r=0;r<i;r++)for(var c=0;c<a;c++){var p=v[c][r],i=v[c+1][r],n=v[c+1][r+1],d=v[c][r+1];h.push(p,i,d),h.push(i,n,d),l+=6}u.addgroup(y,l,0),y+=l}(),!1===o&&(e>0&&x(!0),n>0&&x(!1)),l.setindex(h),l.setattribute("position",new sn(d,3)),l.setattribute("normal",new sn(p,3)),l.setattribute("uv",new sn(f,2)),l}return ut(e,t),e}(_n),ao=function(t){function e(e,n,r,i,a,o,s,c){var l;return(l=t.call(this)||this).type="cylindergeometry",l.parameters={radiustop:e,radiusbottom:n,height:r,radialsegments:i,heightsegments:a,openended:o,thetastart:s,thetalength:c},l.frombuffergeometry(new eo(e,n,r,i,a,o,s,c)),l.mergevertices(),l}return ut(e,t),e}(wo),lo=function(t){function e(e,n,r,i,a,o,s){var c;return(c=t.call(this,0,e,n,r,i,a,o,s)||this).type="conegeometry",c.parameters={radius:e,height:n,radialsegments:r,heightsegments:i,openended:a,thetastart:o,thetalength:s},c}return ut(e,t),e}(ao),ro=function(t){function e(e,n,r,i,a,o,s){var c;return void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=8),void 0===i&&(i=1),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===s&&(s=2*math.pi),(c=t.call(this,0,e,n,r,i,a,o,s)||this).type="conebuffergeometry",c.parameters={radius:e,height:n,radialsegments:r,heightsegments:i,openended:a,thetastart:o,thetalength:s},c}return ut(e,t),e}(eo),co=function(t){function e(e,n,r,i){var a;void 0===r&&(r=1),void 0===i&&(i=0),(a=t.call(this)||this).type="polyhedronbuffergeometry",a.parameters={vertices:e,indices:n,radius:r,detail:i};var o=[],s=[];function c(t,e,n,r){for(var i=r+1,a=[],o=0;o<=i;o++){a[o]=[];for(var s=t.clone().lerp(n,o/i),c=e.clone().lerp(n,o/i),u=i-o,h=0;h<=u;h++)a[o][h]=0===h&&o===i?s:s.clone().lerp(c,h/u)}for(var d=0;d<i;d++)for(var p=0;p<2*(i-d)-1;p++){var f=math.floor(p/2);p%2==0?(l(a[d][f+1]),l(a[d+1][f]),l(a[d][f])):(l(a[d][f+1]),l(a[d+1][f+1]),l(a[d+1][f]))}}function l(t){o.push(t.x,t.y,t.z)}function u(t,n){var r=3*t;n.x=e[r+0],n.y=e[r+1],n.z=e[r+2]}function h(t,e,n,r){r<0&&1===t.x&&(s[e]=t.x-1),0===n.x&&0===n.z&&(s[e]=r/2/math.pi+.5)}function d(t){return math.atan2(t.z,-t.x)}return function(t){for(var e=new mt,r=new mt,i=new mt,a=0;a<n.length;a+=3)u(n[a+0],e),u(n[a+1],r),u(n[a+2],i),c(e,r,i,t)}(i),function(t){for(var e=new mt,n=0;n<o.length;n+=3)e.x=o[n+0],e.y=o[n+1],e.z=o[n+2],e.normalize().multiplyscalar(t),o[n+0]=e.x,o[n+1]=e.y,o[n+2]=e.z}(r),function(){for(var t=new mt,e=0;e<o.length;e+=3){t.x=o[e+0],t.y=o[e+1],t.z=o[e+2];var n=d(t)/2/math.pi+.5,r=(i=t,math.atan2(-i.y,math.sqrt(i.x*i.x+i.z*i.z))/math.pi+.5);s.push(n,1-r)}var i;(function(){for(var t=new mt,e=new mt,n=new mt,r=new mt,i=new pt,a=new pt,c=new pt,l=0,u=0;l<o.length;l+=9,u+=6){t.set(o[l+0],o[l+1],o[l+2]),e.set(o[l+3],o[l+4],o[l+5]),n.set(o[l+6],o[l+7],o[l+8]),i.set(s[u+0],s[u+1]),a.set(s[u+2],s[u+3]),c.set(s[u+4],s[u+5]),r.copy(t).add(e).add(n).dividescalar(3);var p=d(r);h(i,u+0,t,p),h(a,u+2,e,p),h(c,u+4,n,p)}})(),function(){for(var t=0;t<s.length;t+=6){var e=s[t+0],n=s[t+2],r=s[t+4],i=math.max(e,n,r),a=math.min(e,n,r);i>.9&&a<.1&&(e<.2&&(s[t+0]+=1),n<.2&&(s[t+2]+=1),r<.2&&(s[t+4]+=1))}}()}(),a.setattribute("position",new sn(o,3)),a.setattribute("normal",new sn(o.slice(),3)),a.setattribute("uv",new sn(s,2)),0===i?a.computevertexnormals():a.normalizenormals(),a}return ut(e,t),e}(_n),po=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);var i=(1+math.sqrt(5))/2,a=1/i,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-a,-i,0,-a,i,0,a,-i,0,a,i,-a,-i,0,-a,i,0,a,-i,0,a,i,0,-i,0,-a,i,0,-a,-i,0,a,i,0,a];return(r=t.call(this,o,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,n)||this).type="dodecahedronbuffergeometry",r.parameters={radius:e,detail:n},r}return ut(e,t),e}(co),io=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="dodecahedrongeometry",r.parameters={radius:e,detail:n},r.frombuffergeometry(new po(e,n)),r.mergevertices(),r}return ut(e,t),e}(wo),no=new mt,do=new mt,oo=new mt,bo=new ze,zo=function(t){function e(e,n){var r;(r=t.call(this)||this).type="edgesgeometry",r.parameters={thresholdangle:n},n=void 0!==n?n:1,e.isgeometry&&(e=(new _n).fromgeometry(e));for(var i=math.pow(10,4),a=math.cos(st.deg2rad*n),o=e.getindex(),s=e.getattribute("position"),c=o?o.count:s.count,l=[0,0,0],u=["a","b","c"],h=new array(3),d={},p=[],f=0;f<c;f+=3){o?(l[0]=o.getx(f),l[1]=o.getx(f+1),l[2]=o.getx(f+2)):(l[0]=f,l[1]=f+1,l[2]=f+2);var m=bo.a,v=bo.b,g=bo.c;if(m.frombufferattribute(s,l[0]),v.frombufferattribute(s,l[1]),g.frombufferattribute(s,l[2]),bo.getnormal(oo),h[0]=math.round(m.x*i)+","+math.round(m.y*i)+","+math.round(m.z*i),h[1]=math.round(v.x*i)+","+math.round(v.y*i)+","+math.round(v.z*i),h[2]=math.round(g.x*i)+","+math.round(g.y*i)+","+math.round(g.z*i),h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(var y=0;y<3;y++){var x=(y+1)%3,_=h[y],b=h[x],w=bo[u[y]],m=bo[u[x]],s=_+"_"+b,t=b+"_"+_;t in d&&d[t]?(oo.dot(d[t].normal)<=a&&(p.push(w.x,w.y,w.z),p.push(m.x,m.y,m.z)),d[t]=null):s in d||(d[s]={index0:l[y],index1:l[x],normal:oo.clone()})}}for(var e in d)if(d[e]){var a=d[e],l=a.index0,r=a.index1;no.frombufferattribute(s,l),do.frombufferattribute(s,r),p.push(no.x,no.y,no.z),p.push(do.x,do.y,do.z)}return r.setattribute("position",new sn(p,3)),r}return ut(e,t),e}(_n),fo=function(t,e,n){n=n||2;var r,i,a,o,s,c,l,u=e&&e.length,h=u?e[0]*n:t.length,d=go(t,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,n,r){var i,a,o,s=[];for(i=0,a=e.length;i<a;i++)(o=go(t,e[i]*r,i<a-1?e[i+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),s.push(jo(o));for(s.sort(qo),i=0;i<s.length;i++)xo(s[i],n),n=uo(n,n.next);return n}(t,e,d,n)),t.length>80*n){r=a=t[0],i=o=t[1];for(var f=n;f<h;f+=n)(s=t[f])<r&&(r=s),(c=t[f+1])<i&&(i=c),s>a&&(a=s),c>o&&(o=c);l=0!==(l=math.max(a-r,o-i))?1/l:0}return ho(d,p,n,r,i,l),p};function go(t,e,n,r,i){var a,o;if(i===function(t,e,n,r){for(var i=0,a=e,o=n-r;a<n;a+=r)i+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return i}(t,e,n,r)>0)for(a=e;a<n;a+=r)o=os(a,t[a],t[a+1],o);else for(a=n-r;a>=e;a-=r)o=os(a,t[a],t[a+1],o);return o&&ts(o,o.next)&&(ss(o),o=o.next),o}function uo(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!ts(r,r.next)&&0!==$o(r.prev,r,r.next))r=r.next;else{if(ss(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function ho(t,e,n,r,i,a,o){if(t){!o&&a&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=zo(i.x,i.y,e,n,r)),i.prevz=i.prev,i.nextz=i.next,i=i.next}while(i!==t);i.prevz.nextz=null,i.prevz=null,function(t){var e,n,r,i,a,o,s,c,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,r=n,s=0,e=0;e<l&&(s++,r=r.nextz);e++);for(c=l;s>0||c>0&&r;)0!==s&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextz,s--):(i=r,r=r.nextz,c--),a?a.nextz=i:t=i,i.prevz=a,a=i;n=r}a.nextz=null,l*=2}while(o>1)}(i)}(t,r,i,a);for(var s,c,l=t;t.prev!==t.next;)if(s=t.prev,c=t.next,a?vo(t,r,i,a):ko(t))e.push(s.i/n),e.push(t.i/n),e.push(c.i/n),ss(t),t=c.next,l=c.next;else if((t=c)===l){o?1===o?ho(t=wo(uo(t),e,n),e,n,r,i,a,2):2===o&&jo(t,e,n,r,i,a):ho(uo(t),e,n,r,i,a,1);break}}}function ko(t){var e=t.prev,n=t,r=t.next;if($o(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(qo(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&$o(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function vo(t,e,n,r){var i=t.prev,a=t,o=t.next;if($o(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,c=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,l=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,u=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=zo(s,c,e,n,r),d=zo(l,u,e,n,r),p=t.prevz,f=t.nextz;p&&p.z>=h&&f&&f.z<=d;){if(p!==t.prev&&p!==t.next&&qo(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&$o(p.prev,p,p.next)>=0)return!1;if(p=p.prevz,f!==t.prev&&f!==t.next&&qo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&$o(f.prev,f,f.next)>=0)return!1;f=f.nextz}for(;p&&p.z>=h;){if(p!==t.prev&&p!==t.next&&qo(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&$o(p.prev,p,p.next)>=0)return!1;p=p.prevz}for(;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&qo(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&$o(f.prev,f,f.next)>=0)return!1;f=f.nextz}return!0}function wo(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!ts(i,a)&&es(i,r,r.next,a)&&is(i,a)&&is(a,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(a.i/n),ss(r),ss(r.next),r=t=a),r=r.next}while(r!==t);return uo(r)}function jo(t,e,n,r,i,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&ko(o,s)){var c=as(o,s);return o=uo(o,o.next),c=uo(c,c.next),ho(o,e,n,r,i,a),void ho(c,e,n,r,i,a)}s=s.next}o=o.next}while(o!==t)}function qo(t,e){return t.x-e.x}function xo(t,e){if(e=function(t,e){var n,r=e,i=t.x,a=t.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===o)return n;var c,l=n,u=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&qo(a<h?i:o,a,u,h,a<h?o:i,a,r.x,r.y)&&(c=math.abs(a-r.y)/(i-r.x),is(r,t)&&(c<d||c===d&&(r.x>n.x||r.x===n.x&&yo(n,r)))&&(n=r,d=c)),r=r.next}while(r!==l);return n}(t,e)){var n=as(e,t);uo(e,e.next),uo(n,n.next)}}function yo(t,e){return $o(t.prev,t,e.prev)<0&&$o(e.next,t,t.next)<0}function zo(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jo(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function qo(t,e,n,r,i,a,o,s){return(i-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(r-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function ko(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&es(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(is(t,e)&&is(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&($o(t.prev,t,e.prev)||$o(t,e.prev,e))||ts(t,e)&&$o(t.prev,t,t.next)>0&&$o(e.prev,e,e.next)>0)}function $o(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function ts(t,e){return t.x===e.x&&t.y===e.y}function es(t,e,n,r){var i=rs($o(t,e,n)),a=rs($o(t,e,r)),o=rs($o(n,r,t)),s=rs($o(n,r,e));return i!==a&&o!==s||(!(0!==i||!ns(t,n,e))||(!(0!==a||!ns(t,r,e))||(!(0!==o||!ns(n,t,r))||!(0!==s||!ns(n,e,r)))))}function ns(t,e,n){return e.x<=math.max(t.x,n.x)&&e.x>=math.min(t.x,n.x)&&e.y<=math.max(t.y,n.y)&&e.y>=math.min(t.y,n.y)}function rs(t){return t>0?1:t<0?-1:0}function is(t,e){return $o(t.prev,t,t.next)<0?$o(t,e,t.next)>=0&&$o(t,t.prev,e)>=0:$o(t,e,t.prev)<0||$o(t,t.next,e)<0}function as(t,e){var n=new cs(t.i,t.x,t.y),r=new cs(e.i,e.x,e.y),i=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function os(t,e,n,r){var i=new cs(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ss(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevz&&(t.prevz.nextz=t.nextz),t.nextz&&(t.nextz.prevz=t.prevz)}function cs(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevz=null,this.nextz=null,this.steiner=!1}var ls={area:function(t){for(var e=t.length,n=0,r=e-1,i=0;i<e;r=i++)n+=t[r].x*t[i].y-t[i].x*t[r].y;return.5*n},isclockwise:function(t){return ls.area(t)<0},triangulateshape:function(t,e){var n=[],r=[],i=[];us(t),hs(n,t);var a=t.length;e.foreach(us);for(var o=0;o<e.length;o++)r.push(a),a+=e[o].length,hs(n,e[o]);for(var s=fo(n,r),c=0;c<s.length;c+=3)i.push(s.slice(c,c+3));return i}};function us(t){var e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function hs(t,e){for(var n=0;n<e.length;n++)t.push(e[n].x),t.push(e[n].y)}var ds=function(t){function e(e,n){var r;(r=t.call(this)||this).type="extrudebuffergeometry",r.parameters={shapes:e,options:n},e=array.isarray(e)?e:[e];for(var i=ht(r),a=[],o=[],s=0,c=e.length;s<c;s++){l(e[s])}function l(t){var e=[],r=void 0!==n.curvesegments?n.curvesegments:12,s=void 0!==n.steps?n.steps:1,c=void 0!==n.depth?n.depth:100,l=void 0===n.bevelenabled||n.bevelenabled,u=void 0!==n.bevelthickness?n.bevelthickness:6,h=void 0!==n.bevelsize?n.bevelsize:u-2,d=void 0!==n.beveloffset?n.beveloffset:0,p=void 0!==n.bevelsegments?n.bevelsegments:3,f=n.extrudepath,m=void 0!==n.uvgenerator?n.uvgenerator:ps;void 0!==n.amount&&(console.warn("three.extrudebuffergeometry: amount has been renamed to depth."),c=n.amount);var v,g,y,x,_,b=!1;f&&(v=f.getspacedpoints(s),b=!0,l=!1,g=f.computefrenetframes(s,!1),y=new mt,x=new mt,_=new mt),l||(p=0,u=0,h=0,d=0);var w=t.extractpoints(r),m=w.shape,s=w.holes;if(!ls.isclockwise(m)){m=m.reverse();for(var t=0,e=s.length;t<e;t++){var a=s[t];ls.isclockwise(a)&&(s[t]=a.reverse())}}for(var l=ls.triangulateshape(m,s),r=m,c=0,p=s.length;c<p;c++){var i=s[c];m=m.concat(i)}function n(t,e,n){return e||console.error("three.extrudegeometry: vec does not exist"),e.clone().multiplyscalar(n).add(t)}var d=m.length,o=l.length;function b(t,e,n){var r,i,a,o=t.x-e.x,s=t.y-e.y,c=n.x-t.x,l=n.y-t.y,u=o*o+s*s,h=o*l-s*c;if(math.abs(h)>number.epsilon){var d=math.sqrt(u),p=math.sqrt(c*c+l*l),f=e.x-s/d,m=e.y+o/d,v=((n.x-l/p-f)*l-(n.y+c/p-m)*c)/(o*l-s*c),g=(r=f+o*v-t.x)*r+(i=m+s*v-t.y)*i;if(g<=2)return new pt(r,i);a=math.sqrt(g/2)}else{var y=!1;o>number.epsilon?c>number.epsilon&&(y=!0):o<-number.epsilon?c<-number.epsilon&&(y=!0):math.sign(s)===math.sign(l)&&(y=!0),y?(r=-s,i=o,a=math.sqrt(u)):(r=o,i=s,a=math.sqrt(u/2))}return new pt(r/a,i/a)}for(var z=[],f=0,g=r.length,u=g-1,h=f+1;f<g;f++,u++,h++)u===g&&(u=0),h===g&&(h=0),z[f]=b(r[f],r[u],r[h]);for(var k,v=[],w=z.concat(),j=0,q=s.length;j<q;j++){var x=s[j];k=[];for(var y=0,z=x.length,j=z-1,q=y+1;y<z;y++,j++,q++)j===z&&(j=0),q===z&&(q=0),k[y]=b(x[y],x[j],x[q]);v.push(k),w=w.concat(k)}for(var k=0;k<p;k++){for(var $=k/p,tt=u*math.cos($*math.pi/2),et=h*math.sin($*math.pi/2)+d,nt=0,rt=r.length;nt<rt;nt++){var it=n(r[nt],z[nt],et);nt(it.x,it.y,-tt)}for(var at=0,ot=s.length;at<ot;at++){var st=s[at];k=v[at];for(var ct=0,lt=st.length;ct<lt;ct++){var ut=n(st[ct],k[ct],et);nt(ut.x,ut.y,-tt)}}}for(var ht=h+d,dt=0;dt<d;dt++){var ft=l?n(m[dt],w[dt],ht):m[dt];b?(x.copy(g.normals[0]).multiplyscalar(ft.x),y.copy(g.binormals[0]).multiplyscalar(ft.y),_.copy(v[0]).add(x).add(y),nt(_.x,_.y,_.z)):nt(ft.x,ft.y,0)}for(var mt=1;mt<=s;mt++)for(var vt=0;vt<d;vt++){var gt=l?n(m[vt],w[vt],ht):m[vt];b?(x.copy(g.normals[mt]).multiplyscalar(gt.x),y.copy(g.binormals[mt]).multiplyscalar(gt.y),_.copy(v[mt]).add(x).add(y),nt(_.x,_.y,_.z)):nt(gt.x,gt.y,c/s*mt)}for(var yt=p-1;yt>=0;yt--){for(var xt=yt/p,_t=u*math.cos(xt*math.pi/2),bt=h*math.sin(xt*math.pi/2)+d,wt=0,st=r.length;wt<st;wt++){var tt=n(r[wt],z[wt],bt);nt(tt.x,tt.y,c+_t)}for(var et=0,at=s.length;et<at;et++){var lt=s[et];k=v[et];for(var rt=0,ct=lt.length;rt<ct;rt++){var pt=n(lt[rt],k[rt],bt);b?nt(pt.x,pt.y+v[s-1].y,v[s-1].x+_t):nt(pt.x,pt.y,c+_t)}}}function it(t,e){for(var n=t.length;--n>=0;){var r=n,i=n-1;i<0&&(i=t.length-1);for(var a=0,o=s+2*p;a<o;a++){var c=d*a,l=d*(a+1);ot(e+r+c,e+i+c,e+i+l,e+r+l)}}}function nt(t,n,r){e.push(t),e.push(n),e.push(r)}function dt(t,e,n){bt(t),bt(e),bt(n);var r=a.length/3,o=m.generatetopuv(i,a,r-3,r-2,r-1);zt(o[0]),zt(o[1]),zt(o[2])}function ot(t,e,n,r){bt(t),bt(e),bt(r),bt(e),bt(n),bt(r);var o=a.length/3,s=m.generatesidewalluv(i,a,o-6,o-3,o-2,o-1);zt(s[0]),zt(s[1]),zt(s[3]),zt(s[1]),zt(s[2]),zt(s[3])}function bt(t){a.push(e[3*t+0]),a.push(e[3*t+1]),a.push(e[3*t+2])}function zt(t){o.push(t.x),o.push(t.y)}!function(){var t=a.length/3;if(l){for(var e=0,n=d*e,r=0;r<o;r++){var o=l[r];dt(o[2]+n,o[1]+n,o[0]+n)}n=d*(e=s+2*p);for(var c=0;c<o;c++){var u=l[c];dt(u[0]+n,u[1]+n,u[2]+n)}}else{for(var h=0;h<o;h++){var d=l[h];dt(d[2],d[1],d[0])}for(var f=0;f<o;f++){var m=l[f];dt(m[0]+d*s,m[1]+d*s,m[2]+d*s)}}i.addgroup(t,a.length/3-t,0)}(),function(){var t=a.length/3,e=0;it(r,e),e+=r.length;for(var n=0,r=s.length;n<r;n++){var o=s[n];it(o,e),e+=o.length}i.addgroup(t,a.length/3-t,1)}()}return r.setattribute("position",new sn(a,3)),r.setattribute("uv",new sn(o,2)),r.computevertexnormals(),r}return ut(e,t),e.prototype.tojson=function(){var t=_n.prototype.tojson.call(this);return function(t,e,n){if(n.shapes=[],array.isarray(t))for(var r=0,i=t.length;r<i;r++){var a=t[r];n.shapes.push(a.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudepath&&(n.options.extrudepath=e.extrudepath.tojson());return n}(this.parameters.shapes,this.parameters.options,t)},e}(_n),ps={generatetopuv:function(t,e,n,r,i){var a=e[3*n],o=e[3*n+1],s=e[3*r],c=e[3*r+1],l=e[3*i],u=e[3*i+1];return[new pt(a,o),new pt(s,c),new pt(l,u)]},generatesidewalluv:function(t,e,n,r,i,a){var o=e[3*n],s=e[3*n+1],c=e[3*n+2],l=e[3*r],u=e[3*r+1],h=e[3*r+2],d=e[3*i],p=e[3*i+1],f=e[3*i+2],m=e[3*a],v=e[3*a+1],g=e[3*a+2];return math.abs(s-u)<.01?[new pt(o,1-c),new pt(l,1-h),new pt(d,1-f),new pt(m,1-g)]:[new pt(s,1-c),new pt(u,1-h),new pt(p,1-f),new pt(v,1-g)]}};var fs=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="extrudegeometry",r.parameters={shapes:e,options:n},r.frombuffergeometry(new ds(e,n)),r.mergevertices(),r}return ut(e,t),e.prototype.tojson=function(){var e=t.prototype.tojson.call(this);return function(t,e,n){if(n.shapes=[],array.isarray(t))for(var r=0,i=t.length;r<i;r++){var a=t[r];n.shapes.push(a.uuid)}else n.shapes.push(t.uuid);void 0!==e.extrudepath&&(n.options.extrudepath=e.extrudepath.tojson());return n}(this.parameters.shapes,this.parameters.options,e)},e}(wo);var ms=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);var i=(1+math.sqrt(5))/2,a=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];return(r=t.call(this,a,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,n)||this).type="icosahedronbuffergeometry",r.parameters={radius:e,detail:n},r}return ut(e,t),e}(co),vs=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="icosahedrongeometry",r.parameters={radius:e,detail:n},r.frombuffergeometry(new ms(e,n)),r.mergevertices(),r}return ut(e,t),e}(wo),gs=function(t){function e(e,n,r,i){var a;void 0===n&&(n=12),void 0===r&&(r=0),void 0===i&&(i=2*math.pi),(a=t.call(this)||this).type="lathebuffergeometry",a.parameters={points:e,segments:n,phistart:r,philength:i},n=math.floor(n),i=st.clamp(i,0,2*math.pi);for(var o=[],s=[],c=[],l=1/n,u=new mt,h=new pt,d=0;d<=n;d++)for(var p=r+d*l*i,f=math.sin(p),m=math.cos(p),v=0;v<=e.length-1;v++)u.x=e[v].x*f,u.y=e[v].y,u.z=e[v].x*m,s.push(u.x,u.y,u.z),h.x=d/n,h.y=v/(e.length-1),c.push(h.x,h.y);for(var g=0;g<n;g++)for(var y=0;y<e.length-1;y++){var x=y+g*e.length,_=x,b=x+e.length,w=x+e.length+1,m=x+1;o.push(_,b,m),o.push(b,w,m)}if(a.setindex(o),a.setattribute("position",new sn(s,3)),a.setattribute("uv",new sn(c,2)),a.computevertexnormals(),i===2*math.pi)for(var s=a.attributes.normal.array,t=new mt,e=new mt,a=new mt,l=n*e.length*3,r=0,c=0;r<e.length;r++,c+=3)t.x=s[c+0],t.y=s[c+1],t.z=s[c+2],e.x=s[l+c+0],e.y=s[l+c+1],e.z=s[l+c+2],a.addvectors(t,e).normalize(),s[c+0]=s[l+c+0]=a.x,s[c+1]=s[l+c+1]=a.y,s[c+2]=s[l+c+2]=a.z;return a}return ut(e,t),e}(_n),ys=function(t){function e(e,n,r,i){var a;return(a=t.call(this)||this).type="lathegeometry",a.parameters={points:e,segments:n,phistart:r,philength:i},a.frombuffergeometry(new gs(e,n,r,i)),a.mergevertices(),a}return ut(e,t),e}(wo),xs=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);return(r=t.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,n)||this).type="octahedronbuffergeometry",r.parameters={radius:e,detail:n},r}return ut(e,t),e}(co),_s=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="octahedrongeometry",r.parameters={radius:e,detail:n},r.frombuffergeometry(new xs(e,n)),r.mergevertices(),r}return ut(e,t),e}(wo);function bs(t,e,n){_n.call(this),this.type="parametricbuffergeometry",this.parameters={func:t,slices:e,stacks:n};var r=[],i=[],a=[],o=[],s=1e-5,c=new mt,l=new mt,u=new mt,h=new mt,d=new mt;t.length<3&&console.error("three.parametricgeometry: function must now modify a vector3 as third parameter.");for(var p=e+1,f=0;f<=n;f++)for(var m=f/n,v=0;v<=e;v++){var g=v/e;t(g,m,l),i.push(l.x,l.y,l.z),g-s>=0?(t(g-s,m,u),h.subvectors(l,u)):(t(g+s,m,u),h.subvectors(u,l)),m-s>=0?(t(g,m-s,u),d.subvectors(l,u)):(t(g,m+s,u),d.subvectors(u,l)),c.crossvectors(h,d).normalize(),a.push(c.x,c.y,c.z),o.push(g,m)}for(var y=0;y<n;y++)for(var x=0;x<e;x++){var _=y*p+x,b=y*p+x+1,w=(y+1)*p+x+1,m=(y+1)*p+x;r.push(_,b,m),r.push(b,w,m)}this.setindex(r),this.setattribute("position",new sn(i,3)),this.setattribute("normal",new sn(a,3)),this.setattribute("uv",new sn(o,2))}function ws(t,e,n){wo.call(this),this.type="parametricgeometry",this.parameters={func:t,slices:e,stacks:n},this.frombuffergeometry(new bs(t,e,n)),this.mergevertices()}bs.prototype=object.create(_n.prototype),bs.prototype.constructor=bs,ws.prototype=object.create(wo.prototype),ws.prototype.constructor=ws;var ms=function(t){function e(e,n,r,i){var a;return(a=t.call(this)||this).type="planegeometry",a.parameters={width:e,height:n,widthsegments:r,heightsegments:i},a.frombuffergeometry(new ir(e,n,r,i)),a.mergevertices(),a}return ut(e,t),e}(wo),ss=function(t){function e(e,n,r,i){var a;return(a=t.call(this)||this).type="polyhedrongeometry",a.parameters={vertices:e,indices:n,radius:r,detail:i},a.frombuffergeometry(new co(e,n,r,i)),a.mergevertices(),a}return ut(e,t),e}(wo),ts=function(t){function e(e,n,r,i,a,o){var s;void 0===e&&(e=.5),void 0===n&&(n=1),void 0===r&&(r=8),void 0===i&&(i=1),void 0===a&&(a=0),void 0===o&&(o=2*math.pi),(s=t.call(this)||this).type="ringbuffergeometry",s.parameters={innerradius:e,outerradius:n,thetasegments:r,phisegments:i,thetastart:a,thetalength:o},r=math.max(3,r);for(var c=[],l=[],u=[],h=[],d=e,p=(n-e)/(i=math.max(1,i)),f=new mt,m=new pt,v=0;v<=i;v++){for(var g=0;g<=r;g++){var y=a+g/r*o;f.x=d*math.cos(y),f.y=d*math.sin(y),l.push(f.x,f.y,f.z),u.push(0,0,1),m.x=(f.x/n+1)/2,m.y=(f.y/n+1)/2,h.push(m.x,m.y)}d+=p}for(var x=0;x<i;x++)for(var _=x*(r+1),b=0;b<r;b++){var w=b+_,m=w,s=w+r+1,t=w+r+2,e=w+1;c.push(m,s,e),c.push(s,t,e)}return s.setindex(c),s.setattribute("position",new sn(l,3)),s.setattribute("normal",new sn(u,3)),s.setattribute("uv",new sn(h,2)),s}return ut(e,t),e}(_n),es=function(t){function e(e,n,r,i,a,o){var s;return(s=t.call(this)||this).type="ringgeometry",s.parameters={innerradius:e,outerradius:n,thetasegments:r,phisegments:i,thetastart:a,thetalength:o},s.frombuffergeometry(new ts(e,n,r,i,a,o)),s.mergevertices(),s}return ut(e,t),e}(wo),as=function(t){function e(e,n){var r;void 0===n&&(n=12),(r=t.call(this)||this).type="shapebuffergeometry",r.parameters={shapes:e,curvesegments:n};var i=[],a=[],o=[],s=[],c=0,l=0;if(!1===array.isarray(e))h(e);else for(var u=0;u<e.length;u++)h(e[u]),r.addgroup(c,l,u),c+=l,l=0;function h(t){var e=a.length/3,r=t.extractpoints(n),c=r.shape,u=r.holes;!1===ls.isclockwise(c)&&(c=c.reverse());for(var h=0,d=u.length;h<d;h++){var p=u[h];!0===ls.isclockwise(p)&&(u[h]=p.reverse())}for(var f=ls.triangulateshape(c,u),m=0,v=u.length;m<v;m++){var g=u[m];c=c.concat(g)}for(var y=0,x=c.length;y<x;y++){var _=c[y];a.push(_.x,_.y,0),o.push(0,0,1),s.push(_.x,_.y)}for(var b=0,w=f.length;b<w;b++){var m=f[b],s=m[0]+e,t=m[1]+e,e=m[2]+e;i.push(s,t,e),l+=3}}return r.setindex(i),r.setattribute("position",new sn(a,3)),r.setattribute("normal",new sn(o,3)),r.setattribute("uv",new sn(s,2)),r}return ut(e,t),e.prototype.tojson=function(){var t=_n.prototype.tojson.call(this);return function(t,e){if(e.shapes=[],array.isarray(t))for(var n=0,r=t.length;n<r;n++){var i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)},e}(_n);var ls=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="shapegeometry","object"==typeof n&&(console.warn("three.shapegeometry: options parameter has been removed."),n=n.curvesegments),r.parameters={shapes:e,curvesegments:n},r.frombuffergeometry(new as(e,n)),r.mergevertices(),r}return ut(e,t),e.prototype.tojson=function(){var t=wo.prototype.tojson.call(this);return function(t,e){if(e.shapes=[],array.isarray(t))for(var n=0,r=t.length;n<r;n++){var i=t[n];e.shapes.push(i.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)},e}(wo);var rs=function(t){function e(e,n,r,i,a,o,s){var c;void 0===e&&(e=1),void 0===n&&(n=8),void 0===r&&(r=6),void 0===i&&(i=0),void 0===a&&(a=2*math.pi),void 0===o&&(o=0),void 0===s&&(s=math.pi),(c=t.call(this)||this).type="spherebuffergeometry",c.parameters={radius:e,widthsegments:n,heightsegments:r,phistart:i,philength:a,thetastart:o,thetalength:s},n=math.max(3,math.floor(n)),r=math.max(2,math.floor(r));for(var l=math.min(o+s,math.pi),u=0,h=[],d=new mt,p=new mt,f=[],m=[],v=[],g=[],y=0;y<=r;y++){var x=[],_=y/r,b=0;0==y&&0==o?b=.5/n:y==r&&l==math.pi&&(b=-.5/n);for(var w=0;w<=n;w++){var m=w/n;d.x=-e*math.cos(i+m*a)*math.sin(o+_*s),d.y=e*math.cos(o+_*s),d.z=e*math.sin(i+m*a)*math.sin(o+_*s),m.push(d.x,d.y,d.z),p.copy(d).normalize(),v.push(p.x,p.y,p.z),g.push(m+b,1-_),x.push(u++)}h.push(x)}for(var s=0;s<r;s++)for(var t=0;t<n;t++){var e=h[s][t+1],a=h[s][t],l=h[s+1][t],r=h[s+1][t+1];(0!==s||o>0)&&f.push(e,a,r),(s!==r-1||l<math.pi)&&f.push(a,l,r)}return c.setindex(f),c.setattribute("position",new sn(m,3)),c.setattribute("normal",new sn(v,3)),c.setattribute("uv",new sn(g,2)),c}return ut(e,t),e}(_n),cs=function(t){function e(e,n,r,i,a,o,s){var c;return(c=t.call(this)||this).type="spheregeometry",c.parameters={radius:e,widthsegments:n,heightsegments:r,phistart:i,philength:a,thetastart:o,thetalength:s},c.frombuffergeometry(new rs(e,n,r,i,a,o,s)),c.mergevertices(),c}return ut(e,t),e}(wo),ps=function(t){function e(e,n){var r;void 0===e&&(e=1),void 0===n&&(n=0);return(r=t.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,n)||this).type="tetrahedronbuffergeometry",r.parameters={radius:e,detail:n},r}return ut(e,t),e}(co),is=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="tetrahedrongeometry",r.parameters={radius:e,detail:n},r.frombuffergeometry(new ps(e,n)),r.mergevertices(),r}return ut(e,t),e}(wo),ns=function(t){function e(e,n){var r;void 0===n&&(n={});var i=n.font;if(!i||!i.isfont)return console.error("three.textgeometry: font parameter is not an instance of three.font."),new _n||ht(r);var a=i.generateshapes(e,n.size);return n.depth=void 0!==n.height?n.height:50,void 0===n.bevelthickness&&(n.bevelthickness=10),void 0===n.bevelsize&&(n.bevelsize=8),void 0===n.bevelenabled&&(n.bevelenabled=!1),(r=t.call(this,a,n)||this).type="textbuffergeometry",r}return ut(e,t),e}(ds),ds=function(t){function e(e,n){var r;return(r=t.call(this)||this).type="textgeometry",r.parameters={text:e,parameters:n},r.frombuffergeometry(new ns(e,n)),r.mergevertices(),r}return ut(e,t),e}(wo),os=function(t){function e(e,n,r,i,a){var o;void 0===e&&(e=1),void 0===n&&(n=.4),void 0===r&&(r=8),void 0===i&&(i=6),void 0===a&&(a=2*math.pi),(o=t.call(this)||this).type="torusbuffergeometry",o.parameters={radius:e,tube:n,radialsegments:r,tubularsegments:i,arc:a},r=math.floor(r),i=math.floor(i);for(var s=[],c=[],l=[],u=[],h=new mt,d=new mt,p=new mt,f=0;f<=r;f++)for(var m=0;m<=i;m++){var v=m/i*a,g=f/r*math.pi*2;d.x=(e+n*math.cos(g))*math.cos(v),d.y=(e+n*math.cos(g))*math.sin(v),d.z=n*math.sin(g),c.push(d.x,d.y,d.z),h.x=e*math.cos(v),h.y=e*math.sin(v),p.subvectors(d,h).normalize(),l.push(p.x,p.y,p.z),u.push(m/i),u.push(f/r)}for(var y=1;y<=r;y++)for(var x=1;x<=i;x++){var _=(i+1)*y+x-1,b=(i+1)*(y-1)+x-1,w=(i+1)*(y-1)+x,m=(i+1)*y+x;s.push(_,b,m),s.push(b,w,m)}return o.setindex(s),o.setattribute("position",new sn(c,3)),o.setattribute("normal",new sn(l,3)),o.setattribute("uv",new sn(u,2)),o}return ut(e,t),e}(_n),bs=function(t){function e(e,n,r,i,a){var o;return(o=t.call(this)||this).type="torusgeometry",o.parameters={radius:e,tube:n,radialsegments:r,tubularsegments:i,arc:a},o.frombuffergeometry(new os(e,n,r,i,a)),o.mergevertices(),o}return ut(e,t),e}(wo),zs=function(t){function e(e,n,r,i,a,o){var s;void 0===e&&(e=1),void 0===n&&(n=.4),void 0===r&&(r=64),void 0===i&&(i=8),void 0===a&&(a=2),void 0===o&&(o=3),(s=t.call(this)||this).type="torusknotbuffergeometry",s.parameters={radius:e,tube:n,tubularsegments:r,radialsegments:i,p:a,q:o},r=math.floor(r),i=math.floor(i);for(var c=[],l=[],u=[],h=[],d=new mt,p=new mt,f=new mt,m=new mt,v=new mt,g=new mt,y=new mt,x=0;x<=r;++x){var _=x/r*a*math.pi*2;p(_,a,o,e,f),p(_+.01,a,o,e,m),g.subvectors(m,f),y.addvectors(m,f),v.crossvectors(g,y),y.crossvectors(v,g),v.normalize(),y.normalize();for(var b=0;b<=i;++b){var w=b/i*math.pi*2,m=-n*math.cos(w),s=n*math.sin(w);d.x=f.x+(m*y.x+s*v.x),d.y=f.y+(m*y.y+s*v.y),d.z=f.z+(m*y.z+s*v.z),l.push(d.x,d.y,d.z),p.subvectors(d,f).normalize(),u.push(p.x,p.y,p.z),h.push(x/r),h.push(b/i)}}for(var t=1;t<=r;t++)for(var e=1;e<=i;e++){var a=(i+1)*(t-1)+(e-1),l=(i+1)*t+(e-1),r=(i+1)*t+e,c=(i+1)*(t-1)+e;c.push(a,l,c),c.push(l,r,c)}function p(t,e,n,r,i){var a=math.cos(t),o=math.sin(t),s=n/e*t,c=math.cos(s);i.x=r*(2+c)*.5*a,i.y=r*(2+c)*o*.5,i.z=r*math.sin(s)*.5}return s.setindex(c),s.setattribute("position",new sn(l,3)),s.setattribute("normal",new sn(u,3)),s.setattribute("uv",new sn(h,2)),s}return ut(e,t),e}(_n),fs=function(t){function e(e,n,r,i,a,o,s){var c;return(c=t.call(this)||this).type="torusknotgeometry",c.parameters={radius:e,tube:n,tubularsegments:r,radialsegments:i,p:a,q:o},void 0!==s&&console.warn("three.torusknotgeometry: heightscale has been deprecated. use .scale( x, y, z ) instead."),c.frombuffergeometry(new zs(e,n,r,i,a,o)),c.mergevertices(),c}return ut(e,t),e}(wo),gs=function(t){function e(e,n,r,i,a){var o;void 0===n&&(n=64),void 0===r&&(r=1),void 0===i&&(i=8),void 0===a&&(a=!1),(o=t.call(this)||this).type="tubebuffergeometry",o.parameters={path:e,tubularsegments:n,radius:r,radialsegments:i,closed:a};var s=e.computefrenetframes(n,a);o.tangents=s.tangents,o.normals=s.normals,o.binormals=s.binormals;var c=new mt,l=new mt,u=new pt,h=new mt,d=[],p=[],f=[],m=[];function v(t){h=e.getpointat(t/n,h);for(var a=s.normals[t],o=s.binormals[t],u=0;u<=i;u++){var f=u/i*math.pi*2,m=math.sin(f),v=-math.cos(f);l.x=v*a.x+m*o.x,l.y=v*a.y+m*o.y,l.z=v*a.z+m*o.z,l.normalize(),p.push(l.x,l.y,l.z),c.x=h.x+r*l.x,c.y=h.y+r*l.y,c.z=h.z+r*l.z,d.push(c.x,c.y,c.z)}}return function(){for(var t=0;t<n;t++)v(t);v(!1===a?n:0),function(){for(var t=0;t<=n;t++)for(var e=0;e<=i;e++)u.x=t/n,u.y=e/i,f.push(u.x,u.y)}(),function(){for(var t=1;t<=n;t++)for(var e=1;e<=i;e++){var r=(i+1)*(t-1)+(e-1),a=(i+1)*t+(e-1),o=(i+1)*t+e,s=(i+1)*(t-1)+e;m.push(r,a,s),m.push(a,o,s)}}()}(),o.setindex(m),o.setattribute("position",new sn(d,3)),o.setattribute("normal",new sn(p,3)),o.setattribute("uv",new sn(f,2)),o}return ut(e,t),e.prototype.tojson=function(){var t=_n.prototype.tojson.call(this);return t.path=this.parameters.path.tojson(),t},e}(_n),us=function(t){function e(e,n,r,i,a,o){var s;(s=t.call(this)||this).type="tubegeometry",s.parameters={path:e,tubularsegments:n,radius:r,radialsegments:i,closed:a},void 0!==o&&console.warn("three.tubegeometry: taper has been removed.");var c=new gs(e,n,r,i,a);return s.tangents=c.tangents,s.normals=c.normals,s.binormals=c.binormals,s.frombuffergeometry(c),s.mergevertices(),s}return ut(e,t),e}(wo),hs=function(t){function e(e){var n;(n=t.call(this)||this).type="wireframegeometry";var r=[],i=[0,0],a={},o=["a","b","c"];if(e&&e.isgeometry){for(var s=e.faces,c=0,l=s.length;c<l;c++)for(var u=s[c],h=0;h<3;h++){var d=u[o[h]],p=u[o[(h+1)%3]];i[0]=math.min(d,p),i[1]=math.max(d,p);var f=i[0]+","+i[1];void 0===a[f]&&(a[f]={index1:i[0],index2:i[1]})}for(var m in a){var v=a[m],g=e.vertices[v.index1];r.push(g.x,g.y,g.z),g=e.vertices[v.index2],r.push(g.x,g.y,g.z)}}else if(e&&e.isbuffergeometry){var y=new mt;if(null!==e.index){var x=e.attributes.position,_=e.index,b=e.groups;0===b.length&&(b=[{start:0,count:_.count,materialindex:0}]);for(var w=0,m=b.length;w<m;++w)for(var s=b[w],t=s.start,e=t,a=t+s.count;e<a;e+=3)for(var l=0;l<3;l++){var r=_.getx(e+l),c=_.getx(e+(l+1)%3);i[0]=math.min(r,c),i[1]=math.max(r,c);var p=i[0]+","+i[1];void 0===a[p]&&(a[p]={index1:i[0],index2:i[1]})}for(var i in a){var n=a[i];y.frombufferattribute(x,n.index1),r.push(y.x,y.y,y.z),y.frombufferattribute(x,n.index2),r.push(y.x,y.y,y.z)}}else for(var d=e.attributes.position,o=0,b=d.count/3;o<b;o++)for(var z=0;z<3;z++){var f=3*o+z;y.frombufferattribute(d,f),r.push(y.x,y.y,y.z);var g=3*o+(z+1)%3;y.frombufferattribute(d,g),r.push(y.x,y.y,y.z)}}return n.setattribute("position",new sn(r,3)),n}return ut(e,t),e}(_n),ks=object.freeze({__proto__:null,boxgeometry:mo,boxbuffergeometry:hn,circlegeometry:to,circlebuffergeometry:so,conegeometry:lo,conebuffergeometry:ro,cylindergeometry:ao,cylinderbuffergeometry:eo,dodecahedrongeometry:io,dodecahedronbuffergeometry:po,edgesgeometry:zo,extrudegeometry:fs,extrudebuffergeometry:ds,icosahedrongeometry:vs,icosahedronbuffergeometry:ms,lathegeometry:ys,lathebuffergeometry:gs,octahedrongeometry:_s,octahedronbuffergeometry:xs,parametricgeometry:ws,parametricbuffergeometry:bs,planegeometry:ms,planebuffergeometry:ir,polyhedrongeometry:ss,polyhedronbuffergeometry:co,ringgeometry:es,ringbuffergeometry:ts,shapegeometry:ls,shapebuffergeometry:as,spheregeometry:cs,spherebuffergeometry:rs,tetrahedrongeometry:is,tetrahedronbuffergeometry:ps,textgeometry:ds,textbuffergeometry:ns,torusgeometry:bs,torusbuffergeometry:os,torusknotgeometry:fs,torusknotbuffergeometry:zs,tubegeometry:us,tubebuffergeometry:gs,wireframegeometry:hs});function vs(t){xe.call(this),this.type="shadowmaterial",this.color=new we(0),this.transparent=!0,this.setvalues(t)}function ws(t){jn.call(this,t),this.type="rawshadermaterial"}function js(t){xe.call(this),this.defines={standard:""},this.type="meshstandardmaterial",this.color=new we(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightmap=null,this.lightmapintensity=1,this.aomap=null,this.aomapintensity=1,this.emissive=new we(0),this.emissiveintensity=1,this.emissivemap=null,this.bumpmap=null,this.bumpscale=1,this.normalmap=null,this.normalmaptype=0,this.normalscale=new pt(1,1),this.displacementmap=null,this.displacementscale=1,this.displacementbias=0,this.roughnessmap=null,this.metalnessmap=null,this.alphamap=null,this.envmap=null,this.envmapintensity=1,this.refractionratio=.98,this.wireframe=!1,this.wireframelinewidth=1,this.wireframelinecap="round",this.wireframelinejoin="round",this.skinning=!1,this.morphtargets=!1,this.morphnormals=!1,this.vertextangents=!1,this.setvalues(t)}function qs(t){js.call(this),this.defines={standard:"",physical:""},this.type="meshphysicalmaterial",this.clearcoat=0,this.clearcoatmap=null,this.clearcoatroughness=0,this.clearcoatroughnessmap=null,this.clearcoatnormalscale=new pt(1,1),this.clearcoatnormalmap=null,this.reflectivity=.5,object.defineproperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(t){this.reflectivity=st.clamp(2.5*(t-1)/(t+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionmap=null,this.setvalues(t)}function xs(t){xe.call(this),this.type="meshphongmaterial",this.color=new we(16777215),this.specular=new we(1118481),this.shininess=30,this.map=null,this.lightmap=null,this.lightmapintensity=1,this.aomap=null,this.aomapintensity=1,this.emissive=new we(0),this.emissiveintensity=1,this.emissivemap=null,this.bumpmap=null,this.bumpscale=1,this.normalmap=null,this.normalmaptype=0,this.normalscale=new pt(1,1),this.displacementmap=null,this.displacementscale=1,this.displacementbias=0,this.specularmap=null,this.alphamap=null,this.envmap=null,this.combine=0,this.reflectivity=1,this.refractionratio=.98,this.wireframe=!1,this.wireframelinewidth=1,this.wireframelinecap="round",this.wireframelinejoin="round",this.skinning=!1,this.morphtargets=!1,this.morphnormals=!1,this.setvalues(t)}function ys(t){xe.call(this),this.defines={toon:""},this.type="meshtoonmaterial",this.color=new we(16777215),this.map=null,this.gradientmap=null,this.lightmap=null,this.lightmapintensity=1,this.aomap=null,this.aomapintensity=1,this.emissive=new we(0),this.emissiveintensity=1,this.emissivemap=null,this.bumpmap=null,this.bumpscale=1,this.normalmap=null,this.normalmaptype=0,this.normalscale=new pt(1,1),this.displacementmap=null,this.displacementscale=1,this.displacementbias=0,this.alphamap=null,this.wireframe=!1,this.wireframelinewidth=1,this.wireframelinecap="round",this.wireframelinejoin="round",this.skinning=!1,this.morphtargets=!1,this.morphnormals=!1,this.setvalues(t)}function zs(t){xe.call(this),this.type="meshnormalmaterial",this.bumpmap=null,this.bumpscale=1,this.normalmap=null,this.normalmaptype=0,this.normalscale=new pt(1,1),this.displacementmap=null,this.displacementscale=1,this.displacementbias=0,this.wireframe=!1,this.wireframelinewidth=1,this.fog=!1,this.skinning=!1,this.morphtargets=!1,this.morphnormals=!1,this.setvalues(t)}function js(t){xe.call(this),this.type="meshlambertmaterial",this.color=new we(16777215),this.map=null,this.lightmap=null,this.lightmapintensity=1,this.aomap=null,this.aomapintensity=1,this.emissive=new we(0),this.emissiveintensity=1,this.emissivemap=null,this.specularmap=null,this.alphamap=null,this.envmap=null,this.combine=0,this.reflectivity=1,this.refractionratio=.98,this.wireframe=!1,this.wireframelinewidth=1,this.wireframelinecap="round",this.wireframelinejoin="round",this.skinning=!1,this.morphtargets=!1,this.morphnormals=!1,this.setvalues(t)}function qs(t){xe.call(this),this.defines={matcap:""},this.type="meshmatcapmaterial",this.color=new we(16777215),this.matcap=null,this.map=null,this.bumpmap=null,this.bumpscale=1,this.normalmap=null,this.normalmaptype=0,this.normalscale=new pt(1,1),this.displacementmap=null,this.displacementscale=1,this.displacementbias=0,this.alphamap=null,this.skinning=!1,this.morphtargets=!1,this.morphnormals=!1,this.setvalues(t)}function ks(t){za.call(this),this.type="linedashedmaterial",this.scale=1,this.dashsize=3,this.gapsize=1,this.setvalues(t)}vs.prototype=object.create(xe.prototype),vs.prototype.constructor=vs,vs.prototype.isshadowmaterial=!0,vs.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this},ws.prototype=object.create(jn.prototype),ws.prototype.constructor=ws,ws.prototype.israwshadermaterial=!0,js.prototype=object.create(xe.prototype),js.prototype.constructor=js,js.prototype.ismeshstandardmaterial=!0,js.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.defines={standard:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightmap=t.lightmap,this.lightmapintensity=t.lightmapintensity,this.aomap=t.aomap,this.aomapintensity=t.aomapintensity,this.emissive.copy(t.emissive),this.emissivemap=t.emissivemap,this.emissiveintensity=t.emissiveintensity,this.bumpmap=t.bumpmap,this.bumpscale=t.bumpscale,this.normalmap=t.normalmap,this.normalmaptype=t.normalmaptype,this.normalscale.copy(t.normalscale),this.displacementmap=t.displacementmap,this.displacementscale=t.displacementscale,this.displacementbias=t.displacementbias,this.roughnessmap=t.roughnessmap,this.metalnessmap=t.metalnessmap,this.alphamap=t.alphamap,this.envmap=t.envmap,this.envmapintensity=t.envmapintensity,this.refractionratio=t.refractionratio,this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this.wireframelinecap=t.wireframelinecap,this.wireframelinejoin=t.wireframelinejoin,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.morphnormals=t.morphnormals,this.vertextangents=t.vertextangents,this},qs.prototype=object.create(js.prototype),qs.prototype.constructor=qs,qs.prototype.ismeshphysicalmaterial=!0,qs.prototype.copy=function(t){return js.prototype.copy.call(this,t),this.defines={standard:"",physical:""},this.clearcoat=t.clearcoat,this.clearcoatmap=t.clearcoatmap,this.clearcoatroughness=t.clearcoatroughness,this.clearcoatroughnessmap=t.clearcoatroughnessmap,this.clearcoatnormalmap=t.clearcoatnormalmap,this.clearcoatnormalscale.copy(t.clearcoatnormalscale),this.reflectivity=t.reflectivity,t.sheen?this.sheen=(this.sheen||new we).copy(t.sheen):this.sheen=null,this.transmission=t.transmission,this.transmissionmap=t.transmissionmap,this},xs.prototype=object.create(xe.prototype),xs.prototype.constructor=xs,xs.prototype.ismeshphongmaterial=!0,xs.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightmap=t.lightmap,this.lightmapintensity=t.lightmapintensity,this.aomap=t.aomap,this.aomapintensity=t.aomapintensity,this.emissive.copy(t.emissive),this.emissivemap=t.emissivemap,this.emissiveintensity=t.emissiveintensity,this.bumpmap=t.bumpmap,this.bumpscale=t.bumpscale,this.normalmap=t.normalmap,this.normalmaptype=t.normalmaptype,this.normalscale.copy(t.normalscale),this.displacementmap=t.displacementmap,this.displacementscale=t.displacementscale,this.displacementbias=t.displacementbias,this.specularmap=t.specularmap,this.alphamap=t.alphamap,this.envmap=t.envmap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionratio=t.refractionratio,this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this.wireframelinecap=t.wireframelinecap,this.wireframelinejoin=t.wireframelinejoin,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.morphnormals=t.morphnormals,this},ys.prototype=object.create(xe.prototype),ys.prototype.constructor=ys,ys.prototype.ismeshtoonmaterial=!0,ys.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.gradientmap=t.gradientmap,this.lightmap=t.lightmap,this.lightmapintensity=t.lightmapintensity,this.aomap=t.aomap,this.aomapintensity=t.aomapintensity,this.emissive.copy(t.emissive),this.emissivemap=t.emissivemap,this.emissiveintensity=t.emissiveintensity,this.bumpmap=t.bumpmap,this.bumpscale=t.bumpscale,this.normalmap=t.normalmap,this.normalmaptype=t.normalmaptype,this.normalscale.copy(t.normalscale),this.displacementmap=t.displacementmap,this.displacementscale=t.displacementscale,this.displacementbias=t.displacementbias,this.alphamap=t.alphamap,this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this.wireframelinecap=t.wireframelinecap,this.wireframelinejoin=t.wireframelinejoin,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.morphnormals=t.morphnormals,this},zs.prototype=object.create(xe.prototype),zs.prototype.constructor=zs,zs.prototype.ismeshnormalmaterial=!0,zs.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.bumpmap=t.bumpmap,this.bumpscale=t.bumpscale,this.normalmap=t.normalmap,this.normalmaptype=t.normalmaptype,this.normalscale.copy(t.normalscale),this.displacementmap=t.displacementmap,this.displacementscale=t.displacementscale,this.displacementbias=t.displacementbias,this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.morphnormals=t.morphnormals,this},js.prototype=object.create(xe.prototype),js.prototype.constructor=js,js.prototype.ismeshlambertmaterial=!0,js.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.color.copy(t.color),this.map=t.map,this.lightmap=t.lightmap,this.lightmapintensity=t.lightmapintensity,this.aomap=t.aomap,this.aomapintensity=t.aomapintensity,this.emissive.copy(t.emissive),this.emissivemap=t.emissivemap,this.emissiveintensity=t.emissiveintensity,this.specularmap=t.specularmap,this.alphamap=t.alphamap,this.envmap=t.envmap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionratio=t.refractionratio,this.wireframe=t.wireframe,this.wireframelinewidth=t.wireframelinewidth,this.wireframelinecap=t.wireframelinecap,this.wireframelinejoin=t.wireframelinejoin,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.morphnormals=t.morphnormals,this},qs.prototype=object.create(xe.prototype),qs.prototype.constructor=qs,qs.prototype.ismeshmatcapmaterial=!0,qs.prototype.copy=function(t){return xe.prototype.copy.call(this,t),this.defines={matcap:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpmap=t.bumpmap,this.bumpscale=t.bumpscale,this.normalmap=t.normalmap,this.normalmaptype=t.normalmaptype,this.normalscale.copy(t.normalscale),this.displacementmap=t.displacementmap,this.displacementscale=t.displacementscale,this.displacementbias=t.displacementbias,this.alphamap=t.alphamap,this.skinning=t.skinning,this.morphtargets=t.morphtargets,this.morphnormals=t.morphnormals,this},ks.prototype=object.create(za.prototype),ks.prototype.constructor=ks,ks.prototype.islinedashedmaterial=!0,ks.prototype.copy=function(t){return za.prototype.copy.call(this,t),this.scale=t.scale,this.dashsize=t.dashsize,this.gapsize=t.gapsize,this};var $s=object.freeze({__proto__:null,shadowmaterial:vs,spritematerial:va,rawshadermaterial:ws,shadermaterial:jn,pointsmaterial:oo,meshphysicalmaterial:qs,meshstandardmaterial:js,meshphongmaterial:xs,meshtoonmaterial:ys,meshnormalmaterial:zs,meshlambertmaterial:js,meshdepthmaterial:ji,meshdistancematerial:qi,meshbasicmaterial:ye,meshmatcapmaterial:qs,linedashedmaterial:ks,linebasicmaterial:za,material:xe}),tc={arrayslice:function(t,e,n){return tc.istypedarray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertarray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.bytes_per_element?new e(t):array.prototype.slice.call(t)},istypedarray:function(t){return arraybuffer.isview(t)&&!(t instanceof dataview)},getkeyframeorder:function(t){for(var e=t.length,n=new array(e),r=0;r!==e;++r)n[r]=r;return n.sort((function(e,n){return t[e]-t[n]})),n},sortedarray:function(t,e,n){for(var r=t.length,i=new t.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*e,c=0;c!==e;++c)i[o++]=t[s+c];return i},flattenjson:function(t,e,n,r){for(var i=1,a=t[0];void 0!==a&&void 0===a[r];)a=t[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(array.isarray(o))do{void 0!==(o=a[r])&&(e.push(a.time),n.push.apply(n,o)),a=t[i++]}while(void 0!==a);else if(void 0!==o.toarray)do{void 0!==(o=a[r])&&(e.push(a.time),o.toarray(n,n.length)),a=t[i++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(e.push(a.time),n.push(o)),a=t[i++]}while(void 0!==a)}},subclip:function(t,e,n,r,i){void 0===i&&(i=30);var a=t.clone();a.name=e;for(var o=[],s=0;s<a.tracks.length;++s){for(var c=a.tracks[s],l=c.getvaluesize(),u=[],h=[],d=0;d<c.times.length;++d){var p=c.times[d]*i;if(!(p<n||p>=r)){u.push(c.times[d]);for(var f=0;f<l;++f)h.push(c.values[d*l+f])}}0!==u.length&&(c.times=tc.convertarray(u,c.times.constructor),c.values=tc.convertarray(h,c.values.constructor),o.push(c))}a.tracks=o;for(var m=1/0,v=0;v<a.tracks.length;++v)m>a.tracks[v].times[0]&&(m=a.tracks[v].times[0]);for(var g=0;g<a.tracks.length;++g)a.tracks[g].shift(-1*m);return a.resetduration(),a},makeclipadditive:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=t),void 0===r&&(r=30),r<=0&&(r=30);for(var i=n.tracks.length,a=e/r,o=function(e){var r=n.tracks[e],i=r.valuetypename;if("bool"===i||"string"===i)return"continue";var o=t.tracks.find((function(t){return t.name===r.name&&t.valuetypename===i}));if(void 0===o)return"continue";var s=0,c=r.getvaluesize();r.createinterpolant.isinterpolantfactorymethodgltfcubicspline&&(s=c/3);var l=0,u=o.getvaluesize();o.createinterpolant.isinterpolantfactorymethodgltfcubicspline&&(l=u/3);var h=r.times.length-1,d=void 0;if(a<=r.times[0]){var p=s,f=c-s;d=tc.arrayslice(r.values,p,f)}else if(a>=r.times[h]){var m=h*c+s,v=m+c-s;d=tc.arrayslice(r.values,m,v)}else{var g=r.createinterpolant(),y=s,x=c-s;g.evaluate(a),d=tc.arrayslice(g.resultbuffer,y,x)}"quaternion"===i&&(new wt).fromarray(d).normalize().conjugate().toarray(d);for(var _=o.times.length,b=0;b<_;++b){var w=b*u+l;if("quaternion"===i)wt.multiplyquaternionsflat(o.values,w,d,0,o.values,w);else for(var m=u-2*l,s=0;s<m;++s)o.values[w+s]-=d[s]}},s=0;s<i;++s)o(s);return t.blendmode=j,t}};function ec(t,e,n,r){this.parameterpositions=t,this._cachedindex=0,this.resultbuffer=void 0!==r?r:new e.constructor(n),this.samplevalues=e,this.valuesize=n}function nc(t,e,n,r){ec.call(this,t,e,n,r),this._weightprev=-0,this._offsetprev=-0,this._weightnext=-0,this._offsetnext=-0}function rc(t,e,n,r){ec.call(this,t,e,n,r)}function ic(t,e,n,r){ec.call(this,t,e,n,r)}function ac(t,e,n,r){if(void 0===t)throw new error("three.keyframetrack: track name is undefined");if(void 0===e||0===e.length)throw new error("three.keyframetrack: no keyframes in track named "+t);this.name=t,this.times=tc.convertarray(e,this.timebuffertype),this.values=tc.convertarray(n,this.valuebuffertype),this.setinterpolation(r||this.defaultinterpolation)}function oc(t,e,n){ac.call(this,t,e,n)}function sc(t,e,n,r){ac.call(this,t,e,n,r)}function cc(t,e,n,r){ac.call(this,t,e,n,r)}function lc(t,e,n,r){ec.call(this,t,e,n,r)}function uc(t,e,n,r){ac.call(this,t,e,n,r)}function hc(t,e,n,r){ac.call(this,t,e,n,r)}function dc(t,e,n,r){ac.call(this,t,e,n,r)}function pc(t,e,n,r){void 0===e&&(e=-1),void 0===r&&(r=w),this.name=t,this.tracks=n,this.duration=e,this.blendmode=r,this.uuid=st.generateuuid(),this.duration<0&&this.resetduration()}function fc(t){if(void 0===t.type)throw new error("three.keyframetrack: track type undefined, can not parse");var e=function(t){switch(t.tolowercase()){case"scalar":case"double":case"float":case"number":case"integer":return cc;case"vector":case"vector2":case"vector3":case"vector4":return dc;case"color":return sc;case"quaternion":return uc;case"bool":case"boolean":return oc;case"string":return hc}throw new error("three.keyframetrack: unsupported typename: "+t)}(t.type);if(void 0===t.times){var n=[],r=[];tc.flattenjson(t.keys,n,r,"value"),t.times=n,t.values=r}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}object.assign(ec.prototype,{evaluate:function(t){var e=this.parameterpositions,n=this._cachedindex,r=e[n],i=e[n-1];t:{e:{var a;n:{r:if(!(t<r)){for(var o=n+2;;){if(void 0===r){if(t<i)break r;return n=e.length,this._cachedindex=n,this.afterend_(n-1,t,i)}if(n===o)break;if(i=r,t<(r=e[++n]))break e}a=e.length;break n}if(t>=i)break t;var s=e[1];t<s&&(n=2,i=s);for(var c=n-2;;){if(void 0===i)return this._cachedindex=0,this.beforestart_(0,t,r);if(n===c)break;if(r=i,t>=(i=e[--n-1]))break e}a=n,n=0}for(;n<a;){var l=n+a>>>1;t<e[l]?a=l:n=l+1}if(r=e[n],void 0===(i=e[n-1]))return this._cachedindex=0,this.beforestart_(0,t,r);if(void 0===r)return n=e.length,this._cachedindex=n,this.afterend_(n-1,i,t)}this._cachedindex=n,this.intervalchanged_(n,i,r)}return this.interpolate_(n,i,t,r)},settings:null,defaultsettings_:{},getsettings_:function(){return this.settings||this.defaultsettings_},copysamplevalue_:function(t){for(var e=this.resultbuffer,n=this.samplevalues,r=this.valuesize,i=t*r,a=0;a!==r;++a)e[a]=n[i+a];return e},interpolate_:function(){throw new error("call to abstract method")},intervalchanged_:function(){}}),object.assign(ec.prototype,{beforestart_:ec.prototype.copysamplevalue_,afterend_:ec.prototype.copysamplevalue_}),nc.prototype=object.assign(object.create(ec.prototype),{constructor:nc,defaultsettings_:{endingstart:h,endingend:h},intervalchanged_:function(t,e,n){var r=this.parameterpositions,i=t-2,a=t+1,o=r[i],s=r[a];if(void 0===o)switch(this.getsettings_().endingstart){case k:i=t,o=2*e-n;break;case v:o=e+r[i=r.length-2]-r[i+1];break;default:i=t,o=n}if(void 0===s)switch(this.getsettings_().endingend){case k:a=t,s=2*n-e;break;case v:a=1,s=n+r[1]-r[0];break;default:a=t-1,s=e}var c=.5*(n-e),l=this.valuesize;this._weightprev=c/(e-o),this._weightnext=c/(s-n),this._offsetprev=i*l,this._offsetnext=a*l},interpolate_:function(t,e,n,r){for(var i=this.resultbuffer,a=this.samplevalues,o=this.valuesize,s=t*o,c=s-o,l=this._offsetprev,u=this._offsetnext,h=this._weightprev,d=this._weightnext,p=(n-e)/(r-e),f=p*p,m=f*p,v=-h*m+2*h*f-h*p,g=(1+h)*m+(-1.5-2*h)*f+(-.5+h)*p+1,y=(-1-d)*m+(1.5+d)*f+.5*p,x=d*m-d*f,_=0;_!==o;++_)i[_]=v*a[l+_]+g*a[c+_]+y*a[s+_]+x*a[u+_];return i}}),rc.prototype=object.assign(object.create(ec.prototype),{constructor:rc,interpolate_:function(t,e,n,r){for(var i=this.resultbuffer,a=this.samplevalues,o=this.valuesize,s=t*o,c=s-o,l=(n-e)/(r-e),u=1-l,h=0;h!==o;++h)i[h]=a[c+h]*u+a[s+h]*l;return i}}),ic.prototype=object.assign(object.create(ec.prototype),{constructor:ic,interpolate_:function(t){return this.copysamplevalue_(t-1)}}),object.assign(ac,{tojson:function(t){var e,n=t.constructor;if(void 0!==n.tojson)e=n.tojson(t);else{e={name:t.name,times:tc.convertarray(t.times,array),values:tc.convertarray(t.values,array)};var r=t.getinterpolation();r!==t.defaultinterpolation&&(e.interpolation=r)}return e.type=t.valuetypename,e}}),object.assign(ac.prototype,{constructor:ac,timebuffertype:float32array,valuebuffertype:float32array,defaultinterpolation:g,interpolantfactorymethoddiscrete:function(t){return new ic(this.times,this.values,this.getvaluesize(),t)},interpolantfactorymethodlinear:function(t){return new rc(this.times,this.values,this.getvaluesize(),t)},interpolantfactorymethodsmooth:function(t){return new nc(this.times,this.values,this.getvaluesize(),t)},setinterpolation:function(t){var e;switch(t){case f:e=this.interpolantfactorymethoddiscrete;break;case g:e=this.interpolantfactorymethodlinear;break;case u:e=this.interpolantfactorymethodsmooth}if(void 0===e){var n="unsupported interpolation for "+this.valuetypename+" keyframe track named "+this.name;if(void 0===this.createinterpolant){if(t===this.defaultinterpolation)throw new error(n);this.setinterpolation(this.defaultinterpolation)}return console.warn("three.keyframetrack:",n),this}return this.createinterpolant=e,this},getinterpolation:function(){switch(this.createinterpolant){case this.interpolantfactorymethoddiscrete:return f;case this.interpolantfactorymethodlinear:return g;case this.interpolantfactorymethodsmooth:return u}},getvaluesize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]+=t;return this},scale:function(t){if(1!==t)for(var e=this.times,n=0,r=e.length;n!==r;++n)e[n]*=t;return this},trim:function(t,e){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<t;)++i;for(;-1!==a&&n[a]>e;)--a;if(++a,0!==i||a!==r){i>=a&&(i=(a=math.max(a,1))-1);var o=this.getvaluesize();this.times=tc.arrayslice(n,i,a),this.values=tc.arrayslice(this.values,i*o,a*o)}return this},validate:function(){var t=!0,e=this.getvaluesize();e-math.floor(e)!=0&&(console.error("three.keyframetrack: invalid value size in track.",this),t=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("three.keyframetrack: track is empty.",this),t=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"==typeof s&&isnan(s)){console.error("three.keyframetrack: time is not a valid number.",this,o,s),t=!1;break}if(null!==a&&a>s){console.error("three.keyframetrack: out of order keys.",this,o,s,a),t=!1;break}a=s}if(void 0!==r&&tc.istypedarray(r))for(var c=0,l=r.length;c!==l;++c){var u=r[c];if(isnan(u)){console.error("three.keyframetrack: value is not a valid number.",this,c,u),t=!1;break}}return t},optimize:function(){for(var t=tc.arrayslice(this.times),e=tc.arrayslice(this.values),n=this.getvaluesize(),r=this.getinterpolation()===u,i=t.length-1,a=1,o=1;o<i;++o){var s=!1,c=t[o];if(c!==t[o+1]&&(1!==o||c!==c[0]))if(r)s=!0;else for(var l=o*n,u=l-n,h=l+n,d=0;d!==n;++d){var p=e[l+d];if(p!==e[u+d]||p!==e[h+d]){s=!0;break}}if(s){if(o!==a){t[a]=t[o];for(var f=o*n,m=a*n,v=0;v!==n;++v)e[m+v]=e[f+v]}++a}}if(i>0){t[a]=t[i];for(var g=i*n,y=a*n,x=0;x!==n;++x)e[y+x]=e[g+x];++a}return a!==t.length?(this.times=tc.arrayslice(t,0,a),this.values=tc.arrayslice(e,0,a*n)):(this.times=t,this.values=e),this},clone:function(){var t=tc.arrayslice(this.times,0),e=tc.arrayslice(this.values,0),n=new(0,this.constructor)(this.name,t,e);return n.createinterpolant=this.createinterpolant,n}}),oc.prototype=object.assign(object.create(ac.prototype),{constructor:oc,valuetypename:"bool",valuebuffertype:array,defaultinterpolation:f,interpolantfactorymethodlinear:void 0,interpolantfactorymethodsmooth:void 0}),sc.prototype=object.assign(object.create(ac.prototype),{constructor:sc,valuetypename:"color"}),cc.prototype=object.assign(object.create(ac.prototype),{constructor:cc,valuetypename:"number"}),lc.prototype=object.assign(object.create(ec.prototype),{constructor:lc,interpolate_:function(t,e,n,r){for(var i=this.resultbuffer,a=this.samplevalues,o=this.valuesize,s=(n-e)/(r-e),c=t*o,l=c+o;c!==l;c+=4)wt.slerpflat(i,0,a,c-o,a,c,s);return i}}),uc.prototype=object.assign(object.create(ac.prototype),{constructor:uc,valuetypename:"quaternion",defaultinterpolation:g,interpolantfactorymethodlinear:function(t){return new lc(this.times,this.values,this.getvaluesize(),t)},interpolantfactorymethodsmooth:void 0}),hc.prototype=object.assign(object.create(ac.prototype),{constructor:hc,valuetypename:"string",valuebuffertype:array,defaultinterpolation:f,interpolantfactorymethodlinear:void 0,interpolantfactorymethodsmooth:void 0}),dc.prototype=object.assign(object.create(ac.prototype),{constructor:dc,valuetypename:"vector"}),object.assign(pc,{parse:function(t){for(var e=[],n=t.tracks,r=1/(t.fps||1),i=0,a=n.length;i!==a;++i)e.push(fc(n[i]).scale(r));var o=new pc(t.name,t.duration,e,t.blendmode);return o.uuid=t.uuid,o},tojson:function(t){for(var e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendmode:t.blendmode},i=0,a=n.length;i!==a;++i)e.push(ac.tojson(n[i]));return r},createfrommorphtargetsequence:function(t,e,n,r){for(var i=e.length,a=[],o=0;o<i;o++){var s=[],c=[];s.push((o+i-1)%i,o,(o+1)%i),c.push(0,1,0);var l=tc.getkeyframeorder(s);s=tc.sortedarray(s,1,l),c=tc.sortedarray(c,1,l),r||0!==s[0]||(s.push(i),c.push(c[0])),a.push(new cc(".morphtargetinfluences["+e[o].name+"]",s,c).scale(1/n))}return new pc(t,-1,a)},findbyname:function(t,e){var n=t;if(!array.isarray(t)){var r=t;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null},createclipsfrommorphtargetsequences:function(t,e,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=t.length;a<o;a++){var s=t[a],c=s.name.match(i);if(c&&c.length>1){var l=c[1],u=r[l];u||(r[l]=u=[]),u.push(s)}}var h=[];for(var d in r)h.push(pc.createfrommorphtargetsequence(d,r[d],e,n));return h},parseanimation:function(t,e){if(!t)return console.error("three.animationclip: no animation in jsonloader data."),null;for(var n=function(t,e,n,r,i){if(0!==n.length){var a=[],o=[];tc.flattenjson(n,a,o,r),0!==a.length&&i.push(new t(e,a,o))}},r=[],i=t.name||"default",a=t.fps||30,o=t.blendmode,s=t.length||-1,c=t.hierarchy||[],l=0;l<c.length;l++){var u=c[l].keys;if(u&&0!==u.length)if(u[0].morphtargets){var h={},d=void 0;for(d=0;d<u.length;d++)if(u[d].morphtargets)for(var p=0;p<u[d].morphtargets.length;p++)h[u[d].morphtargets[p]]=-1;for(var f in h){for(var m=[],v=[],g=0;g!==u[d].morphtargets.length;++g){var y=u[d];m.push(y.time),v.push(y.morphtarget===f?1:0)}r.push(new cc(".morphtargetinfluence["+f+"]",m,v))}s=h.length*(a||1)}else{var x=".bones["+e[l].name+"]";n(dc,x+".position",u,"pos",r),n(uc,x+".quaternion",u,"rot",r),n(dc,x+".scale",u,"scl",r)}}return 0===r.length?null:new pc(i,s,r,o)}}),object.assign(pc.prototype,{resetduration:function(){for(var t=0,e=0,n=this.tracks.length;e!==n;++e){var r=this.tracks[e];t=math.max(t,r.times[r.times.length-1])}return this.duration=t,this},trim:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this},validate:function(){for(var t=!0,e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t},optimize:function(){for(var t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this},clone:function(){for(var t=[],e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new pc(this.name,this.duration,t,this.blendmode)},tojson:function(){return pc.tojson(this)}});var mc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function vc(t,e,n){var r=this,i=!1,a=0,o=0,s=void 0,c=[];this.onstart=void 0,this.onload=t,this.onprogress=e,this.onerror=n,this.itemstart=function(t){o++,!1===i&&void 0!==r.onstart&&r.onstart(t,a,o),i=!0},this.itemend=function(t){a++,void 0!==r.onprogress&&r.onprogress(t,a,o),a===o&&(i=!1,void 0!==r.onload&&r.onload())},this.itemerror=function(t){void 0!==r.onerror&&r.onerror(t)},this.resolveurl=function(t){return s?s(t):t},this.seturlmodifier=function(t){return s=t,this},this.addhandler=function(t,e){return c.push(t,e),this},this.removehandler=function(t){var e=c.indexof(t);return-1!==e&&c.splice(e,2),this},this.gethandler=function(t){for(var e=0,n=c.length;e<n;e+=2){var r=c[e],i=c[e+1];if(r.global&&(r.lastindex=0),r.test(t))return i}return null}}var gc=new vc;function yc(t){this.manager=void 0!==t?t:gc,this.crossorigin="anonymous",this.withcredentials=!1,this.path="",this.resourcepath="",this.requestheader={}}object.assign(yc.prototype,{load:function(){},loadasync:function(t,e){var n=this;return new promise((function(r,i){n.load(t,r,e,i)}))},parse:function(){},setcrossorigin:function(t){return this.crossorigin=t,this},setwithcredentials:function(t){return this.withcredentials=t,this},setpath:function(t){return this.path=t,this},setresourcepath:function(t){return this.resourcepath=t,this},setrequestheader:function(t){return this.requestheader=t,this}});var xc={};function _c(t){yc.call(this,t)}function bc(t){yc.call(this,t)}function wc(t){yc.call(this,t)}function mc(t){yc.call(this,t)}function sc(t){yc.call(this,t)}function tc(t){yc.call(this,t)}function ec(t){yc.call(this,t)}function ac(){this.type="curve",this.arclengthdivisions=200}function lc(t,e,n,r,i,a,o,s){ac.call(this),this.type="ellipsecurve",this.ax=t||0,this.ay=e||0,this.xradius=n||1,this.yradius=r||1,this.astartangle=i||0,this.aendangle=a||2*math.pi,this.aclockwise=o||!1,this.arotation=s||0}function rc(t,e,n,r,i,a){lc.call(this,t,e,n,n,r,i,a),this.type="arccurve"}function cc(){var t=0,e=0,n=0,r=0;function i(i,a,o,s){t=i,e=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initcatmullrom:function(t,e,n,r,a){i(e,n,a*(n-t),a*(r-e))},initnonuniformcatmullrom:function(t,e,n,r,a,o,s){var c=(e-t)/a-(n-t)/(a+o)+(n-e)/o,l=(n-e)/o-(r-e)/(o+s)+(r-n)/s;i(e,n,c*=o,l*=o)},calc:function(i){var a=i*i;return t+e*i+n*a+r*(a*i)}}}_c.prototype=object.assign(object.create(yc.prototype),{constructor:_c,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveurl(t);var i=this,a=mc.get(t);if(void 0!==a)return i.manager.itemstart(t),settimeout((function(){e&&e(a),i.manager.itemend(t)}),0),a;if(void 0===xc[t]){var o,s=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var c=s[1],l=!!s[2],u=s[3];u=decodeuricomponent(u),l&&(u=atob(u));try{var h,d=(this.responsetype||"").tolowercase();switch(d){case"arraybuffer":case"blob":for(var p=new uint8array(u.length),f=0;f<u.length;f++)p[f]=u.charcodeat(f);h="blob"===d?new blob([p.buffer],{type:c}):p.buffer;break;case"document":var m=new domparser;h=m.parsefromstring(u,c);break;case"json":h=json.parse(u);break;default:h=u}settimeout((function(){e&&e(h),i.manager.itemend(t)}),0)}catch(e){settimeout((function(){r&&r(e),i.manager.itemerror(t),i.manager.itemend(t)}),0)}}else{for(var v in xc[t]=[],xc[t].push({onload:e,onprogress:n,onerror:r}),(o=new xmlhttprequest).open("get",t,!0),o.addeventlistener("load",(function(e){var n=this.response,r=xc[t];if(delete xc[t],200===this.status||0===this.status){0===this.status&&console.warn("three.fileloader: http status 0 received."),mc.add(t,n);for(var a=0,o=r.length;a<o;a++){var s=r[a];s.onload&&s.onload(n)}i.manager.itemend(t)}else{for(var c=0,l=r.length;c<l;c++){var u=r[c];u.onerror&&u.onerror(e)}i.manager.itemerror(t),i.manager.itemend(t)}}),!1),o.addeventlistener("progress",(function(e){for(var n=xc[t],r=0,i=n.length;r<i;r++){var a=n[r];a.onprogress&&a.onprogress(e)}}),!1),o.addeventlistener("error",(function(e){var n=xc[t];delete xc[t];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onerror&&o.onerror(e)}i.manager.itemerror(t),i.manager.itemend(t)}),!1),o.addeventlistener("abort",(function(e){var n=xc[t];delete xc[t];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onerror&&o.onerror(e)}i.manager.itemerror(t),i.manager.itemend(t)}),!1),void 0!==this.responsetype&&(o.responsetype=this.responsetype),void 0!==this.withcredentials&&(o.withcredentials=this.withcredentials),o.overridemimetype&&o.overridemimetype(void 0!==this.mimetype?this.mimetype:"text/plain"),this.requestheader)o.setrequestheader(v,this.requestheader[v]);o.send(null)}return i.manager.itemstart(t),o}xc[t].push({onload:e,onprogress:n,onerror:r})},setresponsetype:function(t){return this.responsetype=t,this},setmimetype:function(t){return this.mimetype=t,this}}),bc.prototype=object.assign(object.create(yc.prototype),{constructor:bc,load:function(t,e,n,r){var i=this,a=new _c(i.manager);a.setpath(i.path),a.setrequestheader(i.requestheader),a.setwithcredentials(i.withcredentials),a.load(t,(function(n){try{e(i.parse(json.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemerror(t)}}),n,r)},parse:function(t){for(var e=[],n=0;n<t.length;n++){var r=pc.parse(t[n]);e.push(r)}return e}}),wc.prototype=object.assign(object.create(yc.prototype),{constructor:wc,load:function(t,e,n,r){var i=this,a=[],o=new mo,s=new _c(this.manager);s.setpath(this.path),s.setresponsetype("arraybuffer"),s.setrequestheader(this.requestheader),s.setwithcredentials(i.withcredentials);var c=0;function l(l){s.load(t[l],(function(t){var n=i.parse(t,!0);a[l]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(c+=1)&&(1===n.mipmapcount&&(o.minfilter=m),o.image=a,o.format=n.format,o.needsupdate=!0,e&&e(o))}),n,r)}if(array.isarray(t))for(var u=0,h=t.length;u<h;++u)l(u);else s.load(t,(function(t){var n=i.parse(t,!0);if(n.iscubemap){for(var r=n.mipmaps.length/n.mipmapcount,s=0;s<r;s++){a[s]={mipmaps:[]};for(var c=0;c<n.mipmapcount;c++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapcount+c]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapcount&&(o.minfilter=m),o.format=n.format,o.needsupdate=!0,e&&e(o)}),n,r);return o}}),mc.prototype=object.assign(object.create(yc.prototype),{constructor:mc,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveurl(t);var i=this,a=mc.get(t);if(void 0!==a)return i.manager.itemstart(t),settimeout((function(){e&&e(a),i.manager.itemend(t)}),0),a;var o=document.createelementns("http://www.w3.org/1999/xhtml","img");function s(){o.removeeventlistener("load",s,!1),o.removeeventlistener("error",c,!1),mc.add(t,this),e&&e(this),i.manager.itemend(t)}function c(e){o.removeeventlistener("load",s,!1),o.removeeventlistener("error",c,!1),r&&r(e),i.manager.itemerror(t),i.manager.itemend(t)}return o.addeventlistener("load",s,!1),o.addeventlistener("error",c,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossorigin&&(o.crossorigin=this.crossorigin),i.manager.itemstart(t),o.src=t,o}}),sc.prototype=object.assign(object.create(yc.prototype),{constructor:sc,load:function(t,e,n,r){var i=new jn,a=new mc(this.manager);a.setcrossorigin(this.crossorigin),a.setpath(this.path);var o=0;function s(n){a.load(t[n],(function(t){i.images[n]=t,6===++o&&(i.needsupdate=!0,e&&e(i))}),void 0,r)}for(var c=0;c<t.length;++c)s(c);return i}}),tc.prototype=object.assign(object.create(yc.prototype),{constructor:tc,load:function(t,e,n,r){var i=this,a=new kn,o=new _c(this.manager);return o.setresponsetype("arraybuffer"),o.setrequestheader(this.requestheader),o.setpath(this.path),o.setwithcredentials(i.withcredentials),o.load(t,(function(t){var n=i.parse(t);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wraps=void 0!==n.wraps?n.wraps:u,a.wrapt=void 0!==n.wrapt?n.wrapt:u,a.magfilter=void 0!==n.magfilter?n.magfilter:m,a.minfilter=void 0!==n.minfilter?n.minfilter:m,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minfilter=g),1===n.mipmapcount&&(a.minfilter=m),a.needsupdate=!0,e&&e(a,n))}),n,r),a}}),ec.prototype=object.assign(object.create(yc.prototype),{constructor:ec,load:function(t,e,n,r){var i=new gt,a=new mc(this.manager);return a.setcrossorigin(this.crossorigin),a.setpath(this.path),a.load(t,(function(n){i.image=n;var r=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);i.format=r?s:t,i.needsupdate=!0,void 0!==e&&e(i)}),n,r),i}}),object.assign(ac.prototype,{getpoint:function(){return console.warn("three.curve: .getpoint() not implemented."),null},getpointat:function(t,e){var n=this.getutotmapping(t);return this.getpoint(n,e)},getpoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getpoint(n/t));return e},getspacedpoints:function(t){void 0===t&&(t=5);for(var e=[],n=0;n<=t;n++)e.push(this.getpointat(n/t));return e},getlength:function(){var t=this.getlengths();return t[t.length-1]},getlengths:function(t){if(void 0===t&&(t=this.arclengthdivisions),this.cachearclengths&&this.cachearclengths.length===t+1&&!this.needsupdate)return this.cachearclengths;this.needsupdate=!1;var e,n=[],r=this.getpoint(0),i=0;n.push(0);for(var a=1;a<=t;a++)i+=(e=this.getpoint(a/t)).distanceto(r),n.push(i),r=e;return this.cachearclengths=n,n},updatearclengths:function(){this.needsupdate=!0,this.getlengths()},getutotmapping:function(t,e){var n,r=this.getlengths(),i=0,a=r.length;n=e||t*r[a-1];for(var o,s=0,c=a-1;s<=c;)if((o=r[i=math.floor(s+(c-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){c=i;break}c=i-1}if(r[i=c]===n)return i/(a-1);var l=r[i];return(i+(n-l)/(r[i+1]-l))/(a-1)},gettangent:function(t,e){var n=1e-4,r=t-n,i=t+n;r<0&&(r=0),i>1&&(i=1);var a=this.getpoint(r),o=this.getpoint(i),s=e||(a.isvector2?new pt:new mt);return s.copy(o).sub(a).normalize(),s},gettangentat:function(t,e){var n=this.getutotmapping(t);return this.gettangent(n,e)},computefrenetframes:function(t,e){for(var n=new mt,r=[],i=[],a=[],o=new mt,s=new qt,c=0;c<=t;c++){var l=c/t;r[c]=this.gettangentat(l,new mt),r[c].normalize()}i[0]=new mt,a[0]=new mt;var u=number.max_value,h=math.abs(r[0].x),d=math.abs(r[0].y),p=math.abs(r[0].z);h<=u&&(u=h,n.set(1,0,0)),d<=u&&(u=d,n.set(0,1,0)),p<=u&&n.set(0,0,1),o.crossvectors(r[0],n).normalize(),i[0].crossvectors(r[0],o),a[0].crossvectors(r[0],i[0]);for(var f=1;f<=t;f++){if(i[f]=i[f-1].clone(),a[f]=a[f-1].clone(),o.crossvectors(r[f-1],r[f]),o.length()>number.epsilon){o.normalize();var m=math.acos(st.clamp(r[f-1].dot(r[f]),-1,1));i[f].applymatrix4(s.makerotationaxis(o,m))}a[f].crossvectors(r[f],i[f])}if(!0===e){var v=math.acos(st.clamp(i[0].dot(i[t]),-1,1));v/=t,r[0].dot(o.crossvectors(i[0],i[t]))>0&&(v=-v);for(var g=1;g<=t;g++)i[g].applymatrix4(s.makerotationaxis(r[g],v*g)),a[g].crossvectors(r[g],i[g])}return{tangents:r,normals:i,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.arclengthdivisions=t.arclengthdivisions,this},tojson:function(){var t={metadata:{version:4.5,type:"curve",generator:"curve.tojson"}};return t.arclengthdivisions=this.arclengthdivisions,t.type=this.type,t},fromjson:function(t){return this.arclengthdivisions=t.arclengthdivisions,this}}),lc.prototype=object.create(ac.prototype),lc.prototype.constructor=lc,lc.prototype.isellipsecurve=!0,lc.prototype.getpoint=function(t,e){for(var n=e||new pt,r=2*math.pi,i=this.aendangle-this.astartangle,a=math.abs(i)<number.epsilon;i<0;)i+=r;for(;i>r;)i-=r;i<number.epsilon&&(i=a?0:r),!0!==this.aclockwise||a||(i===r?i=-r:i-=r);var o=this.astartangle+t*i,s=this.ax+this.xradius*math.cos(o),c=this.ay+this.yradius*math.sin(o);if(0!==this.arotation){var l=math.cos(this.arotation),u=math.sin(this.arotation),h=s-this.ax,d=c-this.ay;s=h*l-d*u+this.ax,c=h*u+d*l+this.ay}return n.set(s,c)},lc.prototype.copy=function(t){return ac.prototype.copy.call(this,t),this.ax=t.ax,this.ay=t.ay,this.xradius=t.xradius,this.yradius=t.yradius,this.astartangle=t.astartangle,this.aendangle=t.aendangle,this.aclockwise=t.aclockwise,this.arotation=t.arotation,this},lc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);return t.ax=this.ax,t.ay=this.ay,t.xradius=this.xradius,t.yradius=this.yradius,t.astartangle=this.astartangle,t.aendangle=this.aendangle,t.aclockwise=this.aclockwise,t.arotation=this.arotation,t},lc.prototype.fromjson=function(t){return ac.prototype.fromjson.call(this,t),this.ax=t.ax,this.ay=t.ay,this.xradius=t.xradius,this.yradius=t.yradius,this.astartangle=t.astartangle,this.aendangle=t.aendangle,this.aclockwise=t.aclockwise,this.arotation=t.arotation,this},rc.prototype=object.create(lc.prototype),rc.prototype.constructor=rc,rc.prototype.isarccurve=!0;var pc=new mt,ic=new cc,nc=new cc,dc=new cc;function oc(t,e,n,r){void 0===t&&(t=[]),void 0===e&&(e=!1),void 0===n&&(n="centripetal"),void 0===r&&(r=.5),ac.call(this),this.type="catmullromcurve3",this.points=t,this.closed=e,this.curvetype=n,this.tension=r}function bc(t,e,n,r,i){var a=.5*(r-e),o=.5*(i-n),s=t*t;return(2*n-2*r+a+o)*(t*s)+(-3*n+3*r-2*a-o)*s+a*t+n}function zc(t,e,n,r){return function(t,e){var n=1-t;return n*n*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,n)+function(t,e){return t*t*e}(t,r)}function fc(t,e,n,r,i){return function(t,e){var n=1-t;return n*n*n*e}(t,e)+function(t,e){var n=1-t;return 3*n*n*t*e}(t,n)+function(t,e){return 3*(1-t)*t*t*e}(t,r)+function(t,e){return t*t*t*e}(t,i)}function gc(t,e,n,r){void 0===t&&(t=new pt),void 0===e&&(e=new pt),void 0===n&&(n=new pt),void 0===r&&(r=new pt),ac.call(this),this.type="cubicbeziercurve",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function uc(t,e,n,r){void 0===t&&(t=new mt),void 0===e&&(e=new mt),void 0===n&&(n=new mt),void 0===r&&(r=new mt),ac.call(this),this.type="cubicbeziercurve3",this.v0=t,this.v1=e,this.v2=n,this.v3=r}function hc(t,e){void 0===t&&(t=new pt),void 0===e&&(e=new pt),ac.call(this),this.type="linecurve",this.v1=t,this.v2=e}function kc(t,e){void 0===t&&(t=new mt),void 0===e&&(e=new mt),ac.call(this),this.type="linecurve3",this.v1=t,this.v2=e}function vc(t,e,n){void 0===t&&(t=new pt),void 0===e&&(e=new pt),void 0===n&&(n=new pt),ac.call(this),this.type="quadraticbeziercurve",this.v0=t,this.v1=e,this.v2=n}function wc(t,e,n){void 0===t&&(t=new mt),void 0===e&&(e=new mt),void 0===n&&(n=new mt),ac.call(this),this.type="quadraticbeziercurve3",this.v0=t,this.v1=e,this.v2=n}function jc(t){void 0===t&&(t=[]),ac.call(this),this.type="splinecurve",this.points=t}oc.prototype=object.create(ac.prototype),oc.prototype.constructor=oc,oc.prototype.iscatmullromcurve3=!0,oc.prototype.getpoint=function(t,e){void 0===e&&(e=new mt);var n,r,i=e,a=this.points,o=a.length,s=(o-(this.closed?0:1))*t,c=math.floor(s),l=s-c;this.closed?c+=c>0?0:(math.floor(math.abs(c)/o)+1)*o:0===l&&c===o-1&&(c=o-2,l=1),this.closed||c>0?n=a[(c-1)%o]:(pc.subvectors(a[0],a[1]).add(a[0]),n=pc);var u=a[c%o],h=a[(c+1)%o];if(this.closed||c+2<o?r=a[(c+2)%o]:(pc.subvectors(a[o-1],a[o-2]).add(a[o-1]),r=pc),"centripetal"===this.curvetype||"chordal"===this.curvetype){var d="chordal"===this.curvetype?.5:.25,p=math.pow(n.distancetosquared(u),d),f=math.pow(u.distancetosquared(h),d),m=math.pow(h.distancetosquared(r),d);f<1e-4&&(f=1),p<1e-4&&(p=f),m<1e-4&&(m=f),ic.initnonuniformcatmullrom(n.x,u.x,h.x,r.x,p,f,m),nc.initnonuniformcatmullrom(n.y,u.y,h.y,r.y,p,f,m),dc.initnonuniformcatmullrom(n.z,u.z,h.z,r.z,p,f,m)}else"catmullrom"===this.curvetype&&(ic.initcatmullrom(n.x,u.x,h.x,r.x,this.tension),nc.initcatmullrom(n.y,u.y,h.y,r.y,this.tension),dc.initcatmullrom(n.z,u.z,h.z,r.z,this.tension));return i.set(ic.calc(l),nc.calc(l),dc.calc(l)),i},oc.prototype.copy=function(t){ac.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(r.clone())}return this.closed=t.closed,this.curvetype=t.curvetype,this.tension=t.tension,this},oc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var r=this.points[e];t.points.push(r.toarray())}return t.closed=this.closed,t.curvetype=this.curvetype,t.tension=this.tension,t},oc.prototype.fromjson=function(t){ac.prototype.fromjson.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new mt).fromarray(r))}return this.closed=t.closed,this.curvetype=t.curvetype,this.tension=t.tension,this},gc.prototype=object.create(ac.prototype),gc.prototype.constructor=gc,gc.prototype.iscubicbeziercurve=!0,gc.prototype.getpoint=function(t,e){void 0===e&&(e=new pt);var n=e,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(fc(t,r.x,i.x,a.x,o.x),fc(t,r.y,i.y,a.y,o.y)),n},gc.prototype.copy=function(t){return ac.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},gc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);return t.v0=this.v0.toarray(),t.v1=this.v1.toarray(),t.v2=this.v2.toarray(),t.v3=this.v3.toarray(),t},gc.prototype.fromjson=function(t){return ac.prototype.fromjson.call(this,t),this.v0.fromarray(t.v0),this.v1.fromarray(t.v1),this.v2.fromarray(t.v2),this.v3.fromarray(t.v3),this},uc.prototype=object.create(ac.prototype),uc.prototype.constructor=uc,uc.prototype.iscubicbeziercurve3=!0,uc.prototype.getpoint=function(t,e){void 0===e&&(e=new mt);var n=e,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(fc(t,r.x,i.x,a.x,o.x),fc(t,r.y,i.y,a.y,o.y),fc(t,r.z,i.z,a.z,o.z)),n},uc.prototype.copy=function(t){return ac.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this},uc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);return t.v0=this.v0.toarray(),t.v1=this.v1.toarray(),t.v2=this.v2.toarray(),t.v3=this.v3.toarray(),t},uc.prototype.fromjson=function(t){return ac.prototype.fromjson.call(this,t),this.v0.fromarray(t.v0),this.v1.fromarray(t.v1),this.v2.fromarray(t.v2),this.v3.fromarray(t.v3),this},hc.prototype=object.create(ac.prototype),hc.prototype.constructor=hc,hc.prototype.islinecurve=!0,hc.prototype.getpoint=function(t,e){void 0===e&&(e=new pt);var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyscalar(t).add(this.v1)),n},hc.prototype.getpointat=function(t,e){return this.getpoint(t,e)},hc.prototype.gettangent=function(t,e){var n=e||new pt;return n.copy(this.v2).sub(this.v1).normalize(),n},hc.prototype.copy=function(t){return ac.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},hc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);return t.v1=this.v1.toarray(),t.v2=this.v2.toarray(),t},hc.prototype.fromjson=function(t){return ac.prototype.fromjson.call(this,t),this.v1.fromarray(t.v1),this.v2.fromarray(t.v2),this},kc.prototype=object.create(ac.prototype),kc.prototype.constructor=kc,kc.prototype.islinecurve3=!0,kc.prototype.getpoint=function(t,e){void 0===e&&(e=new mt);var n=e;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyscalar(t).add(this.v1)),n},kc.prototype.getpointat=function(t,e){return this.getpoint(t,e)},kc.prototype.copy=function(t){return ac.prototype.copy.call(this,t),this.v1.copy(t.v1),this.v2.copy(t.v2),this},kc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);return t.v1=this.v1.toarray(),t.v2=this.v2.toarray(),t},kc.prototype.fromjson=function(t){return ac.prototype.fromjson.call(this,t),this.v1.fromarray(t.v1),this.v2.fromarray(t.v2),this},vc.prototype=object.create(ac.prototype),vc.prototype.constructor=vc,vc.prototype.isquadraticbeziercurve=!0,vc.prototype.getpoint=function(t,e){void 0===e&&(e=new pt);var n=e,r=this.v0,i=this.v1,a=this.v2;return n.set(zc(t,r.x,i.x,a.x),zc(t,r.y,i.y,a.y)),n},vc.prototype.copy=function(t){return ac.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},vc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);return t.v0=this.v0.toarray(),t.v1=this.v1.toarray(),t.v2=this.v2.toarray(),t},vc.prototype.fromjson=function(t){return ac.prototype.fromjson.call(this,t),this.v0.fromarray(t.v0),this.v1.fromarray(t.v1),this.v2.fromarray(t.v2),this},wc.prototype=object.create(ac.prototype),wc.prototype.constructor=wc,wc.prototype.isquadraticbeziercurve3=!0,wc.prototype.getpoint=function(t,e){void 0===e&&(e=new mt);var n=e,r=this.v0,i=this.v1,a=this.v2;return n.set(zc(t,r.x,i.x,a.x),zc(t,r.y,i.y,a.y),zc(t,r.z,i.z,a.z)),n},wc.prototype.copy=function(t){return ac.prototype.copy.call(this,t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this},wc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);return t.v0=this.v0.toarray(),t.v1=this.v1.toarray(),t.v2=this.v2.toarray(),t},wc.prototype.fromjson=function(t){return ac.prototype.fromjson.call(this,t),this.v0.fromarray(t.v0),this.v1.fromarray(t.v1),this.v2.fromarray(t.v2),this},jc.prototype=object.create(ac.prototype),jc.prototype.constructor=jc,jc.prototype.issplinecurve=!0,jc.prototype.getpoint=function(t,e){void 0===e&&(e=new pt);var n=e,r=this.points,i=(r.length-1)*t,a=math.floor(i),o=i-a,s=r[0===a?a:a-1],c=r[a],l=r[a>r.length-2?r.length-1:a+1],u=r[a>r.length-3?r.length-1:a+2];return n.set(bc(o,s.x,c.x,l.x,u.x),bc(o,s.y,c.y,l.y,u.y)),n},jc.prototype.copy=function(t){ac.prototype.copy.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push(r.clone())}return this},jc.prototype.tojson=function(){var t=ac.prototype.tojson.call(this);t.points=[];for(var e=0,n=this.points.length;e<n;e++){var r=this.points[e];t.points.push(r.toarray())}return t},jc.prototype.fromjson=function(t){ac.prototype.fromjson.call(this,t),this.points=[];for(var e=0,n=t.points.length;e<n;e++){var r=t.points[e];this.points.push((new pt).fromarray(r))}return this};var qc=object.freeze({__proto__:null,arccurve:rc,catmullromcurve3:oc,cubicbeziercurve:gc,cubicbeziercurve3:uc,ellipsecurve:lc,linecurve:hc,linecurve3:kc,quadraticbeziercurve:vc,quadraticbeziercurve3:wc,splinecurve:jc});function xc(){ac.call(this),this.type="curvepath",this.curves=[],this.autoclose=!1}function yc(t){xc.call(this),this.type="path",this.currentpoint=new pt,t&&this.setfrompoints(t)}function zc(t){yc.call(this,t),this.uuid=st.generateuuid(),this.type="shape",this.holes=[]}function jc(t,e){void 0===e&&(e=1),we.call(this),this.type="light",this.color=new we(t),this.intensity=e}function qc(t,e,n){jc.call(this,t,n),this.type="hemispherelight",this.position.copy(we.defaultup),this.updatematrix(),this.groundcolor=new we(e)}function kc(t){this.camera=t,this.bias=0,this.normalbias=0,this.radius=1,this.mapsize=new pt(512,512),this.map=null,this.mappass=null,this.matrix=new qt,this.autoupdate=!0,this.needsupdate=!1,this._frustum=new er,this._frameextents=new pt(1,1),this._viewportcount=1,this._viewports=[new xt(0,0,1,1)]}function $c(){kc.call(this,new xn(50,1,.5,500)),this.focus=1}function tl(t,e,n,r,i,a){jc.call(this,t,e),this.type="spotlight",this.position.copy(we.defaultup),this.updatematrix(),this.target=new we,object.defineproperty(this,"power",{get:function(){return this.intensity*math.pi},set:function(t){this.intensity=t/math.pi}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:math.pi/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new $c}function el(){kc.call(this,new xn(90,1,.5,500)),this._frameextents=new pt(4,2),this._viewportcount=6,this._viewports=[new xt(2,1,1,1),new xt(0,1,1,1),new xt(3,1,1,1),new xt(1,1,1,1),new xt(3,0,1,1),new xt(1,0,1,1)],this._cubedirections=[new mt(1,0,0),new mt(-1,0,0),new mt(0,0,1),new mt(0,0,-1),new mt(0,1,0),new mt(0,-1,0)],this._cubeups=[new mt(0,1,0),new mt(0,1,0),new mt(0,1,0),new mt(0,1,0),new mt(0,0,1),new mt(0,0,-1)]}function nl(t,e,n,r){jc.call(this,t,e),this.type="pointlight",object.defineproperty(this,"power",{get:function(){return 4*this.intensity*math.pi},set:function(t){this.intensity=t/(4*math.pi)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new el}function rl(t,e,n,r,i,a){void 0===t&&(t=-1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=-1),void 0===i&&(i=.1),void 0===a&&(a=2e3),qn.call(this),this.type="orthographiccamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateprojectionmatrix()}function il(){kc.call(this,new rl(-5,5,5,-5,.5,500))}function al(t,e){jc.call(this,t,e),this.type="directionallight",this.position.copy(we.defaultup),this.updatematrix(),this.target=new we,this.shadow=new il}function ol(t,e){jc.call(this,t,e),this.type="ambientlight"}function sl(t,e,n,r){jc.call(this,t,e),this.type="rectarealight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}xc.prototype=object.assign(object.create(ac.prototype),{constructor:xc,add:function(t){this.curves.push(t)},closepath:function(){var t=this.curves[0].getpoint(0),e=this.curves[this.curves.length-1].getpoint(1);t.equals(e)||this.curves.push(new hc(e,t))},getpoint:function(t){for(var e=t*this.getlength(),n=this.getcurvelengths(),r=0;r<n.length;){if(n[r]>=e){var i=n[r]-e,a=this.curves[r],o=a.getlength(),s=0===o?0:1-i/o;return a.getpointat(s)}r++}return null},getlength:function(){var t=this.getcurvelengths();return t[t.length-1]},updatearclengths:function(){this.needsupdate=!0,this.cachelengths=null,this.getcurvelengths()},getcurvelengths:function(){if(this.cachelengths&&this.cachelengths.length===this.curves.length)return this.cachelengths;for(var t=[],e=0,n=0,r=this.curves.length;n<r;n++)e+=this.curves[n].getlength(),t.push(e);return this.cachelengths=t,t},getspacedpoints:function(t){void 0===t&&(t=40);for(var e=[],n=0;n<=t;n++)e.push(this.getpoint(n/t));return this.autoclose&&e.push(e[0]),e},getpoints:function(t){void 0===t&&(t=12);for(var e,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a&&a.isellipsecurve?2*t:a&&(a.islinecurve||a.islinecurve3)?1:a&&a.issplinecurve?t*a.points.length:t,s=a.getpoints(o),c=0;c<s.length;c++){var l=s[c];e&&e.equals(l)||(n.push(l),e=l)}return this.autoclose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(t){ac.prototype.copy.call(this,t),this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push(r.clone())}return this.autoclose=t.autoclose,this},tojson:function(){var t=ac.prototype.tojson.call(this);t.autoclose=this.autoclose,t.curves=[];for(var e=0,n=this.curves.length;e<n;e++){var r=this.curves[e];t.curves.push(r.tojson())}return t},fromjson:function(t){ac.prototype.fromjson.call(this,t),this.autoclose=t.autoclose,this.curves=[];for(var e=0,n=t.curves.length;e<n;e++){var r=t.curves[e];this.curves.push((new qc[r.type]).fromjson(r))}return this}}),yc.prototype=object.assign(object.create(xc.prototype),{constructor:yc,setfrompoints:function(t){this.moveto(t[0].x,t[0].y);for(var e=1,n=t.length;e<n;e++)this.lineto(t[e].x,t[e].y);return this},moveto:function(t,e){return this.currentpoint.set(t,e),this},lineto:function(t,e){var n=new hc(this.currentpoint.clone(),new pt(t,e));return this.curves.push(n),this.currentpoint.set(t,e),this},quadraticcurveto:function(t,e,n,r){var i=new vc(this.currentpoint.clone(),new pt(t,e),new pt(n,r));return this.curves.push(i),this.currentpoint.set(n,r),this},beziercurveto:function(t,e,n,r,i,a){var o=new gc(this.currentpoint.clone(),new pt(t,e),new pt(n,r),new pt(i,a));return this.curves.push(o),this.currentpoint.set(i,a),this},splinethru:function(t){var e=new jc([this.currentpoint.clone()].concat(t));return this.curves.push(e),this.currentpoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,i,a){var o=this.currentpoint.x,s=this.currentpoint.y;return this.absarc(t+o,e+s,n,r,i,a),this},absarc:function(t,e,n,r,i,a){return this.absellipse(t,e,n,n,r,i,a),this},ellipse:function(t,e,n,r,i,a,o,s){var c=this.currentpoint.x,l=this.currentpoint.y;return this.absellipse(t+c,e+l,n,r,i,a,o,s),this},absellipse:function(t,e,n,r,i,a,o,s){var c=new lc(t,e,n,r,i,a,o,s);if(this.curves.length>0){var l=c.getpoint(0);l.equals(this.currentpoint)||this.lineto(l.x,l.y)}this.curves.push(c);var u=c.getpoint(1);return this.currentpoint.copy(u),this},copy:function(t){return xc.prototype.copy.call(this,t),this.currentpoint.copy(t.currentpoint),this},tojson:function(){var t=xc.prototype.tojson.call(this);return t.currentpoint=this.currentpoint.toarray(),t},fromjson:function(t){return xc.prototype.fromjson.call(this,t),this.currentpoint.fromarray(t.currentpoint),this}}),zc.prototype=object.assign(object.create(yc.prototype),{constructor:zc,getpointsholes:function(t){for(var e=[],n=0,r=this.holes.length;n<r;n++)e[n]=this.holes[n].getpoints(t);return e},extractpoints:function(t){return{shape:this.getpoints(t),holes:this.getpointsholes(t)}},copy:function(t){yc.prototype.copy.call(this,t),this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push(r.clone())}return this},tojson:function(){var t=yc.prototype.tojson.call(this);t.uuid=this.uuid,t.holes=[];for(var e=0,n=this.holes.length;e<n;e++){var r=this.holes[e];t.holes.push(r.tojson())}return t},fromjson:function(t){yc.prototype.fromjson.call(this,t),this.uuid=t.uuid,this.holes=[];for(var e=0,n=t.holes.length;e<n;e++){var r=t.holes[e];this.holes.push((new yc).fromjson(r))}return this}}),jc.prototype=object.assign(object.create(we.prototype),{constructor:jc,islight:!0,copy:function(t){return we.prototype.copy.call(this,t),this.color.copy(t.color),this.intensity=t.intensity,this},tojson:function(t){var e=we.prototype.tojson.call(this,t);return e.object.color=this.color.gethex(),e.object.intensity=this.intensity,void 0!==this.groundcolor&&(e.object.groundcolor=this.groundcolor.gethex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.tojson()),e}}),qc.prototype=object.assign(object.create(jc.prototype),{constructor:qc,ishemispherelight:!0,copy:function(t){return jc.prototype.copy.call(this,t),this.groundcolor.copy(t.groundcolor),this}}),object.assign(kc.prototype,{_projscreenmatrix:new qt,_lightpositionworld:new mt,_looktarget:new mt,getviewportcount:function(){return this._viewportcount},getfrustum:function(){return this._frustum},updatematrices:function(t){var e=this.camera,n=this.matrix,r=this._projscreenmatrix,i=this._looktarget,a=this._lightpositionworld;a.setfrommatrixposition(t.matrixworld),e.position.copy(a),i.setfrommatrixposition(t.target.matrixworld),e.lookat(i),e.updatematrixworld(),r.multiplymatrices(e.projectionmatrix,e.matrixworldinverse),this._frustum.setfromprojectionmatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionmatrix),n.multiply(e.matrixworldinverse)},getviewport:function(t){return this._viewports[t]},getframeextents:function(){return this._frameextents},copy:function(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapsize.copy(t.mapsize),this},clone:function(){return(new this.constructor).copy(this)},tojson:function(){var t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalbias&&(t.normalbias=this.normalbias),1!==this.radius&&(t.radius=this.radius),512===this.mapsize.x&&512===this.mapsize.y||(t.mapsize=this.mapsize.toarray()),t.camera=this.camera.tojson(!1).object,delete t.camera.matrix,t}}),$c.prototype=object.assign(object.create(kc.prototype),{constructor:$c,isspotlightshadow:!0,updatematrices:function(t){var e=this.camera,n=2*st.rad2deg*t.angle*this.focus,r=this.mapsize.width/this.mapsize.height,i=t.distance||e.far;n===e.fov&&r===e.aspect&&i===e.far||(e.fov=n,e.aspect=r,e.far=i,e.updateprojectionmatrix()),kc.prototype.updatematrices.call(this,t)}}),tl.prototype=object.assign(object.create(jc.prototype),{constructor:tl,isspotlight:!0,copy:function(t){return jc.prototype.copy.call(this,t),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),el.prototype=object.assign(object.create(kc.prototype),{constructor:el,ispointlightshadow:!0,updatematrices:function(t,e){void 0===e&&(e=0);var n=this.camera,r=this.matrix,i=this._lightpositionworld,a=this._looktarget,o=this._projscreenmatrix;i.setfrommatrixposition(t.matrixworld),n.position.copy(i),a.copy(n.position),a.add(this._cubedirections[e]),n.up.copy(this._cubeups[e]),n.lookat(a),n.updatematrixworld(),r.maketranslation(-i.x,-i.y,-i.z),o.multiplymatrices(n.projectionmatrix,n.matrixworldinverse),this._frustum.setfromprojectionmatrix(o)}}),nl.prototype=object.assign(object.create(jc.prototype),{constructor:nl,ispointlight:!0,copy:function(t){return jc.prototype.copy.call(this,t),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}),rl.prototype=object.assign(object.create(qn.prototype),{constructor:rl,isorthographiccamera:!0,copy:function(t,e){return qn.prototype.copy.call(this,t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:object.assign({},t.view),this},setviewoffset:function(t,e,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullwidth:1,fullheight:1,offsetx:0,offsety:0,width:1,height:1}),this.view.enabled=!0,this.view.fullwidth=t,this.view.fullheight=e,this.view.offsetx=n,this.view.offsety=r,this.view.width=i,this.view.height=a,this.updateprojectionmatrix()},clearviewoffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateprojectionmatrix()},updateprojectionmatrix:function(){var t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-t,a=n+t,o=r+e,s=r-e;if(null!==this.view&&this.view.enabled){var c=(this.right-this.left)/this.view.fullwidth/this.zoom,l=(this.top-this.bottom)/this.view.fullheight/this.zoom;a=(i+=c*this.view.offsetx)+c*this.view.width,s=(o-=l*this.view.offsety)-l*this.view.height}this.projectionmatrix.makeorthographic(i,a,o,s,this.near,this.far),this.projectionmatrixinverse.copy(this.projectionmatrix).invert()},tojson:function(t){var e=we.prototype.tojson.call(this,t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=object.assign({},this.view)),e}}),il.prototype=object.assign(object.create(kc.prototype),{constructor:il,isdirectionallightshadow:!0,updatematrices:function(t){kc.prototype.updatematrices.call(this,t)}}),al.prototype=object.assign(object.create(jc.prototype),{constructor:al,isdirectionallight:!0,copy:function(t){return jc.prototype.copy.call(this,t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}),ol.prototype=object.assign(object.create(jc.prototype),{constructor:ol,isambientlight:!0}),sl.prototype=object.assign(object.create(jc.prototype),{constructor:sl,isrectarealight:!0,copy:function(t){return jc.prototype.copy.call(this,t),this.width=t.width,this.height=t.height,this},tojson:function(t){var e=jc.prototype.tojson.call(this,t);return e.object.width=this.width,e.object.height=this.height,e}});var cl=function(){function t(){object.defineproperty(this,"issphericalharmonics3",{value:!0}),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new mt)}var e=t.prototype;return e.set=function(t){for(var e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this},e.zero=function(){for(var t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this},e.getat=function(t,e){var n=t.x,r=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyscalar(.282095),e.addscaledvector(a[1],.488603*r),e.addscaledvector(a[2],.488603*i),e.addscaledvector(a[3],.488603*n),e.addscaledvector(a[4],n*r*1.092548),e.addscaledvector(a[5],r*i*1.092548),e.addscaledvector(a[6],.315392*(3*i*i-1)),e.addscaledvector(a[7],n*i*1.092548),e.addscaledvector(a[8],.546274*(n*n-r*r)),e},e.getirradianceat=function(t,e){var n=t.x,r=t.y,i=t.z,a=this.coefficients;return e.copy(a[0]).multiplyscalar(.886227),e.addscaledvector(a[1],1.023328*r),e.addscaledvector(a[2],1.023328*i),e.addscaledvector(a[3],1.023328*n),e.addscaledvector(a[4],.858086*n*r),e.addscaledvector(a[5],.858086*r*i),e.addscaledvector(a[6],.743125*i*i-.247708),e.addscaledvector(a[7],.858086*n*i),e.addscaledvector(a[8],.429043*(n*n-r*r)),e},e.add=function(t){for(var e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this},e.addscaledsh=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].addscaledvector(t.coefficients[n],e);return this},e.scale=function(t){for(var e=0;e<9;e++)this.coefficients[e].multiplyscalar(t);return this},e.lerp=function(t,e){for(var n=0;n<9;n++)this.coefficients[n].lerp(t.coefficients[n],e);return this},e.equals=function(t){for(var e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0},e.copy=function(t){return this.set(t.coefficients)},e.clone=function(){return(new this.constructor).copy(this)},e.fromarray=function(t,e){void 0===e&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].fromarray(t,e+3*r);return this},e.toarray=function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);for(var n=this.coefficients,r=0;r<9;r++)n[r].toarray(t,e+3*r);return t},t.getbasisat=function(t,e){var n=t.x,r=t.y,i=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*i,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*i,e[6]=.315392*(3*i*i-1),e[7]=1.092548*n*i,e[8]=.546274*(n*n-r*r)},t}();function ll(t,e){jc.call(this,void 0,e),this.type="lightprobe",this.sh=void 0!==t?t:new cl}function ul(t){yc.call(this,t),this.textures={}}ll.prototype=object.assign(object.create(jc.prototype),{constructor:ll,islightprobe:!0,copy:function(t){return jc.prototype.copy.call(this,t),this.sh.copy(t.sh),this},fromjson:function(t){return this.intensity=t.intensity,this.sh.fromarray(t.sh),this},tojson:function(t){var e=jc.prototype.tojson.call(this,t);return e.object.sh=this.sh.toarray(),e}}),ul.prototype=object.assign(object.create(yc.prototype),{constructor:ul,load:function(t,e,n,r){var i=this,a=new _c(i.manager);a.setpath(i.path),a.setrequestheader(i.requestheader),a.setwithcredentials(i.withcredentials),a.load(t,(function(n){try{e(i.parse(json.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemerror(t)}}),n,r)},parse:function(t){var e=this.textures;function n(t){return void 0===e[t]&&console.warn("three.materialloader: undefined texture",t),e[t]}var r=new $s[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&void 0!==r.color&&r.color.sethex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new we).sethex(t.sheen)),void 0!==t.emissive&&void 0!==r.emissive&&r.emissive.sethex(t.emissive),void 0!==t.specular&&void 0!==r.specular&&r.specular.sethex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatroughness&&(r.clearcoatroughness=t.clearcoatroughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatshading&&(r.flatshading=t.flatshading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphatest&&(r.alphatest=t.alphatest),void 0!==t.depthtest&&(r.depthtest=t.depthtest),void 0!==t.depthwrite&&(r.depthwrite=t.depthwrite),void 0!==t.colorwrite&&(r.colorwrite=t.colorwrite),void 0!==t.stencilwrite&&(r.stencilwrite=t.stencilwrite),void 0!==t.stencilwritemask&&(r.stencilwritemask=t.stencilwritemask),void 0!==t.stencilfunc&&(r.stencilfunc=t.stencilfunc),void 0!==t.stencilref&&(r.stencilref=t.stencilref),void 0!==t.stencilfuncmask&&(r.stencilfuncmask=t.stencilfuncmask),void 0!==t.stencilfail&&(r.stencilfail=t.stencilfail),void 0!==t.stencilzfail&&(r.stencilzfail=t.stencilzfail),void 0!==t.stencilzpass&&(r.stencilzpass=t.stencilzpass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframelinewidth&&(r.wireframelinewidth=t.wireframelinewidth),void 0!==t.wireframelinecap&&(r.wireframelinecap=t.wireframelinecap),void 0!==t.wireframelinejoin&&(r.wireframelinejoin=t.wireframelinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashsize&&(r.dashsize=t.dashsize),void 0!==t.gapsize&&(r.gapsize=t.gapsize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonoffset&&(r.polygonoffset=t.polygonoffset),void 0!==t.polygonoffsetfactor&&(r.polygonoffsetfactor=t.polygonoffsetfactor),void 0!==t.polygonoffsetunits&&(r.polygonoffsetunits=t.polygonoffsetunits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphtargets&&(r.morphtargets=t.morphtargets),void 0!==t.morphnormals&&(r.morphnormals=t.morphnormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertextangents&&(r.vertextangents=t.vertextangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.tonemapped&&(r.tonemapped=t.tonemapped),void 0!==t.userdata&&(r.userdata=t.userdata),void 0!==t.vertexcolors&&("number"==typeof t.vertexcolors?r.vertexcolors=t.vertexcolors>0:r.vertexcolors=t.vertexcolors),void 0!==t.uniforms)for(var i in t.uniforms){var a=t.uniforms[i];switch(r.uniforms[i]={},a.type){case"t":r.uniforms[i].value=n(a.value);break;case"c":r.uniforms[i].value=(new we).sethex(a.value);break;case"v2":r.uniforms[i].value=(new pt).fromarray(a.value);break;case"v3":r.uniforms[i].value=(new mt).fromarray(a.value);break;case"v4":r.uniforms[i].value=(new xt).fromarray(a.value);break;case"m3":r.uniforms[i].value=(new ft).fromarray(a.value);break;case"m4":r.uniforms[i].value=(new qt).fromarray(a.value);break;default:r.uniforms[i].value=a.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexshader&&(r.vertexshader=t.vertexshader),void 0!==t.fragmentshader&&(r.fragmentshader=t.fragmentshader),void 0!==t.extensions)for(var o in t.extensions)r.extensions[o]=t.extensions[o];if(void 0!==t.shading&&(r.flatshading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeattenuation&&(r.sizeattenuation=t.sizeattenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphamap&&(r.alphamap=n(t.alphamap)),void 0!==t.bumpmap&&(r.bumpmap=n(t.bumpmap)),void 0!==t.bumpscale&&(r.bumpscale=t.bumpscale),void 0!==t.normalmap&&(r.normalmap=n(t.normalmap)),void 0!==t.normalmaptype&&(r.normalmaptype=t.normalmaptype),void 0!==t.normalscale){var s=t.normalscale;!1===array.isarray(s)&&(s=[s,s]),r.normalscale=(new pt).fromarray(s)}return void 0!==t.displacementmap&&(r.displacementmap=n(t.displacementmap)),void 0!==t.displacementscale&&(r.displacementscale=t.displacementscale),void 0!==t.displacementbias&&(r.displacementbias=t.displacementbias),void 0!==t.roughnessmap&&(r.roughnessmap=n(t.roughnessmap)),void 0!==t.metalnessmap&&(r.metalnessmap=n(t.metalnessmap)),void 0!==t.emissivemap&&(r.emissivemap=n(t.emissivemap)),void 0!==t.emissiveintensity&&(r.emissiveintensity=t.emissiveintensity),void 0!==t.specularmap&&(r.specularmap=n(t.specularmap)),void 0!==t.envmap&&(r.envmap=n(t.envmap)),void 0!==t.envmapintensity&&(r.envmapintensity=t.envmapintensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionratio&&(r.refractionratio=t.refractionratio),void 0!==t.lightmap&&(r.lightmap=n(t.lightmap)),void 0!==t.lightmapintensity&&(r.lightmapintensity=t.lightmapintensity),void 0!==t.aomap&&(r.aomap=n(t.aomap)),void 0!==t.aomapintensity&&(r.aomapintensity=t.aomapintensity),void 0!==t.gradientmap&&(r.gradientmap=n(t.gradientmap)),void 0!==t.clearcoatmap&&(r.clearcoatmap=n(t.clearcoatmap)),void 0!==t.clearcoatroughnessmap&&(r.clearcoatroughnessmap=n(t.clearcoatroughnessmap)),void 0!==t.clearcoatnormalmap&&(r.clearcoatnormalmap=n(t.clearcoatnormalmap)),void 0!==t.clearcoatnormalscale&&(r.clearcoatnormalscale=(new pt).fromarray(t.clearcoatnormalscale)),void 0!==t.transmission&&(r.transmission=t.transmission),void 0!==t.transmissionmap&&(r.transmissionmap=n(t.transmissionmap)),r},settextures:function(t){return this.textures=t,this}});var hl={decodetext:function(t){if("undefined"!=typeof textdecoder)return(new textdecoder).decode(t);for(var e="",n=0,r=t.length;n<r;n++)e+=string.fromcharcode(t[n]);try{return decodeuricomponent(escape(e))}catch(t){return e}},extracturlbase:function(t){var e=t.lastindexof("/");return-1===e?"./":t.substr(0,e+1)}};function dl(){_n.call(this),this.type="instancedbuffergeometry",this.instancecount=1/0}function pl(t,e,n,r){"number"==typeof n&&(r=n,n=!1,console.error("three.instancedbufferattribute: the constructor now expects normalized as the third argument.")),qe.call(this,t,e,n),this.meshperattribute=r||1}function fl(t){yc.call(this,t)}dl.prototype=object.assign(object.create(_n.prototype),{constructor:dl,isinstancedbuffergeometry:!0,copy:function(t){return _n.prototype.copy.call(this,t),this.instancecount=t.instancecount,this},clone:function(){return(new this.constructor).copy(this)},tojson:function(){var t=_n.prototype.tojson.call(this);return t.instancecount=this.instancecount,t.isinstancedbuffergeometry=!0,t}}),pl.prototype=object.assign(object.create(qe.prototype),{constructor:pl,isinstancedbufferattribute:!0,copy:function(t){return qe.prototype.copy.call(this,t),this.meshperattribute=t.meshperattribute,this},tojson:function(){var t=qe.prototype.tojson.call(this);return t.meshperattribute=this.meshperattribute,t.isinstancedbufferattribute=!0,t}}),fl.prototype=object.assign(object.create(yc.prototype),{constructor:fl,load:function(t,e,n,r){var i=this,a=new _c(i.manager);a.setpath(i.path),a.setrequestheader(i.requestheader),a.setwithcredentials(i.withcredentials),a.load(t,(function(n){try{e(i.parse(json.parse(n)))}catch(e){r?r(e):console.error(e),i.manager.itemerror(t)}}),n,r)},parse:function(t){var e={},n={};function r(t,r){if(void 0!==e[r])return e[r];var i=t.interleavedbuffers[r],a=function(t,e){if(void 0!==n[e])return n[e];var r=t.arraybuffers[e],i=new uint32array(r).buffer;return n[e]=i,i}(t,i.buffer),o=new da(dn(i.type,a),i.stride);return o.uuid=i.uuid,e[r]=o,o}var i=t.isinstancedbuffergeometry?new dl:new _n,a=t.data.index;if(void 0!==a){var o=dn(a.type,a.array);i.setindex(new qe(o,1))}var s=t.data.attributes;for(var c in s){var l=s[c],u=void 0;if(l.isinterleavedbufferattribute){u=new ma(r(t.data,l.data),l.itemsize,l.offset,l.normalized)}else{var h=dn(l.type,l.array);u=new(l.isinstancedbufferattribute?pl:qe)(h,l.itemsize,l.normalized)}void 0!==l.name&&(u.name=l.name),i.setattribute(c,u)}var d=t.data.morphattributes;if(d)for(var p in d){for(var f=d[p],m=[],v=0,g=f.length;v<g;v++){var y=f[v],x=void 0;if(y.isinterleavedbufferattribute)x=new ma(r(t.data,y.data),y.itemsize,y.offset,y.normalized);else x=new qe(dn(y.type,y.array),y.itemsize,y.normalized);void 0!==y.name&&(x.name=y.name),m.push(x)}i.morphattributes[p]=m}t.data.morphtargetsrelative&&(i.morphtargetsrelative=!0);var _=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==_)for(var b=0,w=_.length;b!==w;++b){var m=_[b];i.addgroup(m.start,m.count,m.materialindex)}var s=t.data.boundingsphere;if(void 0!==s){var t=new mt;void 0!==s.center&&t.fromarray(s.center),i.boundingsphere=new kt(t,s.radius)}return t.name&&(i.name=t.name),t.userdata&&(i.userdata=t.userdata),i}});var ml,vl=function(t){function e(e){return t.call(this,e)||this}ut(e,t);var n=e.prototype;return n.load=function(t,e,n,r){var i=this,a=""===this.path?hl.extracturlbase(t):this.path;this.resourcepath=this.resourcepath||a;var o=new _c(this.manager);o.setpath(this.path),o.setrequestheader(this.requestheader),o.setwithcredentials(this.withcredentials),o.load(t,(function(n){var a=null;try{a=json.parse(n)}catch(e){return void 0!==r&&r(e),void console.error("three:objectloader: can't parse "+t+".",e.message)}var o=a.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.tolowercase()?i.parse(a,e):console.error("three.objectloader: can't load "+t)}),n,r)},n.parse=function(t,e){var n=this.parseanimations(t.animations),r=this.parseshapes(t.shapes),i=this.parsegeometries(t.geometries,r),a=this.parseimages(t.images,(function(){void 0!==e&&e(c)})),o=this.parsetextures(t.textures,a),s=this.parsematerials(t.materials,o),c=this.parseobject(t.object,i,s,n),l=this.parseskeletons(t.skeletons,c);if(this.bindskeletons(c,l),void 0!==e){var u=!1;for(var h in a)if(a[h]instanceof htmlimageelement){u=!0;break}!1===u&&e(c)}return c},n.parseshapes=function(t){var e={};if(void 0!==t)for(var n=0,r=t.length;n<r;n++){var i=(new zc).fromjson(t[n]);e[i.uuid]=i}return e},n.parseskeletons=function(t,e){var n={},r={};if(e.traverse((function(t){t.isbone&&(r[t.uuid]=t)})),void 0!==t)for(var i=0,a=t.length;i<a;i++){var o=(new va).fromjson(t[i],r);n[o.uuid]=o}return n},n.parsegeometries=function(t,e){var n,r={};if(void 0!==t)for(var i=new fl,a=0,o=t.length;a<o;a++){var s=void 0,c=t[a];switch(c.type){case"planegeometry":case"planebuffergeometry":s=new ks[c.type](c.width,c.height,c.widthsegments,c.heightsegments);break;case"boxgeometry":case"boxbuffergeometry":case"cubegeometry":s=new ks[c.type](c.width,c.height,c.depth,c.widthsegments,c.heightsegments,c.depthsegments);break;case"circlegeometry":case"circlebuffergeometry":s=new ks[c.type](c.radius,c.segments,c.thetastart,c.thetalength);break;case"cylindergeometry":case"cylinderbuffergeometry":s=new ks[c.type](c.radiustop,c.radiusbottom,c.height,c.radialsegments,c.heightsegments,c.openended,c.thetastart,c.thetalength);break;case"conegeometry":case"conebuffergeometry":s=new ks[c.type](c.radius,c.height,c.radialsegments,c.heightsegments,c.openended,c.thetastart,c.thetalength);break;case"spheregeometry":case"spherebuffergeometry":s=new ks[c.type](c.radius,c.widthsegments,c.heightsegments,c.phistart,c.philength,c.thetastart,c.thetalength);break;case"dodecahedrongeometry":case"dodecahedronbuffergeometry":case"icosahedrongeometry":case"icosahedronbuffergeometry":case"octahedrongeometry":case"octahedronbuffergeometry":case"tetrahedrongeometry":case"tetrahedronbuffergeometry":s=new ks[c.type](c.radius,c.detail);break;case"ringgeometry":case"ringbuffergeometry":s=new ks[c.type](c.innerradius,c.outerradius,c.thetasegments,c.phisegments,c.thetastart,c.thetalength);break;case"torusgeometry":case"torusbuffergeometry":s=new ks[c.type](c.radius,c.tube,c.radialsegments,c.tubularsegments,c.arc);break;case"torusknotgeometry":case"torusknotbuffergeometry":s=new ks[c.type](c.radius,c.tube,c.tubularsegments,c.radialsegments,c.p,c.q);break;case"tubegeometry":case"tubebuffergeometry":s=new ks[c.type]((new qc[c.path.type]).fromjson(c.path),c.tubularsegments,c.radius,c.radialsegments,c.closed);break;case"lathegeometry":case"lathebuffergeometry":s=new ks[c.type](c.points,c.segments,c.phistart,c.philength);break;case"polyhedrongeometry":case"polyhedronbuffergeometry":s=new ks[c.type](c.vertices,c.indices,c.radius,c.details);break;case"shapegeometry":case"shapebuffergeometry":n=[];for(var l=0,u=c.shapes.length;l<u;l++){var h=e[c.shapes[l]];n.push(h)}s=new ks[c.type](n,c.curvesegments);break;case"extrudegeometry":case"extrudebuffergeometry":n=[];for(var d=0,p=c.shapes.length;d<p;d++){var f=e[c.shapes[d]];n.push(f)}var m=c.options.extrudepath;void 0!==m&&(c.options.extrudepath=(new qc[m.type]).fromjson(m)),s=new ks[c.type](n,c.options);break;case"buffergeometry":case"instancedbuffergeometry":s=i.parse(c);break;case"geometry":console.error('three.objectloader: loading "geometry" is not supported anymore.');break;default:console.warn('three.objectloader: unsupported geometry type "'+c.type+'"');continue}s.uuid=c.uuid,void 0!==c.name&&(s.name=c.name),!0===s.isbuffergeometry&&void 0!==c.userdata&&(s.userdata=c.userdata),r[c.uuid]=s}return r},n.parsematerials=function(t,e){var n={},r={};if(void 0!==t){var i=new ul;i.settextures(e);for(var a=0,o=t.length;a<o;a++){var s=t[a];if("multimaterial"===s.type){for(var c=[],l=0;l<s.materials.length;l++){var u=s.materials[l];void 0===n[u.uuid]&&(n[u.uuid]=i.parse(u)),c.push(n[u.uuid])}r[s.uuid]=c}else void 0===n[s.uuid]&&(n[s.uuid]=i.parse(s)),r[s.uuid]=n[s.uuid]}}return r},n.parseanimations=function(t){var e={};if(void 0!==t)for(var n=0;n<t.length;n++){var r=t[n],i=pc.parse(r);e[i.uuid]=i}return e},n.parseimages=function(t,e){var n,r=this,i={};function a(t){if("string"==typeof t){var e=t;return function(t){return r.manager.itemstart(t),n.load(t,(function(){r.manager.itemend(t)}),void 0,(function(){r.manager.itemerror(t),r.manager.itemend(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:r.resourcepath+e)}return t.data?{data:dn(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){var o=new vc(e);(n=new mc(o)).setcrossorigin(this.crossorigin);for(var s=0,c=t.length;s<c;s++){var l=t[s],u=l.url;if(array.isarray(u)){i[l.uuid]=[];for(var h=0,d=u.length;h<d;h++){var p=a(u[h]);null!==p&&(p instanceof htmlimageelement?i[l.uuid].push(p):i[l.uuid].push(new kn(p.data,p.width,p.height)))}}else{var f=a(l.url);null!==f&&(i[l.uuid]=f)}}}return i},n.parsetextures=function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("three.objectloader.parsetexture: constant should be in numeric form.",t),e[t])}var r={};if(void 0!==t)for(var i=0,a=t.length;i<a;i++){var o=t[i];void 0===o.image&&console.warn('three.objectloader: no "image" specified for',o.uuid),void 0===e[o.image]&&console.warn("three.objectloader: undefined image",o.image);var s=void 0,c=e[o.image];array.isarray(c)?(s=new jn(c),6===c.length&&(s.needsupdate=!0)):(s=c&&c.data?new kn(c.data,c.width,c.height):new gt(c),c&&(s.needsupdate=!0)),s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),void 0!==o.mapping&&(s.mapping=n(o.mapping,gl)),void 0!==o.offset&&s.offset.fromarray(o.offset),void 0!==o.repeat&&s.repeat.fromarray(o.repeat),void 0!==o.center&&s.center.fromarray(o.center),void 0!==o.rotation&&(s.rotation=o.rotation),void 0!==o.wrap&&(s.wraps=n(o.wrap[0],yl),s.wrapt=n(o.wrap[1],yl)),void 0!==o.format&&(s.format=o.format),void 0!==o.type&&(s.type=o.type),void 0!==o.encoding&&(s.encoding=o.encoding),void 0!==o.minfilter&&(s.minfilter=n(o.minfilter,xl)),void 0!==o.magfilter&&(s.magfilter=n(o.magfilter,xl)),void 0!==o.anisotropy&&(s.anisotropy=o.anisotropy),void 0!==o.flipy&&(s.flipy=o.flipy),void 0!==o.premultiplyalpha&&(s.premultiplyalpha=o.premultiplyalpha),void 0!==o.unpackalignment&&(s.unpackalignment=o.unpackalignment),r[o.uuid]=s}return r},n.parseobject=function(t,e,n,r){var i,a,o;function s(t){return void 0===e[t]&&console.warn("three.objectloader: undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(array.isarray(t)){for(var e=[],r=0,i=t.length;r<i;r++){var a=t[r];void 0===n[a]&&console.warn("three.objectloader: undefined material",a),e.push(n[a])}return e}return void 0===n[t]&&console.warn("three.objectloader: undefined material",t),n[t]}}switch(t.type){case"scene":i=new ha,void 0!==t.background&&number.isinteger(t.background)&&(i.background=new we(t.background)),void 0!==t.fog&&("fog"===t.fog.type?i.fog=new ua(t.fog.color,t.fog.near,t.fog.far):"fogexp2"===t.fog.type&&(i.fog=new la(t.fog.color,t.fog.density)));break;case"perspectivecamera":i=new xn(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(i.focus=t.focus),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.filmgauge&&(i.filmgauge=t.filmgauge),void 0!==t.filmoffset&&(i.filmoffset=t.filmoffset),void 0!==t.view&&(i.view=object.assign({},t.view));break;case"orthographiccamera":i=new rl(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(i.zoom=t.zoom),void 0!==t.view&&(i.view=object.assign({},t.view));break;case"ambientlight":i=new ol(t.color,t.intensity);break;case"directionallight":i=new al(t.color,t.intensity);break;case"pointlight":i=new nl(t.color,t.intensity,t.distance,t.decay);break;case"rectarealight":i=new sl(t.color,t.intensity,t.width,t.height);break;case"spotlight":i=new tl(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"hemispherelight":i=new qc(t.color,t.groundcolor,t.intensity);break;case"lightprobe":i=(new ll).fromjson(t);break;case"skinnedmesh":i=new ga(a=s(t.geometry),o=c(t.material)),void 0!==t.bindmode&&(i.bindmode=t.bindmode),void 0!==t.bindmatrix&&i.bindmatrix.fromarray(t.bindmatrix),void 0!==t.skeleton&&(i.skeleton=t.skeleton);break;case"mesh":i=new fn(a=s(t.geometry),o=c(t.material));break;case"instancedmesh":a=s(t.geometry),o=c(t.material);var l=t.count,u=t.instancematrix;(i=new ya(a,o,l)).instancematrix=new qe(new float32array(u.array),16);break;case"lod":i=new na;break;case"line":i=new eo(s(t.geometry),c(t.material));break;case"lineloop":i=new ao(s(t.geometry),c(t.material));break;case"linesegments":i=new io(s(t.geometry),c(t.material));break;case"pointcloud":case"points":i=new ho(s(t.geometry),c(t.material));break;case"sprite":i=new ra(c(t.material));break;case"group":i=new ra;break;case"bone":i=new ua;break;default:i=new we}if(i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(i.matrix.fromarray(t.matrix),void 0!==t.matrixautoupdate&&(i.matrixautoupdate=t.matrixautoupdate),i.matrixautoupdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromarray(t.position),void 0!==t.rotation&&i.rotation.fromarray(t.rotation),void 0!==t.quaternion&&i.quaternion.fromarray(t.quaternion),void 0!==t.scale&&i.scale.fromarray(t.scale)),void 0!==t.castshadow&&(i.castshadow=t.castshadow),void 0!==t.receiveshadow&&(i.receiveshadow=t.receiveshadow),t.shadow&&(void 0!==t.shadow.bias&&(i.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalbias&&(i.shadow.normalbias=t.shadow.normalbias),void 0!==t.shadow.radius&&(i.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapsize&&i.shadow.mapsize.fromarray(t.shadow.mapsize),void 0!==t.shadow.camera&&(i.shadow.camera=this.parseobject(t.shadow.camera))),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.frustumculled&&(i.frustumculled=t.frustumculled),void 0!==t.renderorder&&(i.renderorder=t.renderorder),void 0!==t.userdata&&(i.userdata=t.userdata),void 0!==t.layers&&(i.layers.mask=t.layers),void 0!==t.children)for(var h=t.children,d=0;d<h.length;d++)i.add(this.parseobject(h[d],e,n,r));if(void 0!==t.animations)for(var p=t.animations,f=0;f<p.length;f++){var m=p[f];i.animations.push(r[m])}if("lod"===t.type){void 0!==t.autoupdate&&(i.autoupdate=t.autoupdate);for(var v=t.levels,g=0;g<v.length;g++){var y=v[g],x=i.getobjectbyproperty("uuid",y.object);void 0!==x&&i.addlevel(x,y.distance)}}return i},n.bindskeletons=function(t,e){0!==object.keys(e).length&&t.traverse((function(t){if(!0===t.isskinnedmesh&&void 0!==t.skeleton){var n=e[t.skeleton];void 0===n?console.warn("three.objectloader: no skeleton found with uuid:",t.skeleton):t.bind(n,t.bindmatrix)}}))},n.settexturepath=function(t){return console.warn("three.objectloader: .settexturepath() has been renamed to .setresourcepath()."),this.setresourcepath(t)},e}(yc),gl={uvmapping:n,cubereflectionmapping:r,cuberefractionmapping:i,equirectangularreflectionmapping:a,equirectangularrefractionmapping:o,cubeuvreflectionmapping:s,cubeuvrefractionmapping:c},yl={repeatwrapping:l,clamptoedgewrapping:u,mirroredrepeatwrapping:h},xl={nearestfilter:d,nearestmipmapnearestfilter:p,nearestmipmaplinearfilter:f,linearfilter:m,linearmipmapnearestfilter:v,linearmipmaplinearfilter:g};function _l(t){"undefined"==typeof createimagebitmap&&console.warn("three.imagebitmaploader: createimagebitmap() not supported."),"undefined"==typeof fetch&&console.warn("three.imagebitmaploader: fetch() not supported."),yc.call(this,t),this.options={premultiplyalpha:"none"}}function bl(){this.type="shapepath",this.color=new we,this.subpaths=[],this.currentpath=null}function wl(t){this.type="font",this.data=t}function ml(t,e,n,r,i){var a=i.glyphs[t]||i.glyphs["?"];if(a){var o,s,c,l,u,h,d,p,f=new bl;if(a.o)for(var m=a._cachedoutline||(a._cachedoutline=a.o.split(" ")),v=0,g=m.length;v<g;){switch(m[v++]){case"m":o=m[v++]*e+n,s=m[v++]*e+r,f.moveto(o,s);break;case"l":o=m[v++]*e+n,s=m[v++]*e+r,f.lineto(o,s);break;case"q":c=m[v++]*e+n,l=m[v++]*e+r,u=m[v++]*e+n,h=m[v++]*e+r,f.quadraticcurveto(u,h,c,l);break;case"b":c=m[v++]*e+n,l=m[v++]*e+r,u=m[v++]*e+n,h=m[v++]*e+r,d=m[v++]*e+n,p=m[v++]*e+r,f.beziercurveto(u,h,d,p,c,l)}}return{offsetx:a.ha*e,path:f}}console.error('three.font: character "'+t+'" does not exists in font family '+i.familyname+".")}function sl(t){yc.call(this,t)}_l.prototype=object.assign(object.create(yc.prototype),{constructor:_l,isimagebitmaploader:!0,setoptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveurl(t);var i=this,a=mc.get(t);if(void 0!==a)return i.manager.itemstart(t),settimeout((function(){e&&e(a),i.manager.itemend(t)}),0),a;var o={};o.credentials="anonymous"===this.crossorigin?"same-origin":"include",fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createimagebitmap(t,i.options)})).then((function(n){mc.add(t,n),e&&e(n),i.manager.itemend(t)})).catch((function(e){r&&r(e),i.manager.itemerror(t),i.manager.itemend(t)})),i.manager.itemstart(t)}}),object.assign(bl.prototype,{moveto:function(t,e){return this.currentpath=new yc,this.subpaths.push(this.currentpath),this.currentpath.moveto(t,e),this},lineto:function(t,e){return this.currentpath.lineto(t,e),this},quadraticcurveto:function(t,e,n,r){return this.currentpath.quadraticcurveto(t,e,n,r),this},beziercurveto:function(t,e,n,r,i,a){return this.currentpath.beziercurveto(t,e,n,r,i,a),this},splinethru:function(t){return this.currentpath.splinethru(t),this},toshapes:function(t,e){function n(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],a=new zc;a.curves=i.curves,e.push(a)}return e}function r(t,e){for(var n=e.length,r=!1,i=n-1,a=0;a<n;i=a++){var o=e[i],s=e[a],c=s.x-o.x,l=s.y-o.y;if(math.abs(l)>number.epsilon){if(l<0&&(o=e[a],c=-c,s=e[i],l=-l),t.y<o.y||t.y>s.y)continue;if(t.y===o.y){if(t.x===o.x)return!0}else{var u=l*(t.x-o.x)-c*(t.y-o.y);if(0===u)return!0;if(u<0)continue;r=!r}}else{if(t.y!==o.y)continue;if(s.x<=t.x&&t.x<=o.x||o.x<=t.x&&t.x<=s.x)return!0}}return r}var i,a,o,s=ls.isclockwise,c=this.subpaths;if(0===c.length)return[];if(!0===e)return n(c);var l=[];if(1===c.length)return a=c[0],(o=new zc).curves=a.curves,l.push(o),l;var u=!s(c[0].getpoints());u=t?!u:u;var h,d,p=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=c.length;g<y;g++)i=s(h=(a=c[g]).getpoints()),(i=t?!i:i)?(!u&&f[v]&&v++,f[v]={s:new zc,p:h},f[v].s.curves=a.curves,u&&v++,m[v]=[]):m[v].push({h:a,p:h[0]});if(!f[0])return n(c);if(f.length>1){for(var x=!1,_=[],b=0,w=f.length;b<w;b++)p[b]=[];for(var m=0,s=f.length;m<s;m++)for(var t=m[m],e=0;e<t.length;e++){for(var a=t[e],l=!0,r=0;r<f.length;r++)r(a.p,f[r].p)&&(m!==r&&_.push({froms:m,tos:r,hole:e}),l?(l=!1,p[r].push(a)):x=!0);l&&p[m].push(a)}_.length>0&&(x||(m=p))}for(var c=0,p=f.length;c<p;c++){o=f[c].s,l.push(o);for(var i=0,n=(d=m[c]).length;i<n;i++)o.holes.push(d[i].h)}return l}}),object.assign(wl.prototype,{isfont:!0,generateshapes:function(t,e){void 0===e&&(e=100);for(var n=[],r=function(t,e,n){for(var r=array.from?array.from(t):string(t).split(""),i=e/n.resolution,a=(n.boundingbox.ymax-n.boundingbox.ymin+n.underlinethickness)*i,o=[],s=0,c=0,l=0;l<r.length;l++){var u=r[l];if("\n"===u)s=0,c-=a;else{var h=ml(u,i,s,c,n);s+=h.offsetx,o.push(h.path)}}return o}(t,e,this.data),i=0,a=r.length;i<a;i++)array.prototype.push.apply(n,r[i].toshapes());return n}}),sl.prototype=object.assign(object.create(yc.prototype),{constructor:sl,load:function(t,e,n,r){var i=this,a=new _c(this.manager);a.setpath(this.path),a.setrequestheader(this.requestheader),a.setwithcredentials(i.withcredentials),a.load(t,(function(t){var n;try{n=json.parse(t)}catch(e){console.warn("three.fontloader: typeface.js support is being deprecated. use typeface.json instead."),n=json.parse(t.substring(65,t.length-2))}var r=i.parse(n);e&&e(r)}),n,r)},parse:function(t){return new wl(t)}});var tl={getcontext:function(){return void 0===ml&&(ml=new(window.audiocontext||window.webkitaudiocontext)),ml},setcontext:function(t){ml=t}};function el(t){yc.call(this,t)}function al(t,e,n){ll.call(this,void 0,n);var r=(new we).set(t),i=(new we).set(e),a=new mt(r.r,r.g,r.b),o=new mt(i.r,i.g,i.b),s=math.sqrt(math.pi),c=s*math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyscalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyscalar(c)}function ll(t,e){ll.call(this,void 0,e);var n=(new we).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyscalar(2*math.sqrt(math.pi))}el.prototype=object.assign(object.create(yc.prototype),{constructor:el,load:function(t,e,n,r){var i=this,a=new _c(i.manager);a.setresponsetype("arraybuffer"),a.setpath(i.path),a.setrequestheader(i.requestheader),a.setwithcredentials(i.withcredentials),a.load(t,(function(n){try{var a=n.slice(0);tl.getcontext().decodeaudiodata(a,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),i.manager.itemerror(t)}}),n,r)}}),al.prototype=object.assign(object.create(ll.prototype),{constructor:al,ishemispherelightprobe:!0,copy:function(t){return ll.prototype.copy.call(this,t),this},tojson:function(t){return ll.prototype.tojson.call(this,t)}}),ll.prototype=object.assign(object.create(ll.prototype),{constructor:ll,isambientlightprobe:!0,copy:function(t){return ll.prototype.copy.call(this,t),this},tojson:function(t){return ll.prototype.tojson.call(this,t)}});var rl=new qt,cl=new qt;function pl(){this.type="stereocamera",this.aspect=1,this.eyesep=.064,this.cameral=new xn,this.cameral.layers.enable(1),this.cameral.matrixautoupdate=!1,this.camerar=new xn,this.camerar.layers.enable(2),this.camerar.matrixautoupdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyesep:null}}object.assign(pl.prototype,{update:function(t){var e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyesep!==this.eyesep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyesep=this.eyesep;var n,r,i=t.projectionmatrix.clone(),a=e.eyesep/2,o=a*e.near/e.focus,s=e.near*math.tan(st.deg2rad*e.fov*.5)/e.zoom;cl.elements[12]=-a,rl.elements[12]=a,n=-s*e.aspect+o,r=s*e.aspect+o,i.elements[0]=2*e.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameral.projectionmatrix.copy(i),n=-s*e.aspect-o,r=s*e.aspect-o,i.elements[0]=2*e.near/(r-n),i.elements[8]=(r+n)/(r-n),this.camerar.projectionmatrix.copy(i)}this.cameral.matrixworld.copy(t.matrixworld).multiply(cl),this.camerar.matrixworld.copy(t.matrixworld).multiply(rl)}});var il=function(){function t(t){this.autostart=void 0===t||t,this.starttime=0,this.oldtime=0,this.elapsedtime=0,this.running=!1}var e=t.prototype;return e.start=function(){this.starttime=nl(),this.oldtime=this.starttime,this.elapsedtime=0,this.running=!0},e.stop=function(){this.getelapsedtime(),this.running=!1,this.autostart=!1},e.getelapsedtime=function(){return this.getdelta(),this.elapsedtime},e.getdelta=function(){var t=0;if(this.autostart&&!this.running)return this.start(),0;if(this.running){var e=nl();t=(e-this.oldtime)/1e3,this.oldtime=e,this.elapsedtime+=t}return t},t}();function nl(){return("undefined"==typeof performance?date:performance).now()}var dl=new mt,ol=new wt,bl=new mt,zl=new mt,fl=function(t){function e(){var e;return(e=t.call(this)||this).type="audiolistener",e.context=tl.getcontext(),e.gain=e.context.creategain(),e.gain.connect(e.context.destination),e.filter=null,e.timedelta=0,e._clock=new il,e}ut(e,t);var n=e.prototype;return n.getinput=function(){return this.gain},n.removefilter=function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},n.getfilter=function(){return this.filter},n.setfilter=function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},n.getmastervolume=function(){return this.gain.gain.value},n.setmastervolume=function(t){return this.gain.gain.settargetattime(t,this.context.currenttime,.01),this},n.updatematrixworld=function(e){t.prototype.updatematrixworld.call(this,e);var n=this.context.listener,r=this.up;if(this.timedelta=this._clock.getdelta(),this.matrixworld.decompose(dl,ol,bl),zl.set(0,0,-1).applyquaternion(ol),n.positionx){var i=this.context.currenttime+this.timedelta;n.positionx.linearramptovalueattime(dl.x,i),n.positiony.linearramptovalueattime(dl.y,i),n.positionz.linearramptovalueattime(dl.z,i),n.forwardx.linearramptovalueattime(zl.x,i),n.forwardy.linearramptovalueattime(zl.y,i),n.forwardz.linearramptovalueattime(zl.z,i),n.upx.linearramptovalueattime(r.x,i),n.upy.linearramptovalueattime(r.y,i),n.upz.linearramptovalueattime(r.z,i)}else n.setposition(dl.x,dl.y,dl.z),n.setorientation(zl.x,zl.y,zl.z,r.x,r.y,r.z)},e}(we),gl=function(t){function e(e){var n;return(n=t.call(this)||this).type="audio",n.listener=e,n.context=e.context,n.gain=n.context.creategain(),n.gain.connect(e.getinput()),n.autoplay=!1,n.buffer=null,n.detune=0,n.loop=!1,n.loopstart=0,n.loopend=0,n.offset=0,n.duration=void 0,n.playbackrate=1,n.isplaying=!1,n.hasplaybackcontrol=!0,n.source=null,n.sourcetype="empty",n._startedat=0,n._progress=0,n._connected=!1,n.filters=[],n}ut(e,t);var n=e.prototype;return n.getoutput=function(){return this.gain},n.setnodesource=function(t){return this.hasplaybackcontrol=!1,this.sourcetype="audionode",this.source=t,this.connect(),this},n.setmediaelementsource=function(t){return this.hasplaybackcontrol=!1,this.sourcetype="medianode",this.source=this.context.createmediaelementsource(t),this.connect(),this},n.setmediastreamsource=function(t){return this.hasplaybackcontrol=!1,this.sourcetype="mediastreamnode",this.source=this.context.createmediastreamsource(t),this.connect(),this},n.setbuffer=function(t){return this.buffer=t,this.sourcetype="buffer",this.autoplay&&this.play(),this},n.play=function(t){if(void 0===t&&(t=0),!0!==this.isplaying){if(!1!==this.hasplaybackcontrol){this._startedat=this.context.currenttime+t;var e=this.context.createbuffersource();return e.buffer=this.buffer,e.loop=this.loop,e.loopstart=this.loopstart,e.loopend=this.loopend,e.onended=this.onended.bind(this),e.start(this._startedat,this._progress+this.offset,this.duration),this.isplaying=!0,this.source=e,this.setdetune(this.detune),this.setplaybackrate(this.playbackrate),this.connect()}console.warn("three.audio: this audio has no playback control.")}else console.warn("three.audio: audio is already playing.")},n.pause=function(){if(!1!==this.hasplaybackcontrol)return!0===this.isplaying&&(this._progress+=math.max(this.context.currenttime-this._startedat,0)*this.playbackrate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isplaying=!1),this;console.warn("three.audio: this audio has no playback control.")},n.stop=function(){if(!1!==this.hasplaybackcontrol)return this._progress=0,this.source.stop(),this.source.onended=null,this.isplaying=!1,this;console.warn("three.audio: this audio has no playback control.")},n.connect=function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getoutput())}else this.source.connect(this.getoutput());return this._connected=!0,this},n.disconnect=function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getoutput())}else this.source.disconnect(this.getoutput());return this._connected=!1,this},n.getfilters=function(){return this.filters},n.setfilters=function(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this},n.setdetune=function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isplaying&&this.source.detune.settargetattime(this.detune,this.context.currenttime,.01),this},n.getdetune=function(){return this.detune},n.getfilter=function(){return this.getfilters()[0]},n.setfilter=function(t){return this.setfilters(t?[t]:[])},n.setplaybackrate=function(t){if(!1!==this.hasplaybackcontrol)return this.playbackrate=t,!0===this.isplaying&&this.source.playbackrate.settargetattime(this.playbackrate,this.context.currenttime,.01),this;console.warn("three.audio: this audio has no playback control.")},n.getplaybackrate=function(){return this.playbackrate},n.onended=function(){this.isplaying=!1},n.getloop=function(){return!1===this.hasplaybackcontrol?(console.warn("three.audio: this audio has no playback control."),!1):this.loop},n.setloop=function(t){if(!1!==this.hasplaybackcontrol)return this.loop=t,!0===this.isplaying&&(this.source.loop=this.loop),this;console.warn("three.audio: this audio has no playback control.")},n.setloopstart=function(t){return this.loopstart=t,this},n.setloopend=function(t){return this.loopend=t,this},n.getvolume=function(){return this.gain.gain.value},n.setvolume=function(t){return this.gain.gain.settargetattime(t,this.context.currenttime,.01),this},e}(we),ul=new mt,hl=new wt,kl=new mt,vl=new mt,wl=function(t){function e(e){var n;return(n=t.call(this,e)||this).panner=n.context.createpanner(),n.panner.panningmodel="hrtf",n.panner.connect(n.gain),n}ut(e,t);var n=e.prototype;return n.getoutput=function(){return this.panner},n.getrefdistance=function(){return this.panner.refdistance},n.setrefdistance=function(t){return this.panner.refdistance=t,this},n.getrollofffactor=function(){return this.panner.rollofffactor},n.setrollofffactor=function(t){return this.panner.rollofffactor=t,this},n.getdistancemodel=function(){return this.panner.distancemodel},n.setdistancemodel=function(t){return this.panner.distancemodel=t,this},n.getmaxdistance=function(){return this.panner.maxdistance},n.setmaxdistance=function(t){return this.panner.maxdistance=t,this},n.setdirectionalcone=function(t,e,n){return this.panner.coneinnerangle=t,this.panner.coneouterangle=e,this.panner.coneoutergain=n,this},n.updatematrixworld=function(e){if(t.prototype.updatematrixworld.call(this,e),!0!==this.hasplaybackcontrol||!1!==this.isplaying){this.matrixworld.decompose(ul,hl,kl),vl.set(0,0,1).applyquaternion(hl);var n=this.panner;if(n.positionx){var r=this.context.currenttime+this.listener.timedelta;n.positionx.linearramptovalueattime(ul.x,r),n.positiony.linearramptovalueattime(ul.y,r),n.positionz.linearramptovalueattime(ul.z,r),n.orientationx.linearramptovalueattime(vl.x,r),n.orientationy.linearramptovalueattime(vl.y,r),n.orientationz.linearramptovalueattime(vl.z,r)}else n.setposition(ul.x,ul.y,ul.z),n.setorientation(vl.x,vl.y,vl.z)}},e}(gl),jl=function(){function t(t,e){void 0===e&&(e=2048),this.analyser=t.context.createanalyser(),this.analyser.fftsize=e,this.data=new uint8array(this.analyser.frequencybincount),t.getoutput().connect(this.analyser)}var e=t.prototype;return e.getfrequencydata=function(){return this.analyser.getbytefrequencydata(this.data),this.data},e.getaveragefrequency=function(){for(var t=0,e=this.getfrequencydata(),n=0;n<e.length;n++)t+=e[n];return t/e.length},t}();function ql(t,e,n){var r,i,a;switch(this.binding=t,this.valuesize=n,e){case"quaternion":r=this._slerp,i=this._slerpadditive,a=this._setadditiveidentityquaternion,this.buffer=new float64array(6*n),this._workindex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setadditiveidentityother,this.buffer=new array(5*n);break;default:r=this._lerp,i=this._lerpadditive,a=this._setadditiveidentitynumeric,this.buffer=new float64array(5*n)}this._mixbufferregion=r,this._mixbufferregionadditive=i,this._setidentity=a,this._origindex=3,this._addindex=4,this.cumulativeweight=0,this.cumulativeweightadditive=0,this.usecount=0,this.referencecount=0}object.assign(ql.prototype,{accumulate:function(t,e){var n=this.buffer,r=this.valuesize,i=t*r+r,a=this.cumulativeweight;if(0===a){for(var o=0;o!==r;++o)n[i+o]=n[o];a=e}else{var s=e/(a+=e);this._mixbufferregion(n,i,0,s,r)}this.cumulativeweight=a},accumulateadditive:function(t){var e=this.buffer,n=this.valuesize,r=n*this._addindex;0===this.cumulativeweightadditive&&this._setidentity(),this._mixbufferregionadditive(e,r,0,t,n),this.cumulativeweightadditive+=t},apply:function(t){var e=this.valuesize,n=this.buffer,r=t*e+e,i=this.cumulativeweight,a=this.cumulativeweightadditive,o=this.binding;if(this.cumulativeweight=0,this.cumulativeweightadditive=0,i<1){var s=e*this._origindex;this._mixbufferregion(n,r,s,1-i,e)}a>0&&this._mixbufferregionadditive(n,r,this._addindex*e,1,e);for(var c=e,l=e+e;c!==l;++c)if(n[c]!==n[c+e]){o.setvalue(n,r);break}},saveoriginalstate:function(){var t=this.binding,e=this.buffer,n=this.valuesize,r=n*this._origindex;t.getvalue(e,r);for(var i=n,a=r;i!==a;++i)e[i]=e[r+i%n];this._setidentity(),this.cumulativeweight=0,this.cumulativeweightadditive=0},restoreoriginalstate:function(){var t=3*this.valuesize;this.binding.setvalue(this.buffer,t)},_setadditiveidentitynumeric:function(){for(var t=this._addindex*this.valuesize,e=t+this.valuesize,n=t;n<e;n++)this.buffer[n]=0},_setadditiveidentityquaternion:function(){this._setadditiveidentitynumeric(),this.buffer[this._addindex*this.valuesize+3]=1},_setadditiveidentityother:function(){for(var t=this._origindex*this.valuesize,e=this._addindex*this.valuesize,n=0;n<this.valuesize;n++)this.buffer[e+n]=this.buffer[t+n]},_select:function(t,e,n,r,i){if(r>=.5)for(var a=0;a!==i;++a)t[e+a]=t[n+a]},_slerp:function(t,e,n,r){wt.slerpflat(t,e,t,e,t,n,r)},_slerpadditive:function(t,e,n,r,i){var a=this._workindex*i;wt.multiplyquaternionsflat(t,a,t,e,t,n),wt.slerpflat(t,e,t,e,t,a,r)},_lerp:function(t,e,n,r,i){for(var a=1-r,o=0;o!==i;++o){var s=e+o;t[s]=t[s]*a+t[n+o]*r}},_lerpadditive:function(t,e,n,r,i){for(var a=0;a!==i;++a){var o=e+a;t[o]=t[o]+t[n+a]*r}}});var xl="\\[\\]\\.:\\/",yl=new regexp("[\\[\\]\\.:\\/]","g"),zl="[^\\[\\]\\.:\\/]",jl="[^"+xl.replace("\\.","")+"]",ql=/((?:wc+[\/:])*)/.source.replace("wc",zl),kl=/(wcod+)?/.source.replace("wcod",jl),$l=/(?:\.(wc+)(?:\[(.+)\])?)?/.source.replace("wc",zl),tu=/\.(wc+)(?:\[(.+)\])?/.source.replace("wc",zl),eu=new regexp("^"+ql+kl+$l+tu+"$"),nu=["material","materials","bones"];function ru(t,e,n){var r=n||iu.parsetrackname(e);this._targetgroup=t,this._bindings=t.subscribe_(e,r)}function iu(t,e,n){this.path=e,this.parsedpath=n||iu.parsetrackname(e),this.node=iu.findnode(t,this.parsedpath.nodename)||t,this.rootnode=t}function au(){this.uuid=st.generateuuid(),this._objects=array.prototype.slice.call(arguments),this.ncachedobjects_=0;var t={};this._indicesbyuuid=t;for(var e=0,n=arguments.length;e!==n;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedpaths=[],this._bindings=[],this._bindingsindicesbypath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inuse(){return this.total-r.ncachedobjects_}},get bindingsperobject(){return r._bindings.length}}}object.assign(ru.prototype,{getvalue:function(t,e){this.bind();var n=this._targetgroup.ncachedobjects_,r=this._bindings[n];void 0!==r&&r.getvalue(t,e)},setvalue:function(t,e){for(var n=this._bindings,r=this._targetgroup.ncachedobjects_,i=n.length;r!==i;++r)n[r].setvalue(t,e)},bind:function(){for(var t=this._bindings,e=this._targetgroup.ncachedobjects_,n=t.length;e!==n;++e)t[e].bind()},unbind:function(){for(var t=this._bindings,e=this._targetgroup.ncachedobjects_,n=t.length;e!==n;++e)t[e].unbind()}}),object.assign(iu,{composite:ru,create:function(t,e,n){return t&&t.isanimationobjectgroup?new iu.composite(t,e,n):new iu(t,e,n)},sanitizenodename:function(t){return t.replace(/\s/g,"_").replace(yl,"")},parsetrackname:function(t){var e=eu.exec(t);if(!e)throw new error("propertybinding: cannot parse trackname: "+t);var n={nodename:e[2],objectname:e[3],objectindex:e[4],propertyname:e[5],propertyindex:e[6]},r=n.nodename&&n.nodename.lastindexof(".");if(void 0!==r&&-1!==r){var i=n.nodename.substring(r+1);-1!==nu.indexof(i)&&(n.nodename=n.nodename.substring(0,r),n.objectname=i)}if(null===n.propertyname||0===n.propertyname.length)throw new error("propertybinding: can not parse propertyname from trackname: "+t);return n},findnode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){var n=t.skeleton.getbonebyname(e);if(void 0!==n)return n}if(t.children){var r=function t(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===e||i.uuid===e)return i;var a=t(i.children);if(a)return a}return null}(t.children);if(r)return r}return null}}),object.assign(iu.prototype,{_getvalue_unavailable:function(){},_setvalue_unavailable:function(){},bindingtype:{direct:0,entirearray:1,arrayelement:2,hasfromtoarray:3},versioning:{none:0,needsupdate:1,matrixworldneedsupdate:2},getterbybindingtype:[function(t,e){t[e]=this.node[this.propertyname]},function(t,e){for(var n=this.resolvedproperty,r=0,i=n.length;r!==i;++r)t[e++]=n[r]},function(t,e){t[e]=this.resolvedproperty[this.propertyindex]},function(t,e){this.resolvedproperty.toarray(t,e)}],setterbybindingtypeandversioning:[[function(t,e){this.targetobject[this.propertyname]=t[e]},function(t,e){this.targetobject[this.propertyname]=t[e],this.targetobject.needsupdate=!0},function(t,e){this.targetobject[this.propertyname]=t[e],this.targetobject.matrixworldneedsupdate=!0}],[function(t,e){for(var n=this.resolvedproperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++]},function(t,e){for(var n=this.resolvedproperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetobject.needsupdate=!0},function(t,e){for(var n=this.resolvedproperty,r=0,i=n.length;r!==i;++r)n[r]=t[e++];this.targetobject.matrixworldneedsupdate=!0}],[function(t,e){this.resolvedproperty[this.propertyindex]=t[e]},function(t,e){this.resolvedproperty[this.propertyindex]=t[e],this.targetobject.needsupdate=!0},function(t,e){this.resolvedproperty[this.propertyindex]=t[e],this.targetobject.matrixworldneedsupdate=!0}],[function(t,e){this.resolvedproperty.fromarray(t,e)},function(t,e){this.resolvedproperty.fromarray(t,e),this.targetobject.needsupdate=!0},function(t,e){this.resolvedproperty.fromarray(t,e),this.targetobject.matrixworldneedsupdate=!0}]],getvalue:function(t,e){this.bind(),this.getvalue(t,e)},setvalue:function(t,e){this.bind(),this.setvalue(t,e)},bind:function(){var t=this.node,e=this.parsedpath,n=e.objectname,r=e.propertyname,i=e.propertyindex;if(t||(t=iu.findnode(this.rootnode,e.nodename)||this.rootnode,this.node=t),this.getvalue=this._getvalue_unavailable,this.setvalue=this._setvalue_unavailable,t){if(n){var a=e.objectindex;switch(n){case"materials":if(!t.material)return void console.error("three.propertybinding: can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("three.propertybinding: can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("three.propertybinding: can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var o=0;o<t.length;o++)if(t[o].name===a){a=o;break}break;default:if(void 0===t[n])return void console.error("three.propertybinding: can not bind to objectname of node undefined.",this);t=t[n]}if(void 0!==a){if(void 0===t[a])return void console.error("three.propertybinding: trying to bind to objectindex of objectname, but is undefined.",this,t);t=t[a]}}var s=t[r];if(void 0!==s){var c=this.versioning.none;this.targetobject=t,void 0!==t.needsupdate?c=this.versioning.needsupdate:void 0!==t.matrixworldneedsupdate&&(c=this.versioning.matrixworldneedsupdate);var l=this.bindingtype.direct;if(void 0!==i){if("morphtargetinfluences"===r){if(!t.geometry)return void console.error("three.propertybinding: can not bind to morphtargetinfluences because node does not have a geometry.",this);if(!t.geometry.isbuffergeometry)return void console.error("three.propertybinding: can not bind to morphtargetinfluences on three.geometry. use three.buffergeometry instead.",this);if(!t.geometry.morphattributes)return void console.error("three.propertybinding: can not bind to morphtargetinfluences because node does not have a geometry.morphattributes.",this);void 0!==t.morphtargetdictionary[i]&&(i=t.morphtargetdictionary[i])}l=this.bindingtype.arrayelement,this.resolvedproperty=s,this.propertyindex=i}else void 0!==s.fromarray&&void 0!==s.toarray?(l=this.bindingtype.hasfromtoarray,this.resolvedproperty=s):array.isarray(s)?(l=this.bindingtype.entirearray,this.resolvedproperty=s):this.propertyname=r;this.getvalue=this.getterbybindingtype[l],this.setvalue=this.setterbybindingtypeandversioning[l][c]}else{var u=e.nodename;console.error("three.propertybinding: trying to update property for track: "+u+"."+r+" but it wasn't found.",t)}}else console.error("three.propertybinding: trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getvalue=this._getvalue_unbound,this.setvalue=this._setvalue_unbound}}),object.assign(iu.prototype,{_getvalue_unbound:iu.prototype.getvalue,_setvalue_unbound:iu.prototype.setvalue}),object.assign(au.prototype,{isanimationobjectgroup:!0,add:function(){for(var t=this._objects,e=this._indicesbyuuid,n=this._paths,r=this._parsedpaths,i=this._bindings,a=i.length,o=void 0,s=t.length,c=this.ncachedobjects_,l=0,u=arguments.length;l!==u;++l){var h=arguments[l],d=h.uuid,p=e[d];if(void 0===p){p=s++,e[d]=p,t.push(h);for(var f=0,m=a;f!==m;++f)i[f].push(new iu(h,n[f],r[f]))}else if(p<c){o=t[p];var v=--c,g=t[v];e[g.uuid]=p,t[p]=g,e[d]=v,t[v]=h;for(var y=0,x=a;y!==x;++y){var _=i[y],b=_[v],w=_[p];_[p]=b,void 0===w&&(w=new iu(h,n[y],r[y])),_[v]=w}}else t[p]!==o&&console.error("three.animationobjectgroup: different objects with the same uuid detected. clean the caches or recreate your infrastructure when reloading scenes.")}this.ncachedobjects_=c},remove:function(){for(var t=this._objects,e=this._indicesbyuuid,n=this._bindings,r=n.length,i=this.ncachedobjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],c=s.uuid,l=e[c];if(void 0!==l&&l>=i){var u=i++,h=t[u];e[h.uuid]=l,t[l]=h,e[c]=u,t[u]=s;for(var d=0,p=r;d!==p;++d){var f=n[d],m=f[u],v=f[l];f[l]=m,f[u]=v}}}this.ncachedobjects_=i},uncache:function(){for(var t=this._objects,e=this._indicesbyuuid,n=this._bindings,r=n.length,i=this.ncachedobjects_,a=t.length,o=0,s=arguments.length;o!==s;++o){var c=arguments[o],l=c.uuid,u=e[l];if(void 0!==u)if(delete e[l],u<i){var h=--i,d=t[h],p=--a,f=t[p];e[d.uuid]=u,t[u]=d,e[f.uuid]=h,t[h]=f,t.pop();for(var m=0,v=r;m!==v;++m){var g=n[m],y=g[h],x=g[p];g[u]=y,g[h]=x,g.pop()}}else{var _=--a,b=t[_];_>0&&(e[b.uuid]=u),t[u]=b,t.pop();for(var w=0,m=r;w!==m;++w){var s=n[w];s[u]=s[_],s.pop()}}}this.ncachedobjects_=i},subscribe_:function(t,e){var n=this._bindingsindicesbypath,r=n[t],i=this._bindings;if(void 0!==r)return i[r];var a=this._paths,o=this._parsedpaths,s=this._objects,c=s.length,l=this.ncachedobjects_,u=new array(c);r=i.length,n[t]=r,a.push(t),o.push(e),i.push(u);for(var h=l,d=s.length;h!==d;++h){var p=s[h];u[h]=new iu(p,t,e)}return u},unsubscribe_:function(t){var e=this._bindingsindicesbypath,n=e[t];if(void 0!==n){var r=this._paths,i=this._parsedpaths,a=this._bindings,o=a.length-1,s=a[o];e[t[o]]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}});var ou=function(){function t(t,e,n,r){void 0===n&&(n=null),void 0===r&&(r=e.blendmode),this._mixer=t,this._clip=e,this._localroot=n,this.blendmode=r;for(var i=e.tracks,a=i.length,o=new array(a),s={endingstart:h,endingend:h},c=0;c!==a;++c){var l=i[c].createinterpolant(null);o[c]=l,l.settings=s}this._interpolantsettings=s,this._interpolants=o,this._propertybindings=new array(a),this._cacheindex=null,this._byclipcacheindex=null,this._timescaleinterpolant=null,this._weightinterpolant=null,this.loop=2201,this._loopcount=-1,this._starttime=null,this.time=0,this.timescale=1,this._effectivetimescale=1,this.weight=1,this._effectiveweight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampwhenfinished=!1,this.zeroslopeatstart=!0,this.zeroslopeatend=!0}var e=t.prototype;return e.play=function(){return this._mixer._activateaction(this),this},e.stop=function(){return this._mixer._deactivateaction(this),this.reset()},e.reset=function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopcount=-1,this._starttime=null,this.stopfading().stopwarping()},e.isrunning=function(){return this.enabled&&!this.paused&&0!==this.timescale&&null===this._starttime&&this._mixer._isactiveaction(this)},e.isscheduled=function(){return this._mixer._isactiveaction(this)},e.startat=function(t){return this._starttime=t,this},e.setloop=function(t,e){return this.loop=t,this.repetitions=e,this},e.seteffectiveweight=function(t){return this.weight=t,this._effectiveweight=this.enabled?t:0,this.stopfading()},e.geteffectiveweight=function(){return this._effectiveweight},e.fadein=function(t){return this._schedulefading(t,0,1)},e.fadeout=function(t){return this._schedulefading(t,1,0)},e.crossfadefrom=function(t,e,n){if(t.fadeout(e),this.fadein(e),n){var r=this._clip.duration,i=t._clip.duration,a=i/r,o=r/i;t.warp(1,a,e),this.warp(o,1,e)}return this},e.crossfadeto=function(t,e,n){return t.crossfadefrom(this,e,n)},e.stopfading=function(){var t=this._weightinterpolant;return null!==t&&(this._weightinterpolant=null,this._mixer._takebackcontrolinterpolant(t)),this},e.seteffectivetimescale=function(t){return this.timescale=t,this._effectivetimescale=this.paused?0:t,this.stopwarping()},e.geteffectivetimescale=function(){return this._effectivetimescale},e.setduration=function(t){return this.timescale=this._clip.duration/t,this.stopwarping()},e.syncwith=function(t){return this.time=t.time,this.timescale=t.timescale,this.stopwarping()},e.halt=function(t){return this.warp(this._effectivetimescale,0,t)},e.warp=function(t,e,n){var r=this._mixer,i=r.time,a=this.timescale,o=this._timescaleinterpolant;null===o&&(o=r._lendcontrolinterpolant(),this._timescaleinterpolant=o);var s=o.parameterpositions,c=o.samplevalues;return s[0]=i,s[1]=i+n,c[0]=t/a,c[1]=e/a,this},e.stopwarping=function(){var t=this._timescaleinterpolant;return null!==t&&(this._timescaleinterpolant=null,this._mixer._takebackcontrolinterpolant(t)),this},e.getmixer=function(){return this._mixer},e.getclip=function(){return this._clip},e.getroot=function(){return this._localroot||this._mixer._root},e._update=function(t,e,n,r){if(this.enabled){var i=this._starttime;if(null!==i){var a=(t-i)*n;if(a<0||0===n)return;this._starttime=null,e=n*a}e*=this._updatetimescale(t);var o=this._updatetime(e),s=this._updateweight(t);if(s>0){var c=this._interpolants,l=this._propertybindings;switch(this.blendmode){case j:for(var u=0,h=c.length;u!==h;++u)c[u].evaluate(o),l[u].accumulateadditive(s);break;case w:default:for(var d=0,p=c.length;d!==p;++d)c[d].evaluate(o),l[d].accumulate(r,s)}}}else this._updateweight(t)},e._updateweight=function(t){var e=0;if(this.enabled){e=this.weight;var n=this._weightinterpolant;if(null!==n){var r=n.evaluate(t)[0];e*=r,t>n.parameterpositions[1]&&(this.stopfading(),0===r&&(this.enabled=!1))}}return this._effectiveweight=e,e},e._updatetimescale=function(t){var e=0;if(!this.paused){e=this.timescale;var n=this._timescaleinterpolant;if(null!==n)e*=n.evaluate(t)[0],t>n.parameterpositions[1]&&(this.stopwarping(),0===e?this.paused=!0:this.timescale=e)}return this._effectivetimescale=e,e},e._updatetime=function(t){var e=this._clip.duration,n=this.loop,r=this.time+t,i=this._loopcount,a=2202===n;if(0===t)return-1===i?r:a&&1==(1&i)?e-r:r;if(2200===n){-1===i&&(this._loopcount=0,this._setendings(!0,!0,!1));t:{if(r>=e)r=e;else{if(!(r<0)){this.time=r;break t}r=0}this.clampwhenfinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchevent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===i&&(t>=0?(i=0,this._setendings(!0,0===this.repetitions,a)):this._setendings(0===this.repetitions,!0,a)),r>=e||r<0){var o=math.floor(r/e);r-=e*o,i+=math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampwhenfinished?this.paused=!0:this.enabled=!1,r=t>0?e:0,this.time=r,this._mixer.dispatchevent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===s){var c=t<0;this._setendings(c,!c,a)}else this._setendings(!1,!1,a);this._loopcount=i,this.time=r,this._mixer.dispatchevent({type:"loop",action:this,loopdelta:o})}}else this.time=r;if(a&&1==(1&i))return e-r}return r},e._setendings=function(t,e,n){var r=this._interpolantsettings;n?(r.endingstart=k,r.endingend=k):(r.endingstart=t?this.zeroslopeatstart?k:h:v,r.endingend=e?this.zeroslopeatend?k:h:v)},e._schedulefading=function(t,e,n){var r=this._mixer,i=r.time,a=this._weightinterpolant;null===a&&(a=r._lendcontrolinterpolant(),this._weightinterpolant=a);var o=a.parameterpositions,s=a.samplevalues;return o[0]=i,s[0]=e,o[1]=i+t,s[1]=n,this},t}();function su(t){this._root=t,this._initmemorymanager(),this._accuindex=0,this.time=0,this.timescale=1}su.prototype=object.assign(object.create(rt.prototype),{constructor:su,_bindaction:function(t,e){var n=t._localroot||this._root,r=t._clip.tracks,i=r.length,a=t._propertybindings,o=t._interpolants,s=n.uuid,c=this._bindingsbyrootandname,l=c[s];void 0===l&&(l={},c[s]=l);for(var u=0;u!==i;++u){var h=r[u],d=h.name,p=l[d];if(void 0!==p)a[u]=p;else{if(void 0!==(p=a[u])){null===p._cacheindex&&(++p.referencecount,this._addinactivebinding(p,s,d));continue}var f=e&&e._propertybindings[u].binding.parsedpath;++(p=new ql(iu.create(n,d,f),h.valuetypename,h.getvaluesize())).referencecount,this._addinactivebinding(p,s,d),a[u]=p}o[u].resultbuffer=p.buffer}},_activateaction:function(t){if(!this._isactiveaction(t)){if(null===t._cacheindex){var e=(t._localroot||this._root).uuid,n=t._clip.uuid,r=this._actionsbyclip[n];this._bindaction(t,r&&r.knownactions[0]),this._addinactiveaction(t,n,e)}for(var i=t._propertybindings,a=0,o=i.length;a!==o;++a){var s=i[a];0==s.usecount++&&(this._lendbinding(s),s.saveoriginalstate())}this._lendaction(t)}},_deactivateaction:function(t){if(this._isactiveaction(t)){for(var e=t._propertybindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.usecount&&(i.restoreoriginalstate(),this._takebackbinding(i))}this._takebackaction(t)}},_initmemorymanager:function(){this._actions=[],this._nactiveactions=0,this._actionsbyclip={},this._bindings=[],this._nactivebindings=0,this._bindingsbyrootandname={},this._controlinterpolants=[],this._nactivecontrolinterpolants=0;var t=this;this.stats={actions:{get total(){return t._actions.length},get inuse(){return t._nactiveactions}},bindings:{get total(){return t._bindings.length},get inuse(){return t._nactivebindings}},controlinterpolants:{get total(){return t._controlinterpolants.length},get inuse(){return t._nactivecontrolinterpolants}}}},_isactiveaction:function(t){var e=t._cacheindex;return null!==e&&e<this._nactiveactions},_addinactiveaction:function(t,e,n){var r=this._actions,i=this._actionsbyclip,a=i[e];if(void 0===a)a={knownactions:[t],actionbyroot:{}},t._byclipcacheindex=0,i[e]=a;else{var o=a.knownactions;t._byclipcacheindex=o.length,o.push(t)}t._cacheindex=r.length,r.push(t),a.actionbyroot[n]=t},_removeinactiveaction:function(t){var e=this._actions,n=e[e.length-1],r=t._cacheindex;n._cacheindex=r,e[r]=n,e.pop(),t._cacheindex=null;var i=t._clip.uuid,a=this._actionsbyclip,o=a[i],s=o.knownactions,c=s[s.length-1],l=t._byclipcacheindex;c._byclipcacheindex=l,s[l]=c,s.pop(),t._byclipcacheindex=null,delete o.actionbyroot[(t._localroot||this._root).uuid],0===s.length&&delete a[i],this._removeinactivebindingsforaction(t)},_removeinactivebindingsforaction:function(t){for(var e=t._propertybindings,n=0,r=e.length;n!==r;++n){var i=e[n];0==--i.referencecount&&this._removeinactivebinding(i)}},_lendaction:function(t){var e=this._actions,n=t._cacheindex,r=this._nactiveactions++,i=e[r];t._cacheindex=r,e[r]=t,i._cacheindex=n,e[n]=i},_takebackaction:function(t){var e=this._actions,n=t._cacheindex,r=--this._nactiveactions,i=e[r];t._cacheindex=r,e[r]=t,i._cacheindex=n,e[n]=i},_addinactivebinding:function(t,e,n){var r=this._bindingsbyrootandname,i=this._bindings,a=r[e];void 0===a&&(a={},r[e]=a),a[n]=t,t._cacheindex=i.length,i.push(t)},_removeinactivebinding:function(t){var e=this._bindings,n=t.binding,r=n.rootnode.uuid,i=n.path,a=this._bindingsbyrootandname,o=a[r],s=e[e.length-1],c=t._cacheindex;s._cacheindex=c,e[c]=s,e.pop(),delete o[i],0===object.keys(o).length&&delete a[r]},_lendbinding:function(t){var e=this._bindings,n=t._cacheindex,r=this._nactivebindings++,i=e[r];t._cacheindex=r,e[r]=t,i._cacheindex=n,e[n]=i},_takebackbinding:function(t){var e=this._bindings,n=t._cacheindex,r=--this._nactivebindings,i=e[r];t._cacheindex=r,e[r]=t,i._cacheindex=n,e[n]=i},_lendcontrolinterpolant:function(){var t=this._controlinterpolants,e=this._nactivecontrolinterpolants++,n=t[e];return void 0===n&&((n=new rc(new float32array(2),new float32array(2),1,this._controlinterpolantsresultbuffer)).__cacheindex=e,t[e]=n),n},_takebackcontrolinterpolant:function(t){var e=this._controlinterpolants,n=t.__cacheindex,r=--this._nactivecontrolinterpolants,i=e[r];t.__cacheindex=r,e[r]=t,i.__cacheindex=n,e[n]=i},_controlinterpolantsresultbuffer:new float32array(1),clipaction:function(t,e,n){var r=e||this._root,i=r.uuid,a="string"==typeof t?pc.findbyname(r,t):t,o=null!==a?a.uuid:t,s=this._actionsbyclip[o],c=null;if(void 0===n&&(n=null!==a?a.blendmode:w),void 0!==s){var l=s.actionbyroot[i];if(void 0!==l&&l.blendmode===n)return l;c=s.knownactions[0],null===a&&(a=c._clip)}if(null===a)return null;var u=new ou(this,a,e,n);return this._bindaction(u,c),this._addinactiveaction(u,o,i),u},existingaction:function(t,e){var n=e||this._root,r=n.uuid,i="string"==typeof t?pc.findbyname(n,t):t,a=i?i.uuid:t,o=this._actionsbyclip[a];return void 0!==o&&o.actionbyroot[r]||null},stopallaction:function(){for(var t=this._actions,e=this._nactiveactions-1;e>=0;--e)t[e].stop();return this},update:function(t){t*=this.timescale;for(var e=this._actions,n=this._nactiveactions,r=this.time+=t,i=math.sign(t),a=this._accuindex^=1,o=0;o!==n;++o){e[o]._update(r,t,i,a)}for(var s=this._bindings,c=this._nactivebindings,l=0;l!==c;++l)s[l].apply(a);return this},settime:function(t){this.time=0;for(var e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)},getroot:function(){return this._root},uncacheclip:function(t){var e=this._actions,n=t.uuid,r=this._actionsbyclip,i=r[n];if(void 0!==i){for(var a=i.knownactions,o=0,s=a.length;o!==s;++o){var c=a[o];this._deactivateaction(c);var l=c._cacheindex,u=e[e.length-1];c._cacheindex=null,c._byclipcacheindex=null,u._cacheindex=l,e[l]=u,e.pop(),this._removeinactivebindingsforaction(c)}delete r[n]}},uncacheroot:function(t){var e=t.uuid,n=this._actionsbyclip;for(var r in n){var i=n[r].actionbyroot[e];void 0!==i&&(this._deactivateaction(i),this._removeinactiveaction(i))}var a=this._bindingsbyrootandname[e];if(void 0!==a)for(var o in a){var s=a[o];s.restoreoriginalstate(),this._removeinactivebinding(s)}},uncacheaction:function(t,e){var n=this.existingaction(t,e);null!==n&&(this._deactivateaction(n),this._removeinactiveaction(n))}});var cu=function(){function t(t){"string"==typeof t&&(console.warn("three.uniform: type parameter is no longer needed."),t=arguments[1]),this.value=t}return t.prototype.clone=function(){return new t(void 0===this.value.clone?this.value:this.value.clone())},t}();function lu(t,e,n){da.call(this,t,e),this.meshperattribute=n||1}function uu(t,e,n,r,i){this.buffer=t,this.type=e,this.itemsize=n,this.elementsize=r,this.count=i,this.version=0}function hu(t,e,n,r){this.ray=new jt(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new ce,this.params={mesh:{},line:{threshold:1},lod:{},points:{threshold:1},sprite:{}},object.defineproperties(this.params,{pointcloud:{get:function(){return console.warn("three.raycaster: params.pointcloud has been renamed to params.points."),this.points}}})}function du(t,e){return t.distance-e.distance}function pu(t,e,n,r){if(t.layers.test(e.layers)&&t.raycast(e,n),!0===r)for(var i=t.children,a=0,o=i.length;a<o;a++)pu(i[a],e,n,!0)}lu.prototype=object.assign(object.create(da.prototype),{constructor:lu,isinstancedinterleavedbuffer:!0,copy:function(t){return da.prototype.copy.call(this,t),this.meshperattribute=t.meshperattribute,this},clone:function(t){var e=da.prototype.clone.call(this,t);return e.meshperattribute=this.meshperattribute,e},tojson:function(t){var e=da.prototype.tojson.call(this,t);return e.isinstancedinterleavedbuffer=!0,e.meshperattribute=this.meshperattribute,e}}),object.defineproperty(uu.prototype,"needsupdate",{set:function(t){!0===t&&this.version++}}),object.assign(uu.prototype,{isglbufferattribute:!0,setbuffer:function(t){return this.buffer=t,this},settype:function(t,e){return this.type=t,this.elementsize=e,this},setitemsize:function(t){return this.itemsize=t,this},setcount:function(t){return this.count=t,this}}),object.assign(hu.prototype,{set:function(t,e){this.ray.set(t,e)},setfromcamera:function(t,e){e&&e.isperspectivecamera?(this.ray.origin.setfrommatrixposition(e.matrixworld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isorthographiccamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformdirection(e.matrixworld),this.camera=e):console.error("three.raycaster: unsupported camera type: "+e.type)},intersectobject:function(t,e,n){var r=n||[];return pu(t,this,r,e),r.sort(du),r},intersectobjects:function(t,e,n){var r=n||[];if(!1===array.isarray(t))return console.warn("three.raycaster.intersectobjects: objects is not an array."),r;for(var i=0,a=t.length;i<a;i++)pu(t[i],this,r,e);return r.sort(du),r}});var fu=function(){function t(t,e,n){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),this.radius=t,this.phi=e,this.theta=n,this}var e=t.prototype;return e.set=function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},e.makesafe=function(){var t=1e-6;return this.phi=math.max(t,math.min(math.pi-t,this.phi)),this},e.setfromvector3=function(t){return this.setfromcartesiancoords(t.x,t.y,t.z)},e.setfromcartesiancoords=function(t,e,n){return this.radius=math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=math.atan2(t,n),this.phi=math.acos(st.clamp(e/this.radius,-1,1))),this},t}(),mu=function(){function t(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}var e=t.prototype;return e.set=function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},e.setfromvector3=function(t){return this.setfromcartesiancoords(t.x,t.y,t.z)},e.setfromcartesiancoords=function(t,e,n){return this.radius=math.sqrt(t*t+n*n),this.theta=math.atan2(t,n),this.y=e,this},t}(),vu=new pt,gu=function(){function t(t,e){object.defineproperty(this,"isbox2",{value:!0}),this.min=void 0!==t?t:new pt(1/0,1/0),this.max=void 0!==e?e:new pt(-1/0,-1/0)}var e=t.prototype;return e.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},e.setfrompoints=function(t){this.makeempty();for(var e=0,n=t.length;e<n;e++)this.expandbypoint(t[e]);return this},e.setfromcenterandsize=function(t,e){var n=vu.copy(e).multiplyscalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},e.makeempty=function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},e.isempty=function(){return this.max.x<this.min.x||this.max.y<this.min.y},e.getcenter=function(t){return void 0===t&&(console.warn("three.box2: .getcenter() target is now required"),t=new pt),this.isempty()?t.set(0,0):t.addvectors(this.min,this.max).multiplyscalar(.5)},e.getsize=function(t){return void 0===t&&(console.warn("three.box2: .getsize() target is now required"),t=new pt),this.isempty()?t.set(0,0):t.subvectors(this.max,this.min)},e.expandbypoint=function(t){return this.min.min(t),this.max.max(t),this},e.expandbyvector=function(t){return this.min.sub(t),this.max.add(t),this},e.expandbyscalar=function(t){return this.min.addscalar(-t),this.max.addscalar(t),this},e.containspoint=function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},e.containsbox=function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},e.getparameter=function(t,e){return void 0===e&&(console.warn("three.box2: .getparameter() target is now required"),e=new pt),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},e.intersectsbox=function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},e.clamppoint=function(t,e){return void 0===e&&(console.warn("three.box2: .clamppoint() target is now required"),e=new pt),e.copy(t).clamp(this.min,this.max)},e.distancetopoint=function(t){return vu.copy(t).clamp(this.min,this.max).sub(t).length()},e.intersect=function(t){return this.min.max(t.min),this.max.min(t.max),this},e.union=function(t){return this.min.min(t.min),this.max.max(t.max),this},e.translate=function(t){return this.min.add(t),this.max.add(t),this},e.equals=function(t){return t.min.equals(this.min)&&t.max.equals(this.max)},t}(),yu=new mt,xu=new mt,_u=function(){function t(t,e){this.start=void 0!==t?t:new mt,this.end=void 0!==e?e:new mt}var e=t.prototype;return e.set=function(t,e){return this.start.copy(t),this.end.copy(e),this},e.clone=function(){return(new this.constructor).copy(this)},e.copy=function(t){return this.start.copy(t.start),this.end.copy(t.end),this},e.getcenter=function(t){return void 0===t&&(console.warn("three.line3: .getcenter() target is now required"),t=new mt),t.addvectors(this.start,this.end).multiplyscalar(.5)},e.delta=function(t){return void 0===t&&(console.warn("three.line3: .delta() target is now required"),t=new mt),t.subvectors(this.end,this.start)},e.distancesq=function(){return this.start.distancetosquared(this.end)},e.distance=function(){return this.start.distanceto(this.end)},e.at=function(t,e){return void 0===e&&(console.warn("three.line3: .at() target is now required"),e=new mt),this.delta(e).multiplyscalar(t).add(this.start)},e.closestpointtopointparameter=function(t,e){yu.subvectors(t,this.start),xu.subvectors(this.end,this.start);var n=xu.dot(xu),r=xu.dot(yu)/n;return e&&(r=st.clamp(r,0,1)),r},e.closestpointtopoint=function(t,e,n){var r=this.closestpointtopointparameter(t,e);return void 0===n&&(console.warn("three.line3: .closestpointtopoint() target is now required"),n=new mt),this.delta(n).multiplyscalar(r).add(this.start)},e.applymatrix4=function(t){return this.start.applymatrix4(t),this.end.applymatrix4(t),this},e.equals=function(t){return t.start.equals(this.start)&&t.end.equals(this.end)},t}();function bu(t){we.call(this),this.material=t,this.render=function(){},this.haspositions=!1,this.hasnormals=!1,this.hascolors=!1,this.hasuvs=!1,this.positionarray=null,this.normalarray=null,this.colorarray=null,this.uvarray=null,this.count=0}bu.prototype=object.create(we.prototype),bu.prototype.constructor=bu,bu.prototype.isimmediaterenderobject=!0;var wu=new mt,mu=function(t){function e(e,n){var r;(r=t.call(this)||this).light=e,r.light.updatematrixworld(),r.matrix=e.matrixworld,r.matrixautoupdate=!1,r.color=n;for(var i=new _n,a=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],o=0,s=1;o<32;o++,s++){var c=o/32*math.pi*2,l=s/32*math.pi*2;a.push(math.cos(c),math.sin(c),1,math.cos(l),math.sin(l),1)}i.setattribute("position",new sn(a,3));var u=new za({fog:!1,tonemapped:!1});return r.cone=new io(i,u),r.add(r.cone),r.update(),r}ut(e,t);var n=e.prototype;return n.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},n.update=function(){this.light.updatematrixworld();var t=this.light.distance?this.light.distance:1e3,e=t*math.tan(this.light.angle);this.cone.scale.set(e,e,t),wu.setfrommatrixposition(this.light.target.matrixworld),this.cone.lookat(wu),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)},e}(we),su=new mt,tu=new qt,eu=new qt,au=function(t){function e(e){for(var n,r=lu(e),i=new _n,a=[],o=[],s=new we(0,0,1),c=new we(0,1,0),l=0;l<r.length;l++){var u=r[l];u.parent&&u.parent.isbone&&(a.push(0,0,0),a.push(0,0,0),o.push(s.r,s.g,s.b),o.push(c.r,c.g,c.b))}i.setattribute("position",new sn(a,3)),i.setattribute("color",new sn(o,3));var h=new za({vertexcolors:!0,depthtest:!1,depthwrite:!1,tonemapped:!1,transparent:!0});return(n=t.call(this,i,h)||this).type="skeletonhelper",n.isskeletonhelper=!0,n.root=e,n.bones=r,n.matrix=e.matrixworld,n.matrixautoupdate=!1,n}return ut(e,t),e.prototype.updatematrixworld=function(e){var n=this.bones,r=this.geometry,i=r.getattribute("position");eu.copy(this.root.matrixworld).invert();for(var a=0,o=0;a<n.length;a++){var s=n[a];s.parent&&s.parent.isbone&&(tu.multiplymatrices(eu,s.matrixworld),su.setfrommatrixposition(tu),i.setxyz(o,su.x,su.y,su.z),tu.multiplymatrices(eu,s.parent.matrixworld),su.setfrommatrixposition(tu),i.setxyz(o+1,su.x,su.y,su.z),o+=2)}r.getattribute("position").needsupdate=!0,t.prototype.updatematrixworld.call(this,e)},e}(io);function lu(t){var e=[];t&&t.isbone&&e.push(t);for(var n=0;n<t.children.length;n++)e.push.apply(e,lu(t.children[n]));return e}var ru=function(t){function e(e,n,r){var i,a=new rs(n,4,2),o=new ye({wireframe:!0,fog:!1,tonemapped:!1});return(i=t.call(this,a,o)||this).light=e,i.light.updatematrixworld(),i.color=r,i.type="pointlighthelper",i.matrix=i.light.matrixworld,i.matrixautoupdate=!1,i.update(),i}ut(e,t);var n=e.prototype;return n.dispose=function(){this.geometry.dispose(),this.material.dispose()},n.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},e}(fn),cu=new mt,pu=new we,iu=new we,nu=function(t){function e(e,n,r){var i;(i=t.call(this)||this).light=e,i.light.updatematrixworld(),i.matrix=e.matrixworld,i.matrixautoupdate=!1,i.color=r;var a=new xs(n);a.rotatey(.5*math.pi),i.material=new ye({wireframe:!0,fog:!1,tonemapped:!1}),void 0===i.color&&(i.material.vertexcolors=!0);var o=a.getattribute("position"),s=new float32array(3*o.count);return a.setattribute("color",new qe(s,3)),i.add(new fn(a,i.material)),i.update(),i}ut(e,t);var n=e.prototype;return n.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},n.update=function(){var t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var e=t.geometry.getattribute("color");pu.copy(this.light.color),iu.copy(this.light.groundcolor);for(var n=0,r=e.count;n<r;n++){var i=n<r/2?pu:iu;e.setxyz(n,i.r,i.g,i.b)}e.needsupdate=!0}t.lookat(cu.setfrommatrixposition(this.light.matrixworld).negate())},e}(we),du=function(t){function e(e,n,r,i){var a;void 0===e&&(e=10),void 0===n&&(n=10),void 0===r&&(r=4473924),void 0===i&&(i=8947848),r=new we(r),i=new we(i);for(var o=n/2,s=e/n,c=e/2,l=[],u=[],h=0,d=0,p=-c;h<=n;h++,p+=s){l.push(-c,0,p,c,0,p),l.push(p,0,-c,p,0,c);var f=h===o?r:i;f.toarray(u,d),d+=3,f.toarray(u,d),d+=3,f.toarray(u,d),d+=3,f.toarray(u,d),d+=3}var m=new _n;m.setattribute("position",new sn(l,3)),m.setattribute("color",new sn(u,3));var v=new za({vertexcolors:!0,tonemapped:!1});return(a=t.call(this,m,v)||this).type="gridhelper",a}return ut(e,t),e}(io),ou=function(t){function e(e,n,r,i,a,o){var s;void 0===e&&(e=10),void 0===n&&(n=16),void 0===r&&(r=8),void 0===i&&(i=64),void 0===a&&(a=4473924),void 0===o&&(o=8947848),a=new we(a),o=new we(o);for(var c=[],l=[],u=0;u<=n;u++){var h=u/n*(2*math.pi),d=math.sin(h)*e,p=math.cos(h)*e;c.push(0,0,0),c.push(d,0,p);var f=1&u?a:o;l.push(f.r,f.g,f.b),l.push(f.r,f.g,f.b)}for(var m=0;m<=r;m++)for(var v=1&m?a:o,g=e-e/r*m,y=0;y<i;y++){var x=y/i*(2*math.pi),_=math.sin(x)*g,b=math.cos(x)*g;c.push(_,0,b),l.push(v.r,v.g,v.b),x=(y+1)/i*(2*math.pi),_=math.sin(x)*g,b=math.cos(x)*g,c.push(_,0,b),l.push(v.r,v.g,v.b)}var w=new _n;w.setattribute("position",new sn(c,3)),w.setattribute("color",new sn(l,3));var m=new za({vertexcolors:!0,tonemapped:!1});return(s=t.call(this,w,m)||this).type="polargridhelper",s}return ut(e,t),e}(io),bu=new mt,zu=new mt,fu=new mt,gu=function(t){function e(e,n,r){var i;(i=t.call(this)||this).light=e,i.light.updatematrixworld(),i.matrix=e.matrixworld,i.matrixautoupdate=!1,i.color=r,void 0===n&&(n=1);var a=new _n;a.setattribute("position",new sn([-n,n,0,n,n,0,n,-n,0,-n,-n,0,-n,n,0],3));var o=new za({fog:!1,tonemapped:!1});return i.lightplane=new eo(a,o),i.add(i.lightplane),(a=new _n).setattribute("position",new sn([0,0,0,0,0,1],3)),i.targetline=new eo(a,o),i.add(i.targetline),i.update(),i}ut(e,t);var n=e.prototype;return n.dispose=function(){this.lightplane.geometry.dispose(),this.lightplane.material.dispose(),this.targetline.geometry.dispose(),this.targetline.material.dispose()},n.update=function(){bu.setfrommatrixposition(this.light.matrixworld),zu.setfrommatrixposition(this.light.target.matrixworld),fu.subvectors(zu,bu),this.lightplane.lookat(zu),void 0!==this.color?(this.lightplane.material.color.set(this.color),this.targetline.material.color.set(this.color)):(this.lightplane.material.color.copy(this.light.color),this.targetline.material.color.copy(this.light.color)),this.targetline.lookat(zu),this.targetline.scale.z=fu.length()},e}(we),uu=new mt,hu=new qn,ku=function(t){function e(e){var n,r=new _n,i=new za({color:16777215,vertexcolors:!0,tonemapped:!1}),a=[],o=[],s={},c=new we(16755200),l=new we(16711680),u=new we(43775),h=new we(16777215),d=new we(3355443);function p(t,e,n){f(t,n),f(e,n)}function f(t,e){a.push(0,0,0),o.push(e.r,e.g,e.b),void 0===s[t]&&(s[t]=[]),s[t].push(a.length/3-1)}return p("n1","n2",c),p("n2","n4",c),p("n4","n3",c),p("n3","n1",c),p("f1","f2",c),p("f2","f4",c),p("f4","f3",c),p("f3","f1",c),p("n1","f1",c),p("n2","f2",c),p("n3","f3",c),p("n4","f4",c),p("p","n1",l),p("p","n2",l),p("p","n3",l),p("p","n4",l),p("u1","u2",u),p("u2","u3",u),p("u3","u1",u),p("c","t",h),p("p","c",d),p("cn1","cn2",d),p("cn3","cn4",d),p("cf1","cf2",d),p("cf3","cf4",d),r.setattribute("position",new sn(a,3)),r.setattribute("color",new sn(o,3)),(n=t.call(this,r,i)||this).type="camerahelper",n.camera=e,n.camera.updateprojectionmatrix&&n.camera.updateprojectionmatrix(),n.matrix=e.matrixworld,n.matrixautoupdate=!1,n.pointmap=s,n.update(),n}return ut(e,t),e.prototype.update=function(){var t=this.geometry,e=this.pointmap;hu.projectionmatrixinverse.copy(this.camera.projectionmatrixinverse),vu("c",e,t,hu,0,0,-1),vu("t",e,t,hu,0,0,1),vu("n1",e,t,hu,-1,-1,-1),vu("n2",e,t,hu,1,-1,-1),vu("n3",e,t,hu,-1,1,-1),vu("n4",e,t,hu,1,1,-1),vu("f1",e,t,hu,-1,-1,1),vu("f2",e,t,hu,1,-1,1),vu("f3",e,t,hu,-1,1,1),vu("f4",e,t,hu,1,1,1),vu("u1",e,t,hu,.7,1.1,-1),vu("u2",e,t,hu,-.7,1.1,-1),vu("u3",e,t,hu,0,2,-1),vu("cf1",e,t,hu,-1,0,1),vu("cf2",e,t,hu,1,0,1),vu("cf3",e,t,hu,0,-1,1),vu("cf4",e,t,hu,0,1,1),vu("cn1",e,t,hu,-1,0,-1),vu("cn2",e,t,hu,1,0,-1),vu("cn3",e,t,hu,0,-1,-1),vu("cn4",e,t,hu,0,1,-1),t.getattribute("position").needsupdate=!0},e}(io);function vu(t,e,n,r,i,a,o){uu.set(i,a,o).unproject(r);var s=e[t];if(void 0!==s)for(var c=n.getattribute("position"),l=0,u=s.length;l<u;l++)c.setxyz(s[l],uu.x,uu.y,uu.z)}var wu,ju,qu,xu=new et,yu=function(t){function e(e,n){var r;void 0===n&&(n=16776960);var i=new uint16array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new float32array(24),o=new _n;return o.setindex(new qe(i,1)),o.setattribute("position",new qe(a,3)),(r=t.call(this,o,new za({color:n,tonemapped:!1}))||this).object=e,r.type="boxhelper",r.matrixautoupdate=!1,r.update(),r}ut(e,t);var n=e.prototype;return n.update=function(t){if(void 0!==t&&console.warn("three.boxhelper: .update() has no longer arguments."),void 0!==this.object&&xu.setfromobject(this.object),!xu.isempty()){var e=xu.min,n=xu.max,r=this.geometry.attributes.position,i=r.array;i[0]=n.x,i[1]=n.y,i[2]=n.z,i[3]=e.x,i[4]=n.y,i[5]=n.z,i[6]=e.x,i[7]=e.y,i[8]=n.z,i[9]=n.x,i[10]=e.y,i[11]=n.z,i[12]=n.x,i[13]=n.y,i[14]=e.z,i[15]=e.x,i[16]=n.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=n.x,i[22]=e.y,i[23]=e.z,r.needsupdate=!0,this.geometry.computeboundingsphere()}},n.setfromobject=function(t){return this.object=t,this.update(),this},n.copy=function(t){return io.prototype.copy.call(this,t),this.object=t.object,this},e}(io),zu=function(t){function e(e,n){var r;void 0===n&&(n=16776960);var i=new uint16array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),a=new _n;return a.setindex(new qe(i,1)),a.setattribute("position",new sn([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),(r=t.call(this,a,new za({color:n,tonemapped:!1}))||this).box=e,r.type="box3helper",r.geometry.computeboundingsphere(),r}return ut(e,t),e.prototype.updatematrixworld=function(e){var n=this.box;n.isempty()||(n.getcenter(this.position),n.getsize(this.scale),this.scale.multiplyscalar(.5),t.prototype.updatematrixworld.call(this,e))},e}(io),ju=function(t){function e(e,n,r){var i;void 0===n&&(n=1),void 0===r&&(r=16776960);var a=r,o=new _n;o.setattribute("position",new sn([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeboundingsphere(),(i=t.call(this,o,new za({color:a,tonemapped:!1}))||this).type="planehelper",i.plane=e,i.size=n;var s=new _n;return s.setattribute("position",new sn([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),s.computeboundingsphere(),i.add(new fn(s,new ye({color:a,opacity:.2,transparent:!0,depthwrite:!1,tonemapped:!1}))),i}return ut(e,t),e.prototype.updatematrixworld=function(e){var n=-this.plane.constant;math.abs(n)<1e-8&&(n=1e-8),this.scale.set(.5*this.size,.5*this.size,n),this.children[0].material.side=n<0?1:0,this.lookat(this.plane.normal),t.prototype.updatematrixworld.call(this,e)},e}(eo),qu=new mt,ku=function(t){function e(e,n,r,i,a,o){var s;return(s=t.call(this)||this).type="arrowhelper",void 0===e&&(e=new mt(0,0,1)),void 0===n&&(n=new mt(0,0,0)),void 0===r&&(r=1),void 0===i&&(i=16776960),void 0===a&&(a=.2*r),void 0===o&&(o=.2*a),void 0===wu&&((wu=new _n).setattribute("position",new sn([0,0,0,0,1,0],3)),(ju=new eo(0,.5,1,5,1)).translate(0,-.5,0)),s.position.copy(n),s.line=new eo(wu,new za({color:i,tonemapped:!1})),s.line.matrixautoupdate=!1,s.add(s.line),s.cone=new fn(ju,new ye({color:i,tonemapped:!1})),s.cone.matrixautoupdate=!1,s.add(s.cone),s.setdirection(e),s.setlength(r,a,o),s}ut(e,t);var n=e.prototype;return n.setdirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{qu.set(t.z,0,-t.x).normalize();var e=math.acos(t.y);this.quaternion.setfromaxisangle(qu,e)}},n.setlength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,math.max(1e-4,t-e),1),this.line.updatematrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updatematrix()},n.setcolor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},n.copy=function(e){return t.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},e}(we),$u=function(t){function e(e){var n;void 0===e&&(e=1);var r=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new _n;i.setattribute("position",new sn(r,3)),i.setattribute("color",new sn([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var a=new za({vertexcolors:!0,tonemapped:!1});return(n=t.call(this,i,a)||this).type="axeshelper",n}return ut(e,t),e}(io),th=new float32array(1),eh=new int32array(th.buffer),nh={tohalffloat:function(t){th[0]=t;var e=eh[0],n=e>>16&32768,r=e>>12&2047,i=e>>23&255;return i<103?n:i>142?(n|=31744,n|=(255==i?0:1)&&8388607&e):i<113?n|=((r|=2048)>>114-i)+(r>>113-i&1):(n|=i-112<<10|r>>1,n+=1&r)}},rh=math.pow(2,8),ih=[.125,.215,.35,.446,.526,.582],ah=5+ih.length,oh=20,sh=((qu={})[3e3]=0,qu[3001]=1,qu[3002]=2,qu[3004]=3,qu[3005]=4,qu[3006]=5,qu[3007]=6,qu),ch=new rl,lh=_h(),uh=lh._lodplanes,hh=lh._sizelods,dh=lh._sigmas,ph=new we,fh=null,mh=(1+math.sqrt(5))/2,vh=1/mh,gh=[new mt(1,1,1),new mt(-1,1,1),new mt(1,1,-1),new mt(-1,1,-1),new mt(0,mh,vh),new mt(0,mh,-vh),new mt(vh,0,mh),new mt(-vh,0,mh),new mt(mh,vh,0),new mt(-mh,vh,0)],yh=function(){function t(t){var e,n,r;this._renderer=t,this._pingpongrendertarget=null,this._blurmaterial=(e=oh,n=new float32array(e),r=new mt(0,1,0),new ws({name:"sphericalgaussianblur",defines:{n:e},uniforms:{envmap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dtheta:{value:0},mipint:{value:0},poleaxis:{value:r},inputencoding:{value:sh[3e3]},outputencoding:{value:sh[3e3]}},vertexshader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceindex;\n\n\t\tvarying vec3 voutputdirection;\n\n\t\t// rh coordinate system; pmrem face-indexing convention\n\t\tvec3 getdirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvoutputdirection = getdirection( uv, faceindex );\n\t\t\tgl_position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentshader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 voutputdirection;\n\n\t\t\tuniform sampler2d envmap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dtheta;\n\t\t\tuniform float mipint;\n\t\t\tuniform vec3 poleaxis;\n\n\t\t\t\n\n\t\tuniform int inputencoding;\n\t\tuniform int outputencoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputtexeltolinear( vec4 value ) {\n\n\t\t\tif ( inputencoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputencoding == 1 ) {\n\n\t\t\t\treturn srgbtolinear( value );\n\n\t\t\t} else if ( inputencoding == 2 ) {\n\n\t\t\t\treturn rgbetolinear( value );\n\n\t\t\t} else if ( inputencoding == 3 ) {\n\n\t\t\t\treturn rgbmtolinear( value, 7.0 );\n\n\t\t\t} else if ( inputencoding == 4 ) {\n\n\t\t\t\treturn rgbmtolinear( value, 16.0 );\n\n\t\t\t} else if ( inputencoding == 5 ) {\n\n\t\t\t\treturn rgbdtolinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn gammatolinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 lineartooutputtexel( vec4 value ) {\n\n\t\t\tif ( outputencoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputencoding == 1 ) {\n\n\t\t\t\treturn lineartosrgb( value );\n\n\t\t\t} else if ( outputencoding == 2 ) {\n\n\t\t\t\treturn lineartorgbe( value );\n\n\t\t\t} else if ( outputencoding == 3 ) {\n\n\t\t\t\treturn lineartorgbm( value, 7.0 );\n\n\t\t\t} else if ( outputencoding == 4 ) {\n\n\t\t\t\treturn lineartorgbm( value, 16.0 );\n\n\t\t\t} else if ( outputencoding == 5 ) {\n\n\t\t\t\treturn lineartorgbd( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn lineartogamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envmaptexeltolinear( vec4 color ) {\n\n\t\t\treturn inputtexeltolinear( color );\n\n\t\t}\n\t\n\n\t\t\t#define envmap_type_cube_uv\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getsample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat costheta = cos( theta );\n\t\t\t\t// rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampledirection = voutputdirection * costheta\n\t\t\t\t\t+ cross( axis, voutputdirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, voutputdirection ) * ( 1.0 - costheta );\n\n\t\t\t\treturn bilinearcubeuv( envmap, sampledirection, mipint );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleaxis : cross( poleaxis, voutputdirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( voutputdirection.z, 0.0, - voutputdirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_fragcolor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_fragcolor.rgb += weights[ 0 ] * getsample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dtheta * float( i );\n\t\t\t\t\tgl_fragcolor.rgb += weights[ i ] * getsample( -1.0 * theta, axis );\n\t\t\t\t\tgl_fragcolor.rgb += weights[ i ] * getsample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_fragcolor = lineartooutputtexel( gl_fragcolor );\n\n\t\t\t}\n\t\t",blending:0,depthtest:!1,depthwrite:!1})),this._equirectshader=null,this._cubemapshader=null,this._compilematerial(this._blurmaterial)}var e=t.prototype;return e.fromscene=function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=.1),void 0===r&&(r=100),fh=this._renderer.getrendertarget();var i=this._allocatetargets();return this._scenetocubeuv(t,n,r,i),e>0&&this._blur(i,0,0,e),this._applypmrem(i),this._cleanup(i),i},e.fromequirectangular=function(t){return this._fromtexture(t)},e.fromcubemap=function(t){return this._fromtexture(t)},e.compilecubemapshader=function(){null===this._cubemapshader&&(this._cubemapshader=sh(),this._compilematerial(this._cubemapshader))},e.compileequirectangularshader=function(){null===this._equirectshader&&(this._equirectshader=mh(),this._compilematerial(this._equirectshader))},e.dispose=function(){this._blurmaterial.dispose(),null!==this._cubemapshader&&this._cubemapshader.dispose(),null!==this._equirectshader&&this._equirectshader.dispose();for(var t=0;t<uh.length;t++)uh[t].dispose()},e._cleanup=function(t){this._pingpongrendertarget.dispose(),this._renderer.setrendertarget(fh),t.scissortest=!1,wh(t,0,0,t.width,t.height)},e._fromtexture=function(t){fh=this._renderer.getrendertarget();var e=this._allocatetargets(t);return this._texturetocubeuv(t,e),this._applypmrem(e),this._cleanup(e),e},e._allocatetargets=function(t){var e={magfilter:d,minfilter:d,generatemipmaps:!1,type:y,format:1023,encoding:xh(t)?t.encoding:z,depthbuffer:!1},n=bh(e);return n.depthbuffer=!t,this._pingpongrendertarget=bh(e),n},e._compilematerial=function(t){var e=new fn(uh[0],t);this._renderer.compile(e,ch)},e._scenetocubeuv=function(t,e,n,r){var i=new xn(90,1,e,n),a=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,c=s.outputencoding,l=s.tonemapping;s.getclearcolor(ph);var u=s.getclearalpha();s.tonemapping=0,s.outputencoding=q;var h=t.background;if(h&&h.iscolor){h.convertsrgbtolinear();var d=math.max(h.r,h.g,h.b),p=math.min(math.max(math.ceil(math.log2(d)),-128),127);h=h.multiplyscalar(math.pow(2,-p));var f=(p+128)/255;s.setclearcolor(h,f),t.background=null}for(var m=0;m<6;m++){var v=m%3;0==v?(i.up.set(0,a[m],0),i.lookat(o[m],0,0)):1==v?(i.up.set(0,0,a[m]),i.lookat(0,o[m],0)):(i.up.set(0,a[m],0),i.lookat(0,0,o[m])),wh(r,v*rh,m>2?rh:0,rh,rh),s.setrendertarget(r),s.render(t,i)}s.tonemapping=l,s.outputencoding=c,s.setclearcolor(ph,u)},e._texturetocubeuv=function(t,e){var n=this._renderer;t.iscubetexture?null==this._cubemapshader&&(this._cubemapshader=sh()):null==this._equirectshader&&(this._equirectshader=mh());var r=t.iscubetexture?this._cubemapshader:this._equirectshader,i=new fn(uh[0],r),a=r.uniforms;a.envmap.value=t,t.iscubetexture||a.texelsize.value.set(1/t.image.width,1/t.image.height),a.inputencoding.value=sh[t.encoding],a.outputencoding.value=sh[e.texture.encoding],wh(e,0,0,3*rh,2*rh),n.setrendertarget(e),n.render(i,ch)},e._applypmrem=function(t){var e=this._renderer,n=e.autoclear;e.autoclear=!1;for(var r=1;r<ah;r++){var i=math.sqrt(dh[r]*dh[r]-dh[r-1]*dh[r-1]),a=gh[(r-1)%gh.length];this._blur(t,r-1,r,i,a)}e.autoclear=n},e._blur=function(t,e,n,r,i){var a=this._pingpongrendertarget;this._halfblur(t,a,e,n,r,"latitudinal",i),this._halfblur(a,t,n,n,r,"longitudinal",i)},e._halfblur=function(t,e,n,r,i,a,o){var s=this._renderer,c=this._blurmaterial;"latitudinal"!==a&&"longitudinal"!==a&&console.error("blur direction must be either latitudinal or longitudinal!");var l=new fn(uh[r],c),u=c.uniforms,h=hh[n]-1,d=isfinite(i)?math.pi/(2*h):2*math.pi/39,p=i/d,f=isfinite(i)?1+math.floor(3*p):oh;f>oh&&console.warn("sigmaradians, "+i+", is too large and will clip, as it requested "+f+" samples when the maximum is set to "+oh);for(var m=[],v=0,g=0;g<oh;++g){var y=g/p,x=math.exp(-y*y/2);m.push(x),0==g?v+=x:g<f&&(v+=2*x)}for(var _=0;_<m.length;_++)m[_]=m[_]/v;u.envmap.value=t.texture,u.samples.value=f,u.weights.value=m,u.latitudinal.value="latitudinal"===a,o&&(u.poleaxis.value=o),u.dtheta.value=d,u.mipint.value=8-n,u.inputencoding.value=sh[t.texture.encoding],u.outputencoding.value=sh[t.texture.encoding];var b=hh[r];wh(e,3*math.max(0,rh-2*b),(0===r?0:2*rh)+2*b*(r>4?r-8+4:0),3*b,2*b),s.setrendertarget(e),s.render(l,ch)},t}();function xh(t){return void 0!==t&&t.type===y&&(t.encoding===q||t.encoding===x||t.encoding===y)}function _h(){for(var t=[],e=[],n=[],r=8,i=0;i<ah;i++){var a=math.pow(2,r);e.push(a);var o=1/a;i>4?o=ih[i-8+4-1]:0==i&&(o=0),n.push(o);for(var s=1/(a-1),c=-s/2,l=1+s/2,u=[c,c,l,c,l,l,c,c,l,l,c,l],h=new float32array(108),d=new float32array(72),p=new float32array(36),f=0;f<6;f++){var m=f%3*2/3-1,v=f>2?0:-1,g=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];h.set(g,18*f),d.set(u,12*f);var y=[f,f,f,f,f,f];p.set(y,6*f)}var x=new _n;x.setattribute("position",new qe(h,3)),x.setattribute("uv",new qe(d,2)),x.setattribute("faceindex",new qe(p,1)),t.push(x),r>4&&r--}return{_lodplanes:t,_sizelods:e,_sigmas:n}}function bh(t){var e=new _t(3*rh,3*rh,t);return e.texture.mapping=s,e.texture.name="pmrem.cubeuv",e.scissortest=!0,e}function wh(t,e,n,r,i){t.viewport.set(e,n,r,i),t.scissor.set(e,n,r,i)}function mh(){return new ws({name:"equirectangulartocubeuv",uniforms:{envmap:{value:null},texelsize:{value:new pt(1,1)},inputencoding:{value:sh[3e3]},outputencoding:{value:sh[3e3]}},vertexshader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceindex;\n\n\t\tvarying vec3 voutputdirection;\n\n\t\t// rh coordinate system; pmrem face-indexing convention\n\t\tvec3 getdirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvoutputdirection = getdirection( uv, faceindex );\n\t\t\tgl_position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentshader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 voutputdirection;\n\n\t\t\tuniform sampler2d envmap;\n\t\t\tuniform vec2 texelsize;\n\n\t\t\t\n\n\t\tuniform int inputencoding;\n\t\tuniform int outputencoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputtexeltolinear( vec4 value ) {\n\n\t\t\tif ( inputencoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputencoding == 1 ) {\n\n\t\t\t\treturn srgbtolinear( value );\n\n\t\t\t} else if ( inputencoding == 2 ) {\n\n\t\t\t\treturn rgbetolinear( value );\n\n\t\t\t} else if ( inputencoding == 3 ) {\n\n\t\t\t\treturn rgbmtolinear( value, 7.0 );\n\n\t\t\t} else if ( inputencoding == 4 ) {\n\n\t\t\t\treturn rgbmtolinear( value, 16.0 );\n\n\t\t\t} else if ( inputencoding == 5 ) {\n\n\t\t\t\treturn rgbdtolinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn gammatolinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 lineartooutputtexel( vec4 value ) {\n\n\t\t\tif ( outputencoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputencoding == 1 ) {\n\n\t\t\t\treturn lineartosrgb( value );\n\n\t\t\t} else if ( outputencoding == 2 ) {\n\n\t\t\t\treturn lineartorgbe( value );\n\n\t\t\t} else if ( outputencoding == 3 ) {\n\n\t\t\t\treturn lineartorgbm( value, 7.0 );\n\n\t\t\t} else if ( outputencoding == 4 ) {\n\n\t\t\t\treturn lineartorgbm( value, 16.0 );\n\n\t\t\t} else if ( outputencoding == 5 ) {\n\n\t\t\t\treturn lineartorgbd( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn lineartogamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envmaptexeltolinear( vec4 color ) {\n\n\t\t\treturn inputtexeltolinear( color );\n\n\t\t}\n\t\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_fragcolor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputdirection = normalize( voutputdirection );\n\t\t\t\tvec2 uv = equirectuv( outputdirection );\n\n\t\t\t\tvec2 f = fract( uv / texelsize - 0.5 );\n\t\t\t\tuv -= f * texelsize;\n\t\t\t\tvec3 tl = envmaptexeltolinear( texture2d ( envmap, uv ) ).rgb;\n\t\t\t\tuv.x += texelsize.x;\n\t\t\t\tvec3 tr = envmaptexeltolinear( texture2d ( envmap, uv ) ).rgb;\n\t\t\t\tuv.y += texelsize.y;\n\t\t\t\tvec3 br = envmaptexeltolinear( texture2d ( envmap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelsize.x;\n\t\t\t\tvec3 bl = envmaptexeltolinear( texture2d ( envmap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_fragcolor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_fragcolor = lineartooutputtexel( gl_fragcolor );\n\n\t\t\t}\n\t\t",blending:0,depthtest:!1,depthwrite:!1})}function sh(){return new ws({name:"cubemaptocubeuv",uniforms:{envmap:{value:null},inputencoding:{value:sh[3e3]},outputencoding:{value:sh[3e3]}},vertexshader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceindex;\n\n\t\tvarying vec3 voutputdirection;\n\n\t\t// rh coordinate system; pmrem face-indexing convention\n\t\tvec3 getdirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvoutputdirection = getdirection( uv, faceindex );\n\t\t\tgl_position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentshader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 voutputdirection;\n\n\t\t\tuniform samplercube envmap;\n\n\t\t\t\n\n\t\tuniform int inputencoding;\n\t\tuniform int outputencoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputtexeltolinear( vec4 value ) {\n\n\t\t\tif ( inputencoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputencoding == 1 ) {\n\n\t\t\t\treturn srgbtolinear( value );\n\n\t\t\t} else if ( inputencoding == 2 ) {\n\n\t\t\t\treturn rgbetolinear( value );\n\n\t\t\t} else if ( inputencoding == 3 ) {\n\n\t\t\t\treturn rgbmtolinear( value, 7.0 );\n\n\t\t\t} else if ( inputencoding == 4 ) {\n\n\t\t\t\treturn rgbmtolinear( value, 16.0 );\n\n\t\t\t} else if ( inputencoding == 5 ) {\n\n\t\t\t\treturn rgbdtolinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn gammatolinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 lineartooutputtexel( vec4 value ) {\n\n\t\t\tif ( outputencoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputencoding == 1 ) {\n\n\t\t\t\treturn lineartosrgb( value );\n\n\t\t\t} else if ( outputencoding == 2 ) {\n\n\t\t\t\treturn lineartorgbe( value );\n\n\t\t\t} else if ( outputencoding == 3 ) {\n\n\t\t\t\treturn lineartorgbm( value, 7.0 );\n\n\t\t\t} else if ( outputencoding == 4 ) {\n\n\t\t\t\treturn lineartorgbm( value, 16.0 );\n\n\t\t\t} else if ( outputencoding == 5 ) {\n\n\t\t\t\treturn lineartorgbd( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn lineartogamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envmaptexeltolinear( vec4 color ) {\n\n\t\t\treturn inputtexeltolinear( color );\n\n\t\t}\n\t\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_fragcolor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_fragcolor.rgb = envmaptexeltolinear( texturecube( envmap, vec3( - voutputdirection.x, voutputdirection.yz ) ) ).rgb;\n\t\t\t\tgl_fragcolor = lineartooutputtexel( gl_fragcolor );\n\n\t\t\t}\n\t\t",blending:0,depthtest:!1,depthwrite:!1})}function th(t){console.warn("three.closedsplinecurve3 has been deprecated. use three.catmullromcurve3 instead."),oc.call(this,t),this.type="catmullrom",this.closed=!0}function eh(t){console.warn("three.splinecurve3 has been deprecated. use three.catmullromcurve3 instead."),oc.call(this,t),this.type="catmullrom"}function ah(t){console.warn("three.spline has been removed. use three.catmullromcurve3 instead."),oc.call(this,t),this.type="catmullrom"}ac.create=function(t,e){return console.log("three.curve.create() has been deprecated"),t.prototype=object.create(ac.prototype),t.prototype.constructor=t,t.prototype.getpoint=e,t},object.assign(xc.prototype,{createpointsgeometry:function(t){console.warn("three.curvepath: .createpointsgeometry() has been removed. use new three.geometry().setfrompoints( points ) instead.");var e=this.getpoints(t);return this.creategeometry(e)},createspacedpointsgeometry:function(t){console.warn("three.curvepath: .createspacedpointsgeometry() has been removed. use new three.geometry().setfrompoints( points ) instead.");var e=this.getspacedpoints(t);return this.creategeometry(e)},creategeometry:function(t){console.warn("three.curvepath: .creategeometry() has been removed. use new three.geometry().setfrompoints( points ) instead.");for(var e=new wo,n=0,r=t.length;n<r;n++){var i=t[n];e.vertices.push(new mt(i.x,i.y,i.z||0))}return e}}),object.assign(yc.prototype,{frompoints:function(t){return console.warn("three.path: .frompoints() has been renamed to .setfrompoints()."),this.setfrompoints(t)}}),th.prototype=object.create(oc.prototype),eh.prototype=object.create(oc.prototype),ah.prototype=object.create(oc.prototype),object.assign(ah.prototype,{initfromarray:function(){console.error("three.spline: .initfromarray() has been removed.")},getcontrolpointsarray:function(){console.error("three.spline: .getcontrolpointsarray() has been removed.")},reparametrizebyarclength:function(){console.error("three.spline: .reparametrizebyarclength() has been removed.")}}),du.prototype.setcolors=function(){console.error("three.gridhelper: setcolors() has been deprecated, pass them in the constructor instead.")},au.prototype.update=function(){console.error("three.skeletonhelper: update() no longer needs to be called.")},object.assign(yc.prototype,{extracturlbase:function(t){return console.warn("three.loader: .extracturlbase() has been deprecated. use three.loaderutils.extracturlbase() instead."),hl.extracturlbase(t)}}),yc.handlers={add:function(){console.error("three.loader: handlers.add() has been removed. use loadingmanager.addhandler() instead.")},get:function(){console.error("three.loader: handlers.get() has been removed. use loadingmanager.gethandler() instead.")}},object.assign(gu.prototype,{center:function(t){return console.warn("three.box2: .center() has been renamed to .getcenter()."),this.getcenter(t)},empty:function(){return console.warn("three.box2: .empty() has been renamed to .isempty()."),this.isempty()},isintersectionbox:function(t){return console.warn("three.box2: .isintersectionbox() has been renamed to .intersectsbox()."),this.intersectsbox(t)},size:function(t){return console.warn("three.box2: .size() has been renamed to .getsize()."),this.getsize(t)}}),object.assign(et.prototype,{center:function(t){return console.warn("three.box3: .center() has been renamed to .getcenter()."),this.getcenter(t)},empty:function(){return console.warn("three.box3: .empty() has been renamed to .isempty()."),this.isempty()},isintersectionbox:function(t){return console.warn("three.box3: .isintersectionbox() has been renamed to .intersectsbox()."),this.intersectsbox(t)},isintersectionsphere:function(t){return console.warn("three.box3: .isintersectionsphere() has been renamed to .intersectssphere()."),this.intersectssphere(t)},size:function(t){return console.warn("three.box3: .size() has been renamed to .getsize()."),this.getsize(t)}}),object.assign(kt.prototype,{empty:function(){return console.warn("three.sphere: .empty() has been renamed to .isempty()."),this.isempty()}}),er.prototype.setfrommatrix=function(t){return console.warn("three.frustum: .setfrommatrix() has been renamed to .setfromprojectionmatrix()."),this.setfromprojectionmatrix(t)},_u.prototype.center=function(t){return console.warn("three.line3: .center() has been renamed to .getcenter()."),this.getcenter(t)},object.assign(st,{random16:function(){return console.warn("three.math: .random16() has been deprecated. use math.random() instead."),math.random()},nearestpoweroftwo:function(t){return console.warn("three.math: .nearestpoweroftwo() has been renamed to .floorpoweroftwo()."),st.floorpoweroftwo(t)},nextpoweroftwo:function(t){return console.warn("three.math: .nextpoweroftwo() has been renamed to .ceilpoweroftwo()."),st.ceilpoweroftwo(t)}}),object.assign(ft.prototype,{flattentoarrayoffset:function(t,e){return console.warn("three.matrix3: .flattentoarrayoffset() has been deprecated. use .toarray() instead."),this.toarray(t,e)},multiplyvector3:function(t){return console.warn("three.matrix3: .multiplyvector3() has been removed. use vector.applymatrix3( matrix ) instead."),t.applymatrix3(this)},multiplyvector3array:function(){console.error("three.matrix3: .multiplyvector3array() has been removed.")},applytobufferattribute:function(t){return console.warn("three.matrix3: .applytobufferattribute() has been removed. use attribute.applymatrix3( matrix ) instead."),t.applymatrix3(this)},applytovector3array:function(){console.error("three.matrix3: .applytovector3array() has been removed.")},getinverse:function(t){return console.warn("three.matrix3: .getinverse() has been removed. use matrixinv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),object.assign(qt.prototype,{extractposition:function(t){return console.warn("three.matrix4: .extractposition() has been renamed to .copyposition()."),this.copyposition(t)},flattentoarrayoffset:function(t,e){return console.warn("three.matrix4: .flattentoarrayoffset() has been deprecated. use .toarray() instead."),this.toarray(t,e)},getposition:function(){return console.warn("three.matrix4: .getposition() has been removed. use vector3.setfrommatrixposition( matrix ) instead."),(new mt).setfrommatrixcolumn(this,3)},setrotationfromquaternion:function(t){return console.warn("three.matrix4: .setrotationfromquaternion() has been renamed to .makerotationfromquaternion()."),this.makerotationfromquaternion(t)},multiplytoarray:function(){console.warn("three.matrix4: .multiplytoarray() has been removed.")},multiplyvector3:function(t){return console.warn("three.matrix4: .multiplyvector3() has been removed. use vector.applymatrix4( matrix ) instead."),t.applymatrix4(this)},multiplyvector4:function(t){return console.warn("three.matrix4: .multiplyvector4() has been removed. use vector.applymatrix4( matrix ) instead."),t.applymatrix4(this)},multiplyvector3array:function(){console.error("three.matrix4: .multiplyvector3array() has been removed.")},rotateaxis:function(t){console.warn("three.matrix4: .rotateaxis() has been removed. use vector3.transformdirection( matrix ) instead."),t.transformdirection(this)},crossvector:function(t){return console.warn("three.matrix4: .crossvector() has been removed. use vector.applymatrix4( matrix ) instead."),t.applymatrix4(this)},translate:function(){console.error("three.matrix4: .translate() has been removed.")},rotatex:function(){console.error("three.matrix4: .rotatex() has been removed.")},rotatey:function(){console.error("three.matrix4: .rotatey() has been removed.")},rotatez:function(){console.error("three.matrix4: .rotatez() has been removed.")},rotatebyaxis:function(){console.error("three.matrix4: .rotatebyaxis() has been removed.")},applytobufferattribute:function(t){return console.warn("three.matrix4: .applytobufferattribute() has been removed. use attribute.applymatrix4( matrix ) instead."),t.applymatrix4(this)},applytovector3array:function(){console.error("three.matrix4: .applytovector3array() has been removed.")},makefrustum:function(t,e,n,r,i,a){return console.warn("three.matrix4: .makefrustum() has been removed. use .makeperspective( left, right, top, bottom, near, far ) instead."),this.makeperspective(t,e,r,n,i,a)},getinverse:function(t){return console.warn("three.matrix4: .getinverse() has been removed. use matrixinv.copy( matrix ).invert(); instead."),this.copy(t).invert()}}),ee.prototype.isintersectionline=function(t){return console.warn("three.plane: .isintersectionline() has been renamed to .intersectsline()."),this.intersectsline(t)},object.assign(wt.prototype,{multiplyvector3:function(t){return console.warn("three.quaternion: .multiplyvector3() has been removed. use is now vector.applyquaternion( quaternion ) instead."),t.applyquaternion(this)},inverse:function(){return console.warn("three.quaternion: .inverse() has been renamed to invert()."),this.invert()}}),object.assign(jt.prototype,{isintersectionbox:function(t){return console.warn("three.ray: .isintersectionbox() has been renamed to .intersectsbox()."),this.intersectsbox(t)},isintersectionplane:function(t){return console.warn("three.ray: .isintersectionplane() has been renamed to .intersectsplane()."),this.intersectsplane(t)},isintersectionsphere:function(t){return console.warn("three.ray: .isintersectionsphere() has been renamed to .intersectssphere()."),this.intersectssphere(t)}}),object.assign(ze.prototype,{area:function(){return console.warn("three.triangle: .area() has been renamed to .getarea()."),this.getarea()},barycoordfrompoint:function(t,e){return console.warn("three.triangle: .barycoordfrompoint() has been renamed to .getbarycoord()."),this.getbarycoord(t,e)},midpoint:function(t){return console.warn("three.triangle: .midpoint() has been renamed to .getmidpoint()."),this.getmidpoint(t)},normal:function(t){return console.warn("three.triangle: .normal() has been renamed to .getnormal()."),this.getnormal(t)},plane:function(t){return console.warn("three.triangle: .plane() has been renamed to .getplane()."),this.getplane(t)}}),object.assign(ze,{barycoordfrompoint:function(t,e,n,r,i){return console.warn("three.triangle: .barycoordfrompoint() has been renamed to .getbarycoord()."),ze.getbarycoord(t,e,n,r,i)},normal:function(t,e,n,r){return console.warn("three.triangle: .normal() has been renamed to .getnormal()."),ze.getnormal(t,e,n,r)}}),object.assign(zc.prototype,{extractallpoints:function(t){return console.warn("three.shape: .extractallpoints() has been removed. use .extractpoints() instead."),this.extractpoints(t)},extrude:function(t){return console.warn("three.shape: .extrude() has been removed. use extrudegeometry() instead."),new fs(this,t)},makegeometry:function(t){return console.warn("three.shape: .makegeometry() has been removed. use shapegeometry() instead."),new ls(this,t)}}),object.assign(pt.prototype,{fromattribute:function(t,e,n){return console.warn("three.vector2: .fromattribute() has been renamed to .frombufferattribute()."),this.frombufferattribute(t,e,n)},distancetomanhattan:function(t){return console.warn("three.vector2: .distancetomanhattan() has been renamed to .manhattandistanceto()."),this.manhattandistanceto(t)},lengthmanhattan:function(){return console.warn("three.vector2: .lengthmanhattan() has been renamed to .manhattanlength()."),this.manhattanlength()}}),object.assign(mt.prototype,{seteulerfromrotationmatrix:function(){console.error("three.vector3: .seteulerfromrotationmatrix() has been removed. use euler.setfromrotationmatrix() instead.")},seteulerfromquaternion:function(){console.error("three.vector3: .seteulerfromquaternion() has been removed. use euler.setfromquaternion() instead.")},getpositionfrommatrix:function(t){return console.warn("three.vector3: .getpositionfrommatrix() has been renamed to .setfrommatrixposition()."),this.setfrommatrixposition(t)},getscalefrommatrix:function(t){return console.warn("three.vector3: .getscalefrommatrix() has been renamed to .setfrommatrixscale()."),this.setfrommatrixscale(t)},getcolumnfrommatrix:function(t,e){return console.warn("three.vector3: .getcolumnfrommatrix() has been renamed to .setfrommatrixcolumn()."),this.setfrommatrixcolumn(e,t)},applyprojection:function(t){return console.warn("three.vector3: .applyprojection() has been removed. use .applymatrix4( m ) instead."),this.applymatrix4(t)},fromattribute:function(t,e,n){return console.warn("three.vector3: .fromattribute() has been renamed to .frombufferattribute()."),this.frombufferattribute(t,e,n)},distancetomanhattan:function(t){return console.warn("three.vector3: .distancetomanhattan() has been renamed to .manhattandistanceto()."),this.manhattandistanceto(t)},lengthmanhattan:function(){return console.warn("three.vector3: .lengthmanhattan() has been renamed to .manhattanlength()."),this.manhattanlength()}}),object.assign(xt.prototype,{fromattribute:function(t,e,n){return console.warn("three.vector4: .fromattribute() has been renamed to .frombufferattribute()."),this.frombufferattribute(t,e,n)},lengthmanhattan:function(){return console.warn("three.vector4: .lengthmanhattan() has been renamed to .manhattanlength()."),this.manhattanlength()}}),object.assign(wo.prototype,{computetangents:function(){console.error("three.geometry: .computetangents() has been removed.")},computelinedistances:function(){console.error("three.geometry: .computelinedistances() has been removed. use three.line.computelinedistances() instead.")},applymatrix:function(t){return console.warn("three.geometry: .applymatrix() has been renamed to .applymatrix4()."),this.applymatrix4(t)}}),object.assign(we.prototype,{getchildbyname:function(t){return console.warn("three.object3d: .getchildbyname() has been renamed to .getobjectbyname()."),this.getobjectbyname(t)},renderdepth:function(){console.warn("three.object3d: .renderdepth has been removed. use .renderorder, instead.")},translate:function(t,e){return console.warn("three.object3d: .translate() has been removed. use .translateonaxis( axis, distance ) instead."),this.translateonaxis(e,t)},getworldrotation:function(){console.error("three.object3d: .getworldrotation() has been removed. use three.object3d.getworldquaternion( target ) instead.")},applymatrix:function(t){return console.warn("three.object3d: .applymatrix() has been renamed to .applymatrix4()."),this.applymatrix4(t)}}),object.defineproperties(we.prototype,{eulerorder:{get:function(){return console.warn("three.object3d: .eulerorder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("three.object3d: .eulerorder is now .rotation.order."),this.rotation.order=t}},usequaternion:{get:function(){console.warn("three.object3d: .usequaternion has been removed. the library now uses quaternions by default.")},set:function(){console.warn("three.object3d: .usequaternion has been removed. the library now uses quaternions by default.")}}}),object.assign(fn.prototype,{setdrawmode:function(){console.error("three.mesh: .setdrawmode() has been removed. the renderer now always assumes three.trianglesdrawmode. transform your geometry via buffergeometryutils.totrianglesdrawmode() if necessary.")}}),object.defineproperties(fn.prototype,{drawmode:{get:function(){return console.error("three.mesh: .drawmode has been removed. the renderer now always assumes three.trianglesdrawmode."),0},set:function(){console.error("three.mesh: .drawmode has been removed. the renderer now always assumes three.trianglesdrawmode. transform your geometry via buffergeometryutils.totrianglesdrawmode() if necessary.")}}}),object.defineproperties(na.prototype,{objects:{get:function(){return console.warn("three.lod: .objects has been renamed to .levels."),this.levels}}}),object.defineproperty(va.prototype,"usevertextexture",{get:function(){console.warn("three.skeleton: usevertextexture has been removed.")},set:function(){console.warn("three.skeleton: usevertextexture has been removed.")}}),ga.prototype.initbones=function(){console.error("three.skinnedmesh: initbones() has been removed.")},object.defineproperty(ac.prototype,"__arclengthdivisions",{get:function(){return console.warn("three.curve: .__arclengthdivisions is now .arclengthdivisions."),this.arclengthdivisions},set:function(t){console.warn("three.curve: .__arclengthdivisions is now .arclengthdivisions."),this.arclengthdivisions=t}}),xn.prototype.setlens=function(t,e){console.warn("three.perspectivecamera.setlens is deprecated. use .setfocallength and .filmgauge for a photographic setup."),void 0!==e&&(this.filmgauge=e),this.setfocallength(t)},object.defineproperties(jc.prototype,{onlyshadow:{set:function(){console.warn("three.light: .onlyshadow has been removed.")}},shadowcamerafov:{set:function(t){console.warn("three.light: .shadowcamerafov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowcameraleft:{set:function(t){console.warn("three.light: .shadowcameraleft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowcameraright:{set:function(t){console.warn("three.light: .shadowcameraright is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowcameratop:{set:function(t){console.warn("three.light: .shadowcameratop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowcamerabottom:{set:function(t){console.warn("three.light: .shadowcamerabottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowcameranear:{set:function(t){console.warn("three.light: .shadowcameranear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowcamerafar:{set:function(t){console.warn("three.light: .shadowcamerafar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowcameravisible:{set:function(){console.warn("three.light: .shadowcameravisible has been removed. use new three.camerahelper( light.shadow.camera ) instead.")}},shadowbias:{set:function(t){console.warn("three.light: .shadowbias is now .shadow.bias."),this.shadow.bias=t}},shadowdarkness:{set:function(){console.warn("three.light: .shadowdarkness has been removed.")}},shadowmapwidth:{set:function(t){console.warn("three.light: .shadowmapwidth is now .shadow.mapsize.width."),this.shadow.mapsize.width=t}},shadowmapheight:{set:function(t){console.warn("three.light: .shadowmapheight is now .shadow.mapsize.height."),this.shadow.mapsize.height=t}}}),object.defineproperties(qe.prototype,{length:{get:function(){return console.warn("three.bufferattribute: .length has been deprecated. use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("three.bufferattribute: .dynamic has been deprecated. use .usage instead."),this.usage===et},set:function(){console.warn("three.bufferattribute: .dynamic has been deprecated. use .usage instead."),this.setusage(et)}}}),object.assign(qe.prototype,{setdynamic:function(t){return console.warn("three.bufferattribute: .setdynamic() has been deprecated. use .setusage() instead."),this.setusage(!0===t?et:tt),this},copyindicesarray:function(){console.error("three.bufferattribute: .copyindicesarray() has been removed.")},setarray:function(){console.error("three.bufferattribute: .setarray has been removed. use buffergeometry .setattribute to replace/resize attribute buffers")}}),object.assign(_n.prototype,{addindex:function(t){console.warn("three.buffergeometry: .addindex() has been renamed to .setindex()."),this.setindex(t)},addattribute:function(t,e){return console.warn("three.buffergeometry: .addattribute() has been renamed to .setattribute()."),e&&e.isbufferattribute||e&&e.isinterleavedbufferattribute?"index"===t?(console.warn("three.buffergeometry.addattribute: use .setindex() for index attribute."),this.setindex(e),this):this.setattribute(t,e):(console.warn("three.buffergeometry: .addattribute() now expects ( name, attribute )."),this.setattribute(t,new qe(arguments[1],arguments[2])))},adddrawcall:function(t,e,n){void 0!==n&&console.warn("three.buffergeometry: .adddrawcall() no longer supports indexoffset."),console.warn("three.buffergeometry: .adddrawcall() is now .addgroup()."),this.addgroup(t,e)},cleardrawcalls:function(){console.warn("three.buffergeometry: .cleardrawcalls() is now .cleargroups()."),this.cleargroups()},computetangents:function(){console.warn("three.buffergeometry: .computetangents() has been removed.")},computeoffsets:function(){console.warn("three.buffergeometry: .computeoffsets() has been removed.")},removeattribute:function(t){return console.warn("three.buffergeometry: .removeattribute() has been renamed to .deleteattribute()."),this.deleteattribute(t)},applymatrix:function(t){return console.warn("three.buffergeometry: .applymatrix() has been renamed to .applymatrix4()."),this.applymatrix4(t)}}),object.defineproperties(_n.prototype,{drawcalls:{get:function(){return console.error("three.buffergeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("three.buffergeometry: .offsets has been renamed to .groups."),this.groups}}}),object.defineproperties(dl.prototype,{maxinstancedcount:{get:function(){return console.warn("three.instancedbuffergeometry: .maxinstancedcount has been renamed to .instancecount."),this.instancecount},set:function(t){console.warn("three.instancedbuffergeometry: .maxinstancedcount has been renamed to .instancecount."),this.instancecount=t}}}),object.defineproperties(hu.prototype,{lineprecision:{get:function(){return console.warn("three.raycaster: .lineprecision has been deprecated. use .params.line.threshold instead."),this.params.line.threshold},set:function(t){console.warn("three.raycaster: .lineprecision has been deprecated. use .params.line.threshold instead."),this.params.line.threshold=t}}}),object.defineproperties(da.prototype,{dynamic:{get:function(){return console.warn("three.interleavedbuffer: .length has been deprecated. use .usage instead."),this.usage===et},set:function(t){console.warn("three.interleavedbuffer: .length has been deprecated. use .usage instead."),this.setusage(t)}}}),object.assign(da.prototype,{setdynamic:function(t){return console.warn("three.interleavedbuffer: .setdynamic() has been deprecated. use .setusage() instead."),this.setusage(!0===t?et:tt),this},setarray:function(){console.error("three.interleavedbuffer: .setarray has been removed. use buffergeometry .setattribute to replace/resize attribute buffers")}}),object.assign(ds.prototype,{getarrays:function(){console.error("three.extrudebuffergeometry: .getarrays() has been removed.")},addshapelist:function(){console.error("three.extrudebuffergeometry: .addshapelist() has been removed.")},addshape:function(){console.error("three.extrudebuffergeometry: .addshape() has been removed.")}}),object.assign(ha.prototype,{dispose:function(){console.error("three.scene: .dispose() has been removed.")}}),object.defineproperties(cu.prototype,{dynamic:{set:function(){console.warn("three.uniform: .dynamic has been removed. use object.onbeforerender() instead.")}},onupdate:{value:function(){return console.warn("three.uniform: .onupdate() has been removed. use object.onbeforerender() instead."),this}}}),object.defineproperties(xe.prototype,{wraparound:{get:function(){console.warn("three.material: .wraparound has been removed.")},set:function(){console.warn("three.material: .wraparound has been removed.")}},overdraw:{get:function(){console.warn("three.material: .overdraw has been removed.")},set:function(){console.warn("three.material: .overdraw has been removed.")}},wraprgb:{get:function(){return console.warn("three.material: .wraprgb has been removed."),new we}},shading:{get:function(){console.error("three."+this.type+": .shading has been removed. use the boolean .flatshading instead.")},set:function(t){console.warn("three."+this.type+": .shading has been removed. use the boolean .flatshading instead."),this.flatshading=1===t}},stencilmask:{get:function(){return console.warn("three."+this.type+": .stencilmask has been removed. use .stencilfuncmask instead."),this.stencilfuncmask},set:function(t){console.warn("three."+this.type+": .stencilmask has been removed. use .stencilfuncmask instead."),this.stencilfuncmask=t}}}),object.defineproperties(xs.prototype,{metal:{get:function(){return console.warn("three.meshphongmaterial: .metal has been removed. use three.meshstandardmaterial instead."),!1},set:function(){console.warn("three.meshphongmaterial: .metal has been removed. use three.meshstandardmaterial instead")}}}),object.defineproperties(qs.prototype,{transparency:{get:function(){return console.warn("three.meshphysicalmaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(t){console.warn("three.meshphysicalmaterial: .transparency has been renamed to .transmission."),this.transmission=t}}}),object.defineproperties(jn.prototype,{derivatives:{get:function(){return console.warn("three.shadermaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("three. shadermaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),object.assign(sa.prototype,{cleartarget:function(t,e,n,r){console.warn("three.webglrenderer: .cleartarget() has been deprecated. use .setrendertarget() and .clear() instead."),this.setrendertarget(t),this.clear(e,n,r)},animate:function(t){console.warn("three.webglrenderer: .animate() is now .setanimationloop()."),this.setanimationloop(t)},getcurrentrendertarget:function(){return console.warn("three.webglrenderer: .getcurrentrendertarget() is now .getrendertarget()."),this.getrendertarget()},getmaxanisotropy:function(){return console.warn("three.webglrenderer: .getmaxanisotropy() is now .capabilities.getmaxanisotropy()."),this.capabilities.getmaxanisotropy()},getprecision:function(){return console.warn("three.webglrenderer: .getprecision() is now .capabilities.precision."),this.capabilities.precision},resetglstate:function(){return console.warn("three.webglrenderer: .resetglstate() is now .state.reset()."),this.state.reset()},supportsfloattextures:function(){return console.warn("three.webglrenderer: .supportsfloattextures() is now .extensions.get( 'oes_texture_float' )."),this.extensions.get("oes_texture_float")},supportshalffloattextures:function(){return console.warn("three.webglrenderer: .supportshalffloattextures() is now .extensions.get( 'oes_texture_half_float' )."),this.extensions.get("oes_texture_half_float")},supportsstandardderivatives:function(){return console.warn("three.webglrenderer: .supportsstandardderivatives() is now .extensions.get( 'oes_standard_derivatives' )."),this.extensions.get("oes_standard_derivatives")},supportscompressedtextures3tc:function(){return console.warn("three.webglrenderer: .supportscompressedtextures3tc() is now .extensions.get( 'webgl_compressed_texture_s3tc' )."),this.extensions.get("webgl_compressed_texture_s3tc")},supportscompressedtexturepvrtc:function(){return console.warn("three.webglrenderer: .supportscompressedtexturepvrtc() is now .extensions.get( 'webgl_compressed_texture_pvrtc' )."),this.extensions.get("webgl_compressed_texture_pvrtc")},supportsblendminmax:function(){return console.warn("three.webglrenderer: .supportsblendminmax() is now .extensions.get( 'ext_blend_minmax' )."),this.extensions.get("ext_blend_minmax")},supportsvertextextures:function(){return console.warn("three.webglrenderer: .supportsvertextextures() is now .capabilities.vertextextures."),this.capabilities.vertextextures},supportsinstancedarrays:function(){return console.warn("three.webglrenderer: .supportsinstancedarrays() is now .extensions.get( 'angle_instanced_arrays' )."),this.extensions.get("angle_instanced_arrays")},enablescissortest:function(t){console.warn("three.webglrenderer: .enablescissortest() is now .setscissortest()."),this.setscissortest(t)},initmaterial:function(){console.warn("three.webglrenderer: .initmaterial() has been removed.")},addpreplugin:function(){console.warn("three.webglrenderer: .addpreplugin() has been removed.")},addpostplugin:function(){console.warn("three.webglrenderer: .addpostplugin() has been removed.")},updateshadowmap:function(){console.warn("three.webglrenderer: .updateshadowmap() has been removed.")},setfaceculling:function(){console.warn("three.webglrenderer: .setfaceculling() has been removed.")},alloctextureunit:function(){console.warn("three.webglrenderer: .alloctextureunit() has been removed.")},settexture:function(){console.warn("three.webglrenderer: .settexture() has been removed.")},settexture2d:function(){console.warn("three.webglrenderer: .settexture2d() has been removed.")},settexturecube:function(){console.warn("three.webglrenderer: .settexturecube() has been removed.")},getactivemipmaplevel:function(){return console.warn("three.webglrenderer: .getactivemipmaplevel() is now .getactivemipmaplevel()."),this.getactivemipmaplevel()}}),object.defineproperties(sa.prototype,{shadowmapenabled:{get:function(){return this.shadowmap.enabled},set:function(t){console.warn("three.webglrenderer: .shadowmapenabled is now .shadowmap.enabled."),this.shadowmap.enabled=t}},shadowmaptype:{get:function(){return this.shadowmap.type},set:function(t){console.warn("three.webglrenderer: .shadowmaptype is now .shadowmap.type."),this.shadowmap.type=t}},shadowmapcullface:{get:function(){console.warn("three.webglrenderer: .shadowmapcullface has been removed. set material.shadowside instead.")},set:function(){console.warn("three.webglrenderer: .shadowmapcullface has been removed. set material.shadowside instead.")}},context:{get:function(){return console.warn("three.webglrenderer: .context has been removed. use .getcontext() instead."),this.getcontext()}},vr:{get:function(){return console.warn("three.webglrenderer: .vr has been renamed to .xr"),this.xr}},gammainput:{get:function(){return console.warn("three.webglrenderer: .gammainput has been removed. set the encoding for textures via texture.encoding instead."),!1},set:function(){console.warn("three.webglrenderer: .gammainput has been removed. set the encoding for textures via texture.encoding instead.")}},gammaoutput:{get:function(){return console.warn("three.webglrenderer: .gammaoutput has been removed. set webglrenderer.outputencoding instead."),!1},set:function(t){console.warn("three.webglrenderer: .gammaoutput has been removed. set webglrenderer.outputencoding instead."),this.outputencoding=!0===t?x:q}},tonemappingwhitepoint:{get:function(){return console.warn("three.webglrenderer: .tonemappingwhitepoint has been removed."),1},set:function(){console.warn("three.webglrenderer: .tonemappingwhitepoint has been removed.")}}}),object.defineproperties(ki.prototype,{cullface:{get:function(){console.warn("three.webglrenderer: .shadowmap.cullface has been removed. set material.shadowside instead.")},set:function(){console.warn("three.webglrenderer: .shadowmap.cullface has been removed. set material.shadowside instead.")}},renderreversesided:{get:function(){console.warn("three.webglrenderer: .shadowmap.renderreversesided has been removed. set material.shadowside instead.")},set:function(){console.warn("three.webglrenderer: .shadowmap.renderreversesided has been removed. set material.shadowside instead.")}},rendersinglesided:{get:function(){console.warn("three.webglrenderer: .shadowmap.rendersinglesided has been removed. set material.shadowside instead.")},set:function(){console.warn("three.webglrenderer: .shadowmap.rendersinglesided has been removed. set material.shadowside instead.")}}}),object.defineproperties(_t.prototype,{wraps:{get:function(){return console.warn("three.webglrendertarget: .wraps is now .texture.wraps."),this.texture.wraps},set:function(t){console.warn("three.webglrendertarget: .wraps is now .texture.wraps."),this.texture.wraps=t}},wrapt:{get:function(){return console.warn("three.webglrendertarget: .wrapt is now .texture.wrapt."),this.texture.wrapt},set:function(t){console.warn("three.webglrendertarget: .wrapt is now .texture.wrapt."),this.texture.wrapt=t}},magfilter:{get:function(){return console.warn("three.webglrendertarget: .magfilter is now .texture.magfilter."),this.texture.magfilter},set:function(t){console.warn("three.webglrendertarget: .magfilter is now .texture.magfilter."),this.texture.magfilter=t}},minfilter:{get:function(){return console.warn("three.webglrendertarget: .minfilter is now .texture.minfilter."),this.texture.minfilter},set:function(t){console.warn("three.webglrendertarget: .minfilter is now .texture.minfilter."),this.texture.minfilter=t}},anisotropy:{get:function(){return console.warn("three.webglrendertarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("three.webglrendertarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("three.webglrendertarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("three.webglrendertarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("three.webglrendertarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("three.webglrendertarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("three.webglrendertarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("three.webglrendertarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("three.webglrendertarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("three.webglrendertarget: .type is now .texture.type."),this.texture.type=t}},generatemipmaps:{get:function(){return console.warn("three.webglrendertarget: .generatemipmaps is now .texture.generatemipmaps."),this.texture.generatemipmaps},set:function(t){console.warn("three.webglrendertarget: .generatemipmaps is now .texture.generatemipmaps."),this.texture.generatemipmaps=t}}}),object.defineproperties(gl.prototype,{load:{value:function(t){console.warn("three.audio: .load has been deprecated. use three.audioloader instead.");var e=this;return(new el).load(t,(function(t){e.setbuffer(t)})),this}},starttime:{set:function(){console.warn("three.audio: .starttime is now .play( delay ).")}}}),jl.prototype.getdata=function(){return console.warn("three.audioanalyser: .getdata() is now .getfrequencydata()."),this.getfrequencydata()},zn.prototype.updatecubemap=function(t,e){return console.warn("three.cubecamera: .updatecubemap() is now .update()."),this.update(t,e)},zn.prototype.clear=function(t,e,n,r){return console.warn("three.cubecamera: .clear() is now .rendertarget.clear()."),this.rendertarget.clear(t,e,n,r)};var lh={merge:function(t,e,n){var r;console.warn("three.geometryutils: .merge() has been moved to geometry. use geometry.merge( geometry2, matrix, materialindexoffset ) instead."),e.ismesh&&(e.matrixautoupdate&&e.updatematrix(),r=e.matrix,e=e.geometry),t.merge(e,r,n)},center:function(t){return console.warn("three.geometryutils: .center() has been moved to geometry. use geometry.center() instead."),t.center()}};mt.crossorigin=void 0,mt.loadtexture=function(t,e,n,r){console.warn("three.imageutils.loadtexture has been deprecated. use three.textureloader() instead.");var i=new ec;i.setcrossorigin(this.crossorigin);var a=i.load(t,n,void 0,r);return e&&(a.mapping=e),a},mt.loadtexturecube=function(t,e,n,r){console.warn("three.imageutils.loadtexturecube has been deprecated. use three.cubetextureloader() instead.");var i=new sc;i.setcrossorigin(this.crossorigin);var a=i.load(t,n,void 0,r);return e&&(a.mapping=e),a},mt.loadcompressedtexture=function(){console.error("three.imageutils.loadcompressedtexture has been removed. use three.ddsloader instead.")},mt.loadcompressedtexturecube=function(){console.error("three.imageutils.loadcompressedtexturecube has been removed. use three.ddsloader instead.")};var rh={createmultimaterialobject:function(){console.error("three.sceneutils has been moved to /examples/jsm/utils/sceneutils.js")},detach:function(){console.error("three.sceneutils has been moved to /examples/jsm/utils/sceneutils.js")},attach:function(){console.error("three.sceneutils has been moved to /examples/jsm/utils/sceneutils.js")}};"undefined"!=typeof __three_devtools__&&__three_devtools__.dispatchevent(new customevent("register",{detail:{revision:"124"}})),t.acesfilmictonemapping=4,t.addequation=e,t.addoperation=2,t.additiveanimationblendmode=j,t.additiveblending=2,t.alphaformat=1021,t.alwaysdepth=1,t.alwaysstencilfunc=519,t.ambientlight=ol,t.ambientlightprobe=ll,t.animationclip=pc,t.animationloader=bc,t.animationmixer=su,t.animationobjectgroup=au,t.animationutils=tc,t.arccurve=rc,t.arraycamera=na,t.arrowhelper=ku,t.audio=gl,t.audioanalyser=jl,t.audiocontext=tl,t.audiolistener=fl,t.audioloader=el,t.axeshelper=$u,t.axishelper=function(t){return console.warn("three.axishelper has been renamed to three.axeshelper."),new $u(t)},t.backside=1,t.basicdepthpacking=3200,t.basicshadowmap=0,t.binarytextureloader=function(t){return console.warn("three.binarytextureloader has been renamed to three.datatextureloader."),new tc(t)},t.bone=ua,t.booleankeyframetrack=oc,t.boundingboxhelper=function(t,e){return console.warn("three.boundingboxhelper has been deprecated. creating a three.boxhelper instead."),new yu(t,e)},t.box2=gu,t.box3=et,t.box3helper=zu,t.boxbuffergeometry=hn,t.boxgeometry=mo,t.boxhelper=yu,t.bufferattribute=qe,t.buffergeometry=_n,t.buffergeometryloader=fl,t.bytetype=1010,t.cache=mc,t.camera=qn,t.camerahelper=ku,t.canvasrenderer=function(){console.error("three.canvasrenderer has been removed")},t.canvastexture=vo,t.catmullromcurve3=oc,t.cineontonemapping=3,t.circlebuffergeometry=so,t.circlegeometry=to,t.clamptoedgewrapping=u,t.clock=il,t.closedsplinecurve3=th,t.color=we,t.colorkeyframetrack=sc,t.compressedtexture=mo,t.compressedtextureloader=wc,t.conebuffergeometry=ro,t.conegeometry=lo,t.cubecamera=zn,t.cubegeometry=mo,t.cubereflectionmapping=r,t.cuberefractionmapping=i,t.cubetexture=jn,t.cubetextureloader=sc,t.cubeuvreflectionmapping=s,t.cubeuvrefractionmapping=c,t.cubicbeziercurve=gc,t.cubicbeziercurve3=uc,t.cubicinterpolant=nc,t.cullfaceback=1,t.cullfacefront=2,t.cullfacefrontback=3,t.cullfacenone=0,t.curve=ac,t.curvepath=xc,t.customblending=5,t.customtonemapping=5,t.cylinderbuffergeometry=eo,t.cylindergeometry=ao,t.cylindrical=mu,t.datatexture=kn,t.datatexture2darray=wr,t.datatexture3d=mr,t.datatextureloader=tc,t.datautils=nh,t.decrementstencilop=7683,t.decrementwrapstencilop=34056,t.defaultloadingmanager=gc,t.depthformat=e,t.depthstencilformat=a,t.depthtexture=go,t.directionallight=al,t.directionallighthelper=gu,t.discreteinterpolant=ic,t.dodecahedronbuffergeometry=po,t.dodecahedrongeometry=io,t.doubleside=2,t.dstalphafactor=206,t.dstcolorfactor=208,t.dynamicbufferattribute=function(t,e){return console.warn("three.dynamicbufferattribute has been removed. use new three.bufferattribute().setusage( three.dynamicdrawusage ) instead."),new qe(t,e).setusage(et)},t.dynamiccopyusage=35050,t.dynamicdrawusage=et,t.dynamicreadusage=35049,t.edgesgeometry=zo,t.edgeshelper=function(t,e){return console.warn("three.edgeshelper has been removed. use three.edgesgeometry instead."),new io(new zo(t.geometry),new za({color:void 0!==e?e:16777215}))},t.ellipsecurve=lc,t.equaldepth=4,t.equalstencilfunc=514,t.equirectangularreflectionmapping=a,t.equirectangularrefractionmapping=o,t.euler=ae,t.eventdispatcher=rt,t.extrudebuffergeometry=ds,t.extrudegeometry=fs,t.face3=je,t.face4=function(t,e,n,r,i,a,o){return console.warn("three.face4 has been removed. a three.face3 will be created instead."),new je(t,e,n,i,a,o)},t.facecolors=1,t.fileloader=_c,t.flatshading=1,t.float16bufferattribute=on,t.float32attribute=function(t,e){return console.warn("three.float32attribute has been removed. use new three.float32bufferattribute() instead."),new sn(t,e)},t.float32bufferattribute=sn,t.float64attribute=function(t,e){return console.warn("three.float64attribute has been removed. use new three.float64bufferattribute() instead."),new cn(t,e)},t.float64bufferattribute=cn,t.floattype=b,t.fog=ua,t.fogexp2=la,t.font=wl,t.fontloader=sl,t.frontside=0,t.frustum=er,t.glbufferattribute=uu,t.glsl1="100",t.glsl3=nt,t.gammaencoding=y,t.geometry=wo,t.geometryutils=lh,t.greaterdepth=6,t.greaterequaldepth=5,t.greaterequalstencilfunc=518,t.greaterstencilfunc=516,t.gridhelper=du,t.group=ra,t.halffloattype=w,t.hemispherelight=qc,t.hemispherelighthelper=nu,t.hemispherelightprobe=al,t.icosahedronbuffergeometry=ms,t.icosahedrongeometry=vs,t.imagebitmaploader=_l,t.imageloader=mc,t.imageutils=mt,t.immediaterenderobject=bu,t.incrementstencilop=7682,t.incrementwrapstencilop=34055,t.instancedbufferattribute=pl,t.instancedbuffergeometry=dl,t.instancedinterleavedbuffer=lu,t.instancedmesh=ya,t.int16attribute=function(t,e){return console.warn("three.int16attribute has been removed. use new three.int16bufferattribute() instead."),new en(t,e)},t.int16bufferattribute=en,t.int32attribute=function(t,e){return console.warn("three.int32attribute has been removed. use new three.int32bufferattribute() instead."),new rn(t,e)},t.int32bufferattribute=rn,t.int8attribute=function(t,e){return console.warn("three.int8attribute has been removed. use new three.int8bufferattribute() instead."),new ke(t,e)},t.int8bufferattribute=ke,t.inttype=1013,t.interleavedbuffer=da,t.interleavedbufferattribute=ma,t.interpolant=ec,t.interpolatediscrete=f,t.interpolatelinear=g,t.interpolatesmooth=u,t.invertstencilop=5386,t.jsonloader=function(){console.error("three.jsonloader has been removed.")},t.keepstencilop=$,t.keyframetrack=ac,t.lod=na,t.lathebuffergeometry=gs,t.lathegeometry=ys,t.layers=ce,t.lensflare=function(){console.error("three.lensflare has been moved to /examples/jsm/objects/lensflare.js")},t.lessdepth=2,t.lessequaldepth=3,t.lessequalstencilfunc=515,t.lessstencilfunc=513,t.light=jc,t.lightprobe=ll,t.line=eo,t.line3=_u,t.linebasicmaterial=za,t.linecurve=hc,t.linecurve3=kc,t.linedashedmaterial=ks,t.lineloop=ao,t.linepieces=1,t.linesegments=io,t.linestrip=0,t.linearencoding=q,t.linearfilter=m,t.linearinterpolant=rc,t.linearmipmaplinearfilter=1008,t.linearmipmapnearestfilter=1007,t.linearmipmaplinearfilter=g,t.linearmipmapnearestfilter=v,t.lineartonemapping=1,t.loader=yc,t.loaderutils=hl,t.loadingmanager=vc,t.logluvencoding=3003,t.looponce=2200,t.looppingpong=2202,t.looprepeat=2201,t.luminancealphaformat=1025,t.luminanceformat=1024,t.mouse={left:0,middle:1,right:2,rotate:0,dolly:1,pan:2},t.material=xe,t.materialloader=ul,t.math=st,t.mathutils=st,t.matrix3=ft,t.matrix4=qt,t.maxequation=104,t.mesh=fn,t.meshbasicmaterial=ye,t.meshdepthmaterial=ji,t.meshdistancematerial=qi,t.meshfacematerial=function(t){return console.warn("three.meshfacematerial has been removed. use an array instead."),t},t.meshlambertmaterial=js,t.meshmatcapmaterial=qs,t.meshnormalmaterial=zs,t.meshphongmaterial=xs,t.meshphysicalmaterial=qs,t.meshstandardmaterial=js,t.meshtoonmaterial=ys,t.minequation=103,t.mirroredrepeatwrapping=h,t.mixoperation=1,t.multimaterial=function(t){return void 0===t&&(t=[]),console.warn("three.multimaterial has been removed. use an array instead."),t.ismultimaterial=!0,t.materials=t,t.clone=function(){return t.slice()},t},t.multiplyblending=4,t.multiplyoperation=0,t.nearestfilter=d,t.nearestmipmaplinearfilter=1005,t.nearestmipmapnearestfilter=1004,t.nearestmipmaplinearfilter=f,t.nearestmipmapnearestfilter=p,t.neverdepth=0,t.neverstencilfunc=512,t.noblending=0,t.nocolors=0,t.notonemapping=0,t.normalanimationblendmode=w,t.normalblending=1,t.notequaldepth=7,t.notequalstencilfunc=517,t.numberkeyframetrack=cc,t.object3d=we,t.objectloader=vl,t.objectspacenormalmap=1,t.octahedronbuffergeometry=xs,t.octahedrongeometry=_s,t.onefactor=201,t.oneminusdstalphafactor=207,t.oneminusdstcolorfactor=209,t.oneminussrcalphafactor=205,t.oneminussrccolorfactor=203,t.orthographiccamera=rl,t.pcfshadowmap=1,t.pcfsoftshadowmap=2,t.pmremgenerator=yh,t.parametricbuffergeometry=bs,t.parametricgeometry=ws,t.particle=function(t){return console.warn("three.particle has been renamed to three.sprite."),new ra(t)},t.particlebasicmaterial=function(t){return console.warn("three.particlebasicmaterial has been renamed to three.pointsmaterial."),new oo(t)},t.particlesystem=function(t,e){return console.warn("three.particlesystem has been renamed to three.points."),new ho(t,e)},t.particlesystemmaterial=function(t){return console.warn("three.particlesystemmaterial has been renamed to three.pointsmaterial."),new oo(t)},t.path=yc,t.perspectivecamera=xn,t.plane=ee,t.planebuffergeometry=ir,t.planegeometry=ms,t.planehelper=ju,t.pointcloud=function(t,e){return console.warn("three.pointcloud has been renamed to three.points."),new ho(t,e)},t.pointcloudmaterial=function(t){return console.warn("three.pointcloudmaterial has been renamed to three.pointsmaterial."),new oo(t)},t.pointlight=nl,t.pointlighthelper=ru,t.points=ho,t.pointsmaterial=oo,t.polargridhelper=ou,t.polyhedronbuffergeometry=co,t.polyhedrongeometry=ss,t.positionalaudio=wl,t.propertybinding=iu,t.propertymixer=ql,t.quadraticbeziercurve=vc,t.quadraticbeziercurve3=wc,t.quaternion=wt,t.quaternionkeyframetrack=uc,t.quaternionlinearinterpolant=lc,t.revision="124",t.rgbadepthpacking=3201,t.rgbaformat=t,t.rgbaintegerformat=1033,t.rgba_astc_10x10_format=37819,t.rgba_astc_10x5_format=37816,t.rgba_astc_10x6_format=37817,t.rgba_astc_10x8_format=37818,t.rgba_astc_12x10_format=37820,t.rgba_astc_12x12_format=37821,t.rgba_astc_4x4_format=37808,t.rgba_astc_5x4_format=37809,t.rgba_astc_5x5_format=37810,t.rgba_astc_6x5_format=37811,t.rgba_astc_6x6_format=37812,t.rgba_astc_8x5_format=37813,t.rgba_astc_8x6_format=37814,t.rgba_astc_8x8_format=37815,t.rgba_bptc_format=36492,t.rgba_etc2_eac_format=z,t.rgba_pvrtc_2bppv1_format=o,t.rgba_pvrtc_4bppv1_format=d,t.rgba_s3tc_dxt1_format=r,t.rgba_s3tc_dxt3_format=c,t.rgba_s3tc_dxt5_format=p,t.rgbdencoding=k,t.rgbeencoding=z,t.rgbeformat=1023,t.rgbformat=s,t.rgbintegerformat=1032,t.rgbm16encoding=q,t.rgbm7encoding=j,t.rgb_etc1_format=36196,t.rgb_etc2_format=b,t.rgb_pvrtc_2bppv1_format=n,t.rgb_pvrtc_4bppv1_format=i,t.rgb_s3tc_dxt1_format=l,t.rgformat=1030,t.rgintegerformat=1031,t.rawshadermaterial=ws,t.ray=jt,t.raycaster=hu,t.rectarealight=sl,t.redformat=1028,t.redintegerformat=1029,t.reinhardtonemapping=2,t.repeatwrapping=l,t.replacestencilop=7681,t.reversesubtractequation=102,t.ringbuffergeometry=ts,t.ringgeometry=es,t.srgb8_alpha8_astc_10x10_format=37851,t.srgb8_alpha8_astc_10x5_format=37848,t.srgb8_alpha8_astc_10x6_format=37849,t.srgb8_alpha8_astc_10x8_format=37850,t.srgb8_alpha8_astc_12x10_format=37852,t.srgb8_alpha8_astc_12x12_format=37853,t.srgb8_alpha8_astc_4x4_format=37840,t.srgb8_alpha8_astc_5x4_format=37841,t.srgb8_alpha8_astc_5x5_format=37842,t.srgb8_alpha8_astc_6x5_format=37843,t.srgb8_alpha8_astc_6x6_format=37844,t.srgb8_alpha8_astc_8x5_format=37845,t.srgb8_alpha8_astc_8x6_format=37846,t.srgb8_alpha8_astc_8x8_format=37847,t.scene=ha,t.sceneutils=rh,t.shaderchunk=ar,t.shaderlib=sr,t.shadermaterial=jn,t.shadowmaterial=vs,t.shape=zc,t.shapebuffergeometry=as,t.shapegeometry=ls,t.shapepath=bl,t.shapeutils=ls,t.shorttype=1011,t.skeleton=va,t.skeletonhelper=au,t.skinnedmesh=ga,t.smoothshading=2,t.sphere=kt,t.spherebuffergeometry=rs,t.spheregeometry=cs,t.spherical=fu,t.sphericalharmonics3=cl,t.spline=ah,t.splinecurve=jc,t.splinecurve3=eh,t.spotlight=tl,t.spotlighthelper=mu,t.sprite=ra,t.spritematerial=va,t.srcalphafactor=204,t.srcalphasaturatefactor=210,t.srccolorfactor=202,t.staticcopyusage=35046,t.staticdrawusage=tt,t.staticreadusage=35045,t.stereocamera=pl,t.streamcopyusage=35042,t.streamdrawusage=35040,t.streamreadusage=35041,t.stringkeyframetrack=hc,t.subtractequation=101,t.subtractiveblending=3,t.touch={rotate:0,pan:1,dolly_pan:2,dolly_rotate:3},t.tangentspacenormalmap=0,t.tetrahedronbuffergeometry=ps,t.tetrahedrongeometry=is,t.textbuffergeometry=ns,t.textgeometry=ds,t.texture=gt,t.textureloader=ec,t.torusbuffergeometry=os,t.torusgeometry=bs,t.torusknotbuffergeometry=zs,t.torusknotgeometry=fs,t.triangle=ze,t.trianglefandrawmode=2,t.trianglestripdrawmode=1,t.trianglesdrawmode=0,t.tubebuffergeometry=gs,t.tubegeometry=us,t.uvmapping=n,t.uint16attribute=function(t,e){return console.warn("three.uint16attribute has been removed. use new three.uint16bufferattribute() instead."),new nn(t,e)},t.uint16bufferattribute=nn,t.uint32attribute=function(t,e){return console.warn("three.uint32attribute has been removed. use new three.uint32bufferattribute() instead."),new an(t,e)},t.uint32bufferattribute=an,t.uint8attribute=function(t,e){return console.warn("three.uint8attribute has been removed. use new three.uint8bufferattribute() instead."),new $e(t,e)},t.uint8bufferattribute=$e,t.uint8clampedattribute=function(t,e){return console.warn("three.uint8clampedattribute has been removed. use new three.uint8clampedbufferattribute() instead."),new tn(t,e)},t.uint8clampedbufferattribute=tn,t.uniform=cu,t.uniformslib=or,t.uniformsutils=wn,t.unsignedbytetype=y,t.unsignedint248type=m,t.unsignedinttype=_,t.unsignedshort4444type=1017,t.unsignedshort5551type=1018,t.unsignedshort565type=1019,t.unsignedshorttype=x,t.vsmshadowmap=3,t.vector2=pt,t.vector3=mt,t.vector4=xt,t.vectorkeyframetrack=dc,t.vertex=function(t,e,n){return console.warn("three.vertex has been removed. use three.vector3 instead."),new mt(t,e,n)},t.vertexcolors=2,t.videotexture=fo,t.webgl1renderer=ca,t.webglcuberendertarget=qn,t.webglmultisamplerendertarget=bt,t.webglrendertarget=_t,t.webglrendertargetcube=function(t,e,n){return console.warn("three.webglrendertargetcube( width, height, options ) is now webglcuberendertarget( size, options )."),new qn(t,n)},t.webglrenderer=sa,t.webglutils=ea,t.wireframegeometry=hs,t.wireframehelper=function(t,e){return console.warn("three.wireframehelper has been removed. use three.wireframegeometry instead."),new io(new hs(t.geometry),new za({color:void 0!==e?e:16777215}))},t.wraparoundending=v,t.xhrloader=function(t){return console.warn("three.xhrloader has been renamed to three.fileloader."),new _c(t)},t.zerocurvatureending=h,t.zerofactor=200,t.zeroslopeending=k,t.zerostencilop=0,t.srgbencoding=x,object.defineproperty(t,"__esmodule",{value:!0})}));